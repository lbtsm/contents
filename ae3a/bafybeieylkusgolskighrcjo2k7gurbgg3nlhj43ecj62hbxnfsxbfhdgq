"use strict";const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(v){let A=0;const E=[],R=[],B={baseUrl:""},O={};function c(v,E,R){let B=null,z={},M=null;"function"==typeof v?z=v:"string"==typeof v?(B=v,"function"==typeof E?z=E:E instanceof Array&&(M=E,z=R)):v instanceof Array&&(M=v,"function"==typeof E&&(z=E)),M=M||["require","exports","module"],null===B&&(B="unnamed-module-"+A++),B=g(B),M=(M||[]).map((v=>function(v,A){return v?b(A,v):A}(B,v))),O[B]||(O[B]={name:B,parent:null,dclamd:1,dependencies:M,handlers:[],exports:{},dependants:new Set}),O[B].dependencies=M,p(M,(function(v){const A=O[B];if(!A)throw new Error("Could not access registered module "+B);let E=A.exports;E="function"==typeof z?z.apply(globalObject,v)||E:z,A.exports=E,d(B)}),(v=>{if("function"!=typeof onerror)throw v;onerror(v)}),B)}function d(v){const A=O[v];if(!A)throw new Error("Could not access registered module "+v);A.dclamd=2;const E=A.handlers;if(E&&E.length)for(let A=0;A<E.length;A++)E[A](O[v])}function u(v,A,E){if(!O[v])return null;if(v===A||50===E)return[v];const R=O[v].dependencies;for(let B=0,O=R.length;B<O;B++){const O=u(R[B],A,E+1);if(null!==O)return O.push(v),O}return null}function a(v,A){const E=O[v];if(!E)return!1;const R={};for(const v in O)R[v]=!1;const B=[];for(B.push(E),R[v]=!0;B.length>0;){const v=B.shift().dependencies;if(v)for(let E=0,z=v.length;E<z;E++){const z=v[E];if(z===A)return!0;const M=O[z];M&&!R[z]&&(R[z]=!0,B.push(M))}}return!1}function p(v,A,E,B){const z=new Array(v.length).fill(null);let M=0,W=!1;if("string"==typeof v){if(O[v]){if(1===O[v].dclamd)throw new Error(`Trying to load ${v} from ${B}. The first module is still loading.`);return O[v]}throw new Error(v+" has not been defined. Please include it as a dependency in "+B+"'s define()")}const V=v.length;for(let H=0;H<V;H++)switch(v[H]){case"require":const h=function(v,A,E){return p(v,A,E,B)};h.toUrl=function(v){return b(v,B)},z[H]=h,M++;break;case"exports":if(!O[B])throw new Error("Parent module "+B+" not registered yet");z[H]=O[B].exports,M++;break;case"module":z[H]={id:B,uri:b(B)},M++;break;default:{const Q=v[H],m=()=>{z[H]=O[Q].exports,M++,M===V&&A&&(W=!0,A(z))};if(a(Q,B)){const v=u(Q,B,0);v&&(v.reverse(),v.push(Q),R.push(v)),w(Q,(()=>{}),E,B),m()}else w(Q,m,E,B);break}}!W&&M===V&&A&&A(z)}function h(v,A){return function(){return dcl.callRpc(v,A.name,E.slice.call(arguments,0))}}function w(v,A,E,R){if(O[v])return O[v].dependants.add(R),void(1===O[v].dclamd?A&&O[v].handlers.push(A):A&&A(O[v]));if(O[v]={name:v,parent:R,dclamd:1,handlers:[A],dependencies:[],dependants:new Set([R]),exports:{}},0===v.indexOf("@")){const A=O[v].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(v,A).then((E=>{for(const v in E.methods){const R=E.methods[v];A[R.name]=h(E.rpcHandle,R)}d(v)})).catch((v=>{E(v)}))}}function g(v){let A,E=v;for(A=/\/\.\//;A.test(E);)E=E.replace(A,"/");for(E=E.replace(/^\.\//g,""),A=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;A.test(E);)E=E.replace(A,"/");return E=E.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),E=E.replace(/^\//g,""),E}function b(v,A){switch(v){case"require":case"exports":case"module":return v}return A?function(v,A){let E=v;if(!E.startsWith("@")&&(E.startsWith("./")||E.startsWith("../"))){const v=A.split("/");v.pop(),E=g(v.join("/")+"/"+E)}return E}(v,A):g(v)}v.config=function(v){if("object"==typeof v)for(const A in v)v.hasOwnProperty(A)&&(B[A]=v[A])},v.define=c,function(v){v.amd={},v.modules=O}(c=v.define||(v.define={})),v.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const v=new Set,A=[];for(const E in O)O[E]&&(1===O[E].dclamd&&A.push(O[E]),O[E].dependencies.forEach((A=>{"require"!==A&&"exports"!==A&&"module"!==A&&(O[A]||v.add(A))})));const E=[];if(R.length&&E.push(`\n> Cyclic dependencies: ${R.map((v=>"\n  - "+v.join(" -> "))).join("")}`),v.size&&E.push(`\n> Undeclared/unknown modules: ${Array.from(v).map((v=>"\n  - "+v)).join("")}`),A.length&&E.push(`\n> These modules didn't load: ${A.map((v=>"\n  - "+v.name)).join("")}.\n`),E.length)throw new Error(E.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(v){var A=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(v){return v.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(v){return v.firstPersonCameraEntity}},t}(),n=function(v,A){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(v[E]=A[E])})(v,A)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function i(v,A){if("function"!=typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function i(){this.constructor=v}n(v,A),v.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}var o=function(){return(o=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var B in A=arguments[E])Object.prototype.hasOwnProperty.call(A,B)&&(v[B]=A[B]);return v}).apply(this,arguments)};function r(v,A,E,R){var B,O=arguments.length,z=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,A,E,R);else for(var M=v.length-1;M>=0;M--)(B=v[M])&&(z=(O<3?B(z):O>3?B(A,E,z):B(A,E))||z);return O>3&&z&&Object.defineProperty(A,E,z),z}function s(v,A){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(v,A)}function h(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(v,A){var E="function"==typeof Symbol&&v[Symbol.iterator];if(!E)return v;var R,B,O=E.call(v),z=[];try{for(;(void 0===A||A-- >0)&&!(R=O.next()).done;)z.push(R.value)}catch(v){B={error:v}}finally{try{R&&!R.done&&(E=O.return)&&E.call(O)}finally{if(B)throw B.error}}return z}function p(v,A){for(var E=0,R=A.length,B=v.length;E<R;E++,B++)v[B]=A[E];return v}var E=0;function c(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];"undefined"!=typeof dcl?dcl.log.apply(dcl,p([],l(v))):console.log.apply(console,p(["DEBUG:"],l(v)))}function y(v,A){"undefined"!=typeof dcl?dcl.error(v,A):console.error("ERROR:",v,A)}function f(v){if(E++,0===v.length)throw new Error("newId(type: string): type cannot be empty");return v+E.toString(36)}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(v){var A=16*Math.random()|0;return("x"===v?A:3&A|8).toString(16)}))}var R=[];function _(v){if(!("__event_name__"in v)||"string"!=typeof v.__event_name__)throw new Error("The EventConstructor is not registered");return v.__event_name__}var B=function(){function t(){this.listeners={}}return t.prototype.addListener=function(v,A,E){if(!v||"function"!=typeof v)throw new Error("Invalid EventConstructor");var R=_(v),B=this.listeners[R];B||(B=this.listeners[R]=[]);for(var O=0;O<B.length;O++)if(B[O].listener===A)throw new Error("The provided listener is already registered");return B.push({listener:A,fn:E}),this},t.prototype.removeListener=function(v,A){if(!A||"function"!=typeof A)throw new Error("Invalid EventConstructor");var E=_(A),R=this.listeners[E];if(!R)return!1;for(var B=0;B<R.length;B++)if(R[B].listener===v)return R.splice(B,1),!0;return!1},t.prototype.fireEvent=function(v){var A=_(v.constructor),E=this.listeners[A];if(E)for(var R=0;R<E.length;R++)try{var B=E[R];B.fn.call(B.listener,v)}catch(v){y(v)}return this},t}();function x(){var v=f("EV");if(-1!==R.indexOf(v))throw new Error("The event name "+v+" is already taken");return R.push(v),function(A){return A.__event_name__=v,A}}var O,z=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,A,E){this.entity=v,this.componentName=A,this.component=E})),M=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,A,E){this.entity=v,this.componentName=A,this.classId=E})),W=r([x(),s("design:paramtypes",[Object,Object])],(function(v,A){this.entity=v,this.parent=A}));v.UIValueType=void 0,(O=v.UIValueType||(v.UIValueType={}))[O.PERCENT=0]="PERCENT",O[O.PIXELS=1]="PIXELS";var V=function(){function e(A){if(this.type=v.UIValueType.PIXELS,"string"==typeof A){var E=A;E.indexOf("px")>-1?this.type=v.UIValueType.PIXELS:E.indexOf("%")>-1&&(this.type=v.UIValueType.PERCENT),this.value=parseFloat(E)}else this.value=A}return e.prototype.toString=function(){var A=this.value.toString();return this.type===v.UIValueType.PERCENT?A+="%":A+="px",A},e}(),H="__name__symbol_",Q="__classId__symbol_",Z="__component__id_",K=r([x(),s("design:paramtypes",[String,String,Number])],(function(v,A,E){this.componentId=v,this.componentName=A,this.classId=E})),J=r([x(),s("design:paramtypes",[String])],(function(v){this.componentId=v})),$=r([x(),s("design:paramtypes",[String,Object])],(function(v,A){this.componentId=v,this.component=A}));function P(v,A){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+v);var R=E,o=function(){var E=Array.prototype.slice.call(arguments),B=new(R.bind.apply(R,p([void 0],l(E))));return Object.defineProperty(B,H,{enumerable:!1,writable:!1,configurable:!1,value:v}),void 0!==A&&Object.defineProperty(B,Q,{enumerable:!1,writable:!1,configurable:!1,value:A}),B};return void 0!==A&&(o.__classId__symbol_=A),o.__name__symbol_=v,o.isComponent=!0,o.originalClassName=v,(o.prototype=E.prototype).constructor=E,o}}function N(v,A){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+v);if("number"!=typeof A||isNaN(A))throw new Error("classId: "+A+" is an invalid integer");var R=E,o=function(){if(!N.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var E=Array.prototype.slice.call(arguments),B=new(R.bind.apply(R,p([void 0],l(E)))),O=f("C");return Object.defineProperty(B,H,{enumerable:!1,writable:!1,configurable:!1,value:v}),Object.defineProperty(B,Z,{enumerable:!1,writable:!1,configurable:!1,value:O}),void 0!==A&&Object.defineProperty(B,Q,{enumerable:!1,writable:!1,configurable:!1,value:A}),N.engine&&N.engine.registerComponent(B),B};return void 0!==A&&(o.__classId__symbol_=A),o.__name__symbol_=v,o.isComponent=!0,o.isDisposableComponent=!0,o.originalClassName=v,(o.prototype=E.prototype).constructor=E,o}}function F(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__name__symbol_)return v.__name__symbol_;throw new TypeError(v+" is not a registered component.")}function L(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__classId__symbol_)return v.__classId__symbol_;if(!v.__name__symbol_)throw new TypeError(v+" is not a registered component.");return null}function D(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__component__id_)return v.__component__id_;throw new TypeError(v+" is not a registered disposable component.")}!function(v){v.engine=null}(N||(N={}));var et=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(v,A){if(delete v[A]){var E=A+"_"+Math.random();v[E]=void 0,Object.defineProperty(v,E,o(o({},Object.getOwnPropertyDescriptor(v,E)),{enumerable:!1})),Object.defineProperty(v,A.toString(),{get:function(){return this[E]},set:function(v){var R=this[E];if(this.data[A]=v?D(v):null,this[E]=v,v!==R){this.dirty=!0;for(var B=0;B<this.subscriptions.length;B++)this.subscriptions[B](A,v,R)}},enumerable:!0})}},t.field=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){return this.data[A]},set:function(v){var E=this.data[A];if(this.data[A]=v,v!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](A,v,E)}},enumerable:!0})},t.uiValue=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){return this.data[A].toString()},set:function(v){var E=this.data[A],R=new V(v);if(this.data[A]=R,R!==E){this.dirty=!0;for(var B=0;B<this.subscriptions.length;B++)this.subscriptions[B](A,R,E)}},enumerable:!0})},t.readonly=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){if(A in this.data==0)throw new Error("The field "+A+" is uninitialized");return this.data[A]},set:function(v){if(A in this.data)throw new Error("The field "+A+" is readonly");this.data[A]=v,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(v){return this.subscriptions.push(v),this},t.prototype.toJSON=function(){return this.data},t}();function U(v){return Z in v}var nt=function(){function t(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];if(this.entities=[],this.active=!1,this._requiresNames=[],!v)throw new Error("ComponentGroup: Could not load the requires list");if(!(v instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return v.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(A){var R=v[A],B=null;if(!R)throw new Error("ComponentGroup: the required component at location "+A+" is invalid");try{B=F(R)}catch(v){throw new Error("ComponentGroup: the required component at location "+A+" is not registered as a @Component. Remember to provide the class of the component, not the name")}if(E._requiresNames.some((function(v){return v===B})))throw new Error("ComponentGroup: the required component list has a repeated name "+B);E._requiresNames.push(B)},E=this,R=0;R<v.length;R++)n(R)}return t.prototype.hasEntity=function(v){return!!v.isAddedToEngine()&&-1!==this.entities.indexOf(v)},t.prototype.addEntity=function(v){if(!v.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(v)&&this.entities.push(v)},t.prototype.removeEntity=function(v){var A=this.entities.indexOf(v);-1!==A&&this.entities.splice(A,1)},t.prototype.componentRemoved=function(v,A){-1!==this._requiresNames.indexOf(A)&&this.removeEntity(v)},t.prototype.meetsRequirements=function(v){for(var A=0;A<this._requiresNames.length;A++)if(!(this._requiresNames[A]in v.components))return!1;return!0},t}(),it=function(){function t(v){this.name=v,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(v){if("function"==typeof v)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof v)throw new Error("You passed a "+typeof v+", an instance of component is expected");var A=F(v);if(this.components[A]){if(this.components[A]===v)return v;this.removeComponent(this.components[A],!1)}return this.addComponent(v)},t.prototype.hasComponent=function(v){var A=typeof v;if("string"!==A&&"object"!==A&&"function"!==A)throw new Error("Entity#has(component): component is not a class, name or instance");if(null===v)return!1;var E="string"===A?v:F(v),R=this.components[E];return!!R&&("object"===A?R===v:"function"!==A||R instanceof v)},t.prototype.getComponent=function(v){var A=typeof v;if("string"!==A&&"function"!==A)throw new Error("Entity#get(component): component is not a class or name");var E="string"===A?v:F(v),R=this.components[E];if(!R)throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'"');if("function"===A){if(R instanceof v)return R;throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'" (by instance)')}return R},t.prototype.getComponentOrNull=function(v){var A=typeof v;if("string"!==A&&"function"!==A)throw new Error("Entity#getOrNull(component): component is not a class or name");var E="string"===A?v:F(v),R=this.components[E];return R?"function"===A?R instanceof v?R:null:R:null},t.prototype.getComponentOrCreate=function(v){if("function"!=typeof v)throw new Error("Entity#getOrCreate(component): component is not a class");var A=this.getComponentOrNull(v);return A||(F(A=new v),this.addComponentOrReplace(A)),A},t.prototype.addComponent=function(v){if("object"!=typeof v)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var A=F(v),E=L(v);if(this.components[A])throw new Error('A component of type "'+A+'" is already present in entity "'+this.identifier+'"');this.components[A]=v,this.eventManager&&this.eventManager.fireEvent(new M(this,A,E));var R=v;return"function"==typeof R.addedToEntity&&R.addedToEntity(this),v},t.prototype.removeComponent=function(v,A){void 0===A&&(A=!0);var E=typeof v;if("string"!==E&&"function"!==E&&"object"!==E)throw new Error("Entity#remove(component): component is not a class, class or name");var R="string"===E?v:F(v),B=this.components[R];if(B){if("function"===E)return B instanceof v?(delete this.components[R],void(B&&(A&&this.eventManager&&this.eventManager.fireEvent(new z(this,R,B)),"function"==typeof B.removedFromEntity&&B.removedFromEntity(this)))):void c('Entity Warning: Trying to remove wrong (by constructor) component "'+R+'" from entity "'+this.identifier+'"');delete this.components[R],B&&(A&&this.eventManager&&this.eventManager.fireEvent(new z(this,R,B)),"function"==typeof B.removedFromEntity&&B.removedFromEntity(this))}else c('Entity Warning: Trying to remove inexisting component "'+R+'" from entity "'+this.identifier+'"')},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(v){var A;if(v&&"getEntityRepresentation"in v){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");A=v.getEntityRepresentation(this.engine)}else A=!v&&this.engine?this.engine.rootEntity:v;var E=this.getParent();if(A===this)throw new Error('Failed to set parent for entity "'+this.identifier+"\": An entity can't set itself as a its own parent");if(A===E)return this;var R=this.getCircularAncestor(A);if(R)throw new Error('Failed to set parent for entity "'+this.identifier+'": Circular parent references are not allowed (See entity "'+R+'")');return E&&delete E.children[this.uuid],null!==A&&"0"!==A.uuid&&(!A.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),A.isAddedToEngine()&&!this.isAddedToEngine()&&A.engine.addEntity(this)),this._parent=A||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new W(this,A)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(v){for(var A=this.engine?this.engine.rootEntity:null,E=v;E&&E!==A;){var R=E.getParent();if(R===this)return E.uuid;E=R}return null},t.prototype.registerAsChild=function(){var v=this.getParent();this.uuid&&v&&(v.children[this.uuid]=this)},t}(),ot=function(){function t(v){this.eventManager=new B,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(M,this,this.componentAddedHandler),this.eventManager.addListener(z,this,this.componentRemovedHandler),this.rootEntity=v,this.firstPersonCameraEntity=new it,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new it,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(v){var A=v.getParent();if(v.isAddedToEngine())return v;for(var E in v.eventManager=this.eventManager,v.engine=this,this._entities[v.uuid]=v,this.checkRequirementsAndAdd(v),A?A.isAddedToEngine()||A===this.rootEntity||c("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+A.uuid):v.setParent(this.rootEntity),v.alive=!0,v.children){var R=v.children[E];R&&(R.isAddedToEngine()||this.addEntity(R))}return v},t.prototype.removeEntity=function(v){var A=v.uuid;if(v.isAddedToEngine()){for(var E in v.components){var R=this._componentGroups[E];if(R)for(var B in R)R[B].removeEntity(v);delete this.entityLists[E][A]}for(var O=0;O<this.simpleSystems.length;O++){var z=this.simpleSystems[O];z.onRemoveEntity&&z.onRemoveEntity(v)}for(var O in v.children){var M=v.children[O];M&&this.removeEntity(M)}return v.alive=!1,v.eventManager=null,delete this._entities[A],!0}for(var E in c("Engine: Trying to remove non existent entity from engine."),v.isAddedToEngine()?c("Engine: Entity id: "+A):c('Engine: Entity "'+v.uuid+'" has not been added to any engine yet.'),c("Engine: Entity's components:"),v.components)c(E);return!1},t.prototype.addSystem=function(v,A){if(void 0===A&&(A=0),-1!==this.addedSystems.indexOf(v))return c("Engine: Trying to add a system that is already added. Aborting"),v;if(this.systems.length>0)for(var E=0;E<this.systems.length;E++){var R=this.systems[E],B=E===this.systems.length-1;if(R.priority>A){this.addedSystems.push(v),this.systems.splice(E,0,{system:v,priority:A});break}if(B){this.addedSystems.push(v),this.systems.splice(E+1,0,{system:v,priority:A});break}}else this.addedSystems.push(v),this.systems.splice(1,0,{system:v,priority:A});return this.registerSystem(v),v},t.prototype.removeSystem=function(v){var A=this.addedSystems.indexOf(v);if(-1!==A){v.active=!1,v.deactivate&&v.deactivate(),this.addedSystems.splice(A,1);for(var E=0;E<this.systems.length;E++)this.systems[E].system===v&&this.systems.splice(E,1);return!0}return!1},t.prototype.update=function(v){for(var A in this.systems){var E=this.systems[A].system;if(E.active&&E.update)try{E.update(v)}catch(v){y(v)}}return this},t.prototype.getEntitiesWithComponent=function(v){var A="string"==typeof v?v:F(v);return A in this.entityLists?this.entityLists[A]:this.entityLists[A]={}},t.prototype.registerComponent=function(v){var A=D(v),E=F(v),R=L(v);this._disposableComponents[A]=v,null!==R&&(this.eventManager.fireEvent(new K(A,E,R)),this.eventManager.fireEvent(new $(A,v)))},t.prototype.disposeComponent=function(v){var A=D(v);return delete this._disposableComponents[A]&&(this.eventManager.fireEvent(new J(A)),v.onDispose&&v.onDispose(),!0)},t.prototype.updateComponent=function(v){this.eventManager.fireEvent(new $(D(v),v))},t.prototype.getComponentGroup=function(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];var E=void 0;if(v.length>0&&(W=this._componentGroups[F(v[0])]))for(var R=v.slice(),B=0;B<W.length;B++){var O=W[B];if(R.length===O.requires.length){for(var z=0;z<R.length&&-1!==O.requires.indexOf(R[z]);z++)z===R.length-1&&(E=O);if(E)break}}if(E)return E;(E=new(nt.bind.apply(nt,p([void 0],l(v))))).active=!0;var M=E.requiresNames;for(B=0;B<M.length;B++){var W,V=M[B];(W=this._componentGroups[V])||(this._componentGroups[V]=W=[]),-1===W.indexOf(E)&&W.push(E)}for(var H in this._entities)this.checkRequirements(this._entities[H],E);return E},t.prototype.removeComponentGroup=function(v){if(v.active){v.active=!1;for(var A=v.requiresNames,E=0;E<A.length;E++){var R=A[E],B=this._componentGroups[R];if(B){var O=B.indexOf(v);-1!==O&&B.splice(O,1)}}return!0}return!1},t.prototype.registerSystem=function(v){v.active=!0,v.activate&&v.activate(this),this.simpleSystems.push(v)},t.prototype.checkRequirementsAndAdd=function(v){if(v.isAddedToEngine()){for(var A in v.components){A in this.entityLists||(this.entityLists[A]={}),this.entityLists[A][v.uuid]=v;var E=this._componentGroups[A];if(E)for(var R in E)this.checkRequirements(v,E[R])}for(var B=0;B<this.simpleSystems.length;B++){var O=this.simpleSystems[B];O.onAddEntity&&O.onAddEntity(v)}}},t.prototype.checkRequirements=function(v,A){A.meetsRequirements(v)?A.hasEntity(v)||A.addEntity(v):A.hasEntity(v)&&A.removeEntity(v)},t.prototype.componentAddedHandler=function(v){var A,E=v.entity,R=v.componentName;if(E.isAddedToEngine()){this.entityLists[R]?this.entityLists[R][E.uuid]=E:this.entityLists[R]=((A={})[E.uuid]=E,A);var B=this._componentGroups[R];if(B)for(var O in B)this.checkRequirements(E,B[O])}},t.prototype.componentRemovedHandler=function(v){var A=v.entity,E=v.componentName;if(A.isAddedToEngine()){delete this.entityLists[E][A.uuid];var R=this._componentGroups[E];if(R)for(var B in R)this.checkRequirements(A,R[B])}},t}(),rt=Promise.resolve().then.bind(Promise.resolve());function G(v){var A=rt(v);return A.isComplete=!1,A.then((function(v){A.isComplete=!0,A.result=v,A.didFail=!1})).catch((function(v){A.isComplete=!0,A.error=v,A.didFail=!0,y("executeTask: FAILED "+v.toString(),v)})),A}var st,at,lt=function(){function t(v,A,E,R){void 0===A&&(A=!1),this.initalize(v,A,E,R)}return t.prototype.initalize=function(v,A,E,R){return void 0===A&&(A=!1),this.mask=v,this.skipNextObservers=A,this.target=E,this.currentTarget=R,this},t}(),Y=function(v,A,E){void 0===E&&(E=null),this.callback=v,this.mask=A,this.scope=E,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},ut=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(v,A,E,R){var B,O;void 0===E&&(E=-1),void 0===R&&(R=null);var z=new t;z._observers=new Array,z._observables=v;try{for(var M=h(v),W=M.next();!W.done;W=M.next()){var V=W.value.add(A,E,!1,R);V&&z._observers.push(V)}}catch(v){B={error:v}}finally{try{W&&!W.done&&(O=M.return)&&O.call(M)}finally{if(B)throw B.error}}return z},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var v=0;v<this._observers.length;v++)this._observables[v].remove(this._observers[v]);this._observers=null,this._observables=null},t}(),ht=function(){function t(v){this._observers=new Array,this._onObserverAdded=null,this._eventState=new lt(0),v&&(this._onObserverAdded=v)}return t.prototype.add=function(v,A,E,R,B){if(void 0===A&&(A=-1),void 0===E&&(E=!1),void 0===R&&(R=null),void 0===B&&(B=!1),!v)return null;var O=new Y(v,A,R);return O.unregisterOnNextCall=B,E?this._observers.unshift(O):this._observers.push(O),this._onObserverAdded&&this._onObserverAdded(O),O},t.prototype.addOnce=function(v){return this.add(v,void 0,void 0,void 0,!0)},t.prototype.remove=function(v){return!!v&&-1!==this._observers.indexOf(v)&&(this._deferUnregister(v),!0)},t.prototype.removeCallback=function(v,A){for(var E=0;E<this._observers.length;E++)if(this._observers[E].callback===v&&(!A||A===this._observers[E].scope))return this._deferUnregister(this._observers[E]),!0;return!1},t.prototype.notifyObservers=function(v,A,E,R){var B,O;if(void 0===A&&(A=-1),!this._observers.length)return!0;var z=this._eventState;z.mask=A,z.target=E,z.currentTarget=R,z.skipNextObservers=!1,z.lastReturnValue=v;try{for(var M=h(this._observers),W=M.next();!W.done;W=M.next()){var V=W.value;if(!V._willBeUnregistered&&(V.mask&A&&(V.scope?z.lastReturnValue=V.callback.apply(V.scope,[v,z]):z.lastReturnValue=V.callback(v,z),V.unregisterOnNextCall&&this._deferUnregister(V)),z.skipNextObservers))return!1}}catch(v){B={error:v}}finally{try{W&&!W.done&&(O=M.return)&&O.call(M)}finally{if(B)throw B.error}}return!0},t.prototype.notifyObserversWithPromise=function(v,A,E,R){var B=this;void 0===A&&(A=-1);var O=Promise.resolve(v);if(!this._observers.length)return O;var z=this._eventState;return z.mask=A,z.target=E,z.currentTarget=R,z.skipNextObservers=!1,this._observers.forEach((function(E){z.skipNextObservers||E._willBeUnregistered||E.mask&A&&(O=E.scope?O.then((function(A){return z.lastReturnValue=A,E.callback.apply(E.scope,[v,z])})):O.then((function(A){return z.lastReturnValue=A,E.callback(v,z)})),E.unregisterOnNextCall&&B._deferUnregister(E))})),O.then((function(){return v}))},t.prototype.notifyObserver=function(v,A,E){void 0===E&&(E=-1);var R=this._eventState;R.mask=E,R.skipNextObservers=!1,v.callback(A,R)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var v=new t;return v._observers=this._observers.slice(0),v},t.prototype.hasSpecificMask=function(v){var A,E;void 0===v&&(v=-1);try{for(var R=h(this._observers),B=R.next();!B.done;B=R.next()){var O=B.value;if(O.mask&v||O.mask===v)return!0}}catch(v){A={error:v}}finally{try{B&&!B.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}return!1},t.prototype._deferUnregister=function(v){var A=this;v.unregisterOnNextCall=!1,v._willBeUnregistered=!0,G((function(){return function(v,A,E,R){return new(E||(E=Promise))((function(A,B){function s(v){try{d(R.next(v))}catch(v){B(v)}}function a(v){try{d(R.throw(v))}catch(v){B(v)}}function d(v){var R;v.done?A(v.value):(R=v.value,R instanceof E?R:new E((function(v){v(R)}))).then(s,a)}d((R=R.apply(v,[])).next())}))}(A,0,void 0,(function(){return function(v,A){var E,R,B,O,z={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(M){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;z;)try{if(E=1,R&&(B=2&O[0]?R.return:O[0]?R.throw||((B=R.return)&&B.call(R),0):R.next)&&!(B=B.call(R,O[1])).done)return B;switch(R=0,B&&(O=[2&O[0],B.value]),O[0]){case 0:case 1:B=O;break;case 4:return z.label++,{value:O[1],done:!1};case 5:z.label++,R=O[1],O=[0];continue;case 7:O=z.ops.pop(),z.trys.pop();continue;default:if(!((B=(B=z.trys).length>0&&B[B.length-1])||6!==O[0]&&2!==O[0])){z=0;continue}if(3===O[0]&&(!B||O[1]>B[0]&&O[1]<B[3])){z.label=O[1];break}if(6===O[0]&&z.label<B[1]){z.label=B[1],B=O;break}if(B&&z.label<B[2]){z.label=B[2],z.ops.push(O);break}B[2]&&z.ops.pop(),z.trys.pop();continue}O=A.call(v,z)}catch(v){O=[6,v],R=0}finally{E=B=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,M])}}}(this,(function(A){return[2,this._remove(v)]}))}))}))},t.prototype._remove=function(v){if(!v)return!1;var A=this._observers.indexOf(v);return-1!==A&&(this._observers.splice(A,1),!0)},t}(),ct=r([x(),s("design:paramtypes",[String,Object])],(function(v,A){this.uuid=v,this.payload=A})),pt=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v})),dt=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v}));function tt(v){return function(){at&&at.subscribe(v)}}var ft=new ht(tt("cameraModeChanged")),yt=new ht(tt("idleStateChanged")),gt=new ht(tt("onEnterScene")),vt=gt,bt=new ht(tt("onLeaveScene")),wt=bt,xt=new ht(tt("sceneStart")),Tt=new ht(tt("playerExpression")),At=new ht(tt("onPointerLock")),St=new ht(tt("videoEvent")),Ct=new ht(tt("profileChanged")),_t=new ht(tt("playerConnected")),It=new ht(tt("playerDisconnected")),Rt=new ht(tt("onRealmChanged")),Pt=new ht(tt("playerClicked"));function mt(v){(at=v)&&at.onEvent((function(v){switch(v.type){case"onEnterScene":return void gt.notifyObservers(v.data);case"onLeaveScene":return void bt.notifyObservers(v.data);case"cameraModeChanged":return void ft.notifyObservers(v.data);case"idleStateChanged":return void yt.notifyObservers(v.data);case"sceneStart":return void xt.notifyObservers(v.data);case"playerExpression":return void Tt.notifyObservers(v.data);case"videoEvent":var A=v.data,E=N.engine.disposableComponents[A.componentId];return E&&E.update(A),void St.notifyObservers(A);case"profileChanged":return void Ct.notifyObservers(v.data);case"onPointerLock":return void At.notifyObservers(v.data);case"playerConnected":return void _t.notifyObservers(v.data);case"playerDisconnected":return void It.notifyObservers(v.data);case"onRealmChanged":return void Rt.notifyObservers(v.data);case"playerClicked":return void Pt.notifyObservers(v.data)}}))}var Bt=function(){function t(v){this.dcl=v,this.cachedComponents={}}return t.prototype.activate=function(v){var A=this;this.engine=v,v.eventManager.addListener(M,this,this.componentAdded),v.eventManager.addListener(z,this,this.componentRemoved),v.eventManager.addListener(K,this,this.disposableComponentCreated),v.eventManager.addListener(J,this,this.disposableComponentRemoved),v.eventManager.addListener($,this,this.disposableComponentUpdated),v.eventManager.addListener(W,this,this.parentChanged);var E=v.rootEntity.uuid;this.dcl.addEntity(E),this.dcl.onUpdate((function(E){v.update(E),A.presentEntities()})),this.dcl.onEvent((function(A){var E=A.data;switch(A.type){case"uuidEvent":v.eventManager.fireEvent(new ct(E.uuid,E.payload));break;case"raycastResponse":("HitFirst"===E.queryType||"HitAll"===E.queryType)&&v.eventManager.fireEvent(new pt(E));break;case"actionButtonEvent":v.eventManager.fireEvent(new dt(E.payload))}}))},t.prototype.onAddEntity=function(v){if(v&&v.isAddedToEngine()){var A=v.uuid,E=v.getParent();for(var R in this.dcl.addEntity(A),E&&this.dcl.setParent(A,E.uuid),this.cachedComponents[A]={},v.components){var B=v.components[R],O=L(B);if(null!==O)if(U(B))this.dcl.attachEntityComponent(v.uuid,R,D(B));else{var z=JSON.stringify(B);this.dcl.updateEntityComponent(A,R,O,z),this.cachedComponents[A][R]=z}}}},t.prototype.onRemoveEntity=function(v){if(v.isAddedToEngine()){var A=v.uuid;this.dcl.removeEntity(A),delete this.cachedComponents[A]}},t.prototype.presentEntities=function(){for(var v in this.engine.entities){var A=this.engine.entities[v];for(var E in A.components){var R=L(z=A.components[E]);if(null!==R&&!U(z)){var B=this.getJsonIfDirty(A.uuid,E,z);B&&(this.dcl.updateEntityComponent(A.uuid,E,R,B),this.clearDirty(A.uuid,E,z,B))}}}for(var O in this.engine.disposableComponents){var z;(z=this.engine.disposableComponents[O])instanceof et&&z.dirty&&(this.dcl.componentUpdated(O,JSON.stringify(z)),z.dirty=!1)}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var A=v.entity.components[v.componentName];if(U(A))this.dcl.attachEntityComponent(v.entity.uuid,v.componentName,D(A));else if(null!==v.classId){var E=JSON.stringify(A);this.dcl.updateEntityComponent(v.entity.uuid,v.componentName,v.classId,E),this.cachedComponents[v.entity.uuid][v.componentName]=E}}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(v.entity.uuid,v.componentName),delete this.cachedComponents[v.entity.uuid][v.componentName])},t.prototype.disposableComponentCreated=function(v){this.dcl.componentCreated(v.componentId,v.componentName,v.classId)},t.prototype.disposableComponentRemoved=function(v){this.dcl.componentDisposed(v.componentId)},t.prototype.disposableComponentUpdated=function(v){this.dcl.componentUpdated(v.componentId,JSON.stringify(v.component))},t.prototype.parentChanged=function(v){this.dcl.setParent(v.entity.uuid,v.parent?v.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(v,A,E){var R=JSON.stringify(E);return R!==this.cachedComponents[v][A]&&R},t.prototype.clearDirty=function(v,A,E,R){this.cachedComponents[v][A]=R},t}(),Ot="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},zt={},Nt={};!function(v){var A,E;Object.defineProperty(v,"__esModule",{value:!0}),v.RAD2DEG=v.DEG2RAD=v.Epsilon=v.ToLinearSpace=v.ToGammaSpace=v.Space=v.Orientation=void 0,(A=v.Orientation||(v.Orientation={}))[A.CW=0]="CW",A[A.CCW=1]="CCW",(E=v.Space||(v.Space={}))[E.LOCAL=0]="LOCAL",E[E.WORLD=1]="WORLD",E[E.BONE=2]="BONE",v.ToGammaSpace=1/2.2,v.ToLinearSpace=2.2,v.Epsilon=1e-6,v.DEG2RAD=Math.PI/180,v.RAD2DEG=360/(2*Math.PI)}(Nt);var Lt={},Ft={};Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.buildArray=void 0,Ft.buildArray=function(v,A){const E=[];for(let R=0;R<v;++R)E.push(A());return E};var kt={},Wt={},qt={},Vt={},Ut={};Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.Scalar=void 0;class Et{static WithinEpsilon(v,A,E=1401298e-51){const R=v-A;return-E<=R&&R<=E}static ToHex(v){const A=v.toString(16);return v<=15?("0"+A).toUpperCase():A.toUpperCase()}static Sign(v){const A=+v;return 0===A||isNaN(A)?A:A>0?1:-1}static Clamp(v,A=0,E=1){return Math.min(E,Math.max(A,v))}static Log2(v){return Math.log(v)*Math.LOG2E}static Repeat(v,A){return v-Math.floor(v/A)*A}static Normalize(v,A,E){return(v-A)/(E-A)}static Denormalize(v,A,E){return v*(E-A)+A}static DeltaAngle(v,A){let E=Et.Repeat(A-v,360);return E>180&&(E-=360),E}static PingPong(v,A){const E=Et.Repeat(v,2*A);return A-Math.abs(E-A)}static SmoothStep(v,A,E){let R=Et.Clamp(E);return R=-2*R*R*R+3*R*R,A*R+v*(1-R)}static MoveTowards(v,A,E){let R=0;return R=Math.abs(A-v)<=E?A:v+Et.Sign(A-v)*E,R}static MoveTowardsAngle(v,A,E){const R=Et.DeltaAngle(v,A);let B=0;return B=-E<R&&R<E?A:Et.MoveTowards(v,v+R,E),B}static Lerp(v,A,E){return v+(A-v)*E}static LerpAngle(v,A,E){let R=Et.Repeat(A-v,360);return R>180&&(R-=360),v+R*Et.Clamp(E)}static InverseLerp(v,A,E){let R=0;return R=v!==A?Et.Clamp((E-v)/(A-v)):0,R}static Hermite(v,A,E,R,B){const O=B*B,z=B*O;return v*(2*z-3*O+1)+E*(-2*z+3*O)+A*(z-2*O+B)+R*(z-O)}static RandomRange(v,A){return v===A?v:Math.random()*(A-v)+v}static RangeToPercent(v,A,E){return(v-A)/(E-A)}static PercentToRange(v,A,E){return(E-A)*v+A}static NormalizeRadians(v){return v-Et.TwoPi*Math.floor((v+Math.PI)/Et.TwoPi)}}Ut.Scalar=Et,Et.TwoPi=2*Math.PI,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.Vector4=void 0;const Ht=Nt,Gt=Ut,Yt=kt;class Mt{constructor(v,A,E,R){this.x=v,this.y=A,this.z=E,this.w=R}static Add(v,A){return new Mt(v.x,v.y,v.z,v.w).addInPlace(A)}static FromArray(v,A=0){return new Mt(v[A],v[A+1],v[A+2],v[A+3])}static FromArrayToRef(v,A,E){E.x=v[A],E.y=v[A+1],E.z=v[A+2],E.w=v[A+3]}static FromFloatArrayToRef(v,A,E){Mt.FromArrayToRef(v,A,E)}static FromFloatsToRef(v,A,E,R,B){B.x=v,B.y=A,B.z=E,B.w=R}static Zero(){return new Mt(0,0,0,0)}static One(){return new Mt(1,1,1,1)}static Normalize(v){const A=Mt.Zero();return Mt.NormalizeToRef(v,A),A}static NormalizeToRef(v,A){A.copyFrom(v),A.normalize()}static Minimize(v,A){const E=new Mt(v.x,v.y,v.z,v.w);return E.minimizeInPlace(A),E}static Maximize(v,A){const E=new Mt(v.x,v.y,v.z,v.w);return E.maximizeInPlace(A),E}static Distance(v,A){return Math.sqrt(Mt.DistanceSquared(v,A))}static DistanceSquared(v,A){const E=v.x-A.x,R=v.y-A.y,B=v.z-A.z,O=v.w-A.w;return E*E+R*R+B*B+O*O}static Center(v,A){const E=Mt.Add(v,A);return E.scaleInPlace(.5),E}static TransformNormal(v,A){const E=Mt.Zero();return Mt.TransformNormalToRef(v,A,E),E}static TransformNormalToRef(v,A,E){const R=A.m,B=v.x*R[0]+v.y*R[4]+v.z*R[8],O=v.x*R[1]+v.y*R[5]+v.z*R[9],z=v.x*R[2]+v.y*R[6]+v.z*R[10];E.x=B,E.y=O,E.z=z,E.w=v.w}static TransformNormalFromFloatsToRef(v,A,E,R,B,O){const z=B.m;O.x=v*z[0]+A*z[4]+E*z[8],O.y=v*z[1]+A*z[5]+E*z[9],O.z=v*z[2]+A*z[6]+E*z[10],O.w=R}toString(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"}getClassName(){return"Vector4"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,v[A+2]=this.z,v[A+3]=this.w,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}add(v){return new Mt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addToRef(v,A){return A.x=this.x+v.x,A.y=this.y+v.y,A.z=this.z+v.z,A.w=this.w+v.w,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this.w-=v.w,this}subtract(v){return new Mt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}subtractToRef(v,A){return A.x=this.x-v.x,A.y=this.y-v.y,A.z=this.z-v.z,A.w=this.w-v.w,this}subtractFromFloats(v,A,E,R){return new Mt(this.x-v,this.y-A,this.z-E,this.w-R)}subtractFromFloatsToRef(v,A,E,R,B){return B.x=this.x-v,B.y=this.y-A,B.z=this.z-E,B.w=this.w-R,this}negate(){return new Mt(-this.x,-this.y,-this.z,-this.w)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scale(v){return new Mt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,A.z=this.z*v,A.w=this.w*v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,A.z+=this.z*v,A.w+=this.w*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}equalsWithEpsilon(v,A=Ht.Epsilon){return v&&Gt.Scalar.WithinEpsilon(this.x,v.x,A)&&Gt.Scalar.WithinEpsilon(this.y,v.y,A)&&Gt.Scalar.WithinEpsilon(this.z,v.z,A)&&Gt.Scalar.WithinEpsilon(this.w,v.w,A)}equalsToFloats(v,A,E,R){return this.x===v&&this.y===A&&this.z===E&&this.w===R}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this.w*=v.w,this}multiply(v){return new Mt(this.x*v.x,this.y*v.y,this.z*v.z,this.w*v.w)}multiplyToRef(v,A){return A.x=this.x*v.x,A.y=this.y*v.y,A.z=this.z*v.z,A.w=this.w*v.w,this}multiplyByFloats(v,A,E,R){return new Mt(this.x*v,this.y*A,this.z*E,this.w*R)}divide(v){return new Mt(this.x/v.x,this.y/v.y,this.z/v.z,this.w/v.w)}divideToRef(v,A){return A.x=this.x/v.x,A.y=this.y/v.y,A.z=this.z/v.z,A.w=this.w/v.w,this}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return v.x<this.x&&(this.x=v.x),v.y<this.y&&(this.y=v.y),v.z<this.z&&(this.z=v.z),v.w<this.w&&(this.w=v.w),this}maximizeInPlace(v){return v.x>this.x&&(this.x=v.x),v.y>this.y&&(this.y=v.y),v.z>this.z&&(this.z=v.z),v.w>this.w&&(this.w=v.w),this}floor(){return new Mt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return new Mt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){const v=this.length();return 0===v?this:this.scaleInPlace(1/v)}toVector3(){return new Yt.Vector3(this.x,this.y,this.z)}clone(){return new Mt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,A,E,R){return this.x=v,this.y=A,this.z=E,this.w=R,this}set(v,A,E,R){return this.copyFromFloats(v,A,E,R)}setAll(v){return this.x=this.y=this.z=this.w=v,this}}Vt.Vector4=Mt,Object.defineProperty(qt,"__esModule",{value:!0}),qt.Matrix=void 0;const Qt=kt,Zt=Wt,Kt=Lt,Jt=Vt;class Dt{constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}get m(){return this._m}static get IdentityReadOnly(){return Dt._identityReadOnly}static FromArray(v,A=0){const E=new Dt;return Dt.FromArrayToRef(v,A,E),E}static FromArrayToRef(v,A,E){for(let R=0;R<16;R++)E._m[R]=v[R+A];E._markAsUpdated()}static FromFloatArrayToRefScaled(v,A,E,R){for(let B=0;B<16;B++)R._m[B]=v[B+A]*E;R._markAsUpdated()}static FromValuesToRef(v,A,E,R,B,O,z,M,W,V,H,Q,Z,K,J,$,et){const nt=et._m;nt[0]=v,nt[1]=A,nt[2]=E,nt[3]=R,nt[4]=B,nt[5]=O,nt[6]=z,nt[7]=M,nt[8]=W,nt[9]=V,nt[10]=H,nt[11]=Q,nt[12]=Z,nt[13]=K,nt[14]=J,nt[15]=$,et._markAsUpdated()}static FromValues(v,A,E,R,B,O,z,M,W,V,H,Q,Z,K,J,$){const et=new Dt,nt=et._m;return nt[0]=v,nt[1]=A,nt[2]=E,nt[3]=R,nt[4]=B,nt[5]=O,nt[6]=z,nt[7]=M,nt[8]=W,nt[9]=V,nt[10]=H,nt[11]=Q,nt[12]=Z,nt[13]=K,nt[14]=J,nt[15]=$,et._markAsUpdated(),et}static Compose(v,A,E){const R=new Dt;return Dt.ComposeToRef(v,A,E,R),R}static ComposeToRef(v,A,E,R){Dt.ScalingToRef(v.x,v.y,v.z,Kt.MathTmp.Matrix[1]),A.toRotationMatrix(Kt.MathTmp.Matrix[0]),Kt.MathTmp.Matrix[1].multiplyToRef(Kt.MathTmp.Matrix[0],R),R.setTranslation(E)}static Identity(){const v=Dt.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return v._updateIdentityStatus(!0),v}static IdentityToRef(v){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,v),v._updateIdentityStatus(!0)}static Zero(){const v=Dt.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return v._updateIdentityStatus(!1),v}static RotationX(v){const A=new Dt;return Dt.RotationXToRef(v,A),A}static Invert(v){const A=new Dt;return v.invertToRef(A),A}static RotationXToRef(v,A){const E=Math.sin(v),R=Math.cos(v);Dt.FromValuesToRef(1,0,0,0,0,R,E,0,0,-E,R,0,0,0,0,1,A),A._updateIdentityStatus(1===R&&0===E)}static RotationY(v){const A=new Dt;return Dt.RotationYToRef(v,A),A}static RotationYToRef(v,A){const E=Math.sin(v),R=Math.cos(v);Dt.FromValuesToRef(R,0,-E,0,0,1,0,0,E,0,R,0,0,0,0,1,A),A._updateIdentityStatus(1===R&&0===E)}static RotationZ(v){const A=new Dt;return Dt.RotationZToRef(v,A),A}static RotationZToRef(v,A){const E=Math.sin(v),R=Math.cos(v);Dt.FromValuesToRef(R,E,0,0,-E,R,0,0,0,0,1,0,0,0,0,1,A),A._updateIdentityStatus(1===R&&0===E)}static RotationAxis(v,A){const E=new Dt;return Dt.RotationAxisToRef(v,A,E),E}static RotationAxisToRef(v,A,E){const R=Math.sin(-A),B=Math.cos(-A),O=1-B;v.normalize();const z=E._m;z[0]=v.x*v.x*O+B,z[1]=v.x*v.y*O-v.z*R,z[2]=v.x*v.z*O+v.y*R,z[3]=0,z[4]=v.y*v.x*O+v.z*R,z[5]=v.y*v.y*O+B,z[6]=v.y*v.z*O-v.x*R,z[7]=0,z[8]=v.z*v.x*O-v.y*R,z[9]=v.z*v.y*O+v.x*R,z[10]=v.z*v.z*O+B,z[11]=0,z[12]=0,z[13]=0,z[14]=0,z[15]=1,E._markAsUpdated()}static RotationYawPitchRoll(v,A,E){const R=new Dt;return Dt.RotationYawPitchRollToRef(v,A,E,R),R}static RotationYawPitchRollToRef(v,A,E,R){Zt.Quaternion.RotationYawPitchRollToRef(v,A,E,Kt.MathTmp.Quaternion[0]),Kt.MathTmp.Quaternion[0].toRotationMatrix(R)}static Scaling(v,A,E){const R=new Dt;return Dt.ScalingToRef(v,A,E,R),R}static ScalingToRef(v,A,E,R){Dt.FromValuesToRef(v,0,0,0,0,A,0,0,0,0,E,0,0,0,0,1,R),R._updateIdentityStatus(1===v&&1===A&&1===E)}static Translation(v,A,E){const R=new Dt;return Dt.TranslationToRef(v,A,E,R),R}static TranslationToRef(v,A,E,R){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v,A,E,1,R),R._updateIdentityStatus(0===v&&0===A&&0===E)}static Lerp(v,A,E){const R=new Dt;return Dt.LerpToRef(v,A,E,R),R}static LerpToRef(v,A,E,R){for(let B=0;B<16;B++)R._m[B]=v._m[B]*(1-E)+A._m[B]*E;R._markAsUpdated()}static DecomposeLerp(v,A,E){const R=new Dt;return Dt.DecomposeLerpToRef(v,A,E,R),R}static DecomposeLerpToRef(v,A,E,R){const B=Kt.MathTmp.Vector3[0],O=Kt.MathTmp.Quaternion[0],z=Kt.MathTmp.Vector3[1];v.decompose(B,O,z);const M=Kt.MathTmp.Vector3[2],W=Kt.MathTmp.Quaternion[1],V=Kt.MathTmp.Vector3[3];A.decompose(M,W,V);const H=Kt.MathTmp.Vector3[4];Qt.Vector3.LerpToRef(B,M,E,H);const Q=Kt.MathTmp.Quaternion[2];Zt.Quaternion.SlerpToRef(O,W,E,Q);const Z=Kt.MathTmp.Vector3[5];Qt.Vector3.LerpToRef(z,V,E,Z),Dt.ComposeToRef(H,Q,Z,R)}static LookAtLH(v,A,E){const R=new Dt;return Dt.LookAtLHToRef(v,A,E,R),R}static LookAtLHToRef(v,A,E,R){const B=Kt.MathTmp.Vector3[0],O=Kt.MathTmp.Vector3[1],z=Kt.MathTmp.Vector3[2];A.subtractToRef(v,z),z.normalize(),Qt.Vector3.CrossToRef(E,z,B);const M=B.lengthSquared();0===M?B.x=1:B.normalizeFromLength(Math.sqrt(M)),Qt.Vector3.CrossToRef(z,B,O),O.normalize();const W=-Qt.Vector3.Dot(B,v),V=-Qt.Vector3.Dot(O,v),H=-Qt.Vector3.Dot(z,v);Dt.FromValuesToRef(B.x,O.x,z.x,0,B.y,O.y,z.y,0,B.z,O.z,z.z,0,W,V,H,1,R)}static LookAtRH(v,A,E){const R=new Dt;return Dt.LookAtRHToRef(v,A,E,R),R}static LookAtRHToRef(v,A,E,R){const B=Kt.MathTmp.Vector3[0],O=Kt.MathTmp.Vector3[1],z=Kt.MathTmp.Vector3[2];v.subtractToRef(A,z),z.normalize(),Qt.Vector3.CrossToRef(E,z,B);const M=B.lengthSquared();0===M?B.x=1:B.normalizeFromLength(Math.sqrt(M)),Qt.Vector3.CrossToRef(z,B,O),O.normalize();const W=-Qt.Vector3.Dot(B,v),V=-Qt.Vector3.Dot(O,v),H=-Qt.Vector3.Dot(z,v);Dt.FromValuesToRef(B.x,O.x,z.x,0,B.y,O.y,z.y,0,B.z,O.z,z.z,0,W,V,H,1,R)}static OrthoLH(v,A,E,R){const B=new Dt;return Dt.OrthoLHToRef(v,A,E,R,B),B}static OrthoLHToRef(v,A,E,R,B){const O=2/v,z=2/A,M=2/(R-E),W=-(R+E)/(R-E);Dt.FromValuesToRef(O,0,0,0,0,z,0,0,0,0,M,0,0,0,W,1,B),B._updateIdentityStatus(1===O&&1===z&&1===M&&0===W)}static OrthoOffCenterLH(v,A,E,R,B,O){const z=new Dt;return Dt.OrthoOffCenterLHToRef(v,A,E,R,B,O,z),z}static OrthoOffCenterLHToRef(v,A,E,R,B,O,z){const M=2/(A-v),W=2/(R-E),V=2/(O-B),H=-(O+B)/(O-B),Q=(v+A)/(v-A),Z=(R+E)/(E-R);Dt.FromValuesToRef(M,0,0,0,0,W,0,0,0,0,V,0,Q,Z,H,1,z),z._markAsUpdated()}static OrthoOffCenterRH(v,A,E,R,B,O){const z=new Dt;return Dt.OrthoOffCenterRHToRef(v,A,E,R,B,O,z),z}static OrthoOffCenterRHToRef(v,A,E,R,B,O,z){Dt.OrthoOffCenterLHToRef(v,A,E,R,B,O,z),z._m[10]*=-1}static PerspectiveLH(v,A,E,R){const B=new Dt,O=2*E/v,z=2*E/A,M=(R+E)/(R-E),W=-2*R*E/(R-E);return Dt.FromValuesToRef(O,0,0,0,0,z,0,0,0,0,M,1,0,0,W,0,B),B._updateIdentityStatus(!1),B}static PerspectiveFovLH(v,A,E,R){const B=new Dt;return Dt.PerspectiveFovLHToRef(v,A,E,R,B),B}static PerspectiveFovLHToRef(v,A,E,R,B,O=!0){const z=E,M=R,W=1/Math.tan(.5*v),V=O?W/A:W,H=O?W:W*A,Q=(M+z)/(M-z),Z=-2*M*z/(M-z);Dt.FromValuesToRef(V,0,0,0,0,H,0,0,0,0,Q,1,0,0,Z,0,B),B._updateIdentityStatus(!1)}static PerspectiveFovRH(v,A,E,R){const B=new Dt;return Dt.PerspectiveFovRHToRef(v,A,E,R,B),B}static PerspectiveFovRHToRef(v,A,E,R,B,O=!0){const z=E,M=R,W=1/Math.tan(.5*v),V=O?W/A:W,H=O?W:W*A,Q=-(M+z)/(M-z),Z=-2*M*z/(M-z);Dt.FromValuesToRef(V,0,0,0,0,H,0,0,0,0,Q,-1,0,0,Z,0,B),B._updateIdentityStatus(!1)}static PerspectiveFovWebVRToRef(v,A,E,R,B=!1){const O=B?-1:1,z=Math.tan(v.upDegrees*Math.PI/180),M=Math.tan(v.downDegrees*Math.PI/180),W=Math.tan(v.leftDegrees*Math.PI/180),V=Math.tan(v.rightDegrees*Math.PI/180),H=2/(W+V),Q=2/(z+M),Z=R._m;Z[0]=H,Z[1]=Z[2]=Z[3]=Z[4]=0,Z[5]=Q,Z[6]=Z[7]=0,Z[8]=(W-V)*H*.5,Z[9]=-(z-M)*Q*.5,Z[10]=-E/(A-E),Z[11]=1*O,Z[12]=Z[13]=Z[15]=0,Z[14]=-2*E*A/(E-A),R._markAsUpdated()}static GetAsMatrix2x2(v){return[v._m[0],v._m[1],v._m[4],v._m[5]]}static GetAsMatrix3x3(v){return[v._m[0],v._m[1],v._m[2],v._m[4],v._m[5],v._m[6],v._m[8],v._m[9],v._m[10]]}static Transpose(v){const A=new Dt;return Dt.TransposeToRef(v,A),A}static TransposeToRef(v,A){const E=A._m,R=v._m;E[0]=R[0],E[1]=R[4],E[2]=R[8],E[3]=R[12],E[4]=R[1],E[5]=R[5],E[6]=R[9],E[7]=R[13],E[8]=R[2],E[9]=R[6],E[10]=R[10],E[11]=R[14],E[12]=R[3],E[13]=R[7],E[14]=R[11],E[15]=R[15],A._updateIdentityStatus(v._isIdentity,v._isIdentityDirty)}static Reflection(v){const A=new Dt;return Dt.ReflectionToRef(v,A),A}static ReflectionToRef(v,A){v.normalize();const E=v.normal.x,R=v.normal.y,B=v.normal.z,O=-2*E,z=-2*R,M=-2*B;Dt.FromValuesToRef(O*E+1,z*E,M*E,0,O*R,z*R+1,M*R,0,O*B,z*B,M*B+1,0,O*v.d,z*v.d,M*v.d,1,A)}static FromXYZAxesToRef(v,A,E,R){Dt.FromValuesToRef(v.x,v.y,v.z,0,A.x,A.y,A.z,0,E.x,E.y,E.z,0,0,0,0,1,R)}static FromQuaternionToRef(v,A){const E=v.x*v.x,R=v.y*v.y,B=v.z*v.z,O=v.x*v.y,z=v.z*v.w,M=v.z*v.x,W=v.y*v.w,V=v.y*v.z,H=v.x*v.w;A._m[0]=1-2*(R+B),A._m[1]=2*(O+z),A._m[2]=2*(M-W),A._m[3]=0,A._m[4]=2*(O-z),A._m[5]=1-2*(B+E),A._m[6]=2*(V+H),A._m[7]=0,A._m[8]=2*(M+W),A._m[9]=2*(V-H),A._m[10]=1-2*(R+E),A._m[11]=0,A._m[12]=0,A._m[13]=0,A._m[14]=0,A._m[15]=1,A._markAsUpdated()}_markAsUpdated(){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const v=this._m;this._isIdentity=1===v[0]&&0===v[1]&&0===v[2]&&0===v[3]&&0===v[4]&&1===v[5]&&0===v[6]&&0===v[7]&&0===v[8]&&0===v[9]&&1===v[10]&&0===v[11]&&0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const v=this._m,A=v[0],E=v[1],R=v[2],B=v[3],O=v[4],z=v[5],M=v[6],W=v[7],V=v[8],H=v[9],Q=v[10],Z=v[11],K=v[12],J=v[13],$=v[14],et=v[15],nt=Q*et-$*Z,it=H*et-J*Z,ot=H*$-J*Q,rt=V*et-K*Z,st=V*$-Q*K,at=V*J-K*H;return A*+(z*nt-M*it+W*ot)+E*-(O*nt-M*rt+W*st)+R*+(O*it-z*rt+W*at)+B*-(O*ot-z*st+M*at)}toArray(){return this._m}asArray(){return this._m}invert(){return this.invertToRef(this),this}reset(){return Dt.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(v){const A=new Dt;return this.addToRef(v,A),A}addToRef(v,A){for(let E=0;E<16;E++)A._m[E]=this._m[E]+v._m[E];return A._markAsUpdated(),this}addToSelf(v){for(let A=0;A<16;A++)this._m[A]+=v._m[A];return this._markAsUpdated(),this}invertToRef(v){if(!0===this._isIdentity)return Dt.IdentityToRef(v),this;const A=this._m,E=A[0],R=A[1],B=A[2],O=A[3],z=A[4],M=A[5],W=A[6],V=A[7],H=A[8],Q=A[9],Z=A[10],K=A[11],J=A[12],$=A[13],et=A[14],nt=A[15],it=Z*nt-et*K,ot=Q*nt-$*K,rt=Q*et-$*Z,st=H*nt-J*K,at=H*et-Z*J,lt=H*$-J*Q,ut=+(M*it-W*ot+V*rt),ht=-(z*it-W*st+V*at),ct=+(z*ot-M*st+V*lt),pt=-(z*rt-M*at+W*lt),dt=E*ut+R*ht+B*ct+O*pt;if(0===dt)return v.copyFrom(this),this;const ft=1/dt,yt=W*nt-et*V,gt=M*nt-$*V,vt=M*et-$*W,bt=z*nt-J*V,wt=z*et-J*W,xt=z*$-J*M,Tt=W*K-Z*V,At=M*K-Q*V,St=M*Z-Q*W,Ct=z*K-H*V,_t=z*Z-H*W,It=z*Q-H*M,Rt=-(R*it-B*ot+O*rt),Pt=+(E*it-B*st+O*at),Bt=-(E*ot-R*st+O*lt),Ot=+(E*rt-R*at+B*lt),zt=+(R*yt-B*gt+O*vt),Nt=-(E*yt-B*bt+O*wt),Lt=+(E*gt-R*bt+O*xt),Ft=-(E*vt-R*wt+B*xt),kt=-(R*Tt-B*At+O*St),Wt=+(E*Tt-B*Ct+O*_t),qt=-(E*At-R*Ct+O*It),Vt=+(E*St-R*_t+B*It);return Dt.FromValuesToRef(ut*ft,Rt*ft,zt*ft,kt*ft,ht*ft,Pt*ft,Nt*ft,Wt*ft,ct*ft,Bt*ft,Lt*ft,qt*ft,pt*ft,Ot*ft,Ft*ft,Vt*ft,v),this}addAtIndex(v,A){return this._m[v]+=A,this._markAsUpdated(),this}multiplyAtIndex(v,A){return this._m[v]*=A,this._markAsUpdated(),this}setTranslationFromFloats(v,A,E){return this._m[12]=v,this._m[13]=A,this._m[14]=E,this._markAsUpdated(),this}setTranslation(v){return this.setTranslationFromFloats(v.x,v.y,v.z)}getTranslation(){return new Qt.Vector3(this._m[12],this._m[13],this._m[14])}getTranslationToRef(v){return v.x=this._m[12],v.y=this._m[13],v.z=this._m[14],this}removeRotationAndScaling(){const v=this.m;return Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v[12],v[13],v[14],v[15],this),this._updateIdentityStatus(0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]),this}multiply(v){const A=new Dt;return this.multiplyToRef(v,A),A}copyFrom(v){v.copyToArray(this._m);const A=v;return this._updateIdentityStatus(A._isIdentity,A._isIdentityDirty,A._isIdentity3x2,A._isIdentity3x2Dirty),this}copyToArray(v,A=0){for(let E=0;E<16;E++)v[A+E]=this._m[E];return this}multiplyToRef(v,A){return this._isIdentity?(A.copyFrom(v),this):v._isIdentity?(A.copyFrom(this),this):(this.multiplyToArray(v,A._m,0),A._markAsUpdated(),this)}multiplyToArray(v,A,E){const R=this._m,B=v.m,O=R[0],z=R[1],M=R[2],W=R[3],V=R[4],H=R[5],Q=R[6],Z=R[7],K=R[8],J=R[9],$=R[10],et=R[11],nt=R[12],it=R[13],ot=R[14],rt=R[15],st=B[0],at=B[1],lt=B[2],ut=B[3],ht=B[4],ct=B[5],pt=B[6],dt=B[7],ft=B[8],yt=B[9],gt=B[10],vt=B[11],bt=B[12],wt=B[13],xt=B[14],Tt=B[15];return A[E]=O*st+z*ht+M*ft+W*bt,A[E+1]=O*at+z*ct+M*yt+W*wt,A[E+2]=O*lt+z*pt+M*gt+W*xt,A[E+3]=O*ut+z*dt+M*vt+W*Tt,A[E+4]=V*st+H*ht+Q*ft+Z*bt,A[E+5]=V*at+H*ct+Q*yt+Z*wt,A[E+6]=V*lt+H*pt+Q*gt+Z*xt,A[E+7]=V*ut+H*dt+Q*vt+Z*Tt,A[E+8]=K*st+J*ht+$*ft+et*bt,A[E+9]=K*at+J*ct+$*yt+et*wt,A[E+10]=K*lt+J*pt+$*gt+et*xt,A[E+11]=K*ut+J*dt+$*vt+et*Tt,A[E+12]=nt*st+it*ht+ot*ft+rt*bt,A[E+13]=nt*at+it*ct+ot*yt+rt*wt,A[E+14]=nt*lt+it*pt+ot*gt+rt*xt,A[E+15]=nt*ut+it*dt+ot*vt+rt*Tt,this}equals(v){const A=v;if(!A)return!1;if((this._isIdentity||A._isIdentity)&&!this._isIdentityDirty&&!A._isIdentityDirty)return this._isIdentity&&A._isIdentity;const E=this.m,R=A.m;return E[0]===R[0]&&E[1]===R[1]&&E[2]===R[2]&&E[3]===R[3]&&E[4]===R[4]&&E[5]===R[5]&&E[6]===R[6]&&E[7]===R[7]&&E[8]===R[8]&&E[9]===R[9]&&E[10]===R[10]&&E[11]===R[11]&&E[12]===R[12]&&E[13]===R[13]&&E[14]===R[14]&&E[15]===R[15]}clone(){const v=new Dt;return v.copyFrom(this),v}getClassName(){return"Matrix"}getHashCode(){let v=this._m[0]||0;for(let A=1;A<16;A++)v=397*v^(this._m[A]||0);return v}decompose(v,A,E){if(this._isIdentity)return E&&E.setAll(0),v&&v.setAll(1),A&&A.copyFromFloats(0,0,0,1),!0;const R=this._m;E&&E.copyFromFloats(R[12],R[13],R[14]);const B=v||Kt.MathTmp.Vector3[0];if(B.x=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]),B.y=Math.sqrt(R[4]*R[4]+R[5]*R[5]+R[6]*R[6]),B.z=Math.sqrt(R[8]*R[8]+R[9]*R[9]+R[10]*R[10]),this.determinant()<=0&&(B.y*=-1),0===B.x||0===B.y||0===B.z)return A&&A.copyFromFloats(0,0,0,1),!1;if(A){const v=1/B.x,E=1/B.y,O=1/B.z;Dt.FromValuesToRef(R[0]*v,R[1]*v,R[2]*v,0,R[4]*E,R[5]*E,R[6]*E,0,R[8]*O,R[9]*O,R[10]*O,0,0,0,0,1,Kt.MathTmp.Matrix[0]),Zt.Quaternion.FromRotationMatrixToRef(Kt.MathTmp.Matrix[0],A)}return!0}getRow(v){if(v<0||v>3)return null;const A=4*v;return new Jt.Vector4(this._m[A+0],this._m[A+1],this._m[A+2],this._m[A+3])}setRow(v,A){return this.setRowFromFloats(v,A.x,A.y,A.z,A.w)}transpose(){return Dt.Transpose(this)}transposeToRef(v){return Dt.TransposeToRef(this,v),this}setRowFromFloats(v,A,E,R,B){if(v<0||v>3)return this;const O=4*v;return this._m[O+0]=A,this._m[O+1]=E,this._m[O+2]=R,this._m[O+3]=B,this._markAsUpdated(),this}scale(v){const A=new Dt;return this.scaleToRef(v,A),A}scaleToRef(v,A){for(let E=0;E<16;E++)A._m[E]=this._m[E]*v;return A._markAsUpdated(),this}scaleAndAddToRef(v,A){for(let E=0;E<16;E++)A._m[E]+=this._m[E]*v;return A._markAsUpdated(),this}toNormalMatrix(v){const A=Kt.MathTmp.Matrix[0];this.invertToRef(A),A.transposeToRef(v);const E=v._m;Dt.FromValuesToRef(E[0],E[1],E[2],0,E[4],E[5],E[6],0,E[8],E[9],E[10],0,0,0,0,1,v)}getRotationMatrix(){const v=new Dt;return this.getRotationMatrixToRef(v),v}getRotationMatrixToRef(v){const A=Kt.MathTmp.Vector3[0];if(!this.decompose(A))return Dt.IdentityToRef(v),this;const E=this._m,R=1/A.x,B=1/A.y,O=1/A.z;return Dt.FromValuesToRef(E[0]*R,E[1]*R,E[2]*R,0,E[4]*B,E[5]*B,E[6]*B,0,E[8]*O,E[9]*O,E[10]*O,0,0,0,0,1,v),this}toggleModelMatrixHandInPlace(){const v=this._m;v[2]*=-1,v[6]*=-1,v[8]*=-1,v[9]*=-1,v[14]*=-1,this._markAsUpdated()}toggleProjectionMatrixHandInPlace(){const v=this._m;v[8]*=-1,v[9]*=-1,v[10]*=-1,v[11]*=-1,this._markAsUpdated()}_updateIdentityStatus(v,A=!1,E=!1,R=!0){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=v,this._isIdentity3x2=v||E,this._isIdentityDirty=!this._isIdentity&&A,this._isIdentity3x2Dirty=!this._isIdentity3x2&&R}}qt.Matrix=Dt,Dt._updateFlagSeed=0,Dt._identityReadOnly=Dt.Identity(),Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.Quaternion=void 0;const $t=qt,ee=kt,ne=Lt,ie=Nt,oe=Ut;class jt{constructor(v=0,A=0,E=0,R=1){this.x=v,this.y=A,this.z=E,this.w=R}static FromRotationMatrix(v){const A=new jt;return jt.FromRotationMatrixToRef(v,A),A}static FromRotationMatrixToRef(v,A){const E=v.m,R=E[0],B=E[4],O=E[8],z=E[1],M=E[5],W=E[9],V=E[2],H=E[6],Q=E[10],Z=R+M+Q;let K;Z>0?(K=.5/Math.sqrt(Z+1),A.w=.25/K,A.x=(H-W)*K,A.y=(O-V)*K,A.z=(z-B)*K):R>M&&R>Q?(K=2*Math.sqrt(1+R-M-Q),A.w=(H-W)/K,A.x=.25*K,A.y=(B+z)/K,A.z=(O+V)/K):M>Q?(K=2*Math.sqrt(1+M-R-Q),A.w=(O-V)/K,A.x=(B+z)/K,A.y=.25*K,A.z=(W+H)/K):(K=2*Math.sqrt(1+Q-R-M),A.w=(z-B)/K,A.x=(O+V)/K,A.y=(W+H)/K,A.z=.25*K)}static Dot(v,A){return v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w}static AreClose(v,A){return jt.Dot(v,A)>=0}static Zero(){return new jt(0,0,0,0)}static Inverse(v){return new jt(-v.x,-v.y,-v.z,v.w)}static IsIdentity(v){return v&&0===v.x&&0===v.y&&0===v.z&&1===v.w}static RotationAxis(v,A){const E=A*ie.DEG2RAD;return jt.RotationAxisToRef(v,E,new jt)}static RotationAxisToRef(v,A,E){const R=A*ie.DEG2RAD,B=Math.sin(R/2);return v.normalize(),E.w=Math.cos(R/2),E.x=v.x*B,E.y=v.y*B,E.z=v.z*B,E}static FromArray(v,A=0){return new jt(v[A],v[A+1],v[A+2],v[A+3])}static FromEulerAnglesRef(v,A,E,R){return jt.RotationYawPitchRollToRef(A*ie.DEG2RAD,v*ie.DEG2RAD,E*ie.DEG2RAD,R)}static RotationYawPitchRoll(v,A,E){const R=new jt;return jt.RotationYawPitchRollToRef(v,A,E,R),R}static RotationYawPitchRollToRef(v,A,E,R){const B=.5*A,O=.5*v,z=.5*E,M=Math.cos(B),W=Math.cos(O),V=Math.cos(z),H=Math.sin(B),Q=Math.sin(O),Z=Math.sin(z);R.x=W*H*V+Q*M*Z,R.y=Q*M*V-W*H*Z,R.z=W*M*Z-Q*H*V,R.w=W*M*V+Q*H*Z}static RotationAlphaBetaGamma(v,A,E){const R=new jt;return jt.RotationAlphaBetaGammaToRef(v,A,E,R),R}static RotationAlphaBetaGammaToRef(v,A,E,R){const B=.5*(E+v),O=.5*(E-v),z=.5*A;R.x=Math.cos(O)*Math.sin(z),R.y=Math.sin(O)*Math.sin(z),R.z=Math.sin(B)*Math.cos(z),R.w=Math.cos(B)*Math.cos(z)}static RotationQuaternionFromAxis(v,A,E){const R=new jt(0,0,0,0);return jt.RotationQuaternionFromAxisToRef(v,A,E,R),R}static RotationQuaternionFromAxisToRef(v,A,E,R){const B=ne.MathTmp.Matrix[0];$t.Matrix.FromXYZAxesToRef(v.normalize(),A.normalize(),E.normalize(),B),jt.FromRotationMatrixToRef(B,R)}static Slerp(v,A,E){const R=jt.Identity;return jt.SlerpToRef(v,A,E,R),R}static SlerpToRef(v,A,E,R){let B,O,z=v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w,M=!1;if(z<0&&(M=!0,z=-z),z>.999999)O=1-E,B=M?-E:E;else{const v=Math.acos(z),A=1/Math.sin(v);O=Math.sin((1-E)*v)*A,B=M?-Math.sin(E*v)*A:Math.sin(E*v)*A}R.x=O*v.x+B*A.x,R.y=O*v.y+B*A.y,R.z=O*v.z+B*A.z,R.w=O*v.w+B*A.w}static Hermite(v,A,E,R,B){const O=B*B,z=B*O,M=2*z-3*O+1,W=-2*z+3*O,V=z-2*O+B,H=z-O,Q=v.x*M+E.x*W+A.x*V+R.x*H,Z=v.y*M+E.y*W+A.y*V+R.y*H,K=v.z*M+E.z*W+A.z*V+R.z*H,J=v.w*M+E.w*W+A.w*V+R.w*H;return new jt(Q,Z,K,J)}static get Identity(){return new jt(0,0,0,1)}static Angle(v,A){const E=jt.Dot(v,A);return 2*Math.acos(Math.min(Math.abs(E),1))*ie.RAD2DEG}static Euler(v,A,E){return jt.RotationYawPitchRoll(A*ie.DEG2RAD,v*ie.DEG2RAD,E*ie.DEG2RAD)}static LookRotation(v,A=ne.MathTmp.staticUp){const E=ee.Vector3.Normalize(v),R=ee.Vector3.Normalize(ee.Vector3.Cross(A,E)),B=ee.Vector3.Cross(E,R),O=R.x,z=R.y,M=R.z,W=B.x,V=B.y,H=B.z,Q=E.x,Z=E.y,K=E.z,J=O+V+K,$=new jt;if(J>0){let v=Math.sqrt(J+1);return $.w=.5*v,v=.5/v,$.x=(H-Z)*v,$.y=(Q-M)*v,$.z=(z-W)*v,$}if(O>=V&&O>=K){const v=Math.sqrt(1+O-V-K),A=.5/v;return $.x=.5*v,$.y=(z+W)*A,$.z=(M+Q)*A,$.w=(H-Z)*A,$}if(V>K){const v=Math.sqrt(1+V-O-K),A=.5/v;return $.x=(W+z)*A,$.y=.5*v,$.z=(Z+H)*A,$.w=(Q-M)*A,$}const et=Math.sqrt(1+K-O-V),nt=.5/et;return $.x=(Q+M)*nt,$.y=(Z+H)*nt,$.z=.5*et,$.w=(z-W)*nt,$}static RotateTowards(v,A,E){const R=jt.Angle(v,A);if(0===R)return A;const B=Math.min(1,E/R);return jt.Slerp(v,A,B)}static FromToRotation(v,A,E=ne.MathTmp.staticUp){const R=v.normalize(),B=A.normalize(),O=ee.Vector3.Cross(R,B),z=Math.sqrt(R.lengthSquared()*B.lengthSquared())+ee.Vector3.Dot(R,B);return O.lengthSquared()<1e-4?Math.abs(z)<1e-4?new jt(E.x,E.y,E.z,0).normalized:jt.Identity:new jt(O.x,O.y,O.z,z).normalized}get normalized(){return this.normalize()}setFromToRotation(v,A,E=ne.MathTmp.staticUp){const R=jt.FromToRotation(v,A,E);this.x=R.x,this.y=R.y,this.z=R.z,this.w=R.w}set eulerAngles(v){this.setEuler(v.x,v.y,v.z)}get eulerAngles(){const v=new ee.Vector3,A=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,E=this.x*this.w-this.y*this.z;return E>.4995*A?(v.x=Math.PI/2,v.y=2*Math.atan2(this.y,this.x),v.z=0):E<-.4995*A?(v.x=-Math.PI/2,v.y=-2*Math.atan2(this.y,this.x),v.z=0):(v.x=Math.asin(2*(this.w*this.x-this.y*this.z)),v.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),v.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),v.x*=ie.RAD2DEG,v.y*=ie.RAD2DEG,v.z*=ie.RAD2DEG,v.x=oe.Scalar.Repeat(v.x,360),v.y=oe.Scalar.Repeat(v.y,360),v.z=oe.Scalar.Repeat(v.z,360),v}toString(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`}get length(){return Math.sqrt(this.lengthSquared)}get lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}getClassName(){return"Quaternion"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){return[this.x,this.y,this.z,this.w]}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}clone(){return new jt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,A,E,R){return this.x=v,this.y=A,this.z=E,this.w=R,this}set(v,A,E,R){return this.copyFromFloats(v,A,E,R)}setEuler(v,A,E){return jt.RotationYawPitchRollToRef(A*ie.DEG2RAD,v*ie.DEG2RAD,E*ie.DEG2RAD,this),this}add(v){return new jt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}subtract(v){return new jt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}scale(v){return new jt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,A.z=this.z*v,A.w=this.w*v,this}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,A.z+=this.z*v,A.w+=this.w*v,this}multiply(v){const A=new jt(0,0,0,1);return this.multiplyToRef(v,A),A}multiplyToRef(v,A){const E=this.x*v.w+this.y*v.z-this.z*v.y+this.w*v.x,R=-this.x*v.z+this.y*v.w+this.z*v.x+this.w*v.y,B=this.x*v.y-this.y*v.x+this.z*v.w+this.w*v.z,O=-this.x*v.x-this.y*v.y-this.z*v.z+this.w*v.w;return A.copyFromFloats(E,R,B,O),this}multiplyInPlace(v){return this.multiplyToRef(v,this),this}conjugateToRef(v){return v.copyFromFloats(-this.x,-this.y,-this.z,this.w),this}conjugateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this}conjugate(){return new jt(-this.x,-this.y,-this.z,this.w)}normalize(){const v=1/this.length;return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}angleAxis(v,A){if(0===A.lengthSquared())return jt.Identity;const E=jt.Identity;let R=v*ie.DEG2RAD;R*=.5;let B=A.normalize();return B=A.scaleInPlace(Math.sin(R)),E.x=B.x,E.y=B.y,E.z=B.z,E.w=Math.cos(R),E.normalize()}toRotationMatrix(v){return $t.Matrix.FromQuaternionToRef(this,v),this}fromRotationMatrix(v){return jt.FromRotationMatrixToRef(v,this),this}}Wt.Quaternion=jt,Object.defineProperty(kt,"__esModule",{value:!0}),kt.Vector3=void 0;const se=Lt,ae=Nt,le=Wt,ue=Ut;class Xt{constructor(v=0,A=0,E=0){this.x=v,this.y=A,this.z=E}get isNonUniform(){const v=Math.abs(this.x),A=Math.abs(this.y);if(v!==A)return!0;const E=Math.abs(this.z);return v!==E||A!==E}static Add(v,A){return new Xt(v.x,v.y,v.z).addInPlace(A)}static GetClipFactor(v,A,E,R){const B=Xt.Dot(v,E)-R;return B/(B-(Xt.Dot(A,E)-R))}static GetAngleBetweenVectors(v,A,E){const R=v.normalizeToRef(se.MathTmp.Vector3[1]),B=A.normalizeToRef(se.MathTmp.Vector3[2]),O=Xt.Dot(R,B),z=se.MathTmp.Vector3[3];return Xt.CrossToRef(R,B,z),Xt.Dot(z,E)>0?Math.acos(O):-Math.acos(O)}static FromArray(v,A=0){return new Xt(v[A],v[A+1],v[A+2])}static FromFloatArray(v,A){return Xt.FromArray(v,A)}static FromArrayToRef(v,A,E){E.x=v[A],E.y=v[A+1],E.z=v[A+2]}static FromFloatArrayToRef(v,A,E){return Xt.FromArrayToRef(v,A,E)}static FromFloatsToRef(v,A,E,R){R.copyFromFloats(v,A,E)}static Zero(){return new Xt(0,0,0)}static One(){return new Xt(1,1,1)}static Up(){return new Xt(0,1,0)}static Down(){return new Xt(0,-1,0)}static Forward(){return new Xt(0,0,1)}static Backward(){return new Xt(0,0,-1)}static Right(){return new Xt(1,0,0)}static Left(){return new Xt(-1,0,0)}static TransformCoordinates(v,A){const E=Xt.Zero();return Xt.TransformCoordinatesToRef(v,A,E),E}static TransformCoordinatesToRef(v,A,E){return Xt.TransformCoordinatesFromFloatsToRef(v.x,v.y,v.z,A,E)}static TransformCoordinatesFromFloatsToRef(v,A,E,R,B){const O=R.m,z=v*O[0]+A*O[4]+E*O[8]+O[12],M=v*O[1]+A*O[5]+E*O[9]+O[13],W=v*O[2]+A*O[6]+E*O[10]+O[14],V=1/(v*O[3]+A*O[7]+E*O[11]+O[15]);B.x=z*V,B.y=M*V,B.z=W*V}static TransformNormal(v,A){const E=Xt.Zero();return Xt.TransformNormalToRef(v,A,E),E}static TransformNormalToRef(v,A,E){this.TransformNormalFromFloatsToRef(v.x,v.y,v.z,A,E)}static TransformNormalFromFloatsToRef(v,A,E,R,B){const O=R.m;B.x=v*O[0]+A*O[4]+E*O[8],B.y=v*O[1]+A*O[5]+E*O[9],B.z=v*O[2]+A*O[6]+E*O[10]}static CatmullRom(v,A,E,R,B){const O=B*B,z=B*O,M=.5*(2*A.x+(-v.x+E.x)*B+(2*v.x-5*A.x+4*E.x-R.x)*O+(-v.x+3*A.x-3*E.x+R.x)*z),W=.5*(2*A.y+(-v.y+E.y)*B+(2*v.y-5*A.y+4*E.y-R.y)*O+(-v.y+3*A.y-3*E.y+R.y)*z),V=.5*(2*A.z+(-v.z+E.z)*B+(2*v.z-5*A.z+4*E.z-R.z)*O+(-v.z+3*A.z-3*E.z+R.z)*z);return new Xt(M,W,V)}static Clamp(v,A,E){const R=new Xt;return Xt.ClampToRef(v,A,E,R),R}static ClampToRef(v,A,E,R){let B=v.x;B=B>E.x?E.x:B,B=B<A.x?A.x:B;let O=v.y;O=O>E.y?E.y:O,O=O<A.y?A.y:O;let z=v.z;z=z>E.z?E.z:z,z=z<A.z?A.z:z,R.copyFromFloats(B,O,z)}static Hermite(v,A,E,R,B){const O=B*B,z=B*O,M=2*z-3*O+1,W=-2*z+3*O,V=z-2*O+B,H=z-O,Q=v.x*M+E.x*W+A.x*V+R.x*H,Z=v.y*M+E.y*W+A.y*V+R.y*H,K=v.z*M+E.z*W+A.z*V+R.z*H;return new Xt(Q,Z,K)}static Lerp(v,A,E){const R=new Xt(0,0,0);return Xt.LerpToRef(v,A,E,R),R}static LerpToRef(v,A,E,R){R.x=v.x+(A.x-v.x)*E,R.y=v.y+(A.y-v.y)*E,R.z=v.z+(A.z-v.z)*E}static Dot(v,A){return v.x*A.x+v.y*A.y+v.z*A.z}static Cross(v,A){const E=Xt.Zero();return Xt.CrossToRef(v,A,E),E}static CrossToRef(v,A,E){const R=v.y*A.z-v.z*A.y,B=v.z*A.x-v.x*A.z,O=v.x*A.y-v.y*A.x;E.copyFromFloats(R,B,O)}static Normalize(v){const A=Xt.Zero();return Xt.NormalizeToRef(v,A),A}static NormalizeToRef(v,A){v.normalizeToRef(A)}static Minimize(v,A){const E=new Xt(v.x,v.y,v.z);return E.minimizeInPlace(A),E}static Maximize(v,A){const E=new Xt(v.x,v.y,v.z);return E.maximizeInPlace(A),E}static Distance(v,A){return Math.sqrt(Xt.DistanceSquared(v,A))}static DistanceSquared(v,A){const E=v.x-A.x,R=v.y-A.y,B=v.z-A.z;return E*E+R*R+B*B}static Center(v,A){const E=Xt.Add(v,A);return E.scaleInPlace(.5),E}static RotationFromAxis(v,A,E){const R=Xt.Zero();return Xt.RotationFromAxisToRef(v,A,E,R),R}static RotationFromAxisToRef(v,A,E,R){const B=se.MathTmp.Quaternion[0];le.Quaternion.RotationQuaternionFromAxisToRef(v,A,E,B),R.copyFrom(B.eulerAngles)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}getClassName(){return"Vector3"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v}asArray(){const v=[];return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,v[A+2]=this.z,this}toQuaternion(){return le.Quaternion.Identity.setEuler(this.y,this.x,this.z)}addInPlace(v){return this.addInPlaceFromFloats(v.x,v.y,v.z)}addInPlaceFromFloats(v,A,E){return this.x+=v,this.y+=A,this.z+=E,this}add(v){return new Xt(this.x+v.x,this.y+v.y,this.z+v.z)}addToRef(v,A){return A.copyFromFloats(this.x+v.x,this.y+v.y,this.z+v.z)}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this}subtract(v){return new Xt(this.x-v.x,this.y-v.y,this.z-v.z)}subtractToRef(v,A){return this.subtractFromFloatsToRef(v.x,v.y,v.z,A)}subtractFromFloats(v,A,E){return new Xt(this.x-v,this.y-A,this.z-E)}subtractFromFloatsToRef(v,A,E,R){return R.copyFromFloats(this.x-v,this.y-A,this.z-E)}applyMatrix4(v){this.applyMatrix4ToRef(v,this)}applyMatrix4ToRef(v,A){const{x:E,y:R,z:B}=this,{m:O}=v,z=1/(O[3]*E+O[7]*R+O[11]*B+O[15]);return A.x=(O[0]*E+O[4]*R+O[8]*B+O[12])*z,A.y=(O[1]*E+O[5]*R+O[9]*B+O[13])*z,A.z=(O[2]*E+O[6]*R+O[10]*B+O[14])*z,A}rotate(v){return this.rotateToRef(v,this)}rotateToRef(v,A){const{x:E,y:R,z:B}=this,{x:O,y:z,z:M,w:W}=v,V=W*E+z*B-M*R,H=W*R+M*E-O*B,Q=W*B+O*R-z*E,Z=-O*E-z*R-M*B;return A.x=V*W+Z*-O+H*-M-Q*-z,A.y=H*W+Z*-z+Q*-O-V*-M,A.z=Q*W+Z*-M+V*-z-H*-O,A}negate(){return new Xt(-this.x,-this.y,-this.z)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this}scale(v){return new Xt(this.x*v,this.y*v,this.z*v)}scaleToRef(v,A){return A.copyFromFloats(this.x*v,this.y*v,this.z*v)}scaleAndAddToRef(v,A){return A.addInPlaceFromFloats(this.x*v,this.y*v,this.z*v)}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z}equalsWithEpsilon(v,A=ae.Epsilon){return v&&ue.Scalar.WithinEpsilon(this.x,v.x,A)&&ue.Scalar.WithinEpsilon(this.y,v.y,A)&&ue.Scalar.WithinEpsilon(this.z,v.z,A)}equalsToFloats(v,A,E){return this.x===v&&this.y===A&&this.z===E}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this}multiply(v){return this.multiplyByFloats(v.x,v.y,v.z)}multiplyToRef(v,A){return A.copyFromFloats(this.x*v.x,this.y*v.y,this.z*v.z)}multiplyByFloats(v,A,E){return new Xt(this.x*v,this.y*A,this.z*E)}divide(v){return new Xt(this.x/v.x,this.y/v.y,this.z/v.z)}divideToRef(v,A){return A.copyFromFloats(this.x/v.x,this.y/v.y,this.z/v.z)}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return this.minimizeInPlaceFromFloats(v.x,v.y,v.z)}maximizeInPlace(v){return this.maximizeInPlaceFromFloats(v.x,v.y,v.z)}minimizeInPlaceFromFloats(v,A,E){return v<this.x&&(this.x=v),A<this.y&&(this.y=A),E<this.z&&(this.z=E),this}maximizeInPlaceFromFloats(v,A,E){return v>this.x&&(this.x=v),A>this.y&&(this.y=A),E>this.z&&(this.z=E),this}floor(){return new Xt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return new Xt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){const v=new Xt(0,0,0);return this.normalizeToRef(v),v}normalizeToRef(v){const A=this.length();return 0===A||1===A?v.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/A,v)}clone(){return new Xt(this.x,this.y,this.z)}copyFrom(v){return this.copyFromFloats(v.x,v.y,v.z)}copyFromFloats(v,A,E){return this.x=v,this.y=A,this.z=E,this}set(v,A,E){return this.copyFromFloats(v,A,E)}setAll(v){return this.x=this.y=this.z=v,this}}kt.Vector3=Xt,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.MathTmp=void 0;const he=Ft,ce=kt,de=Wt,fe=qt;Lt.MathTmp={Vector3:(0,he.buildArray)(6,ce.Vector3.Zero),Matrix:(0,he.buildArray)(2,fe.Matrix.Identity),Quaternion:(0,he.buildArray)(3,de.Quaternion.Zero),staticUp:ce.Vector3.Up(),tmpMatrix:fe.Matrix.Zero()};var ye={};Object.defineProperty(ye,"__esModule",{value:!0}),ye.Angle=void 0;class te{constructor(v){this._radians=v,this._radians<0&&(this._radians+=2*Math.PI)}static BetweenTwoPoints(v,A){const E=A.subtract(v),R=Math.atan2(E.y,E.x);return new te(R)}static FromRadians(v){return new te(v)}static FromDegrees(v){return new te(v*Math.PI/180)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}}ye.Angle=te;var me={},ve={};Object.defineProperty(ve,"__esModule",{value:!0}),ve.Vector2=void 0;const be=Nt,we=Ut;class re{constructor(v=0,A=0){this.x=v,this.y=A}static Zero(){return new re(0,0)}static One(){return new re(1,1)}static Add(v,A){return new re(v.x,v.y).addInPlace(A)}static FromArray(v,A=0){return new re(v[A],v[A+1])}static FromArrayToRef(v,A,E){E.x=v[A],E.y=v[A+1]}static CatmullRom(v,A,E,R,B){const O=B*B,z=B*O,M=.5*(2*A.x+(-v.x+E.x)*B+(2*v.x-5*A.x+4*E.x-R.x)*O+(-v.x+3*A.x-3*E.x+R.x)*z),W=.5*(2*A.y+(-v.y+E.y)*B+(2*v.y-5*A.y+4*E.y-R.y)*O+(-v.y+3*A.y-3*E.y+R.y)*z);return new re(M,W)}static Clamp(v,A,E){let R=v.x;R=R>E.x?E.x:R,R=R<A.x?A.x:R;let B=v.y;return B=B>E.y?E.y:B,B=B<A.y?A.y:B,new re(R,B)}static Hermite(v,A,E,R,B){const O=B*B,z=B*O,M=2*z-3*O+1,W=-2*z+3*O,V=z-2*O+B,H=z-O,Q=v.x*M+E.x*W+A.x*V+R.x*H,Z=v.y*M+E.y*W+A.y*V+R.y*H;return new re(Q,Z)}static Lerp(v,A,E){const R=v.x+(A.x-v.x)*E,B=v.y+(A.y-v.y)*E;return new re(R,B)}static Dot(v,A){return v.x*A.x+v.y*A.y}static Normalize(v){const A=new re(v.x,v.y);return A.normalize(),A}static Minimize(v,A){const E=v.x<A.x?v.x:A.x,R=v.y<A.y?v.y:A.y;return new re(E,R)}static Maximize(v,A){const E=v.x>A.x?v.x:A.x,R=v.y>A.y?v.y:A.y;return new re(E,R)}static Transform(v,A){const E=re.Zero();return re.TransformToRef(v,A,E),E}static TransformToRef(v,A,E){const R=A.m,B=v.x*R[0]+v.y*R[4]+R[12],O=v.x*R[1]+v.y*R[5]+R[13];E.x=B,E.y=O}static PointInTriangle(v,A,E,R){const B=.5*(-E.y*R.x+A.y*(-E.x+R.x)+A.x*(E.y-R.y)+E.x*R.y),O=B<0?-1:1,z=(A.y*R.x-A.x*R.y+(R.y-A.y)*v.x+(A.x-R.x)*v.y)*O,M=(A.x*E.y-A.y*E.x+(A.y-E.y)*v.x+(E.x-A.x)*v.y)*O;return z>0&&M>0&&z+M<2*B*O}static Distance(v,A){return Math.sqrt(re.DistanceSquared(v,A))}static DistanceSquared(v,A){const E=v.x-A.x,R=v.y-A.y;return E*E+R*R}static Center(v,A){const E=re.Add(v,A);return E.scaleInPlace(.5),E}static DistanceOfPointFromSegment(v,A,E){const R=re.DistanceSquared(A,E);if(0===R)return re.Distance(v,A);const B=E.subtract(A),O=Math.max(0,Math.min(1,re.Dot(v.subtract(A),B)/R)),z=A.add(B.multiplyByFloats(O,O));return re.Distance(v,z)}toString(){return"{X: "+this.x+" Y:"+this.y+"}"}getClassName(){return"Vector2"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,this}asArray(){const v=new Array;return this.toArray(v,0),v}copyFrom(v){return this.x=v.x,this.y=v.y,this}copyFromFloats(v,A){return this.x=v,this.y=A,this}set(v,A){return this.copyFromFloats(v,A)}add(v){return new re(this.x+v.x,this.y+v.y)}addToRef(v,A){return A.x=this.x+v.x,A.y=this.y+v.y,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this}addVector3(v){return new re(this.x+v.x,this.y+v.y)}subtract(v){return new re(this.x-v.x,this.y-v.y)}subtractToRef(v,A){return A.x=this.x-v.x,A.y=this.y-v.y,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this}multiply(v){return new re(this.x*v.x,this.y*v.y)}multiplyToRef(v,A){return A.x=this.x*v.x,A.y=this.y*v.y,this}multiplyByFloats(v,A){return new re(this.x*v,this.y*A)}divide(v){return new re(this.x/v.x,this.y/v.y)}divideToRef(v,A){return A.x=this.x/v.x,A.y=this.y/v.y,this}divideInPlace(v){return this.divideToRef(v,this)}negate(){return new re(-this.x,-this.y)}scaleInPlace(v){return this.x*=v,this.y*=v,this}scale(v){const A=new re(0,0);return this.scaleToRef(v,A),A}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y}equalsWithEpsilon(v,A=be.Epsilon){return v&&we.Scalar.WithinEpsilon(this.x,v.x,A)&&we.Scalar.WithinEpsilon(this.y,v.y,A)}floor(){return new re(Math.floor(this.x),Math.floor(this.y))}fract(){return new re(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){const v=this.length();if(0===v)return this;const A=1/v;return this.x*=A,this.y*=A,this}clone(){return new re(this.x,this.y)}}ve.Vector2=re,Object.defineProperty(me,"__esModule",{value:!0}),me.Arc2=void 0;const Te=ye,Se=ve,Ce=Nt;me.Arc2=class{constructor(v,A,E){this.startPoint=v,this.midPoint=A,this.endPoint=E;const R=Math.pow(A.x,2)+Math.pow(A.y,2),B=(Math.pow(v.x,2)+Math.pow(v.y,2)-R)/2,O=(R-Math.pow(E.x,2)-Math.pow(E.y,2))/2,z=(v.x-A.x)*(A.y-E.y)-(A.x-E.x)*(v.y-A.y);this.centerPoint=new Se.Vector2((B*(A.y-E.y)-O*(v.y-A.y))/z,((v.x-A.x)*O-(A.x-E.x)*B)/z),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=Te.Angle.BetweenTwoPoints(this.centerPoint,this.startPoint);const M=this.startAngle.degrees();let W=Te.Angle.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),V=Te.Angle.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();W-M>180&&(W-=360),W-M<-180&&(W+=360),V-W>180&&(V-=360),V-W<-180&&(V+=360),this.orientation=W-M<0?Ce.Orientation.CW:Ce.Orientation.CCW,this.angle=Te.Angle.FromDegrees(this.orientation===Ce.Orientation.CW?M-V:V-M)}};var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Axis=void 0;const _e=kt;class pe{}Ee.Axis=pe,pe.X=new _e.Vector3(1,0,0),pe.Y=new _e.Vector3(0,1,0),pe.Z=new _e.Vector3(0,0,1);var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.BezierCurve=void 0,Ie.BezierCurve=class{static Interpolate(v,A,E,R,B){const O=1-3*R+3*A,z=3*R-6*A,M=3*A;let W=v;for(let A=0;A<5;A++){const A=W*W;W-=1/(3*O*A+2*z*W+M)*(O*(A*W)+z*A+M*W-v),W=Math.min(1,Math.max(0,W))}return 3*Math.pow(1-W,2)*W*E+3*(1-W)*Math.pow(W,2)*B+Math.pow(W,3)}};var Re={},Pe={};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Color4=void 0;const Be=Ut,Oe=Nt;class ge{constructor(v=0,A=0,E=0,R=1){this.r=v,this.g=A,this.b=E,this.a=R}static FromHexString(v){if("#"!==v.substring(0,1)||9!==v.length)return new ge(0,0,0,0);const A=parseInt(v.substring(1,3),16),E=parseInt(v.substring(3,5),16),R=parseInt(v.substring(5,7),16),B=parseInt(v.substring(7,9),16);return ge.FromInts(A,E,R,B)}static Lerp(v,A,E){const R=new ge(0,0,0,0);return ge.LerpToRef(v,A,E,R),R}static LerpToRef(v,A,E,R){R.r=v.r+(A.r-v.r)*E,R.g=v.g+(A.g-v.g)*E,R.b=v.b+(A.b-v.b)*E,R.a=v.a+(A.a-v.a)*E}static Red(){return new ge(1,0,0,1)}static Green(){return new ge(0,1,0,1)}static Blue(){return new ge(0,0,1,1)}static Black(){return new ge(0,0,0,1)}static White(){return new ge(1,1,1,1)}static Purple(){return new ge(.5,0,.5,1)}static Magenta(){return new ge(1,0,1,1)}static Yellow(){return new ge(1,1,0,1)}static Gray(){return new ge(.5,.5,.5,1)}static Teal(){return new ge(0,1,1,1)}static Clear(){return new ge(0,0,0,0)}static FromColor3(v,A=1){return new ge(v.r,v.g,v.b,A)}static FromArray(v,A=0){return new ge(v[A],v[A+1],v[A+2],v[A+3])}static FromInts(v,A,E,R){return new ge(v/255,A/255,E/255,R/255)}static CheckColors4(v,A){if(v.length===3*A){const A=[];for(let E=0;E<v.length;E+=3){const R=E/3*4;A[R]=v[E],A[R+1]=v[E+1],A[R+2]=v[E+2],A[R+3]=1}return A}return v}addInPlace(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this.a+=v.a,this}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.r,v[A+1]=this.g,v[A+2]=this.b,v[A+3]=this.a,this}add(v){return new ge(this.r+v.r,this.g+v.g,this.b+v.b,this.a+v.a)}subtract(v){return new ge(this.r-v.r,this.g-v.g,this.b-v.b,this.a-v.a)}subtractToRef(v,A){return A.r=this.r-v.r,A.g=this.g-v.g,A.b=this.b-v.b,A.a=this.a-v.a,this}scale(v){return new ge(this.r*v,this.g*v,this.b*v,this.a*v)}scaleToRef(v,A){return A.r=this.r*v,A.g=this.g*v,A.b=this.b*v,A.a=this.a*v,this}scaleAndAddToRef(v,A){return A.r+=this.r*v,A.g+=this.g*v,A.b+=this.b*v,A.a+=this.a*v,this}clampToRef(v=0,A=1,E){return E.r=Be.Scalar.Clamp(this.r,v,A),E.g=Be.Scalar.Clamp(this.g,v,A),E.b=Be.Scalar.Clamp(this.b,v,A),E.a=Be.Scalar.Clamp(this.a,v,A),this}multiply(v){return new ge(this.r*v.r,this.g*v.g,this.b*v.b,this.a*v.a)}multiplyToRef(v,A){return A.r=this.r*v.r,A.g=this.g*v.g,A.b=this.b*v.b,A.a=this.a*v.a,A}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v=397*v^(this.a||0),v}clone(){return new ge(this.r,this.g,this.b,this.a)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this.a=v.a,this}copyFromFloats(v,A,E,R){return this.r=v,this.g=A,this.b=E,this.a=R,this}set(v,A,E,R){return this.copyFromFloats(v,A,E,R)}toHexString(){const v=255*this.r|0,A=255*this.g|0,E=255*this.b|0,R=255*this.a|0;return"#"+Be.Scalar.ToHex(v)+Be.Scalar.ToHex(A)+Be.Scalar.ToHex(E)+Be.Scalar.ToHex(R)}toLinearSpace(){const v=new ge;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Oe.ToLinearSpace),v.g=Math.pow(this.g,Oe.ToLinearSpace),v.b=Math.pow(this.b,Oe.ToLinearSpace),v.a=this.a,this}toGammaSpace(){const v=new ge;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Oe.ToGammaSpace),v.g=Math.pow(this.g,Oe.ToGammaSpace),v.b=Math.pow(this.b,Oe.ToGammaSpace),v.a=this.a,this}}Pe.Color4=ge,Object.defineProperty(Re,"__esModule",{value:!0}),Re.Color3=void 0;const Ne=Nt,Le=Pe,Fe=Ut;class xe{constructor(v=0,A=0,E=0){this.r=v,this.g=A,this.b=E}static FromHexString(v){if("#"!==v.substring(0,1)||7!==v.length)return new xe(0,0,0);const A=parseInt(v.substring(1,3),16),E=parseInt(v.substring(3,5),16),R=parseInt(v.substring(5,7),16);return xe.FromInts(A,E,R)}static FromArray(v,A=0){return new xe(v[A],v[A+1],v[A+2])}static FromInts(v,A,E){return new xe(v/255,A/255,E/255)}static Lerp(v,A,E){const R=new xe(0,0,0);return xe.LerpToRef(v,A,E,R),R}static LerpToRef(v,A,E,R){R.r=v.r+(A.r-v.r)*E,R.g=v.g+(A.g-v.g)*E,R.b=v.b+(A.b-v.b)*E}static Red(){return new xe(1,0,0)}static Green(){return new xe(0,1,0)}static Blue(){return new xe(0,0,1)}static Black(){return new xe(0,0,0)}static White(){return new xe(1,1,1)}static Purple(){return new xe(.5,0,.5)}static Magenta(){return new xe(1,0,1)}static Yellow(){return new xe(1,1,0)}static Gray(){return new xe(.5,.5,.5)}static Teal(){return new xe(0,1,1)}static Random(){return new xe(Math.random(),Math.random(),Math.random())}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v}toArray(v,A=0){return v[A]=this.r,v[A+1]=this.g,v[A+2]=this.b,this}toColor4(v=1){return new Le.Color4(this.r,this.g,this.b,v)}asArray(){const v=new Array;return this.toArray(v,0),v}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(v){return new xe(this.r*v.r,this.g*v.g,this.b*v.b)}multiplyToRef(v,A){return A.r=this.r*v.r,A.g=this.g*v.g,A.b=this.b*v.b,this}equals(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b}equalsFloats(v,A,E){return this.r===v&&this.g===A&&this.b===E}scale(v){return new xe(this.r*v,this.g*v,this.b*v)}scaleToRef(v,A){return A.r=this.r*v,A.g=this.g*v,A.b=this.b*v,this}scaleAndAddToRef(v,A){return A.r+=this.r*v,A.g+=this.g*v,A.b+=this.b*v,this}clampToRef(v=0,A=1,E){return E.r=Fe.Scalar.Clamp(this.r,v,A),E.g=Fe.Scalar.Clamp(this.g,v,A),E.b=Fe.Scalar.Clamp(this.b,v,A),this}add(v){return new xe(this.r+v.r,this.g+v.g,this.b+v.b)}addToRef(v,A){return A.r=this.r+v.r,A.g=this.g+v.g,A.b=this.b+v.b,this}subtract(v){return new xe(this.r-v.r,this.g-v.g,this.b-v.b)}subtractToRef(v,A){return A.r=this.r-v.r,A.g=this.g-v.g,A.b=this.b-v.b,this}clone(){return new xe(this.r,this.g,this.b)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this}copyFromFloats(v,A,E){return this.r=v,this.g=A,this.b=E,this}set(v,A,E){return this.copyFromFloats(v,A,E)}toHexString(){const v=255*this.r|0,A=255*this.g|0,E=255*this.b|0;return"#"+Fe.Scalar.ToHex(v)+Fe.Scalar.ToHex(A)+Fe.Scalar.ToHex(E)}toLinearSpace(){const v=new xe;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Ne.ToLinearSpace),v.g=Math.pow(this.g,Ne.ToLinearSpace),v.b=Math.pow(this.b,Ne.ToLinearSpace),this}toGammaSpace(){const v=new xe;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Ne.ToGammaSpace),v.g=Math.pow(this.g,Ne.ToGammaSpace),v.b=Math.pow(this.b,Ne.ToGammaSpace),this}toJSON(){return{r:this.r,g:this.g,b:this.b}}}Re.Color3=xe;var ke={};Object.defineProperty(ke,"__esModule",{value:!0}),ke.Curve3=void 0;const We=kt;class Ae{constructor(v){this._length=0,this._points=v,this._length=this._computeLength(v)}static CreateQuadraticBezier(v,A,E,R){R=R>2?R:3;const B=new Array,r=(v,A,E,R)=>(1-v)*(1-v)*A+2*v*(1-v)*E+v*v*R;for(let O=0;O<=R;O++)B.push(new We.Vector3(r(O/R,v.x,A.x,E.x),r(O/R,v.y,A.y,E.y),r(O/R,v.z,A.z,E.z)));return new Ae(B)}static CreateCubicBezier(v,A,E,R,B){B=B>3?B:4;const O=new Array,s=(v,A,E,R,B)=>(1-v)*(1-v)*(1-v)*A+3*v*(1-v)*(1-v)*E+3*v*v*(1-v)*R+v*v*v*B;for(let z=0;z<=B;z++)O.push(new We.Vector3(s(z/B,v.x,A.x,E.x,R.x),s(z/B,v.y,A.y,E.y,R.y),s(z/B,v.z,A.z,E.z,R.z)));return new Ae(O)}static CreateHermiteSpline(v,A,E,R,B){const O=new Array,z=1/B;for(let M=0;M<=B;M++)O.push(We.Vector3.Hermite(v,A,E,R,M*z));return new Ae(O)}static CreateCatmullRomSpline(v,A,E){const R=new Array,B=1/A;let O=0;if(E){const E=v.length;for(let z=0;z<E;z++){O=0;for(let M=0;M<A;M++)R.push(We.Vector3.CatmullRom(v[z%E],v[(z+1)%E],v[(z+2)%E],v[(z+3)%E],O)),O+=B}R.push(R[0])}else{const E=new Array;E.push(v[0].clone()),Array.prototype.push.apply(E,v),E.push(v[v.length-1].clone());let z=0;for(z=0;z<E.length-3;z++){O=0;for(let v=0;v<A;v++)R.push(We.Vector3.CatmullRom(E[z],E[z+1],E[z+2],E[z+3],O)),O+=B}z--,R.push(We.Vector3.CatmullRom(E[z],E[z+1],E[z+2],E[z+3],O))}return new Ae(R)}getPoints(){return this._points}length(){return this._length}continue(v){const A=this._points[this._points.length-1],E=this._points.slice(),R=v.getPoints();for(let v=1;v<R.length;v++)E.push(R[v].subtract(R[0]).add(A));return new Ae(E)}_computeLength(v){let A=0;for(let E=1;E<v.length;E++)A+=v[E].subtract(v[E-1]).length();return A}}ke.Curve3=Ae;var qe={},Ve={};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.Plane=void 0;const Ue=kt,He=qt,Ge=Lt;class ze{constructor(v,A,E,R){this.normal=new Ue.Vector3(v,A,E),this.d=R}static FromArray(v){return new ze(v[0],v[1],v[2],v[3])}static FromPoints(v,A,E){const R=new ze(0,0,0,0);return R.copyFromPoints(v,A,E),R}static FromPositionAndNormal(v,A){const E=new ze(0,0,0,0);return A.normalize(),E.normal=A,E.d=-(A.x*v.x+A.y*v.y+A.z*v.z),E}static SignedDistanceToPlaneFromPositionAndNormal(v,A,E){const R=-(A.x*v.x+A.y*v.y+A.z*v.z);return Ue.Vector3.Dot(E,A)+R}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new ze(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let v=this.normal.getHashCode();return v=397*v^(this.d||0),v}normalize(){const v=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let A=0;return 0!==v&&(A=1/v),this.normal.x*=A,this.normal.y*=A,this.normal.z*=A,this.d*=A,this}transform(v){const A=Ge.MathTmp.Matrix[0];He.Matrix.TransposeToRef(v,A);const E=A.m,R=this.normal.x,B=this.normal.y,O=this.normal.z,z=this.d,M=R*E[0]+B*E[1]+O*E[2]+z*E[3],W=R*E[4]+B*E[5]+O*E[6]+z*E[7],V=R*E[8]+B*E[9]+O*E[10]+z*E[11],H=R*E[12]+B*E[13]+O*E[14]+z*E[15];return new ze(M,W,V,H)}dotCoordinate(v){return this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z+this.d}copyFromPoints(v,A,E){const R=A.x-v.x,B=A.y-v.y,O=A.z-v.z,z=E.x-v.x,M=E.y-v.y,W=E.z-v.z,V=B*W-O*M,H=O*z-R*W,Q=R*M-B*z,Z=Math.sqrt(V*V+H*H+Q*Q);let K;return K=0!==Z?1/Z:0,this.normal.x=V*K,this.normal.y=H*K,this.normal.z=Q*K,this.d=-(this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z),this}isFrontFacingTo(v,A){return Ue.Vector3.Dot(this.normal,v)<=A}signedDistanceTo(v){return Ue.Vector3.Dot(v,this.normal)+this.d}}Ve.Plane=ze,Object.defineProperty(qe,"__esModule",{value:!0}),qe.Frustum=void 0;const Xe=Ve;class Me{static GetPlanes(v){const A=[];for(let v=0;v<6;v++)A.push(new Xe.Plane(0,0,0,0));return Me.GetPlanesToRef(v,A),A}static GetNearPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]+E[2],A.normal.y=E[7]+E[6],A.normal.z=E[11]+E[10],A.d=E[15]+E[14],A.normalize()}static GetFarPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]-E[2],A.normal.y=E[7]-E[6],A.normal.z=E[11]-E[10],A.d=E[15]-E[14],A.normalize()}static GetLeftPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]+E[0],A.normal.y=E[7]+E[4],A.normal.z=E[11]+E[8],A.d=E[15]+E[12],A.normalize()}static GetRightPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]-E[0],A.normal.y=E[7]-E[4],A.normal.z=E[11]-E[8],A.d=E[15]-E[12],A.normalize()}static GetTopPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]-E[1],A.normal.y=E[7]-E[5],A.normal.z=E[11]-E[9],A.d=E[15]-E[13],A.normalize()}static GetBottomPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]+E[1],A.normal.y=E[7]+E[5],A.normal.z=E[11]+E[9],A.d=E[15]+E[13],A.normalize()}static GetPlanesToRef(v,A){Me.GetNearPlaneToRef(v,A[0]),Me.GetFarPlaneToRef(v,A[1]),Me.GetLeftPlaneToRef(v,A[2]),Me.GetRightPlaneToRef(v,A[3]),Me.GetTopPlaneToRef(v,A[4]),Me.GetBottomPlaneToRef(v,A[5])}}qe.Frustum=Me;var Ye={};Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Path2=void 0;const Qe=ve,Ze=me,Je=Nt;class De{constructor(v,A){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Qe.Vector2(v,A))}static StartingAt(v,A){return new De(v,A)}addLineTo(v,A){if(this.closed)return this;const E=new Qe.Vector2(v,A),R=this._points[this._points.length-1];return this._points.push(E),this._length+=E.subtract(R).length(),this}addArcTo(v,A,E,R,B=36){if(this.closed)return this;const O=this._points[this._points.length-1],z=new Qe.Vector2(v,A),M=new Qe.Vector2(E,R),W=new Ze.Arc2(O,z,M);let V=W.angle.radians()/B;W.orientation===Je.Orientation.CW&&(V*=-1);let H=W.startAngle.radians()+V;for(let v=0;v<B;v++){const v=Math.cos(H)*W.radius+W.centerPoint.x,A=Math.sin(H)*W.radius+W.centerPoint.y;this.addLineTo(v,A),H+=V}return this}close(){return this.closed=!0,this}length(){let v=this._length;if(!this.closed){const A=this._points[this._points.length-1];v+=this._points[0].subtract(A).length()}return v}getPoints(){return this._points}getPointAtLengthPosition(v){if(v<0||v>1)return Qe.Vector2.Zero();const A=v*this.length();let E=0;for(let v=0;v<this._points.length;v++){const R=(v+1)%this._points.length,B=this._points[v],O=this._points[R].subtract(B),z=O.length()+E;if(A>=E&&A<=z){const v=O.normalize(),R=A-E;return new Qe.Vector2(B.x+v.x*R,B.y+v.y*R)}E=z}return Qe.Vector2.Zero()}}Ye.Path2=De;var $e={};Object.defineProperty($e,"__esModule",{value:!0}),$e.Path3D=void 0;const tn=kt,nn=Nt,on=Ut;$e.Path3D=class{constructor(v,A=null,E){this.path=v,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(let A=0;A<v.length;A++)this._curve[A]=v[A].clone();this._raw=E||!1,this._compute(A)}getCurve(){return this._curve}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}update(v,A=null){for(let A=0;A<v.length;A++)this._curve[A].x=v[A].x,this._curve[A].y=v[A].y,this._curve[A].z=v[A].z;return this._compute(A),this}_compute(v){const A=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[A-1]=this._curve[A-1].subtract(this._curve[A-2]),this._raw||this._tangents[A-1].normalize();const E=this._tangents[0],R=this._normalVector(this._curve[0],E,v);let B,O,z,M;this._normals[0]=R,this._raw||this._normals[0].normalize(),this._binormals[0]=tn.Vector3.Cross(E,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let v=1;v<A;v++)B=this._getLastNonNullVector(v),v<A-1&&(O=this._getFirstNonNullVector(v),this._tangents[v]=B.add(O),this._tangents[v].normalize()),this._distances[v]=this._distances[v-1]+B.length(),z=this._tangents[v],M=this._binormals[v-1],this._normals[v]=tn.Vector3.Cross(M,z),this._raw||this._normals[v].normalize(),this._binormals[v]=tn.Vector3.Cross(z,this._normals[v]),this._raw||this._binormals[v].normalize()}_getFirstNonNullVector(v){let A=1,E=this._curve[v+A].subtract(this._curve[v]);for(;0===E.length()&&v+A+1<this._curve.length;)A++,E=this._curve[v+A].subtract(this._curve[v]);return E}_getLastNonNullVector(v){let A=1,E=this._curve[v].subtract(this._curve[v-A]);for(;0===E.length()&&v>A+1;)A++,E=this._curve[v].subtract(this._curve[v-A]);return E}_normalVector(v,A,E){let R,B=A.length();if(0===B&&(B=1),null==E){let v;v=on.Scalar.WithinEpsilon(Math.abs(A.y)/B,1,nn.Epsilon)?on.Scalar.WithinEpsilon(Math.abs(A.x)/B,1,nn.Epsilon)?on.Scalar.WithinEpsilon(Math.abs(A.z)/B,1,nn.Epsilon)?tn.Vector3.Zero():new tn.Vector3(0,0,1):new tn.Vector3(1,0,0):new tn.Vector3(0,-1,0),R=tn.Vector3.Cross(A,v)}else R=tn.Vector3.Cross(A,E),tn.Vector3.CrossToRef(R,A,R);return R.normalize(),R}};var rn={};Object.defineProperty(rn,"__esModule",{value:!0}),rn.Size=void 0;class je{constructor(v,A){this.width=v,this.height=A}get surface(){return this.width*this.height}static Zero(){return new je(0,0)}static Lerp(v,A,E){const R=v.width+(A.width-v.width)*E,B=v.height+(A.height-v.height)*E;return new je(R,B)}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let v=this.width||0;return v=397*v^(this.height||0),v}copyFrom(v){this.width=v.width,this.height=v.height}copyFromFloats(v,A){return this.width=v,this.height=A,this}set(v,A){return this.copyFromFloats(v,A)}multiplyByFloats(v,A){return new je(this.width*v,this.height*A)}clone(){return new je(this.width,this.height)}equals(v){return!!v&&this.width===v.width&&this.height===v.height}add(v){return new je(this.width+v.width,this.height+v.height)}subtract(v){return new je(this.width-v.width,this.height-v.height)}}rn.Size=je,function(v){var A=Ot&&Ot.__createBinding||(Object.create?function(v,A,E,R){void 0===R&&(R=E),Object.defineProperty(v,R,{enumerable:!0,get:function(){return A[E]}})}:function(v,A,E,R){void 0===R&&(R=E),v[R]=A[E]}),E=Ot&&Ot.__exportStar||function(v,E){for(var R in v)"default"===R||Object.prototype.hasOwnProperty.call(E,R)||A(E,v,R)};Object.defineProperty(v,"__esModule",{value:!0}),E(Nt,v),E(Lt,v),E(ye,v),E(me,v),E(Ee,v),E(Ie,v),E(Re,v),E(Pe,v),E(ke,v),E(qe,v),E(qt,v),E(Ye,v),E($e,v),E(Ve,v),E(Wt,v),E(Ut,v),E(rn,v),E(ve,v),E(kt,v),E(Vt,v),E(zt,v)}(zt);var sn,an,ln,un,hn={looping:!0,speed:1,weight:1,layer:0},cn=function(v){function e(A,E){void 0===E&&(E=hn);var R=v.call(this)||this;return R.isAnimationClip=!0,R.looping=hn.looping,R.weight=hn.weight,R.playing=!1,R.shouldReset=!1,R.speed=hn.speed,R.name=f("AnimClip"),R.layer=hn.layer,R.clip=A,R.setParams(o({},E)),R}return i(e,v),e.prototype.setParams=function(v){return this.looping=void 0!==v.looping?v.looping:this.looping,this.speed=v.speed||this.speed,this.weight=v.weight||this.weight,this.layer=v.layer||this.layer,this},e.prototype.toJSON=function(){var A=JSON.parse(JSON.stringify(v.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),A},e.prototype.play=function(v){var A;void 0===v&&(v=!1),null===(A=this.owner)||void 0===A||A.play(this,v)},e.prototype.pause=function(){var v;null===(v=this.owner)||void 0===v||v.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var v;null===(v=this.owner)||void 0===v||v.stop(this)},r([et.readonly,s("design:type",String)],e.prototype,"clip",void 0),r([et.field,s("design:type",Boolean)],e.prototype,"looping",void 0),r([et.field,s("design:type",Number)],e.prototype,"weight",void 0),r([et.field,s("design:type",Boolean)],e.prototype,"playing",void 0),r([et.field,s("design:type",Boolean)],e.prototype,"shouldReset",void 0),r([et.field,s("design:type",Number)],e.prototype,"speed",void 0),r([et.readonly,s("design:type",String)],e.prototype,"name",void 0),e}(et);v.InputEventType=void 0,(sn=v.InputEventType||(v.InputEventType={}))[sn.DOWN=0]="DOWN",sn[sn.UP=1]="UP",v.CameraMode=void 0,(an=v.CameraMode||(v.CameraMode={}))[an.FirstPerson=0]="FirstPerson",an[an.ThirdPerson=1]="ThirdPerson",an[an.BuildingToolGodMode=2]="BuildingToolGodMode",v.LandRole=void 0,(ln=v.LandRole||(v.LandRole={})).OWNER="owner",ln.OPERATOR="operator",v.ActionButton=void 0,(un=v.ActionButton||(v.ActionButton={})).POINTER="POINTER",un.PRIMARY="PRIMARY",un.SECONDARY="SECONDARY",un.ANY="ANY",un.FORWARD="FORWARD",un.BACKWARD="BACKWARD",un.RIGHT="RIGHT",un.LEFT="LEFT",un.JUMP="JUMP",un.WALK="WALK",un.ACTION_3="ACTION_3",un.ACTION_4="ACTION_4",un.ACTION_5="ACTION_5",un.ACTION_6="ACTION_6";var pn,dn,Ke=function(v){if(this.callback=v,!v||!("apply"in v)||!("call"in v))throw new Error("Callback is not a function");gn.ensureInstance()},fn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerDown")],e)}(Ke),yn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerUp")],e)}(Ke),en=function(v,A){this.fn=v,this.useRaycast=A},gn=function(){function e(){this.buttonIdMapping=[v.ActionButton.POINTER,v.ActionButton.PRIMARY,v.ActionButton.SECONDARY,v.ActionButton.ANY,v.ActionButton.FORWARD,v.ActionButton.BACKWARD,v.ActionButton.RIGHT,v.ActionButton.LEFT,v.ActionButton.JUMP,v.ActionButton.WALK,v.ActionButton.ACTION_3,v.ActionButton.ACTION_4,v.ActionButton.ACTION_5,v.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(v,A){var E;return o(o({},v),((E={})[A]={BUTTON_DOWN:[],BUTTON_UP:[]},E))}),{}),this.internalState=this.buttonIdMapping.reduce((function(v,A){var E;return o(o({},v),((E={})[A]={BUTTON_DOWN:!1},E))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(v){return this.internalState[v]},e.prototype.subscribe=function(v,A,E,R){var B=this;return this.subscriptions[A][v].push(new en(R,E)),function(){B.unsubscribe(v,A,R)}},e.prototype.unsubscribe=function(v,A,E){var R=this.getSubscriptionId(v,A,E);return R>-1&&this.subscriptions[A][v].splice(R,1)},e.prototype.handlePointerEvent=function(A){var E=this.getPointerById(A.buttonId);if(E){var R=o(o({},A),{button:E,direction:(new zt.Vector3).copyFrom(A.direction),origin:(new zt.Vector3).copyFrom(A.origin),hit:void 0}),B=A.hit?o(o({},A.hit),{hitPoint:(new zt.Vector3).copyFrom(A.hit.hitPoint),normal:(new zt.Vector3).copyFrom(A.hit.normal),worldNormal:(new zt.Vector3).copyFrom(A.hit.worldNormal)}):void 0;if(A.type===v.InputEventType.DOWN){this.internalState[E].BUTTON_DOWN=!0;for(var O=0;O<this.subscriptions[E].BUTTON_DOWN.length;O++)(z=this.subscriptions[E].BUTTON_DOWN[O]).useRaycast?R.hit=B:R.hit=void 0,z.fn(R);B&&B.entityId&&N.engine&&(W=(M=N.engine.entities[B.entityId])&&M.getComponentOrNull(fn))&&(R.hit=B,W.callback(R))}else{for(this.internalState[E].BUTTON_DOWN=!1,O=0;O<this.subscriptions[E].BUTTON_UP.length;O++){var z;(z=this.subscriptions[E].BUTTON_UP[O]).useRaycast?R.hit=B:R.hit=void 0,z.fn(R)}var M,W;B&&B.entityId&&N.engine&&(W=(M=N.engine.entities[B.entityId])&&M.getComponentOrNull(yn))&&(R.hit=B,W.callback(R))}}},e.prototype.getSubscriptionId=function(v,A,E){for(var R=0;R<this.subscriptions[A][v].length;R++)if(this.subscriptions[A][v][R].fn===E)return R;return-1},e.prototype.getPointerById=function(A){if(A<0||A>=this.buttonIdMapping.length)return null;var E=this.buttonIdMapping[A];return E===v.ActionButton.ANY?null:E},e}();v.CLASS_ID=void 0,(pn=v.CLASS_ID||(v.CLASS_ID={}))[pn.TRANSFORM=1]="TRANSFORM",pn[pn.UUID_CALLBACK=8]="UUID_CALLBACK",pn[pn.BOX_SHAPE=16]="BOX_SHAPE",pn[pn.SPHERE_SHAPE=17]="SPHERE_SHAPE",pn[pn.PLANE_SHAPE=18]="PLANE_SHAPE",pn[pn.CONE_SHAPE=19]="CONE_SHAPE",pn[pn.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",pn[pn.TEXT_SHAPE=21]="TEXT_SHAPE",pn[pn.NFT_SHAPE=22]="NFT_SHAPE",pn[pn.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",pn[pn.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",pn[pn.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",pn[pn.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",pn[pn.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",pn[pn.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",pn[pn.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",pn[pn.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",pn[pn.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",pn[pn.BILLBOARD=32]="BILLBOARD",pn[pn.ANIMATION=33]="ANIMATION",pn[pn.FONT=34]="FONT",pn[pn.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",pn[pn.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",pn[pn.GLTF_SHAPE=54]="GLTF_SHAPE",pn[pn.OBJ_SHAPE=55]="OBJ_SHAPE",pn[pn.AVATAR_SHAPE=56]="AVATAR_SHAPE",pn[pn.BASIC_MATERIAL=64]="BASIC_MATERIAL",pn[pn.PBR_MATERIAL=65]="PBR_MATERIAL",pn[pn.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",pn[pn.SOUND=67]="SOUND",pn[pn.TEXTURE=68]="TEXTURE",pn[pn.VIDEO_CLIP=70]="VIDEO_CLIP",pn[pn.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",pn[pn.AVATAR_TEXTURE=72]="AVATAR_TEXTURE",pn[pn.AUDIO_CLIP=200]="AUDIO_CLIP",pn[pn.AUDIO_SOURCE=201]="AUDIO_SOURCE",pn[pn.AUDIO_STREAM=202]="AUDIO_STREAM",pn[pn.GIZMOS=203]="GIZMOS",pn[pn.SMART_ITEM=204]="SMART_ITEM",pn[pn.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",pn[pn.AVATAR_ATTACH=206]="AVATAR_ATTACH",pn[pn.CAMERA_MODE_AREA=207]="CAMERA_MODE_AREA",pn[pn.NAME=300]="NAME",pn[pn.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",pn[pn.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",v.AvatarModifiers=void 0,(dn=v.AvatarModifiers||(v.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",dn.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var mn,vn=function(A){function n(v){var E=A.call(this)||this;return E.area=v.area,E.modifiers=v.modifiers,E.excludeIds=v.excludeIds,E}return i(n,A),r([et.field,s("design:type",Object)],n.prototype,"area",void 0),r([et.field,s("design:type",Array)],n.prototype,"modifiers",void 0),r([et.field,s("design:type",Array)],n.prototype,"excludeIds",void 0),r([P("engine.avatarModifierArea",v.CLASS_ID.AVATAR_MODIFIER_AREA),s("design:paramtypes",[Object])],n)}(et),bn=function(A){function n(v){void 0===v&&(v={});var E=A.call(this)||this;return E.position=v.position||zt.Vector3.Zero(),E.rotation=v.rotation||zt.Quaternion.Identity,E.scale=v.scale||new zt.Vector3(1,1,1),E}return i(n,A),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(v,A){void 0===A&&(A=zt.MathTmp.staticUp);var E=new zt.Matrix;return zt.Matrix.LookAtLHToRef(this.position,v,A,E),E.invert(),zt.Quaternion.FromRotationMatrixToRef(E,this.rotation),this},n.prototype.rotate=function(v,A){return this.rotation.multiplyInPlace(this.rotation.angleAxis(A,v)),this},n.prototype.translate=function(v){return this.position.addInPlace(v),this},r([et.field,s("design:type",zt.Vector3)],n.prototype,"position",void 0),r([et.field,s("design:type",zt.Quaternion)],n.prototype,"rotation",void 0),r([et.field,s("design:type",zt.Vector3)],n.prototype,"scale",void 0),r([P("engine.transform",v.CLASS_ID.TRANSFORM),s("design:paramtypes",[Object])],n)}(et);v.AttachToAvatarAnchorPointId=void 0,(mn=v.AttachToAvatarAnchorPointId||(v.AttachToAvatarAnchorPointId={}))[mn.Position=0]="Position",mn[mn.NameTag=1]="NameTag",mn[mn.LeftHand=2]="LeftHand",mn[mn.RightHand=3]="RightHand";var wn,xn=function(A){function n(E){void 0===E&&(E={});var R=A.call(this)||this;return R.avatarId=E.avatarId||"",R.anchorPointId=E.anchorPointId||v.AttachToAvatarAnchorPointId.Position,R}return i(n,A),r([et.field,s("design:type",String)],n.prototype,"avatarId",void 0),r([et.field,s("design:type",Number)],n.prototype,"anchorPointId",void 0),r([et.field,s("design:type",String)],n.prototype,"avatarSceneId",void 0),r([P("engine.transform",v.CLASS_ID.AVATAR_ATTACH),s("design:paramtypes",[Object])],n)}(et),Tn=function(A){function n(v,E,R){void 0===v&&(v=!0),void 0===E&&(E=!0),void 0===R&&(R=!0);var B=A.call(this)||this;return B.x=!0,B.y=!0,B.z=!0,B.x=v,B.y=E,B.z=R,B}return i(n,A),r([et.field,s("design:type",Boolean)],n.prototype,"x",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"y",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"z",void 0),r([P("engine.billboard",v.CLASS_ID.BILLBOARD),s("design:paramtypes",[Boolean,Boolean,Boolean])],n)}(et),An=function(v){function e(){var A=null!==v&&v.apply(this,arguments)||this;return A.withCollisions=!0,A.isPointerBlocker=!0,A.visible=!0,A}return i(e,v),r([et.field,s("design:type",Boolean)],e.prototype,"withCollisions",void 0),r([et.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),r([et.field,s("design:type",Boolean)],e.prototype,"visible",void 0),e}(et),Sn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([et.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.BOX_SHAPE)],n)}(An),Cn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.SPHERE_SHAPE)],n)}(An),En=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"segments",void 0),r([et.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CIRCLE_SHAPE)],n)}(An),_n=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.width=1,v.height=1,v}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"width",void 0),r([et.field,s("design:type",Number)],n.prototype,"height",void 0),r([et.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.PLANE_SHAPE)],n)}(An),In=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.radiusTop=0,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([et.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([et.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([et.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([et.field,s("design:type",Object)],n.prototype,"radius",void 0),r([et.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CONE_SHAPE)],n)}(An),Rn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.radiusTop=1,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([et.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([et.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([et.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([et.field,s("design:type",Object)],n.prototype,"radius",void 0),r([et.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CYLINDER_SHAPE)],n)}(An),Pn=function(A){function n(v){var E=A.call(this)||this;return E.src=v,E}return i(n,A),r([An.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.GLTF_SHAPE),s("design:paramtypes",[String])],n)}(An);v.PictureFrameStyle=void 0,(wn=v.PictureFrameStyle||(v.PictureFrameStyle={}))[wn.Classic=0]="Classic",wn[wn.Baroque_Ornament=1]="Baroque_Ornament",wn[wn.Diamond_Ornament=2]="Diamond_Ornament",wn[wn.Minimal_Wide=3]="Minimal_Wide",wn[wn.Minimal_Grey=4]="Minimal_Grey",wn[wn.Blocky=5]="Blocky",wn[wn.Gold_Edges=6]="Gold_Edges",wn[wn.Gold_Carved=7]="Gold_Carved",wn[wn.Gold_Wide=8]="Gold_Wide",wn[wn.Gold_Rounded=9]="Gold_Rounded",wn[wn.Metal_Medium=10]="Metal_Medium",wn[wn.Metal_Wide=11]="Metal_Wide",wn[wn.Metal_Slim=12]="Metal_Slim",wn[wn.Metal_Rounded=13]="Metal_Rounded",wn[wn.Pins=14]="Pins",wn[wn.Minimal_Black=15]="Minimal_Black",wn[wn.Minimal_White=16]="Minimal_White",wn[wn.Tape=17]="Tape",wn[wn.Wood_Slim=18]="Wood_Slim",wn[wn.Wood_Wide=19]="Wood_Wide",wn[wn.Wood_Twigs=20]="Wood_Twigs",wn[wn.Canvas=21]="Canvas",wn[wn.None=22]="None";var Bn,On=function(A){function n(E,R){void 0===R&&(R={});var B=A.call(this)||this;B.src=E;var O=new zt.Color3(.6404918,.611472,.8584906),z=v.PictureFrameStyle.Classic;return"r"in R?O=R:null!==R&&(R.color&&(O=R.color),R.style&&(z=R.style)),B.color=O,B.style=z,B}return i(n,A),r([An.readonly,s("design:type",String)],n.prototype,"src",void 0),r([An.readonly,s("design:type",Number)],n.prototype,"style",void 0),r([et.field,s("design:type",zt.Color3)],n.prototype,"color",void 0),r([N("engine.shape",v.CLASS_ID.NFT_SHAPE),s("design:paramtypes",[String,Object])],n)}(An),zn=function(A){function n(v,E){var R=A.call(this)||this,B=new RegExp("data:[a-z-]+/[a-z-]+;base64");if((v.length>2048||B.test(v))&&c(" Base64 textures will be deprecated in version 7 of decentraland-ecs"),R.src=v,E)for(var O in E)R[O]=E[O];return R}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"src",void 0),r([et.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([et.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([et.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.TEXTURE),s("design:paramtypes",[String,Object])],n)}(et),Nn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.states=[],v}return i(n,A),n.prototype.addClip=function(v){var A=this;return this.states.push(v),v.onChange((function(){A.dirty=!0})),v.owner=this,this},n.prototype.getClip=function(v){for(var A=0;A<this.states.length;A++){var E=this.states[A];if(E.clip===v)return E}var R=new cn(v);return this.addClip(R),R},n.prototype.stop=function(v){if(v)v.playing=!1,v.shouldReset=!0;else for(var A=0;A<this.states.length;A++){var E=this.states[A];this.stop(E)}},n.prototype.play=function(v,A){void 0===A&&(A=!1);for(var E=0;E<this.states.length;E++){var R=this.states[E];R.layer===v.layer&&v!==R&&this.pause(R)}A&&(v.shouldReset=!0),v.playing=!0,v.dirty=!0,v.data.nonce=Math.random()},n.prototype.pause=function(v){if(v)v.playing=!1;else for(var A=0;A<this.states.length;A++){var E=this.states[A];this.pause(E)}},r([et.readonly,s("design:type",Array)],n.prototype,"states",void 0),r([P("engine.animator",v.CLASS_ID.ANIMATION)],n)}(An),Ln=function(A){function n(v){var E=A.call(this)||this;return E.src=v,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.OBJ_SHAPE),s("design:paramtypes",[String])],n)}(An),Mn=function(A){function n(v){void 0===v&&(v="");var E=A.call(this)||this;return E.src=v,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.font",v.CLASS_ID.FONT),s("design:paramtypes",[String])],n)}(et);v.Fonts=void 0,(Bn=v.Fonts||(v.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",Bn.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",Bn.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",Bn.LiberationSans="builtin:LiberationSans SDF",Bn.SansSerif="SansSerif",Bn.SansSerif_Heavy="SansSerif_Heavy",Bn.SansSerif_Bold="SansSerif_Bold",Bn.SansSerif_SemiBold="SansSerif_SemiBold";var Fn,Dn=function(A){function n(v){var E=A.call(this)||this;return E.outlineWidth=0,E.outlineColor=new zt.Color3(1,1,1),E.color=new zt.Color3(1,1,1),E.fontSize=10,E.opacity=1,E.value="",E.lineSpacing="0px",E.lineCount=0,E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=new zt.Color3(1,1,1),E.hTextAlign="center",E.vTextAlign="center",E.width=1,E.height=1,E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.billboard=!1,E.visible=!0,v&&(E.value=v),E}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([et.field,s("design:type",zt.Color3)],n.prototype,"outlineColor",void 0),r([et.field,s("design:type",zt.Color3)],n.prototype,"color",void 0),r([et.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([et.component,s("design:type",Mn)],n.prototype,"font",void 0),r([et.field,s("design:type",Number)],n.prototype,"opacity",void 0),r([et.field,s("design:type",String)],n.prototype,"value",void 0),r([et.field,s("design:type",String)],n.prototype,"lineSpacing",void 0),r([et.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([et.field,s("design:type",zt.Color3)],n.prototype,"shadowColor",void 0),r([et.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([et.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([et.field,s("design:type",Number)],n.prototype,"width",void 0),r([et.field,s("design:type",Number)],n.prototype,"height",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"billboard",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"visible",void 0),r([P("engine.text",v.CLASS_ID.TEXT_SHAPE),s("design:paramtypes",[String])],n)}(et);v.TransparencyMode=void 0,(Fn=v.TransparencyMode||(v.TransparencyMode={}))[Fn.OPAQUE=0]="OPAQUE",Fn[Fn.ALPHA_TEST=1]="ALPHA_TEST",Fn[Fn.ALPHA_BLEND=2]="ALPHA_BLEND",Fn[Fn.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",Fn[Fn.AUTO=4]="AUTO";var kn,Wn=function(A){function n(){var E=null!==A&&A.apply(this,arguments)||this;return E.alphaTest=.5,E.castShadows=!0,E.transparencyMode=v.TransparencyMode.AUTO,E}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([et.field,s("design:type",Object)],n.prototype,"albedoColor",void 0),r([et.field,s("design:type",zt.Color3)],n.prototype,"emissiveColor",void 0),r([et.field,s("design:type",Number)],n.prototype,"metallic",void 0),r([et.field,s("design:type",Number)],n.prototype,"roughness",void 0),r([et.field,s("design:type",zt.Color3)],n.prototype,"reflectivityColor",void 0),r([et.field,s("design:type",Number)],n.prototype,"directIntensity",void 0),r([et.field,s("design:type",Number)],n.prototype,"microSurface",void 0),r([et.field,s("design:type",Number)],n.prototype,"emissiveIntensity",void 0),r([et.field,s("design:type",Number)],n.prototype,"specularIntensity",void 0),r([et.component,s("design:type",Object)],n.prototype,"albedoTexture",void 0),r([et.component,s("design:type",Object)],n.prototype,"alphaTexture",void 0),r([et.component,s("design:type",Object)],n.prototype,"emissiveTexture",void 0),r([et.component,s("design:type",Object)],n.prototype,"bumpTexture",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([et.field,s("design:type",Number)],n.prototype,"transparencyMode",void 0),r([N("engine.material",v.CLASS_ID.PBR_MATERIAL)],n)}(et),qn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.alphaTest=.5,v.castShadows=!0,v}return i(n,A),r([et.component,s("design:type",Object)],n.prototype,"texture",void 0),r([et.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([N("engine.material",v.CLASS_ID.BASIC_MATERIAL)],n)}(et),Vn=function(v){function e(A){var E=v.call(this)||this;if(E.uuid=f("UUID"),!A||!("apply"in A)||!("call"in A))throw new Error("Callback is not a function");return E.callback=A,E}return i(e,v),e.uuidEvent=function(v,A){if(delete v[A]){var E=A+"_"+Math.random();v[E]=void 0,Object.defineProperty(v,E,o(o({},Object.getOwnPropertyDescriptor(v,E)),{enumerable:!1})),Object.defineProperty(v,A.toString(),{get:function(){return this[E]},set:function(v){var R=this[E];if(v){if(!(v instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[A]=v.uuid}else this.data[A]=null;if(this[E]=v,v!==R){this.dirty=!0;for(var B=0;B<this.subscriptions.length;B++)this.subscriptions[B](A,v,R)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([et.field,s("design:type",Function)],e.prototype,"callback",void 0),e}(et),Un=function(A){function n(){var E=null!==A&&A.apply(this,arguments)||this;return E.button=v.ActionButton.ANY,E.hoverText="Interact",E.distance=10,E.showFeedback=!0,E}return i(n,A),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([et.field,s("design:type",String)],n.prototype,"button",void 0),r([et.field,s("design:type",String)],n.prototype,"hoverText",void 0),r([et.field,s("design:type",Number)],n.prototype,"distance",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"showFeedback",void 0),n}(Vn),jn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="onPointerLock",v}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onPointerLock",v.CLASS_ID.UUID_CALLBACK)],n)}(Vn),Hn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="onAnimationEnd",v}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onAnimationEnd",v.CLASS_ID.UUID_CALLBACK)],n)}(Vn),Gn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([P("engine.smartItem",v.CLASS_ID.SMART_ITEM)],n)}(et),Xn=function(A){function n(v){var E=A.call(this)||this;return E.url=v,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"url",void 0),r([N("engine.VideoClip",v.CLASS_ID.VIDEO_CLIP),s("design:paramtypes",[String])],n)}(et);v.VideoStatus=void 0,(kn=v.VideoStatus||(v.VideoStatus={}))[kn.NONE=0]="NONE",kn[kn.ERROR=1]="ERROR",kn[kn.LOADING=2]="LOADING",kn[kn.READY=3]="READY",kn[kn.PLAYING=4]="PLAYING",kn[kn.BUFFERING=5]="BUFFERING";var Yn,Qn=function(A){function n(E,R){var B=A.call(this)||this;if(B.volume=1,B.playbackRate=1,B.loop=!1,B.seek=-1,B._position=-1,B._videoLength=-1,B._status=v.VideoStatus.NONE,B.playing=!1,!(E instanceof Xn))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(B.videoClipId=D(E),R)for(var O in R)B[O]=R[O];return B}return i(n,A),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(v){this.seek=v,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var v=JSON.parse(JSON.stringify(A.prototype.toJSON.call(this)));return this.seek=-1,v}return A.prototype.toJSON.call(this)},n.prototype.update=function(A){A.videoClipId===this.videoClipId&&(this._status=A.videoStatus||v.VideoStatus.NONE,this._videoLength=A.totalVideoLength,this._position=A.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([et.readonly,s("design:type",String)],n.prototype,"videoClipId",void 0),r([et.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([et.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([et.field,s("design:type",Number)],n.prototype,"volume",void 0),r([et.field,s("design:type",Number)],n.prototype,"playbackRate",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([et.field,s("design:type",Number)],n.prototype,"seek",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([N("engine.VideoTexture",v.CLASS_ID.VIDEO_TEXTURE),s("design:paramtypes",[Xn,Object])],n)}(et),Zn=function(A){function n(v){var E=A.call(this)||this;return E.area=v.area,E.cameraMode=v.cameraMode,E}return i(n,A),r([et.field,s("design:type",Object)],n.prototype,"area",void 0),r([et.field,s("design:type",Number)],n.prototype,"cameraMode",void 0),r([P("engine.cameraModeArea",v.CLASS_ID.CAMERA_MODE_AREA),s("design:paramtypes",[Object])],n)}(et),Kn=function(A){function n(v,E){var R=A.call(this)||this;if(R.userId=v,E)for(var B in E)R[B]=E[B];return R}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"userId",void 0),r([et.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([et.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([et.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.AVATAR_TEXTURE),s("design:paramtypes",[String,Object])],n)}(et),Jn=function(){function e(){var A=this;this.position=new zt.Vector3,this.rotation=new zt.Quaternion,this.feetPosition=new zt.Vector3,this.worldPosition=new zt.Vector3,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=v.CameraMode.ThirdPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(v){switch(v.type){case"positionChanged":A.positionChanged(v.data);break;case"rotationChanged":A.rotationChanged(v.data);break;case"cameraModeChanged":A.cameraModeChanged(v.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return A.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return A.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return A.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return A.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return A.lastEventPosition.y-A.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return A.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return A.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return A.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return A.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(v){this.lastEventPosition=v.position,this.lastEventWorldPosition=v.cameraPosition,this._playerHeight=v.playerHeight},e.prototype.rotationChanged=function(v){this.lastEventRotation=v.quaternion},e.prototype.cameraModeChanged=function(v){this._cameraMode=v.cameraMode},e}();!function(v){v.HitFirst="rqhf",v.HitAll="rqha"}(Yn||(Yn={}));var $n,ti=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(v){var A=Jn.instance.rotation,E=zt.Matrix.Identity();A.toRotationMatrix(E);var R=zt.Vector3.TransformCoordinates(zt.Vector3.Forward(),E);return{origin:Jn.instance.position,direction:R,distance:v}},t.prototype.getRayFromPositions=function(v,A){var E=A.subtract(v),R=E.length();return{origin:v,direction:E.normalize(),distance:R}},t.prototype.hitFirst=function(v,A,E){var R="number"==typeof E?Yn.HitFirst+E:m();this.queries[R]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitFirst",ray:v})},t.prototype.hitAll=function(v,A,E){var R="number"==typeof E?Yn.HitAll+E:m();this.queries[R]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitAll",ray:v})},t.prototype.hitFirstAvatar=function(v,A){c("not implemented yet")},t.prototype.hitAllAvatars=function(v,A){c("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t}(),ei=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(pt,this,(function(v){"HitFirst"===v.payload.queryType?ti.instance.handleRaycastHitFirstResponse(v):"HitAll"===v.payload.queryType&&ti.instance.handleRaycastHitAllResponse(v)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),ni=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(dt,this,(function(v){gn.instance.handlePointerEvent(v.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),ii=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(v){v.eventManager.addListener(ct,this,this.handleEvent),v.eventManager.addListener(M,this,this.componentAdded),v.eventManager.addListener(z,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(v){for(var A in v.components){var E=v.components[A];E instanceof Vn&&(this.handlerMap[E.uuid]=E)}},t.prototype.onRemoveEntity=function(v){for(var A in v.components){var E=v.components[A];E instanceof Vn&&delete this.handlerMap[E.uuid]}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var A=v.entity.components[v.componentName];A instanceof Vn&&(this.handlerMap[A.uuid]=A)}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&v.component instanceof Vn&&delete this.handlerMap[v.component.uuid]},t.prototype.handleEvent=function(v){if(v.uuid in this.handlerMap){var A=this.handlerMap[v.uuid];A&&A.callback&&"call"in A.callback&&A.callback(v.payload)}},t}(),oi=new ei,ri=new ni,si=new ii,ai=function(A){function n(v){var E=A.call(this)||this;return E.loop=!1,E.volume=1,E.url=v,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"url",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([et.field,s("design:type",String)],n.prototype,"loadingCompleteEventId",void 0),r([et.field,s("design:type",Number)],n.prototype,"volume",void 0),r([N("engine.AudioClip",v.CLASS_ID.AUDIO_CLIP),s("design:paramtypes",[String])],n)}(et),li=function(A){function n(v){var E=A.call(this)||this;if(E.audioClip=v,E.loop=!1,E.volume=1,E.playing=!1,E.pitch=1,E.playedAtTimestamp=Date.now(),!(v instanceof ai))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return E.audioClipId=D(v),E}return i(n,A),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([et.readonly,s("design:type",String)],n.prototype,"audioClipId",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([et.field,s("design:type",Number)],n.prototype,"volume",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([et.field,s("design:type",Number)],n.prototype,"pitch",void 0),r([et.field,s("design:type",Number)],n.prototype,"playedAtTimestamp",void 0),r([P("engine.AudioSource",v.CLASS_ID.AUDIO_SOURCE),s("design:paramtypes",[ai])],n)}(et),ui=function(A){function n(v){var E=A.call(this)||this;return E.playing=!1,E.volume=1,E.url=v,E.playing=!0,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"url",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([et.field,s("design:type",Number)],n.prototype,"volume",void 0),r([P("engine.AudioStream",v.CLASS_ID.AUDIO_STREAM),s("design:paramtypes",[String])],n)}(et);v.Gizmo=void 0,($n=v.Gizmo||(v.Gizmo={})).MOVE="MOVE",$n.ROTATE="ROTATE",$n.SCALE="SCALE",$n.NONE="NONE";var hi,ci=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="gizmoEvent",v}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.gizmoEvent",v.CLASS_ID.UUID_CALLBACK)],n)}(Vn),pi=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.position=!0,v.rotation=!0,v.scale=!0,v.cycle=!0,v.localReference=!1,v}return i(n,A),r([et.field,s("design:type",Boolean)],n.prototype,"position",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"rotation",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"scale",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"cycle",void 0),r([et.field,s("design:type",String)],n.prototype,"selectedGizmo",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"localReference",void 0),r([P("engine.gizmos",v.CLASS_ID.GIZMOS)],n)}(et),di=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onFocus",si.handlerMap[E.uuid]=E,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onFocus",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),fi=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onTextSubmit",si.handlerMap[E.uuid]=E,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onTextSubmit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),yi=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onBlur",si.handlerMap[E.uuid]=E,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onBlur",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),gi=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onEnter",si.handlerMap[E.uuid]=E,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),mi=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onChange",si.handlerMap[E.uuid]=E,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onChange",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),vi=function(A){function n(v,E){var R=A.call(this,v)||this;return R.type="onClick",si.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onClick",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Un),bi=function(A){function n(v,E){var R=A.call(this,v)||this;return R.type="pointerDown",si.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerDown",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Un),wi=function(A){function n(v,E){var R=A.call(this,v)||this;return R.type="pointerUp",si.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerUp",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Un),xi=function(A){function n(v,E){var R=A.call(this,v)||this;return R.type="pointerHoverEnter",si.handlerMap[R.uuid]=R,E&&E.distance&&(R.distance=E.distance),R}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Un),Ti=function(A){function n(v){var E=A.call(this,v)||this;return E.type="pointerHoverExit",si.handlerMap[E.uuid]=E,E.distance=160,E}return i(n,A),r([et.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverExit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Un),Ai=function(v){function e(A){var E=v.call(this)||this;return E.name=null,E.visible=!0,E.opacity=1,E.hAlign="center",E.vAlign="center",E.width="100px",E.height="50px",E.positionX="0px",E.positionY="0px",E.isPointerBlocker=!0,A&&(E._parent=A,E.data.parentComponent=D(A)),E}return i(e,v),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([et.field,s("design:type",Object)],e.prototype,"name",void 0),r([et.field,s("design:type",Boolean)],e.prototype,"visible",void 0),r([et.field,s("design:type",Number)],e.prototype,"opacity",void 0),r([et.field,s("design:type",String)],e.prototype,"hAlign",void 0),r([et.field,s("design:type",String)],e.prototype,"vAlign",void 0),r([et.uiValue,s("design:type",Object)],e.prototype,"width",void 0),r([et.uiValue,s("design:type",Object)],e.prototype,"height",void 0),r([et.uiValue,s("design:type",Object)],e.prototype,"positionX",void 0),r([et.uiValue,s("design:type",Object)],e.prototype,"positionY",void 0),r([et.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),e}(et),Si=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_FULLSCREEN_SHAPE),s("design:paramtypes",[])],n)}(Ai),Ci=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_WORLD_SPACE_SHAPE),s("design:paramtypes",[])],n)}(Ai),Ei=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_SCREEN_SPACE_SHAPE),s("design:paramtypes",[])],n)}(Ai),_i=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.thickness=0,v.color=zt.Color4.Clear(),v.alignmentUsesSize=!0,v}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"color",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"alignmentUsesSize",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_RECT)],n)}(Ai);v.UIStackOrientation=void 0,(hi=v.UIStackOrientation||(v.UIStackOrientation={}))[hi.VERTICAL=0]="VERTICAL",hi[hi.HORIZONTAL=1]="HORIZONTAL";var Ii=function(A){function n(){var E=null!==A&&A.apply(this,arguments)||this;return E.adaptWidth=!0,E.adaptHeight=!0,E.color=zt.Color4.Clear(),E.stackOrientation=v.UIStackOrientation.VERTICAL,E.spacing=0,E}return i(n,A),r([et.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"color",void 0),r([et.field,s("design:type",Number)],n.prototype,"stackOrientation",void 0),r([et.field,s("design:type",Number)],n.prototype,"spacing",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_STACK)],n)}(Ai),Pi=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.fontSize=10,v.fontWeight="normal",v.thickness=0,v.cornerRadius=0,v.color=zt.Color4.White(),v.background=zt.Color4.White(),v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=zt.Color4.Black(),v.text="button",v}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([et.field,s("design:type",String)],n.prototype,"fontWeight",void 0),r([et.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([et.field,s("design:type",Number)],n.prototype,"cornerRadius",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"color",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"background",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"shadowColor",void 0),r([et.field,s("design:type",String)],n.prototype,"text",void 0),r([N("engine.shape",v.CLASS_ID.UI_BUTTON_SHAPE)],n)}(Ai),Bi=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.outlineWidth=0,v.outlineColor=zt.Color4.White(),v.color=zt.Color4.White(),v.fontSize=10,v.fontAutoSize=!1,v.value="",v.lineSpacing=0,v.lineCount=0,v.adaptWidth=!1,v.adaptHeight=!1,v.textWrapping=!1,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=zt.Color4.Black(),v.hTextAlign="left",v.vTextAlign="bottom",v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"outlineColor",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"color",void 0),r([et.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"fontAutoSize",void 0),r([et.component,s("design:type",Mn)],n.prototype,"font",void 0),r([et.field,s("design:type",String)],n.prototype,"value",void 0),r([et.field,s("design:type",Number)],n.prototype,"lineSpacing",void 0),r([et.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"shadowColor",void 0),r([et.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([et.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([N("engine.shape",v.CLASS_ID.UI_TEXT_SHAPE)],n)}(Ai),Oi=function(A){function n(v){var E=A.call(this,v)||this;return E.outlineWidth=0,E.outlineColor=zt.Color4.Black(),E.color=zt.Color4.Clear(),E.fontSize=10,E.value="",E.placeholder="",E.margin=10,E.hTextAlign="left",E.vTextAlign="bottom",E.focusedBackground=zt.Color4.Black(),E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=zt.Color4.White(),E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.onTextSubmit=null,E.onChanged=null,E.onFocus=null,E.onBlur=null,E.onTextChanged=new mi((function(v){var A=v.value,R=A.value,B=A.isSubmit,O=E.dirty;if(E.value=R,E.dirty=O,B&&E.onTextSubmit){var z={text:R};E.onTextSubmit.callback(z)}else if(!B&&E.onChanged){var M={value:R,pointerId:v.pointerId};E.onChanged.callback(M)}})),E}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"outlineColor",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"color",void 0),r([et.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([et.component,s("design:type",Mn)],n.prototype,"font",void 0),r([et.field,s("design:type",String)],n.prototype,"value",void 0),r([et.field,s("design:type",String)],n.prototype,"placeholder",void 0),r([et.field,s("design:type",Number)],n.prototype,"margin",void 0),r([et.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([et.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"focusedBackground",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([et.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"shadowColor",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Vn.uuidEvent,s("design:type",mi)],n.prototype,"onTextChanged",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onFocus",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onBlur",void 0),r([N("engine.shape",v.CLASS_ID.UI_INPUT_TEXT_SHAPE),s("design:paramtypes",[Object])],n)}(Ai),zi=function(A){function n(v,E){var R=A.call(this,v)||this;return R.sourceLeft=0,R.sourceTop=0,R.sourceWidth=1,R.sourceHeight=1,R.paddingTop=0,R.paddingRight=0,R.paddingBottom=0,R.paddingLeft=0,R.sizeInPixels=!0,R.onClick=null,R.source=E,R}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"sourceLeft",void 0),r([et.field,s("design:type",Number)],n.prototype,"sourceTop",void 0),r([et.field,s("design:type",Number)],n.prototype,"sourceWidth",void 0),r([et.field,s("design:type",Number)],n.prototype,"sourceHeight",void 0),r([et.component,s("design:type",Object)],n.prototype,"source",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"sizeInPixels",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onClick",void 0),r([N("engine.shape",v.CLASS_ID.UI_IMAGE_SHAPE),s("design:paramtypes",[Ai,Object])],n)}(Ai),Ni=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.valueX=0,v.valueY=0,v.backgroundColor=zt.Color4.Clear(),v.isHorizontal=!1,v.isVertical=!1,v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.onChanged=null,v}return i(n,A),r([et.field,s("design:type",Number)],n.prototype,"valueX",void 0),r([et.field,s("design:type",Number)],n.prototype,"valueY",void 0),r([et.field,s("design:type",zt.Color4)],n.prototype,"backgroundColor",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"isHorizontal",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"isVertical",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([et.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onChanged",void 0),r([N("engine.shape",v.CLASS_ID.UI_SLIDER_SHAPE)],n)}(Ai),Li=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.useDummyModel=!1,v.talking=!1,v}var E;return i(n,A),E=n,n.Dummy=function(){var v=new E;return v.useDummyModel=!0,v},r([et.field,s("design:type",String)],n.prototype,"id",void 0),r([et.field,s("design:type",String)],n.prototype,"name",void 0),r([et.field,s("design:type",String)],n.prototype,"expressionTriggerId",void 0),r([et.field,s("design:type",Number)],n.prototype,"expressionTriggerTimestamp",void 0),r([et.field,s("design:type",String)],n.prototype,"bodyShape",void 0),r([et.field,s("design:type",Array)],n.prototype,"wearables",void 0),r([et.field,s("design:type",Object)],n.prototype,"skinColor",void 0),r([et.field,s("design:type",Object)],n.prototype,"hairColor",void 0),r([et.field,s("design:type",Object)],n.prototype,"eyeColor",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"useDummyModel",void 0),r([et.field,s("design:type",Boolean)],n.prototype,"talking",void 0),E=r([P("engine.avatarShape",v.CLASS_ID.AVATAR_SHAPE)],n)}(et),Mi=null,Fi=null,Di=null;function Ri(){return Di||(Di=new ht),Di}var ki=function(){function t(){var v=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!Fi){(Fi=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(v){Mi=v}));var v=Ri();dcl.subscribe("comms"),dcl.onEvent((function(A){"comms"===A.type&&v.notifyObservers(A.data)}))}return Fi}().then((function(){v.connected=!0,v.flush()}))}return t.prototype.on=function(v,A){return Ri().add((function(E){try{var R=JSON.parse(E.message);R.message===v&&A(R.payload,E.sender)}catch(E){dcl.error("Error parsing comms message "+(E.message||""),E)}}))},t.prototype.sendRaw=function(v){this.messageQueue.push(v),this.connected&&this.flush()},t.prototype.emit=function(v,A){var E=JSON.stringify({message:v,payload:A});this.sendRaw(E),Ri().notifyObservers({message:E,sender:"self"})},t.prototype.flush=function(){var v=this;if(0!==this.messageQueue.length&&this.connected&&Mi&&!this.flushing){var A=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(Mi.rpcHandle,"send",[A]).then((function(A){v.flushing=!1,v.flush()}),(function(A){v.flushing=!1,y("Error flushing MessageBus",A)}))}},t}(),Wi=new it("scene");Wi.uuid="0";var qi=new ot(Wi);N.engine=qi,"undefined"!=typeof dcl&&(qi.addSystem(new Bt(dcl),1/0),mt(dcl)),qi.addSystem(si),qi.addSystem(ri),qi.addSystem(oi),v.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",v.Angle=zt.Angle,v.AnimationState=cn,v.Animator=Nn,v.Arc2=zt.Arc2,v.AttachToAvatar=xn,v.Attachable=A,v.AudioClip=ai,v.AudioSource=li,v.AudioStream=ui,v.AvatarModifierArea=vn,v.AvatarShape=Li,v.AvatarTexture=Kn,v.Axis=zt.Axis,v.BasicMaterial=qn,v.BezierCurve=zt.BezierCurve,v.Billboard=Tn,v.BoxShape=Sn,v.Camera=Jn,v.CameraModeArea=Zn,v.CircleShape=En,v.Color3=zt.Color3,v.Color4=zt.Color4,v.Component=P,v.ComponentAdded=M,v.ComponentGroup=nt,v.ComponentRemoved=z,v.ConeShape=In,v.Curve3=zt.Curve3,v.CylinderShape=Rn,v.DEG2RAD=zt.DEG2RAD,v.DisposableComponent=N,v.DisposableComponentCreated=K,v.DisposableComponentRemoved=J,v.DisposableComponentUpdated=$,v.Engine=ot,v.Entity=it,v.Epsilon=zt.Epsilon,v.EventConstructor=x,v.EventManager=B,v.Font=Mn,v.Frustum=zt.Frustum,v.GLTFShape=Pn,v.Gizmos=pi,v.GlobalPointerDown=fn,v.GlobalPointerUp=yn,v.Input=gn,v.Material=Wn,v.Matrix=zt.Matrix,v.MessageBus=ki,v.MultiObserver=ut,v.NFTShape=On,v.OBJShape=Ln,v.Observable=ht,v.ObservableComponent=et,v.Observer=Y,v.ObserverEventState=lt,v.OnAnimationEnd=Hn,v.OnBlur=yi,v.OnChanged=mi,v.OnClick=vi,v.OnEnter=gi,v.OnFocus=di,v.OnGizmoEvent=ci,v.OnPointerDown=bi,v.OnPointerHoverEnter=xi,v.OnPointerHoverExit=Ti,v.OnPointerLock=jn,v.OnPointerUUIDEvent=Un,v.OnPointerUp=wi,v.OnTextSubmit=fi,v.OnUUIDEvent=Vn,v.Orientation=zt.Orientation,v.ParentChanged=W,v.Path2=zt.Path2,v.Path3D=zt.Path3D,v.PhysicsCast=ti,v.Plane=zt.Plane,v.PlaneShape=_n,v.PointerEvent=dt,v.PointerEventComponent=Ke,v.PointerEventSystem=ni,v.Quaternion=zt.Quaternion,v.RAD2DEG=zt.RAD2DEG,v.RaycastEventSystem=ei,v.RaycastResponse=pt,v.Scalar=zt.Scalar,v.Shape=An,v.Size=zt.Size,v.SmartItem=Gn,v.Space=zt.Space,v.SphereShape=Cn,v.Subscription=en,v.TextShape=Dn,v.Texture=zn,v.ToGammaSpace=zt.ToGammaSpace,v.ToLinearSpace=zt.ToLinearSpace,v.Transform=bn,v.UIButton=Pi,v.UICanvas=Ei,v.UIContainerRect=_i,v.UIContainerStack=Ii,v.UIFullScreen=Si,v.UIImage=zi,v.UIInputText=Oi,v.UIScrollRect=Ni,v.UIShape=Ai,v.UIText=Bi,v.UIValue=V,v.UIWorldSpace=Ci,v.UUIDEvent=ct,v.UUIDEventSystem=ii,v.Vector2=zt.Vector2,v.Vector3=zt.Vector3,v.Vector4=zt.Vector4,v.VideoClip=Xn,v.VideoTexture=Qn,v._initEventObservables=mt,v.buildArray=function(v,A){for(var E=[],R=0;R<v;++R)E.push(A());return E},v.engine=qi,v.error=y,v.executeTask=G,v.getComponentClassId=L,v.getComponentId=D,v.getComponentName=F,v.getMessageObserver=Ri,v.isDisposableComponent=U,v.log=c,v.newId=f,v.onCameraModeChangedObservable=ft,v.onEnterScene=vt,v.onEnterSceneObservable=gt,v.onIdleStateChangedObservable=yt,v.onLeaveScene=wt,v.onLeaveSceneObservable=bt,v.onPlayerClickedObservable=Pt,v.onPlayerConnectedObservable=_t,v.onPlayerDisconnectedObservable=It,v.onPlayerExpressionObservable=Tt,v.onPointerLockedStateChange=At,v.onProfileChanged=Ct,v.onRealmChangedObservable=Rt,v.onSceneReadyObservable=xt,v.onVideoEvent=St,v.openExternalURL=function(v){"undefined"!=typeof dcl?dcl.openExternalUrl(v):y("ERROR: openExternalURL dcl is undefined")},v.openNFTDialog=function(v,A){if(void 0===A&&(A=null),"undefined"!=typeof dcl){var E=v.match(/ethereum:\/\/(.+)\/(.+)/);if(!E||E.length<3)return;dcl.openNFTDialog(E[1],E[2],A)}else y("ERROR: openNFTDialog dcl is undefined")},v.pointerEventSystem=ri,v.raycastEventSystem=oi,v.teleportTo=function(v){var A;A=[v],void 0===st&&"undefined"!=typeof dcl&&(st=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==st&&"undefined"!=typeof dcl&&st.then((function(v){dcl.callRpc(v.rpcHandle,"requestTeleport",A)}))},v.uuid=m,v.uuidEventSystem=si,Object.defineProperty(v,"__esModule",{value:!0})}(this.self=this.self||{});var __decorate=this&&this.__decorate||function(v,A,E,R){var B,O=arguments.length,z=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,A,E,R);else for(var M=v.length-1;M>=0;M--)(B=v[M])&&(z=(O<3?B(z):O>3?B(A,E,z):B(A,E))||z);return O>3&&z&&Object.defineProperty(A,E,z),z},__values=this&&this.__values||function(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var B in A=arguments[E])Object.prototype.hasOwnProperty.call(A,B)&&(v[B]=A[B]);return v}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(v,A,E,R){return new(E||(E=Promise))((function(B,O){function fulfilled(v){try{step(R.next(v))}catch(v){O(v)}}function rejected(v){try{step(R.throw(v))}catch(v){O(v)}}function step(v){var A;v.done?B(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(fulfilled,rejected)}step((R=R.apply(v,A||[])).next())}))},__generator=this&&this.__generator||function(v,A){var E,R,B,O,z={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return O={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function verb(O){return function(M){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;z;)try{if(E=1,R&&(B=2&O[0]?R.return:O[0]?R.throw||((B=R.return)&&B.call(R),0):R.next)&&!(B=B.call(R,O[1])).done)return B;switch(R=0,B&&(O=[2&O[0],B.value]),O[0]){case 0:case 1:B=O;break;case 4:return z.label++,{value:O[1],done:!1};case 5:z.label++,R=O[1],O=[0];continue;case 7:O=z.ops.pop(),z.trys.pop();continue;default:if(!((B=(B=z.trys).length>0&&B[B.length-1])||6!==O[0]&&2!==O[0])){z=0;continue}if(3===O[0]&&(!B||O[1]>B[0]&&O[1]<B[3])){z.label=O[1];break}if(6===O[0]&&z.label<B[1]){z.label=B[1],B=O;break}if(B&&z.label<B[2]){z.label=B[2],z.ops.push(O);break}B[2]&&z.ops.pop(),z.trys.pop();continue}O=A.call(v,z)}catch(v){O=[6,v],R=0}finally{E=B=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,M])}}},__createBinding=this&&this.__createBinding||(Object.create?function(v,A,E,R){void 0===R&&(R=E),Object.defineProperty(v,R,{enumerable:!0,get:function(){return A[E]}})}:function(v,A,E,R){void 0===R&&(R=E),v[R]=A[E]}),__exportStar=this&&this.__exportStar||function(v,A){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(A,E)||__createBinding(A,v,E)},__read=this&&this.__read||function(v,A){var E="function"==typeof Symbol&&v[Symbol.iterator];if(!E)return v;var R,B,O=E.call(v),z=[];try{for(;(void 0===A||A-- >0)&&!(R=O.next()).done;)z.push(R.value)}catch(v){B={error:v}}finally{try{R&&!R.done&&(E=O.return)&&E.call(O)}finally{if(B)throw B.error}}return z},__spreadArray=this&&this.__spreadArray||function(v,A){for(var E=0,R=A.length,B=v.length;E<R;E++,B++)v[B]=A[E];return v};define("dcl-quests-client/quests-client-amd",(function(){var v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(v){var A={exports:{}};return v(A,A.exports),A.exports}var A=n((function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.fromBase64=A.toBase64=void 0;var E="function"==typeof btoa?btoa:function(v){return Buffer.from(v).toString("base64")},R="function"==typeof atob?atob:function(v){return Buffer.from(v,"base64").toString("utf-8")};A.toBase64=function(v){return E(v)},A.fromBase64=function(v){return R(v)}})),E=n((function(v,E){function n(v){return v.split("").reverse().join("")}Object.defineProperty(E,"__esModule",{value:!0}),E.DefObf=void 0,E.DefObf=new(function(){function t(){}return t.prototype.obf=function(v){return n(A.toBase64(v)).replace(/=/g,"_")},t.prototype.deobf=function(v){return A.fromBase64(n(v.replace(/_/g,"=")))},t}())})),R=n((function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.AUTH_METADATA_HEADER=A.AUTH_TIMESTAMP_HEADER=A.AUTH_CHAIN_HEADER_PREFIX=void 0,A.AUTH_CHAIN_HEADER_PREFIX="x-identity-auth-chain-",A.AUTH_TIMESTAMP_HEADER="x-identity-timestamp",A.AUTH_METADATA_HEADER="x-identity-metadata"})),B=n((function(v,A){var E,R,B;Object.defineProperty(A,"__esModule",{value:!0}),A.GivenRewardStatus=A.Visibility=A.ProgressStatus=void 0,(E=A.ProgressStatus||(A.ProgressStatus={})).BLOCKED="blocked",E.NOT_STARTED="not_started",E.ON_GOING="on_going",E.COMPLETED="completed",E.FAILED="failed",E.REVERTED="reverted",(R=A.Visibility||(A.Visibility={})).VISIBLE="visible",R.VISIBLE_IF_CAN_START="visible_if_can_start",R.SECRET="secret",(B=A.GivenRewardStatus||(A.GivenRewardStatus={})).OK="ok",B.ALREADY_GIVEN="already_given",B.TASK_ALREADY_COMPLETED="task_already_completed",B.FAILED="failed"})),O=n((function(A,O){var z=v&&v.__createBinding||(Object.create?function(v,A,E,R){void 0===R&&(R=E),Object.defineProperty(v,R,{enumerable:!0,get:function(){return A[E]}})}:function(v,A,E,R){void 0===R&&(R=E),v[R]=A[E]}),M=v&&v.__exportStar||function(v,A){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(A,E)||z(A,v,E)};Object.defineProperty(O,"__esModule",{value:!0}),M(E,O),M(R,O),M(B,O)})),z=n((function(A,E){var R=v&&v.__awaiter||function(v,A,E,R){return new(E||(E=Promise))((function(B,O){function u(v){try{c(R.next(v))}catch(v){O(v)}}function a(v){try{c(R.throw(v))}catch(v){O(v)}}function c(v){var A;v.done?B(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(u,a)}c((R=R.apply(v,A||[])).next())}))},B=v&&v.__generator||function(v,A){var E,R,B,O,z={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(M){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;z;)try{if(E=1,R&&(B=2&O[0]?R.return:O[0]?R.throw||((B=R.return)&&B.call(R),0):R.next)&&!(B=B.call(R,O[1])).done)return B;switch(R=0,B&&(O=[2&O[0],B.value]),O[0]){case 0:case 1:B=O;break;case 4:return z.label++,{value:O[1],done:!1};case 5:z.label++,R=O[1],O=[0];continue;case 7:O=z.ops.pop(),z.trys.pop();continue;default:if(!((B=(B=z.trys).length>0&&B[B.length-1])||6!==O[0]&&2!==O[0])){z=0;continue}if(3===O[0]&&(!B||O[1]>B[0]&&O[1]<B[3])){z.label=O[1];break}if(6===O[0]&&z.label<B[1]){z.label=B[1],B=O;break}if(B&&z.label<B[2]){z.label=B[2],z.ops.push(O);break}B[2]&&z.ops.pop(),z.trys.pop();continue}O=A.call(v,z)}catch(v){O=[6,v],R=0}finally{E=B=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,M])}}};Object.defineProperty(E,"__esModule",{value:!0}),E.flatFetch=void 0,E.flatFetch=function(v,A){return R(this,void 0,void 0,(function(){var E,R,O,z,M,W;return B(this,(function(B){switch(B.label){case 0:return[4,fetch(v,A)];case 1:switch(E=B.sent(),R=(null==A?void 0:A.responseBodyType)||"text",O={},E.headers.forEach((function(v,A){return O[A]=v})),z={ok:E.ok,status:E.status,statusText:E.statusText,headers:O},R){case"json":return[3,2];case"text":return[3,4]}return[3,6];case 2:return M=z,[4,E.json()];case 3:return M.json=B.sent(),[3,6];case 4:return W=z,[4,E.text()];case 5:return W.text=B.sent(),[3,6];case 6:return[2,z]}}))}))}})),M=n((function(A,E){var R=v&&v.__assign||function(){return(R=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var B in A=arguments[E])Object.prototype.hasOwnProperty.call(A,B)&&(v[B]=A[B]);return v}).apply(this,arguments)},B=v&&v.__awaiter||function(v,A,E,R){return new(E||(E=Promise))((function(B,O){function u(v){try{c(R.next(v))}catch(v){O(v)}}function a(v){try{c(R.throw(v))}catch(v){O(v)}}function c(v){var A;v.done?B(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(u,a)}c((R=R.apply(v,A||[])).next())}))},M=v&&v.__generator||function(v,A){var E,R,B,O,z={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(M){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;z;)try{if(E=1,R&&(B=2&O[0]?R.return:O[0]?R.throw||((B=R.return)&&B.call(R),0):R.next)&&!(B=B.call(R,O[1])).done)return B;switch(R=0,B&&(O=[2&O[0],B.value]),O[0]){case 0:case 1:B=O;break;case 4:return z.label++,{value:O[1],done:!1};case 5:z.label++,R=O[1],O=[0];continue;case 7:O=z.ops.pop(),z.trys.pop();continue;default:if(!((B=(B=z.trys).length>0&&B[B.length-1])||6!==O[0]&&2!==O[0])){z=0;continue}if(3===O[0]&&(!B||O[1]>B[0]&&O[1]<B[3])){z.label=O[1];break}if(6===O[0]&&z.label<B[1]){z.label=B[1],B=O;break}if(B&&z.label<B[2]){z.label=B[2],z.ops.push(O);break}B[2]&&z.ops.pop(),z.trys.pop();continue}O=A.call(v,z)}catch(v){O=[6,v],R=0}finally{E=B=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,M])}}};function u(v,A,E,R){var B={},z=Date.now(),M=JSON.stringify(E);return R([v.toLowerCase(),A.toLowerCase(),z.toString(),M].join(":").toLowerCase()).forEach((function(v,A){B[""+O.AUTH_CHAIN_HEADER_PREFIX+A]=JSON.stringify(v)})),B[O.AUTH_TIMESTAMP_HEADER]=z.toString(),B[O.AUTH_METADATA_HEADER]=M,B}Object.defineProperty(E,"__esModule",{value:!0}),E.authFetch=void 0,E.authFetch=function(v){return function(A,E){var O,W;return B(this,void 0,void 0,(function(){var B,V;return M(this,(function(M){return B=new URL(A).pathname,V=R(R({},E),{headers:R(R({},u(null!==(O=null==E?void 0:E.method)&&void 0!==O?O:"get",B,null!==(W=null==E?void 0:E.metadata)&&void 0!==W?W:{},v)),null==E?void 0:E.headers)}),[2,z.flatFetch(A,V)]}))}))}}})),W=n((function(A,E){var R=v&&v.__assign||function(){return(R=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var B in A=arguments[E])Object.prototype.hasOwnProperty.call(A,B)&&(v[B]=A[B]);return v}).apply(this,arguments)},B=v&&v.__awaiter||function(v,A,E,R){return new(E||(E=Promise))((function(B,O){function u(v){try{c(R.next(v))}catch(v){O(v)}}function a(v){try{c(R.throw(v))}catch(v){O(v)}}function c(v){var A;v.done?B(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(u,a)}c((R=R.apply(v,A||[])).next())}))},W=v&&v.__generator||function(v,A){var E,R,B,O,z={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(M){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;z;)try{if(E=1,R&&(B=2&O[0]?R.return:O[0]?R.throw||((B=R.return)&&B.call(R),0):R.next)&&!(B=B.call(R,O[1])).done)return B;switch(R=0,B&&(O=[2&O[0],B.value]),O[0]){case 0:case 1:B=O;break;case 4:return z.label++,{value:O[1],done:!1};case 5:z.label++,R=O[1],O=[0];continue;case 7:O=z.ops.pop(),z.trys.pop();continue;default:if(!((B=(B=z.trys).length>0&&B[B.length-1])||6!==O[0]&&2!==O[0])){z=0;continue}if(3===O[0]&&(!B||O[1]>B[0]&&O[1]<B[3])){z.label=O[1];break}if(6===O[0]&&z.label<B[1]){z.label=B[1],B=O;break}if(B&&z.label<B[2]){z.label=B[2],z.ops.push(O);break}B[2]&&z.ops.pop(),z.trys.pop();continue}O=A.call(v,z)}catch(v){O=[6,v],R=0}finally{E=B=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,M])}}};Object.defineProperty(E,"__esModule",{value:!0}),E.QuestsClient=void 0;var V=function(){function t(v){var A;this.options=v,this.obf=O.DefObf,v.authChainProvider?this.fetchFn=M.authFetch(v.authChainProvider):this.fetchFn=null!==(A=v.fetchFn)&&void 0!==A?A:z.flatFetch}return t.prototype.urlFor=function(v){return""+this.options.baseUrl+v},t.prototype.fetch=function(v,A){return B(this,void 0,void 0,(function(){var E,O=this;return W(this,(function(z){return(null==A?void 0:A.bodyObject)&&(A.body=JSON.stringify(A.bodyObject),A.obf?(A.body=this.obf.obf(A.body),A.headers=R(R({},A.headers),{"Content-Type":"application/quests"})):A.headers=R(R({},A.headers),{"Content-Type":"application/json"})),E=R(R({},A),{metadata:this.options.metadata,responseBodyType:"text"}),[2,this.fetchFn(this.urlFor(v),E).then((function(v){return B(O,void 0,void 0,(function(){var E,R;return W(this,(function(B){return E=v.text||"",(null==A?void 0:A.deobf)&&v.ok&&(E=this.obf.deobf(E)),R=function(v){try{return JSON.parse(v)}catch(A){return v}}(E),[2,{ok:v.ok,status:v.status,body:R}]}))}))}))]}))}))},t.prototype.getQuests=function(){return B(this,void 0,void 0,(function(){return W(this,(function(v){return[2,this.fetch("/quests")]}))}))},t.prototype.getQuestDetails=function(v){return B(this,void 0,void 0,(function(){return W(this,(function(A){return[2,this.fetch("/quests/"+v)]}))}))},t.prototype.startQuest=function(v){return B(this,void 0,void 0,(function(){return W(this,(function(A){return[2,this.fetch("/s/"+this.obf.obf(v),{method:"post",deobf:!0})]}))}))},t.prototype.updateArbitraryState=function(v,A){return B(this,void 0,void 0,(function(){return W(this,(function(E){return[2,this.fetch("/kv/"+this.obf.obf(v),{method:"put",deobf:!0,obf:!0,bodyObject:A})]}))}))},t.prototype.makeProgress=function(v,A,E){return B(this,void 0,void 0,(function(){return W(this,(function(R){return[2,this.fetch("/p/"+this.obf.obf(v)+"/"+this.obf.obf(A),{method:"post",deobf:!0,obf:!0,bodyObject:E})]}))}))},t}();E.QuestsClient=V}));return function(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}(n((function(A,E){var R=v&&v.__createBinding||(Object.create?function(v,A,E,R){void 0===R&&(R=E),Object.defineProperty(v,R,{enumerable:!0,get:function(){return A[E]}})}:function(v,A,E,R){void 0===R&&(R=E),v[R]=A[E]}),O=v&&v.__exportStar||function(v,A){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(A,E)||R(A,v,E)};Object.defineProperty(E,"__esModule",{value:!0}),O(W,E),O(B,E)})))})),define("@dcl/types",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0})})),define("@dcl/component",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.QuestTrackingInfo=void 0;var E=function(){function QuestTrackingInfo(v){this.questData=v}return QuestTrackingInfo.prototype.toJSON=function(){return this.questData},__decorate([Component("engine.questTrackingComponent",1417815519)],QuestTrackingInfo)}();A.QuestTrackingInfo=E})),define("@dcl/mappings",["require","exports"],(function(v,A){function toRendererSections(v){var A=v.reduce((function(v,A){var E,R,B=null!==(E=A.section)&&void 0!==E?E:"",O=null!==(R=v[B])&&void 0!==R?R:{id:B,name:B,progress:0,tasks:[]};return O.tasks.push(function(v){return{id:v.id,progress:v.progressPercentage,name:v.description,coordinates:v.coordinates,payload:JSON.stringify(getProgressPayload(v)),status:v.progressStatus,type:v.progressMode.type}}(A)),v[B]=O,v}),{}),E=[];for(var R in A){var B=A[R];B.progress=B.tasks.length>0?B.tasks.reduce((function(v,A){return v+A.progress}),0)/B.tasks.length:0,E.push(B)}return E}function getProgressPayload(v){return"single"===v.progressMode.type?{isDone:"completed"===v.progressStatus}:{type:"numeric",start:v.progressSummary.start,end:v.progressSummary.end,current:v.progressSummary.current}}function gatherRewards(v){var A,E,R,B,O,z,M,W,V,H,Q,Z,K,J,$,et,nt,it,ot=[],_loop_1=function(A){ot.push({id:null!==(M=A.id)&&void 0!==M?M:"",name:null!==(W=A.name)&&void 0!==W?W:"",type:null!==(V=A.type)&&void 0!==V?V:"",imageUrl:null!==(H=A.imageUrl)&&void 0!==H?H:"",status:null!==(Z=null===(Q=v.givenRewards.filter((function(v){return v.reward.id===A.id}))[0])||void 0===Q?void 0:Q.status)&&void 0!==Z?Z:"not_given"})};try{for(var rt=__values(v.rewards),st=rt.next();!st.done;st=rt.next())_loop_1(st.value)}catch(v){A={error:v}}finally{try{st&&!st.done&&(E=rt.return)&&E.call(rt)}finally{if(A)throw A.error}}try{for(var at=__values(v.tasks),lt=at.next();!lt.done;lt=at.next()){var ut=lt.value,_loop_2=function(v){ot.push({id:null!==(K=v.id)&&void 0!==K?K:"",name:null!==(J=v.name)&&void 0!==J?J:"",type:null!==($=v.type)&&void 0!==$?$:"",imageUrl:null!==(et=v.imageUrl)&&void 0!==et?et:"",status:null!==(it=null===(nt=ut.givenRewards.filter((function(A){return A.reward.id===v.id}))[0])||void 0===nt?void 0:nt.status)&&void 0!==it?it:"not_given"})};try{for(var ht=(O=void 0,__values(ut.rewards)),ct=ht.next();!ct.done;ct=ht.next())_loop_2(ct.value)}catch(v){O={error:v}}finally{try{ct&&!ct.done&&(z=ht.return)&&z.call(ht)}finally{if(O)throw O.error}}}}catch(v){R={error:v}}finally{try{lt&&!lt.done&&(B=at.return)&&B.call(at)}finally{if(R)throw R.error}}return ot}Object.defineProperty(A,"__esModule",{value:!0}),A.toRendererQuest=void 0,A.toRendererQuest=function(v){return{id:v.id,name:v.name,description:v.description,icon:v.icon,thumbnail_banner:v.thumbnailBanner,thumbnail_entry:v.thumbnailEntry,status:v.progressStatus,sections:toRendererSections(v.tasks),rewards:gatherRewards(v),visibility:v.visibility}}})),define("@dcl/RemoteQuestTracker",["require","exports","dcl-quests-client/quests-client-amd","@decentraland/SignedFetch","@dcl/component","@dcl/mappings","@decentraland/EnvironmentAPI"],(function(v,A,E,R,B,O,z){Object.defineProperty(A,"__esModule",{value:!0}),A.RemoteQuestTracker=void 0;var M={clientFactory:function(v){return new E.QuestsClient({baseUrl:v,fetchFn:R.signedFetch})},logErrors:!0,addToEngine:!0},W=function(){function RemoteQuestTracker(v,A){var E=this;if(this.questId=v,this.readyListeners=[],this._ready=!1,this.options=__assign(__assign({},M),null!=A?A:{}),this.options.baseUrl)this.setReady(this.options.clientFactory(this.options.baseUrl));else{if(!z.getExplorerConfiguration)throw new Error("Unsupported configuration for this explorer version! You need to provide baseUrl");z.getExplorerConfiguration().then((function(v){"string"==typeof v.configurations.questsServerUrl&&(E.options.baseUrl=v.configurations.questsServerUrl,E.setReady(E.options.clientFactory(E.options.baseUrl)))})).catch((function(v){E.readyListeners.forEach((function(A){return A.reject("Couldn't get configuration from explorer: "+v)}))}))}this.entity=new Entity,this.options.addToEngine&&engine.addEntity(this.entity),this.refresh()}return RemoteQuestTracker.prototype.setReady=function(v){this.client=v,this._ready=!0,this.readyListeners.forEach((function(A){return A.resolve(v)})),this.readyListeners=[]},RemoteQuestTracker.prototype.ready=function(){return __awaiter(this,void 0,void 0,(function(){var v=this;return __generator(this,(function(A){return this._ready?[2,this.client]:[2,new Promise((function(A,E){return v.readyListeners.push({resolve:A,reject:E})}))]}))}))},RemoteQuestTracker.prototype.getClient=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return this.client?[2,this.client]:[4,this.ready()];case 1:return[2,v.sent()]}}))}))},RemoteQuestTracker.prototype.refresh=function(){return __awaiter(this,void 0,void 0,(function(){var v=this;return __generator(this,(function(A){return[2,this.updateQuest(this.makeRequest((function(){return __awaiter(v,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return[4,this.getClient()];case 1:return[2,v.sent().getQuestDetails(this.questId)]}}))}))})))]}))}))},RemoteQuestTracker.prototype.startQuest=function(){return __awaiter(this,void 0,void 0,(function(){var v=this;return __generator(this,(function(A){return[2,this.updateQuest(this.makeRequest((function(){return __awaiter(v,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return[4,this.getClient()];case 1:return[2,v.sent().startQuest(this.questId)]}}))}))})))]}))}))},RemoteQuestTracker.prototype.makeProgress=function(v,A){return __awaiter(this,void 0,void 0,(function(){var E=this;return __generator(this,(function(R){return[2,this.updateQuest(this.makeRequest((function(){return __awaiter(E,void 0,void 0,(function(){return __generator(this,(function(E){switch(E.label){case 0:return[4,this.getClient()];case 1:return[2,E.sent().makeProgress(this.questId,v,A)]}}))}))})))]}))}))},RemoteQuestTracker.prototype.updateArbitraryState=function(v){return __awaiter(this,void 0,void 0,(function(){var A=this;return __generator(this,(function(E){return[2,this.updateQuest(this.makeRequest((function(){return __awaiter(A,void 0,void 0,(function(){return __generator(this,(function(A){switch(A.label){case 0:return[4,this.getClient()];case 1:return[2,A.sent().updateArbitraryState(this.questId,v)]}}))}))})))]}))}))},RemoteQuestTracker.prototype.getCurrentStatePromise=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return this.currentStatePromise?[2,this.currentStatePromise]:[2]}))}))},RemoteQuestTracker.prototype.getCurrentState=function(){return this.currentState},RemoteQuestTracker.prototype.makeRequest=function(v){return __awaiter(this,void 0,void 0,(function(){var A;return __generator(this,(function(E){switch(E.label){case 0:return[4,v()];case 1:return(A=E.sent()).ok||this.options.logErrors&&log("Error performing request on quest with id: "+this.questId+". Status: "+A.status,{body:A.body}),[2,A]}}))}))},RemoteQuestTracker.prototype.updateQuest=function(v){return __awaiter(this,void 0,void 0,(function(){var A,E;return __generator(this,(function(R){switch(R.label){case 0:return this.currentStatePromise=v.then((function(v){if(v.ok)return v.body;throw new Error("Could not get quest state. Status: "+v.status+". Body: "+v.body)})),[4,v];case 1:return(A=R.sent()).ok&&(this.currentState=A.body,(E=this.entity.getComponentOrNull(B.QuestTrackingInfo))?E.questData=O.toRendererQuest(this.currentState):this.entity.addComponent(new B.QuestTrackingInfo(O.toRendererQuest(this.currentState)))),[2,A]}}))}))},RemoteQuestTracker}();A.RemoteQuestTracker=W})),define("@dcl/ecs-quests",["require","exports","@dcl/component","@dcl/mappings","@dcl/types","@dcl/RemoteQuestTracker"],(function(v,A,E,R,B,O){Object.defineProperty(A,"__esModule",{value:!0}),__exportStar(E,A),__exportStar(R,A),__exportStar(B,A),__exportStar(O,A)})),define("@dcl/quests-query",["require","exports","dcl-quests-client/quests-client-amd"],(function(v,A,E){function find(v,A){var E,R;try{for(var B=__values(v),O=B.next();!O.done;O=B.next()){var z=O.value;if(A(z))return z}}catch(v){E={error:v}}finally{try{O&&!O.done&&(R=B.return)&&R.call(B)}finally{if(E)throw E.error}}}function flatMap(v,A){return v.map(A).reduce((function(v,A){return v.concat(A)}),[])}Object.defineProperty(A,"__esModule",{value:!0}),A.query=void 0,A.query=function(v){return new(function(){function class_1(){}return class_1.prototype.getTaskStatus=function(A){var E;return null===(E=find(v.tasks,(function(v){return v.id===A})))||void 0===E?void 0:E.progressStatus},class_1.prototype.getStepStatus=function(A){var E;return null===(E=find(flatMap(v.tasks,(function(v){return v.steps})),(function(v){return v.id===A})))||void 0===E?void 0:E.progressStatus},class_1.prototype.isTaskCompleted=function(v){return this.getTaskStatus(v)===E.ProgressStatus.COMPLETED},class_1.prototype.isStepCompleted=function(v){return this.getStepStatus(v)===E.ProgressStatus.COMPLETED},class_1.prototype.getTaskProgress=function(A){var E;return null===(E=find(v.tasks,(function(v){return v.id===A})))||void 0===E?void 0:E.progressSummary},class_1.prototype.getAllGivenRewards=function(){return __spreadArray(__spreadArray([],__read(v.givenRewards)),__read(flatMap(v.tasks,(function(v){return v.givenRewards}))))},class_1}())}})),define("@dcl/ecs-scene-utils",["exports","@decentraland/EnvironmentAPI"],(function(v,A){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var n=function(v,A){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(v[E]=A[E])})(v,A)};function i(v,A){function i(){this.constructor=v}n(v,A),v.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}function r(v,A,E,R){var B,O=arguments.length,z=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,A,E,R);else for(var M=v.length-1;M>=0;M--)(B=v[M])&&(z=(O<3?B(z):O>3?B(A,E,z):B(A,E))||z);return O>3&&z&&Object.defineProperty(A,E,z),z}function o(v,A,E,R){return new(E||(E=Promise))((function(B,O){function a(v){try{u(R.next(v))}catch(v){O(v)}}function s(v){try{u(R.throw(v))}catch(v){O(v)}}function u(v){var A;v.done?B(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(a,s)}u((R=R.apply(v,A||[])).next())}))}function a(v,A){var E,R,B,O,z={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return O={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function s(O){return function(M){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;z;)try{if(E=1,R&&(B=2&O[0]?R.return:O[0]?R.throw||((B=R.return)&&B.call(R),0):R.next)&&!(B=B.call(R,O[1])).done)return B;switch(R=0,B&&(O=[2&O[0],B.value]),O[0]){case 0:case 1:B=O;break;case 4:return z.label++,{value:O[1],done:!1};case 5:z.label++,R=O[1],O=[0];continue;case 7:O=z.ops.pop(),z.trys.pop();continue;default:if(!((B=(B=z.trys).length>0&&B[B.length-1])||6!==O[0]&&2!==O[0])){z=0;continue}if(3===O[0]&&(!B||O[1]>B[0]&&O[1]<B[3])){z.label=O[1];break}if(6===O[0]&&z.label<B[1]){z.label=B[1],B=O;break}if(B&&z.label<B[2]){z.label=B[2],z.ops.push(O);break}B[2]&&z.ops.pop(),z.trys.pop();continue}O=A.call(v,z)}catch(v){O=[6,v],R=0}finally{E=B=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,M])}}}function s(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var E,R=function(){function e(){this._components=[],this._componentGroups=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var A,E;try{for(var R=s(this._components),B=R.next();!B.done;B=R.next())if(v==B.value)return}catch(v){A={error:v}}finally{try{B&&!B.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}this._components.push(v),this._componentGroups.push(engine.getComponentGroup(v,Transform))},e.prototype.update=function(v){for(var A=0;A<this._components.length;A++)this.updateComponent(v,this._components[A],this._componentGroups[A])},e.prototype.updateComponent=function(v,A,E){E.entities.forEach((function(E){var R=E.getComponent(Transform),B=E.getComponent(A);B.update(v),B.assignValueToTransform(R),B.hasFinished()&&(E.removeComponent(B),null!=B.onFinishCallback&&B.onFinishCallback())}))},e._instance=null,e}();function h(A,E){switch(A){case v.InterpolationType.LINEAR:return E;case v.InterpolationType.EASEINQUAD:return function(v){return v*v}(E);case v.InterpolationType.EASEOUTQUAD:return function(v){return v*(2-v)}(E);case v.InterpolationType.EASEQUAD:return function(v){return v*v/(2*(v*v-v)+1)}(E);case v.InterpolationType.EASEINSINE:return function(v){return 1-Math.cos(v*Math.PI/2)}(E);case v.InterpolationType.EASEOUTSINE:return function(v){return Math.sin(v*Math.PI/2)}(E);case v.InterpolationType.EASESINE:return function(v){return-(Math.cos(Math.PI*v)-1)/2}(E);case v.InterpolationType.EASEINEXPO:return function(v){return 0===v?0:Math.pow(2,10*v-10)}(E);case v.InterpolationType.EASEOUTEXPO:return function(v){return 1===v?1:1-Math.pow(2,-10*v)}(E);case v.InterpolationType.EASEEXPO:return function(v){return 0===v?0:1===v?1:v<.5?Math.pow(2,20*v-10)/2:(2-Math.pow(2,-20*v+10))/2}(E);case v.InterpolationType.EASEINELASTIC:return function(v){var A=2*Math.PI/3;return 0===v?0:1===v?1:-Math.pow(2,10*v-10)*Math.sin((10*v-10.75)*A)}(E);case v.InterpolationType.EASEOUTELASTIC:return function(v){var A=2*Math.PI/3;return 0===v?0:1===v?1:Math.pow(2,-10*v)*Math.sin((10*v-.75)*A)+1}(E);case v.InterpolationType.EASEELASTIC:return function(v){var A=2*Math.PI/4.5;return 0===v?0:1===v?1:v<.5?-Math.pow(2,20*v-10)*Math.sin((20*v-11.125)*A)/2:Math.pow(2,-20*v+10)*Math.sin((20*v-11.125)*A)/2+1}(E);case v.InterpolationType.EASEINBOUNCE:return function(v){return 1-l(1-v)}(E);case v.InterpolationType.EASEOUTEBOUNCE:return function(v){return l(v)}(E);case v.InterpolationType.EASEBOUNCE:return function(v){return v<.5?(1-l(1-2*v))/2:(1+l(2*v-1))/2}(E);default:return E}}function l(v){var A=7.5625,E=2.75;return v<1/E?A*v*v:v<2/E?A*(v-=1.5/E)*v+.75:v<2.5/E?A*(v-=2.25/E)*v+.9375:A*(v-=2.625/E)*v+.984375}v.InterpolationType=void 0,(E=v.InterpolationType||(v.InterpolationType={}))[E.LINEAR=0]="LINEAR",E[E.EASEINQUAD=1]="EASEINQUAD",E[E.EASEOUTQUAD=2]="EASEOUTQUAD",E[E.EASEQUAD=3]="EASEQUAD",E.EASEINSINE="easeinsine",E.EASEOUTSINE="easeoutsine",E.EASESINE="easeinoutsine",E.EASEINEXPO="easeinexpo",E.EASEOUTEXPO="easeoutexpo",E.EASEEXPO="easeinoutexpo",E.EASEINELASTIC="easeinelastic",E.EASEOUTELASTIC="easeoutelastic",E.EASEELASTIC="easeinoutelastic",E.EASEINBOUNCE="easeinbounce",E.EASEOUTEBOUNCE="easeoutbounce",E.EASEBOUNCE="easeinoutbounce";var B,O=function(){function t(E,B,O,z,M){void 0===M&&(M=v.InterpolationType.LINEAR),this.start=E,this.end=B,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=z,this.interpolationType=M,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.start,this.end,this.lerpTime)},A=r([Component("moveTransformComponent")],t)}(),z=function(){function t(E,B,O,z,M){void 0===M&&(M=v.InterpolationType.LINEAR),this.start=E,this.end=B,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=z,this.interpolationType=M,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.rotation=Quaternion.Slerp(this.start,this.end,this.lerpTime)},A=r([Component("rotateTransformComponent")],t)}(),M=function(){function t(E,B,O,z,M){void 0===M&&(M=v.InterpolationType.LINEAR),this.start=E,this.end=B,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=z,this.interpolationType=M,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.scale=Vector3.Lerp(this.start,this.end,this.lerpTime)},A=r([Component("scaleTransformComponent")],t)}(),W=function(){function e(A,E,B,O){if(this.speed=[],this.normalizedTime=0,this.currentIndex=0,this.points=A,this.onFinishCallback=B,this.onPointReachedCallback=O,A.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(E>0){for(var z=0,M=[],W=0;W<A.length-1;W++){var V=Vector3.Distance(A[W],A[W+1]);z+=V,M.push(V)}for(W=0;W<M.length;W++)this.speed.push(1/(M[W]/z*E))}else this.normalizedTime=1,this.currentIndex=A.length-2;R.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,this.onPointReachedCallback&&this.currentIndex<this.points.length-1&&this.onPointReachedCallback(this.points[this.currentIndex],this.points[this.currentIndex+1]))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime)},v=r([Component("followPathComponent")],e)}(),V=function(){function e(A,E,B,O,z,M){if(this.speed=[],this.turnToFaceNext=!1,this.facingNext=!1,this.normalizedTime=0,this.currentIndex=0,this.points=Curve3.CreateCatmullRomSpline(A,B,!!z).getPoints(),this.onFinishCallback=M,this.turnToFaceNext=O||!1,this.points.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(E>0){for(var W=0,V=[],H=0;H<this.points.length-1;H++){var Q=Vector3.Distance(this.points[H],this.points[H+1]);W+=Q,V.push(Q)}for(H=0;H<V.length;H++)this.speed.push(1/(V[H]/W*E))}else this.normalizedTime=1,this.currentIndex=A.length-2;R.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,1==this.turnToFaceNext&&(this.facingNext=!1))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime),this.facingNext||(this.facingNext=!0,this.currentIndex<this.points.length-1?v.lookAt(this.points[this.currentIndex+1]):v.lookAt(this.points[0]))},v=r([Component("followCurvedPathComponent")],e)}(),H=function(){function e(A,E){this.rotationVelocity=A,this.onFinishCallback=E,this.rotation=Quaternion.Identity,this.finished=!1,R.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.rotation=Quaternion.Slerp(Quaternion.Identity,this.rotationVelocity,v)},e.prototype.hasFinished=function(){return this.finished},e.prototype.assignValueToTransform=function(v){v.rotation=v.rotation.multiply(this.rotation)},e.prototype.stop=function(){this.finished=!0},v=r([Component("keepRotatingComponent")],e)}();v.ToggleState=void 0,(B=v.ToggleState||(v.ToggleState={}))[B.Off=0]="Off",B[B.On=1]="On";var Q=function(){function t(A,E){void 0===A&&(A=v.ToggleState.On),this.enabled=!0,this.state=v.ToggleState.Off,this.set(A),E&&this.setCallback(E)}return t.prototype.set=function(v){this.state=v,this.onValueChangedCallback&&this.onValueChangedCallback(v)},t.prototype.toggle=function(){this.enabled&&this.set(1-this.state)},t.prototype.isOn=function(){return this.state==v.ToggleState.On},t.prototype.setCallback=function(v){this.onValueChangedCallback=v},r([Component("toggle")],t)}(),Z=function(){function e(){this._components=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var A,E;try{for(var R=s(this._components),B=R.next();!B.done;B=R.next())if(v==B.value)return}catch(v){A={error:v}}finally{try{B&&!B.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}this._components.push(v)},e.prototype.update=function(v){var A=this;this._components.forEach((function(E){A.updateComponent(v,E)}))},e.prototype.updateComponent=function(v,A){var E=engine.getEntitiesWithComponent(A);for(var R in E)if(E.hasOwnProperty(R)){var B=E[R],O=B.getComponent(A);O.elapsedTime+=v,O.elapsedTime>=O.targetTime&&O.onTargetTimeReached(B)}},e._instance=null,e}(),K=function(){function e(A,E){var R=this;Z.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(v){R.onTimeReachedCallback&&R.onTimeReachedCallback(),v.removeComponent(R)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerDelay")],e)}(),J=function(){function e(A,E){var R=this;Z.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(v){R.onTimeReachedCallback&&R.onTimeReachedCallback(),v.removeComponent(R),engine.removeEntity(v)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerExpireIn")],e)}(),$=function(){function e(A,E){var R=this;Z.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(){R.elapsedTime=0,R.onTimeReachedCallback&&R.onTimeReachedCallback()}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerInterval")],e)}();function I(v,A,E,R,B,O){var z=new Entity;z.addComponent(new Transform(O||{position:new Vector3(0,1.5,0)})),z.setParent(A);var M=new TextShape(v);return M.fontSize=B||3,M.color=R||Color3.Black(),z.addComponent(M),E&&z.addComponent(new Billboard),engine.addEntity(z),z}var et,nt,it=function(){function e(){this._triggers={},e._instance=this,this._cameraTriggerWrapper=new rt(new P(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(st)}return Object.defineProperty(e,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},e.prototype.update=function(){var v=this,A=this._componentGroup.entities;for(var E in A.forEach((function(A){v.shouldWrapTriggerEntity(A)&&v.wrapTriggerEntity(A)})),this._triggers)if(this._triggers.hasOwnProperty(E)){var R=this._triggers[E];R.isDebugging()&&R.updateDebugEntity(),R.isInEngine()?null!=R.trigger&&R.trigger.enabled?(R.wasEnabled||R.isDebugging()&&R.addDebugEntity(),R.wasEnabled=!0,(R.trigger.onCameraEnter||R.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(R),(R.trigger.onTriggerEnter||R.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(R)):R.wasEnabled&&(R.wasEnabled=!1,R.isDebugging()&&R.removeDebugEntity(),e.removeTriggerFromSystem(R)):(R.isDebugging()&&R.removeDebugEntity(),e.removeTriggerFromSystem(R),delete this._triggers[E])}},e.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},e.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new ot(v)},e.removeTriggerFromSystem=function(v){for(var A,E=v.getActiveCollisions(),R=0;R<E.length;R++)!(E[R]===(null===(A=e._instance)||void 0===A?void 0:A._cameraTriggerWrapper)||null==E[R].trigger)&&E[R].trigger.onTriggerExit&&v.entity&&E[R].trigger.onTriggerExit(v.entity),E[R].disengageActiveCollision(v),v.disengageActiveCollision(E[R])},e.disengageCollision=function(v,A){v.disengageActiveCollision(A),A.disengageActiveCollision(v),v.trigger.onTriggerExit&&A.entity&&v.trigger.onTriggerExit(A.entity),A.trigger.onTriggerExit&&v.entity&&A.trigger.onTriggerExit(v.entity)},e.engageCollision=function(v,A){v.engageCollision(A),A.engageCollision(v),v.trigger.onTriggerEnter&&A.entity&&v.trigger.onTriggerEnter(A.entity),A.trigger.onTriggerEnter&&v.entity&&A.trigger.onTriggerEnter(v.entity)},e.prototype.checkCollisionAgainstCamera=function(v){var A=v.hasActiveCollision(this._cameraTriggerWrapper),E=e.areColliding(v,this._cameraTriggerWrapper);A&&!E?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!A&&E&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},e.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var A in this._triggers)if(this._triggers.hasOwnProperty(A)&&A!=v.uuid&&this._triggers[A].trigger.enabled&&e.canTriggersCollide(v,this._triggers[A])){var E=v.hasActiveCollision(this._triggers[A]),R=e.areColliding(v,this._triggers[A]);E&&!R?e.disengageCollision(v,this._triggers[A]):!E&&R&&e.engageCollision(v,this._triggers[A])}},e.canTriggersCollide=function(v,A){return 0==v.trigger.triggeredByLayer||0!=(A.trigger.layer&v.trigger.triggeredByLayer)},e.areColliding=function(v,A){return v.getShape()instanceof P&&A.getShape()instanceof P?e.areCollidingAABB(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof k&&A.getShape()instanceof k?e.areCollidingSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof P&&A.getShape()instanceof k?e.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof k&&A.getShape()instanceof P&&e.areCollidingAABBSphere(A.getGlobalPosition(),A.getShape(),v.getGlobalPosition(),v.getShape())},e.areCollidingAABB=function(v,A,E,R){var B=e.getBoxShapeValues(v,A),O=e.getBoxShapeValues(E,R);return B.min.x<=O.max.x&&B.max.x>=O.min.x&&B.min.y<=O.max.y&&B.max.y>=O.min.y&&B.min.z<=O.max.z&&B.max.z>=O.min.z},e.areCollidingSphere=function(v,A,E,R){return Vector3.DistanceSquared(v.add(A.position),E.add(R.position))<A.radius*A.radius+R.radius*R.radius},e.areCollidingAABBSphere=function(v,A,E,R){var B=e.getBoxShapeValues(v,A),O=E.add(R.position),z=R.radius,M=0;return O.x<B.min.x&&(M+=(B.min.x-O.x)*(B.min.x-O.x)),O.x>B.max.x&&(M+=(O.x-B.max.x)*(O.x-B.max.x)),O.y<B.min.y&&(M+=(B.min.y-O.y)*(B.min.y-O.y)),O.y>B.max.y&&(M+=(O.y-B.max.y)*(O.y-B.max.y)),O.z<B.min.z&&(M+=(B.min.z-O.z)*(B.min.z-O.z)),O.z>B.max.z&&(M+=(O.z-B.max.z)*(O.z-B.max.z)),M<z*z},e.getBoxShapeValues=function(v,A){var E=v.add(A.position);return{center:E,min:E.subtract(A.size.scale(.5)),max:E.add(A.size.scale(.5))}},e._instance=null,e}(),ot=function(){function e(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(st),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),e.prototype.getGlobalPosition=function(){return this._entity?e.getEntityWorldPosition(this._entity):Vector3.Zero()},e.prototype.getShape=function(){return this._trigger.shape},e.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},e.prototype.getActiveCollisions=function(){var v=[];for(var A in this._collidingWith)this._collidingWith.hasOwnProperty(A)&&v.push(this._collidingWith[A]);return v},e.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},e.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},e.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},e.prototype.isDebugging=function(){return this._isDebug},e.prototype.addDebugEntity=function(){return o(this,void 0,void 0,(function(){var v,E,R;return a(this,(function(B){switch(B.label){case 0:return[4,!A.isPreviewMode()];case 1:return B.sent()||(e._debugMaterial||(e._debugMaterial=new Material,e._debugMaterial.alphaTest=.5),null==this._debugEntity&&(this._debugEntity=new Entity,v=new Transform,this._debugEntity.addComponent(v),this._debugEntity.addComponent(e._debugMaterial),this.getShape()instanceof P&&((E=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(E),v.scale=this.getShape().size),this.getShape()instanceof k&&((E=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(E),R=this.getShape().radius,v.scale=new Vector3(R,R,R))),engine.addEntity(this._debugEntity)),[2]}}))}))},e.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},e.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},e.getEntityWorldPosition=function(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),E=v.getParent();if(null!=E){var R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(E).add(A.rotate(R))}return A},e._debugMaterial=null,e}(),rt=function(v){function t(A){var E=v.call(this)||this;return E._shape=A,E._uuid="cameraTrigger",E}return i(t,v),t.prototype.getGlobalPosition=function(){return Camera.instance.position},t.prototype.getShape=function(){return this._shape},t.prototype.setShape=function(v){this._shape=v},t.prototype.isInEngine=function(){return!1},t.prototype.hasActiveCollision=function(v){return!1},t.prototype.disengageActiveCollision=function(v){},t.prototype.engageCollision=function(v){},t.prototype.isDebugging=function(){return!1},t}(ot),st=function(){function e(v,A){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,this._debugEnabled=!1,it.createAndAddToEngine(),this.shape=v,A&&(A.layer&&(this.layer=A.layer),A.triggeredByLayer&&(this.triggeredByLayer=A.triggeredByLayer),A.onTriggerEnter&&(this.onTriggerEnter=A.onTriggerEnter),A.onTriggerExit&&(this.onTriggerExit=A.onTriggerExit),A.onCameraEnter&&(this.onCameraEnter=A.onCameraEnter),A.onCameraExit&&(this.onCameraExit=A.onCameraExit),A.enableDebug&&(this._debugEnabled=A.enableDebug))}return Object.defineProperty(e.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),r([Component("triggerComponent")],e)}(),P=function(v,A){void 0===v&&(v=Vector3.One().scale(2)),void 0===A&&(A=Vector3.Zero()),this.size=v,this.position=A},k=function(v,A){void 0===v&&(v=2),void 0===A&&(A=Vector3.Zero()),this.radius=v,this.position=A};v.ActionsSequenceSystem=function(){function e(v){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,v&&this.startSequence(v)}return e.prototype.startSequence=function(v){this.beginSequenceNode=v.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.setOnFinishCallback=function(v){this.onFinishCallback=v},e.prototype.isRunning=function(){return this.running},e.prototype.stop=function(){this.running=!1},e.prototype.resume=function(){null!=this.beginSequenceNode&&(this.running=!0)},e.prototype.reset=function(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.getRunningAction=function(){var v=this.currentSequenceNode;if(this.currentSequenceNode instanceof lt)do{v=v.currentInnerSequence}while(v instanceof lt);return v.action},e.prototype.update=function(v){this.running&&(this.started?this.currentSequenceNode.hasFinish()?(this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())):this.currentSequenceNode.update(v):(this.currentSequenceNode.onStart(),this.started=!0))},e}(),et=v.ActionsSequenceSystem||(v.ActionsSequenceSystem={}),nt=function(){function e(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}return e.prototype.then=function(v){if(null==this.currentSequenceNode)this.currentSequenceNode=new at,this.currentSequenceNode.action=v,this.beginSequenceNode=this.currentSequenceNode;else{var A=new at;A.action=v,this.currentSequenceNode=this.currentSequenceNode.then(A)}return this},e.prototype.if=function(v){var A=new ut(v);return null==this.currentSequenceNode?(this.currentSequenceNode=A,this.beginSequenceNode=A):this.currentSequenceNode=this.currentSequenceNode.then(A),this},e.prototype.else=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof ut))throw new Error("IF statement is needed to be called before ELSE statement.");v.closed=!0;var A=new ht(v);return this.currentSequenceNode=this.currentSequenceNode.then(A),this},e.prototype.endIf=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof ut||v instanceof ht))throw new Error("IF statement is needed to be called before ENDIF statement.");return v.closed=!0,this},e.prototype.while=function(v){var A=new ct(v);return null==this.currentSequenceNode?(this.currentSequenceNode=A,this.beginSequenceNode=A):this.currentSequenceNode=this.currentSequenceNode.then(A),this.whileNodeStack.push(A),this},e.prototype.endWhile=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof ct))throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return v.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1),this},e.prototype.breakWhile=function(){if(!(this.whileNodeStack.length>0))throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this.currentSequenceNode=this.currentSequenceNode.then(new pt(this.whileNodeStack[this.whileNodeStack.length-1])),this},e}(),et.SequenceBuilder=nt;var at=function(){function e(){this.action=null,this.next=null}return e.prototype.then=function(v){return this.next=v,v},e.prototype.onStart=function(){this.action&&this.action.onStart()},e.prototype.update=function(v){this.action&&this.action.update(v)},e.prototype.onFinish=function(){this.action&&this.action.onFinish()},e.prototype.hasFinish=function(){return!this.action||this.action.hasFinished},e.prototype.getSequence=function(){return this},e}(),lt=function(v){function t(){var A=null!==v&&v.apply(this,arguments)||this;return A.currentInnerSequence=null,A.startingInnerSequence=null,A.closed=!1,A}return i(t,v),t.prototype.then=function(v){if(null==this.currentInnerSequence)this.currentInnerSequence=v,this.startingInnerSequence=v;else{if(this.closed)return this.next=v,v;this.currentInnerSequence=this.currentInnerSequence.then(v)}return this},t.prototype.onStart=function(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.onFinish=function(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()},t.prototype.hasFinish=function(){return null==this.currentInnerSequence},t.prototype.getSequence=function(){if(this.currentInnerSequence){var v=this.currentInnerSequence.getSequence();if(v instanceof t&&!v.closed)return v}return this},t}(at),ut=function(v){function t(A){var E=v.call(this)||this;return E.result=!1,E.condition=A,E}return i(t,v),t.prototype.onStart=function(){this.result=this.condition(),this.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(lt),ht=function(v){function t(A){var E=v.call(this)||this;return E.ifSequence=null,E.ifSequence=A,E}return i(t,v),t.prototype.onStart=function(){this.ifSequence&&!this.ifSequence.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(lt),ct=function(v){function t(A){var E=v.call(this)||this;return E.breakWhile=!1,E.condition=A,E}return i(t,v),t.prototype.onStart=function(){this.breakWhile=!1,this.condition()?v.prototype.onStart.call(this):this.currentInnerSequence=null},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,null==this.currentInnerSequence&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.hasFinish=function(){return this.breakWhile||!this.condition()},t}(lt),pt=function(v){function t(A){var E=v.call(this)||this;return E.whileNode=A,E}return i(t,v),t.prototype.onStart=function(){this.whileNode.breakWhile=!0},t}(at);v.Delay=K,v.ExpireIn=J,v.FollowCurvedPathComponent=V,v.FollowPathComponent=W,v.Interpolate=h,v.Interval=$,v.KeepRotatingComponent=H,v.MoveTransformComponent=O,v.RotateTransformComponent=z,v.ScaleTransformComponent=M,v.SequenceNode=at,v.ToggleComponent=Q,v.TransformSystem=R,v.TriggerBoxShape=P,v.TriggerComponent=st,v.TriggerSphereShape=k,v.TriggerSystem=it,v.addLabel=I,v.addOneTimeTrigger=function(v,A,E){var R=!1,B=!1,O=new Entity;O.addComponent(new Transform({}));var z={};return A.layer&&(z.layer=A.layer),A.triggeredByLayer&&(z.triggeredByLayer=A.triggeredByLayer),A.onCameraEnter&&(z.onCameraEnter=function(){R||(R=!0,A.onCameraEnter()),!R&&A.onCameraEnter||!B&&A.onCameraExit||engine.removeEntity(O)}),A.onCameraExit&&(z.onCameraExit=function(){B||(B=!0,A.onCameraExit()),!R&&A.onCameraEnter||!B&&A.onCameraExit||engine.removeEntity(O)}),A.enableDebug&&(z.enableDebug=A.enableDebug),O.addComponent(new st(v,z)),E&&O.setParent(E),engine.addEntity(O),O},v.addTestCube=function(v,E,R,B,O,z,M){return o(this,void 0,void 0,(function(){var W,V,H;return a(this,(function(Q){switch(Q.label){case 0:return(W=!M)?[4,!A.isPreviewMode()]:[3,2];case 1:W=Q.sent(),Q.label=2;case 2:return W?[2]:((V=new Entity).addComponent(new Transform(v)),O?(V.addComponent(new SphereShape),V.getComponent(Transform).scale.setAll(.5)):V.addComponent(new BoxShape),engine.addEntity(V),V.addComponent(new OnPointerDown(E,{hoverText:R||"click",button:ActionButton.POINTER})),B&&((H=new Material).albedoColor=B,V.addComponent(H)),z&&(V.getComponent(BoxShape).withCollisions=!1),R&&I(R,V,!0),[2,V])}}))}))},v.clamp=function(v,A,E){var R=v;return v>E?R=E:v<A&&(R=A),R},v.getEntityWorldPosition=function e(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),E=v.getParent();if(null!=E&&"0"!=E.uuid){if("FirstPersonCameraEntityReference"==E.uuid){var R=Camera.instance.rotation.clone();return Camera.instance.position.clone().add(A.rotate(R))}if("AvatarEntityReference"==E.uuid){var B=Camera.instance.rotation;return R=Quaternion.Euler(0,B.eulerAngles.y,0),Camera.instance.position.clone().add(A.rotate(R)).add(new Vector3(0,-.875,0))}return R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity,e(E).add(A.rotate(R))}return A},v.getEntityWorldRotation=function e(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).rotation.clone():Quaternion.Zero(),E=v.getParent();if(null!=E&&"0"!=E.uuid){if("FirstPersonCameraEntityReference"==E.uuid){var R=Camera.instance.rotation.clone();return A.multiply(R)}return"AvatarEntityReference"==E.uuid?(R=Quaternion.Euler(0,Camera.instance.rotation.eulerAngles.y,0),A.multiply(R)):(R=e(E),A.multiply(R))}return A},v.map=function(v,A,E,R,B){return(v-A)/(E-A)*(B-R)+R},v.sendRequest=function(v,A,E,R){return o(this,void 0,void 0,(function(){var B,O,z;return a(this,(function(M){switch(M.label){case 0:return M.trys.push([0,6,,7]),B={method:A||"GET"},E&&(B.headers=E),R&&(B.body=JSON.stringify(R)),[4,fetch(v,B)];case 1:O=M.sent(),M.label=2;case 2:return M.trys.push([2,4,,5]),[4,O.json()];case 3:return[2,M.sent()];case 4:return M.sent(),[2,O];case 5:return[3,7];case 6:return z=M.sent(),log("error fetching from ",v," : ",z),[3,7];case 7:return[2]}}))}))},v.setTimeout=function(v,A){var E=new Entity;return E.addComponent(new K(v,(function(){A(),engine.removeEntity(E)}))),engine.addEntity(E),E},Object.defineProperty(v,"__esModule",{value:!0})})),function(v,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define("@dcl/npc-scene-utils",["exports"],A):A((v="undefined"!=typeof globalThis?globalThis:v||self)["@dcl/npc-scene-utils"]={})}(this,(function(v){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(v,A){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(v[E]=A[E])})(v,A)};function i(v,A){function o(){this.constructor=v}e(v,A),v.prototype=null===A?Object.create(A):(o.prototype=A.prototype,new o)}function o(v,A,E,R){var B,O=arguments.length,z=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,A,E,R);else for(var M=v.length-1;M>=0;M--)(B=v[M])&&(z=(O<3?B(z):O>3?B(A,E,z):B(A,E))||z);return O>3&&z&&Object.defineProperty(A,E,z),z}function n(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var A=o([Component("trackUserFlag")],(function(v,A,R){this.lockXZRotation=!1,this.active=!1,E||(E=!0,engine.addSystem(new B)),this.lockXZRotation=v||!1,this.rotSpeed=A||2,R&&(this.active=!0)})),E=!1,R=Camera.instance,B=function(){function t(){this.followingNPCs=engine.getComponentGroup(A)}return t.prototype.update=function(v){var E,B;try{for(var O=n(this.followingNPCs.entities),z=O.next();!z.done;z=O.next()){var M=z.value,W=M.getComponent(Transform),V=M.getComponent(A);if(V.active){var H=new Vector3(R.position.x,R.position.y,R.position.z).subtract(W.position);W.rotation=Quaternion.Slerp(W.rotation,Quaternion.LookRotation(H),v*V.rotSpeed),V.lockXZRotation&&(W.rotation.x=0,W.rotation.z=0)}}}catch(v){E={error:v}}finally{try{z&&!z.done&&(B=O.return)&&B.call(O)}finally{if(E)throw E.error}}},t}(),O=new UICanvas;O.visible=!0;var z,M,W=new Font(Fonts.SanFrancisco),V=new Font(Fonts.SanFrancisco_Heavy),H=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),Q=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),Z=new Texture("https://decentraland.org/images/ui/dialog-bubbles.png");function b(v,A,E,R){void 0===E&&(E=512),void 0===R&&(R=512),function(v,A,E,R,B){v.uvs=[A.x,A.y,E.x,E.y,R.x,R.y,B.x,B.y,A.x,A.y,E.x,E.y,R.x,R.y,B.x,B.y]}(v,new Vector2(A.sourceLeft/E,(R-A.sourceTop-A.sourceHeight)/R),new Vector2((A.sourceLeft+A.sourceWidth)/E,(R-A.sourceTop-A.sourceHeight)/R),new Vector2((A.sourceLeft+A.sourceWidth)/E,(R-A.sourceTop)/R),new Vector2(A.sourceLeft/E,(R-A.sourceTop)/R))}function T(v,A){v.sourceWidth=A.sourceWidth,v.sourceHeight=A.sourceHeight,v.sourceLeft=A.sourceLeft?A.sourceLeft:0,v.sourceTop=A.sourceTop?A.sourceTop:0}function C(v){var A=-10-4*v;return A>-65?A:-65}(z=v.ButtonStyles||(v.ButtonStyles={})).E="e",z.F="f",z.DARK="dark",z.RED="red",z.ROUNDBLACK="roundblack",z.ROUNDWHITE="roundwhite",z.ROUNDSILVER="roundsilver",z.ROUNDGOLD="roundgold",z.SQUAREBLACK="squareblack",z.SQUAREWHITE="squarewhite",z.SQUARESILVER="squaresilver",z.SQUAREGOLD="squaregold",z.WHITE="white",(M=v.NPCState||(v.NPCState={})).STANDING="standing",M.TALKING="talking",M.FOLLOWPATH="followPath";var K,J={buttons:{buttonE:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonF:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},white:{sourceWidth:174,sourceHeight:46,sourceLeft:698,sourceTop:662},buttonRed:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonDark:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},roundBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},squareBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},roundWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},squareWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},roundSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},squareSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},roundGold:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},squareGold:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567}},buttonLabels:{E:{sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},F:{sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},EBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:766,sourceTop:611},FBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:802,sourceTop:611}},backgrounds:{promptBackground:{sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},promptLargeBackground:{sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},promptSlantedBackground:{sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},NPCDialog:{sourceWidth:766,sourceHeight:248,sourceLeft:22,sourceTop:756}},icons:{closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},checkboxes:{wOff:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},wOn:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},dOff:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},dOn:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},wLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},wLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},dLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},dLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168}},switches:{roundOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},roundRed:{sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},roundGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},squareOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},squareRed:{sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},squareGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501}},bubbles:{short:{sourceWidth:232,sourceHeight:168,sourceLeft:610,sourceTop:834},normal:{sourceWidth:572,sourceHeight:168,sourceLeft:16,sourceTop:834},long:{sourceWidth:994,sourceHeight:306,sourceLeft:12,sourceTop:508},huge:{sourceWidth:994,sourceHeight:478,sourceLeft:12,sourceTop:14}}},$=function(){function t(A,E){var R=this;nt.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=A,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(A){R.onTimeReachedCallback(),A.removeComponent(v)}}var v;return v=t,t.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=o([Component("npcTimerDelay")],t)}(),et=engine.getComponentGroup($),nt=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){var A,E;try{for(var R=n(et.entities),B=R.next();!B.done;B=R.next()){var O=B.value,z=O.getComponent($);z.elapsedTime+=v,z.elapsedTime>=z.targetTime&&z.onTargetTimeReached(O)}}catch(v){A={error:v}}finally{try{B&&!B.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},t._instance=null,t}();!function(v){v[v.Confirm=0]="Confirm",v[v.Cancel=1]="Cancel",v[v.Next=2]="Next",v[v.Button3=3]="Button3",v[v.Button4=4]="Button4"}(K||(K={}));var it=.75,ot=-262.5,rt=262.5,st=37.5,at=192,lt=192,ut=7.5,ht=112.5,ct=112.5,pt=-48.75,dt=-48.75,ft=19.5,yt=19.5,gt=function(){function e(A,E,R,B){var z=this;this.NPCScript=[],this.isDialogOpen=!1,this.isQuestionPanel=!1,this.isFixedScreen=!1,this.activeTextId=0,this.UIOpenTime=0,this.defaultSound=null,this.canvas=O,this.ClickAction=null,this.EButtonAction=null,this.FButtonAction=null,this.defaultPortrait=A||null,this.uiTheme=B||(E?Q:H),this.container=new UIContainerRect(O),this.container.adaptWidth=!0,this.container.width="100%",this.container.vAlign="bottom",this.container.positionY=105,this.container.visible=!1,this.panel=new UIImage(this.container,this.uiTheme),T(this.panel,J.backgrounds.NPCDialog),this.panel.width=574.5,this.panel.height=186,this.panel.onClick=new OnClick((function(){z.confirmText(K.Next)})),this.defaultPortraitTexture=new Texture(A?A.path:this.uiTheme.src),this.portrait=new UIImage(this.container,this.defaultPortraitTexture),this.portrait.sourceWidth=A&&A.section?A.section.sourceWidth:256,this.portrait.sourceHeight=A&&A.section?A.section.sourceHeight:256,this.portrait.width=A&&A.width?A.width*it:at,this.portrait.height=A&&A.height?A.height*it:at,this.portrait.positionX=A&&A.offsetX?A.offsetX*it+ot:ot,this.portrait.positionY=A&&A.offsetY?A.offsetY*it+0:0,this.portrait.onClick=new OnClick((function(){z.confirmText(K.Next)})),this.image=new UIImage(this.container,new Texture(this.uiTheme.src)),this.image.sourceWidth=256,this.image.sourceHeight=256,this.image.sourceTop=0,this.image.sourceLeft=0,this.image.width=lt,this.image.height=lt,this.image.positionX=rt,this.image.positionY=st,this.image.onClick=new OnClick((function(){z.confirmText(K.Next)})),this.text=new UIText(this.container),this.text.adaptWidth=!1,this.text.textWrapping=!0,this.text.width=345,this.text.positionX=30,this.text.hAlign="center",this.text.vAlign="center",this.text.font=V,this.text.fontSize=18,this.text.hTextAlign="left",this.text.vTextAlign="center",this.text.positionY=ut,this.text.fontWeight="normal",this.text.color=E?Color4.White():Color4.Black(),this.text.isPointerBlocker=!1,this.soundEnt=new Entity,this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(Attachable.AVATAR),R&&(this.soundEnt.addComponent(new AudioSource(new AudioClip(R))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=R),this.button1=new bt(this.container,this.uiTheme,"yes",ht,pt,(function(){z.confirmText(K.Confirm)}),!!E,v.ButtonStyles.E),this.button1.hide(),this.button2=new bt(this.container,this.uiTheme,"no",-60,dt,(function(){z.confirmText(K.Cancel)}),!!E,v.ButtonStyles.F),this.button2.hide(),this.button3=new bt(this.container,this.uiTheme,"maybe",-60,-60,(function(){z.confirmText(K.Button3)}),!!E,v.ButtonStyles.DARK),this.button3.hide(),this.button4=new bt(this.container,this.uiTheme,"maybe",ct,-60,(function(){z.confirmText(K.Button4)}),!!E,v.ButtonStyles.DARK),this.button4.hide(),this.skipButton=new bt(this.container,this.uiTheme,"Skip",-225,-75,(function(){z.skipDialogs()}),!1,Q?v.ButtonStyles.WHITE:v.ButtonStyles.F),this.skipButton.image.width=60,this.skipButton.image.height=22.5,this.skipButton.label.hTextAlign="left",this.skipButton.label.fontSize=9,this.skipButton.label.positionX=30,this.skipButton.label.font=V,this.skipButton.icon.height=15,this.skipButton.icon.width=15,this.skipButton.icon.positionX=-15,this.skipButton.hide(),this.leftClickIcon=new UIImage(this.container,this.uiTheme),this.leftClickIcon.width=24,this.leftClickIcon.height=36,this.leftClickIcon.positionX=255,this.leftClickIcon.positionY=-60,this.leftClickIcon.visible=!1,T(this.leftClickIcon,E?J.icons.ClickDark:J.icons.ClickWhite),vt.createAndAddToEngine()}return e.prototype.openDialogWindow=function(v,A){var E=this;this.UIOpenTime=+Date.now(),this.NPCScript=v,this.activeTextId=A?"number"==typeof A?A:X(v,A):0;var R=v[this.activeTextId]?v[this.activeTextId]:{text:""};if(R.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(R.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),R.portrait?(this.portrait.source=new Texture(R.portrait.path),this.portrait.positionX=R.portrait.offsetX?R.portrait.offsetX*it+ot:ot,this.portrait.positionY=R.portrait.offsetY?R.portrait.offsetY*it+0:0,this.portrait.width=R.portrait.width?R.portrait.width*it:at,this.portrait.height=R.portrait.height?R.portrait.height*it:at,R.portrait.section&&T(this.portrait,R.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=this.defaultPortraitTexture,this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*it+ot:ot,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*it+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*it:at,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*it:at,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),R.image){var B=R.image;log("setting image to ",B.path),this.image.source=new Texture(B.path),this.image.positionX=B.offsetX?B.offsetX*it+rt:rt,this.image.positionY=B.offsetY?B.offsetY*it+st:st,this.image.width=B.width?B.width*it:lt,this.portrait.height=B.height?B.height*it:lt,B.section&&T(this.image,B.section),this.image.visible=!0}else this.image.visible=!1;this.text.fontSize=R.fontSize?R.fontSize*it:18,this.text.positionY=R.offsetY?R.offsetY*it+ut:ut,this.text.positionX=R.offsetX?R.offsetX*it:0,this.text.visible=!0,this.container.visible=!0,vt._instance.newText(this,R.text,this.activeTextId,R.typeSpeed?R.typeSpeed:void 0),this.ClickAction||(this.ClickAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,!1,(function(v){!E.isDialogOpen||+Date.now()-E.UIOpenTime<100||(vt._instance.done?E.isQuestionPanel||E.isFixedScreen||E.confirmText(K.Next):vt._instance.rush())})),this.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){!E.isDialogOpen||+Date.now()-E.UIOpenTime<100||(E.isQuestionPanel?E.confirmText(K.Confirm):E.isQuestionPanel||E.isFixedScreen||E.confirmText(K.Next))})),this.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){!E.isDialogOpen||+Date.now()-E.UIOpenTime<100||(E.isQuestionPanel?E.confirmText(K.Cancel):R.skipable&&!E.isFixedScreen&&E.skipDialogs())}))),this.layoutDialogWindow(this.activeTextId),this.isDialogOpen=!0},e.prototype.confirmText=function(v){var A=this.NPCScript[this.activeTextId];if(this.UIOpenTime=+Date.now(),v==K.Next&&!A.isQuestion){if(A.triggeredByNext&&A.triggeredByNext(),A.isEndOfDialog)return void this.closeDialogWindow();this.activeTextId++}v==K.Confirm&&A.buttons&&A.buttons.length>=1&&("number"==typeof A.buttons[0].goToDialog?this.activeTextId=A.buttons[0].goToDialog:this.activeTextId=X(this.NPCScript,A.buttons[0].goToDialog),A.buttons[0].triggeredActions&&A.buttons[0].triggeredActions()),v==K.Cancel&&A.buttons&&A.buttons.length>=2&&("number"==typeof A.buttons[1].goToDialog?this.activeTextId=A.buttons[1].goToDialog:this.activeTextId=X(this.NPCScript,A.buttons[1].goToDialog),A.buttons[1].triggeredActions&&A.buttons[1].triggeredActions()),v==K.Button3&&A.buttons&&A.buttons.length>=3&&("number"==typeof A.buttons[2].goToDialog?this.activeTextId=A.buttons[2].goToDialog:this.activeTextId=X(this.NPCScript,A.buttons[2].goToDialog),A.buttons[2].triggeredActions&&A.buttons[2].triggeredActions()),v==K.Button4&&A.buttons&&A.buttons.length>=4&&("number"==typeof A.buttons[3].goToDialog?this.activeTextId=A.buttons[3].goToDialog:this.activeTextId=X(this.NPCScript,A.buttons[3].goToDialog),A.buttons[3].triggeredActions&&A.buttons[3].triggeredActions()),A=this.NPCScript[this.activeTextId],vt._instance.newText(this,A.text,this.activeTextId,A.typeSpeed?A.typeSpeed:void 0)},e.prototype.layoutDialogWindow=function(v){var A=this,E=this.NPCScript[v]?this.NPCScript[v]:{text:""},R=E.offsetY?E.offsetY*it+ut:ut;if(E.buttons&&E.buttons.length>=3?R+=37.5:E.buttons&&E.buttons.length>=1&&(R+=18),this.text.fontSize=E.fontSize?E.fontSize*it:18,this.text.positionY=R,E.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(E.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),E.portrait?(this.portrait.source=new Texture(E.portrait.path),this.portrait.positionX=E.portrait.offsetX?E.portrait.offsetX*it+ot:ot,this.portrait.positionY=E.portrait.offsetY?E.portrait.offsetY*it+0:0,this.portrait.width=E.portrait.width?E.portrait.width*it:at,this.portrait.height=E.portrait.height?E.portrait.height*it:at,E.portrait.section&&T(this.portrait,E.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=new Texture(this.defaultPortrait.path),this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*it+ot:ot,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*it+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*it:at,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*it:at,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),this.image.visible=!1,E.image){var B=E.image;log("setting image to ",B.path),this.image.source=new Texture(B.path),this.image.positionX=B.offsetX?B.offsetX*it+rt:rt,this.image.positionY=B.offsetY?B.offsetY*it+st:st,this.image.width=E.image.width?E.image.width*it:lt,this.image.height=E.image.height?E.image.height*it:lt,B.section&&T(this.image,B.section),this.image.visible=!0}else this.image.visible=!1;this.isQuestionPanel=!!E.isQuestion&&E.isQuestion,this.isFixedScreen=!!E.isFixedScreen&&E.isFixedScreen,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.leftClickIcon.visible=!1,E.isQuestion?(this.skipButton.hide(),E.buttons&&E.buttons.length>=1&&this.button1.update(E.buttons[0].label,E.buttons[0].offsetX?E.buttons[0].offsetX*it+ht:ht,E.buttons.length>=3?E.buttons[0].offsetY?E.buttons[0].offsetY*it-15:-15:E.buttons[0].offsetY?E.buttons[0].offsetY*it+pt:pt),E.buttons&&E.buttons.length>=2&&this.button2.update(E.buttons[1].label,E.buttons[1].offsetX*it?E.buttons[1].offsetX*it-60:-60,E.buttons.length>=3?E.buttons[1].offsetY*it?E.buttons[1].offsetY*it-15:-15:E.buttons[1].offsetY*it?E.buttons[1].offsetY*it+dt:dt),E.buttons&&E.buttons.length>=3&&this.button3.update(E.buttons[2].label,E.buttons[2].offsetX*it?E.buttons[2].offsetX*it-60:-60,E.buttons[2].offsetY*it?E.buttons[2].offsetY*it-60:-60),E.buttons&&E.buttons.length>=4&&this.button4.update(E.buttons[3].label,E.buttons[3].offsetX*it?E.buttons[3].offsetX*it+ct:ct,E.buttons[3].offsetY*it?E.buttons[3].offsetY*it-60:-60),wt.addComponentOrReplace(new $(.7,(function(){E.buttons&&E.buttons.length>=1&&A.button1.show(),E.buttons&&E.buttons.length>=2&&A.button2.show(),E.buttons&&E.buttons.length>=3&&A.button3.show(),E.buttons&&E.buttons.length>=4&&A.button4.show()})))):this.isFixedScreen||(this.leftClickIcon.visible=!0,E.skipable?this.skipButton.show():this.skipButton.hide())},e.prototype.closeDialogWindow=function(){this.isDialogOpen&&(this.isDialogOpen=!1,this.portrait.visible=!1,this.text.value="",this.text.visible=!1,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.skipButton.hide(),this.leftClickIcon.visible=!1,this.container.visible=!1)},e.prototype.skipDialogs=function(){if(this.isDialogOpen&&!(+Date.now()-this.UIOpenTime<100)){for(;this.NPCScript[this.activeTextId]&&this.NPCScript[this.activeTextId].skipable&&!this.NPCScript[this.activeTextId].isQuestion;){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].skipable&&this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}this.confirmText(K.Next)}},e}(),vt=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.UIText=null,this.done=!0,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done&&(this.timer+=v,this.timer>=2/this.speed)){var A=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=A,this.closeTag(A),this.visibleChars>=this.fullText.length&&(this.done=!0,this.visibleChars=this.fullText.length),this.UIText&&(this.UIText.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,A,E,R){this.timer=0,this.done=!1,this.UIText=v.text,this.fullText=A,this.visibleChars=0,R&&R<=0?this.rush():this.speed=R||45,v.layoutDialogWindow(E)},t.prototype.rush=function(){this.done=!0,this.timer=0,this.visibleChars=this.fullText.length,this.UIText&&(this.UIText.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var A=!1,E=!1,R=this.visibleChars-v;R<this.visibleChars;R++)A?">"==this.fullText.substr(R,1)&&(E=!0):"<"==this.fullText.substr(R,1)&&(A=!0);if(A&&!E)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),bt=function(A){function o(E,R,B,O,z,M,V,Z){var K=A.call(this)||this;if(K.icon=null,K.image=new UIImage(E,R),K.image.positionX=O,K.image.positionY=z,K.image.width=130.5,K.image.height=34.5,K.label=new UIText(K.image),K.style=Z||null,K.onClick=M,K.style)switch(K.style){case v.ButtonStyles.E:T(K.image,J.buttons.buttonE),K.label.positionX=18.75,K.icon=new UIImage(K.image,1==V?Q:H),K.icon.width=ft,K.icon.height=yt,K.icon.hAlign="center",K.icon.vAlign="center",K.icon.isPointerBlocker=!1,T(K.icon,J.buttonLabels.E),K.icon.positionX=C(B.length);break;case v.ButtonStyles.F:T(K.image,J.buttons.buttonF),K.label.positionX=18.75,K.icon=new UIImage(K.image,1==V?Q:H),K.icon.width=ft,K.icon.height=yt,K.icon.hAlign="center",K.icon.vAlign="center",K.icon.isPointerBlocker=!1,T(K.icon,J.buttonLabels.F),K.icon.positionX=C(B.length);break;case v.ButtonStyles.WHITE:T(K.image,J.buttons.white),K.label.positionX=18.75,K.icon=new UIImage(K.image,1==V?Q:H),K.icon.width=ft,K.icon.height=yt,K.icon.hAlign="center",K.icon.vAlign="center",K.icon.isPointerBlocker=!1,T(K.icon,J.buttonLabels.FBlack),K.icon.positionX=C(B.length);break;case v.ButtonStyles.RED:T(K.image,J.buttons.buttonRed);break;case v.ButtonStyles.DARK:T(K.image,J.buttons.buttonDark);break;case v.ButtonStyles.ROUNDBLACK:T(K.image,J.buttons.roundBlack);break;case v.ButtonStyles.ROUNDWHITE:T(K.image,J.buttons.roundWhite);break;case v.ButtonStyles.ROUNDSILVER:T(K.image,J.buttons.roundSilver);break;case v.ButtonStyles.ROUNDGOLD:T(K.image,J.buttons.roundGold);break;case v.ButtonStyles.SQUAREBLACK:T(K.image,J.buttons.squareBlack);break;case v.ButtonStyles.SQUAREWHITE:T(K.image,J.buttons.squareWhite);break;case v.ButtonStyles.SQUARESILVER:T(K.image,J.buttons.squareSilver);break;case v.ButtonStyles.SQUAREGOLD:T(K.image,J.buttons.squareGold)}else T(K.image,J.buttons.roundSilver);return K.label.value=B,K.label.hTextAlign="center",K.label.vTextAlign="center",K.label.fontSize=15,K.label.font=W,K.label.color=Z==v.ButtonStyles.ROUNDWHITE||Z==v.ButtonStyles.SQUAREWHITE||Z==v.ButtonStyles.WHITE?Color4.Black():Color4.White(),K.label.isPointerBlocker=!1,K.image.onClick=new OnClick((function(){K.onClick()})),Z==v.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){K.image.visible&&K.onClick()})):Z==v.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){K.image.visible&&K.onClick()})),K}return i(o,A),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0},o.prototype.update=function(A,E,R){this.label.value=A,this.image.positionX=E,this.image.positionY=R,!this.icon||this.style!=v.ButtonStyles.E&&this.style!=v.ButtonStyles.F||(this.icon.positionX=C(A.length))},o}(Entity),wt=new Entity;function X(v,A){for(var E=0;E<v.length;E++)if(v[E].name&&v[E].name==A)return E;return 0}engine.addEntity(wt);var xt=function(){function t(){this._triggers={},t._instance=this,this._cameraTriggerWrapper=new At(new j(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(St)}return Object.defineProperty(t,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},t.prototype.update=function(){var v=this,A=this._componentGroup.entities;for(var E in A.forEach((function(A){v.shouldWrapTriggerEntity(A)&&v.wrapTriggerEntity(A)})),this._triggers)if(this._triggers.hasOwnProperty(E)){var R=this._triggers[E];R.isDebugging()&&R.updateDebugEntity(),R.isInEngine()?null!=R.trigger&&R.trigger.enabled?(R.wasEnabled||R.isDebugging()&&R.addDebugEntity(),R.wasEnabled=!0,(R.trigger.onCameraEnter||R.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(R),(R.trigger.onTriggerEnter||R.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(R)):R.wasEnabled&&(R.wasEnabled=!1,R.isDebugging()&&R.removeDebugEntity(),t.removeTriggerFromSystem(R)):(R.isDebugging()&&R.removeDebugEntity(),t.removeTriggerFromSystem(R),delete this._triggers[E])}},t.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},t.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new Tt(v)},t.removeTriggerFromSystem=function(v){for(var A,E=v.getActiveCollisions(),R=0;R<E.length;R++)!(E[R]===(null===(A=t._instance)||void 0===A?void 0:A._cameraTriggerWrapper)||null==E[R].trigger)&&E[R].trigger.onTriggerExit&&v.entity&&E[R].trigger.onTriggerExit(v.entity),E[R].disengageActiveCollision(v),v.disengageActiveCollision(E[R])},t.disengageCollision=function(v,A){v.disengageActiveCollision(A),A.disengageActiveCollision(v),v.trigger.onTriggerExit&&A.entity&&v.trigger.onTriggerExit(A.entity),A.trigger.onTriggerExit&&v.entity&&A.trigger.onTriggerExit(v.entity)},t.engageCollision=function(v,A){v.engageCollision(A),A.engageCollision(v),v.trigger.onTriggerEnter&&A.entity&&v.trigger.onTriggerEnter(A.entity),A.trigger.onTriggerEnter&&v.entity&&A.trigger.onTriggerEnter(v.entity)},t.prototype.checkCollisionAgainstCamera=function(v){var A=v.hasActiveCollision(this._cameraTriggerWrapper),E=t.areColliding(v,this._cameraTriggerWrapper);A&&!E?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!A&&E&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},t.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var A in this._triggers)if(this._triggers.hasOwnProperty(A)&&A!=v.uuid&&this._triggers[A].trigger.enabled&&t.canTriggersCollide(v,this._triggers[A])){var E=v.hasActiveCollision(this._triggers[A]),R=t.areColliding(v,this._triggers[A]);E&&!R?t.disengageCollision(v,this._triggers[A]):!E&&R&&t.engageCollision(v,this._triggers[A])}},t.canTriggersCollide=function(v,A){return 0==v.trigger.triggeredByLayer||0!=(A.trigger.layer&v.trigger.triggeredByLayer)},t.areColliding=function(v,A){return v.getShape()instanceof j&&A.getShape()instanceof j?t.areCollidingAABB(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof q&&A.getShape()instanceof q?t.areCollidingSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof j&&A.getShape()instanceof q?t.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof q&&A.getShape()instanceof j&&t.areCollidingAABBSphere(A.getGlobalPosition(),A.getShape(),v.getGlobalPosition(),v.getShape())},t.areCollidingAABB=function(v,A,E,R){var B=t.getBoxShapeValues(v,A),O=t.getBoxShapeValues(E,R);return B.min.x<=O.max.x&&B.max.x>=O.min.x&&B.min.y<=O.max.y&&B.max.y>=O.min.y&&B.min.z<=O.max.z&&B.max.z>=O.min.z},t.areCollidingSphere=function(v,A,E,R){return Vector3.DistanceSquared(v.add(A.position),E.add(R.position))<A.radius*A.radius+R.radius*R.radius},t.areCollidingAABBSphere=function(v,A,E,R){var B=t.getBoxShapeValues(v,A),O=E.add(R.position),z=R.radius,M=0;return O.x<B.min.x&&(M+=(B.min.x-O.x)*(B.min.x-O.x)),O.x>B.max.x&&(M+=(O.x-B.max.x)*(O.x-B.max.x)),O.y<B.min.y&&(M+=(B.min.y-O.y)*(B.min.y-O.y)),O.y>B.max.y&&(M+=(O.y-B.max.y)*(O.y-B.max.y)),O.z<B.min.z&&(M+=(B.min.z-O.z)*(B.min.z-O.z)),O.z>B.max.z&&(M+=(O.z-B.max.z)*(O.z-B.max.z)),M<z*z},t.getBoxShapeValues=function(v,A){var E=v.add(A.position);return{center:E,min:E.subtract(A.size.scale(.5)),max:E.add(A.size.scale(.5))}},t._instance=null,t}(),Tt=function(){function t(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(St),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),t.prototype.getGlobalPosition=function(){return this._entity?t.getEntityWorldPosition(this._entity):Vector3.Zero()},t.prototype.getShape=function(){return this._trigger.shape},t.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},t.prototype.getActiveCollisions=function(){var v=[];for(var A in this._collidingWith)this._collidingWith.hasOwnProperty(A)&&v.push(this._collidingWith[A]);return v},t.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},t.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},t.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},t.prototype.isDebugging=function(){return this._isDebug},t.prototype.addDebugEntity=function(){if(t._debugMaterial||(t._debugMaterial=new Material,t._debugMaterial.alphaTest=.5),null==this._debugEntity){this._debugEntity=new Entity;var v=new Transform;if(this._debugEntity.addComponent(v),this._debugEntity.addComponent(t._debugMaterial),this.getShape()instanceof j&&((A=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(A),v.scale=this.getShape().size),this.getShape()instanceof q){var A;(A=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(A);var E=this.getShape().radius;v.scale=new Vector3(E,E,E)}}engine.addEntity(this._debugEntity)},t.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},t.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},t.getEntityWorldPosition=function(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),E=v.getParent();if(null!=E){var R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(E).add(A.rotate(R))}return A},t._debugMaterial=null,t}(),At=function(v){function e(A){var E=v.call(this)||this;return E._shape=A,E._uuid="cameraTrigger",E}return i(e,v),e.prototype.getGlobalPosition=function(){return Camera.instance.position},e.prototype.getShape=function(){return this._shape},e.prototype.setShape=function(v){this._shape=v},e.prototype.isInEngine=function(){return!1},e.prototype.hasActiveCollision=function(v){return!1},e.prototype.disengageActiveCollision=function(v){},e.prototype.engageCollision=function(v){},e.prototype.isDebugging=function(){return!1},e}(Tt),St=function(){function t(v,A){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,xt.createAndAddToEngine(),this.shape=v,this.layer=A&&A.layer?A.layer:0,this.triggeredByLayer=A&&A.triggeredByLayer?A.triggeredByLayer:0,this.onTriggerEnter=A&&A.onTriggerEnter?A.onTriggerEnter:void 0,this.onTriggerExit=A&&A.onTriggerExit?A.onTriggerExit:void 0,this.onCameraEnter=A&&A.onCameraEnter?A.onCameraEnter:void 0,this.onCameraExit=A&&A.onCameraExit?A.onCameraExit:void 0,this._debugEnabled=!(!A||!A.enableDebug)&&A.enableDebug}return Object.defineProperty(t.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),o([Component("npcTriggerComponent")],t)}(),j=function(v,A){this.size=v,this.position=A},q=function(v,A){this.radius=v,this.position=A},Ct=function(){function t(v){this.origin=0,this.target=1,this.fraction=0,this.totalDuration=0,this.speed=[],this.loop=!1,this.path=v,It.createAndAddToEngine()}return t.prototype.setIndex=function(v){this.fraction=0,this.origin=v,this.target=v+1<this.path.length?v+1:0},o([Component("npclerpData")],t)}(),_t=[],It=function(){function e(){e._instance=this}return e.prototype.update=function(A){var E,R;try{for(var B=n(_t),O=B.next();!O.done;O=B.next()){var z=O.value;if(z.state==v.NPCState.FOLLOWPATH){var M=z.getComponent(Transform),W=z.getComponent(Ct);if(W.fraction<1)W.fraction+=A*W.speed[W.origin],M.position=Vector3.Lerp(W.path[W.origin],W.path[W.target],W.fraction);else{if(W.origin=W.target,W.target+=1,W.target>=W.path.length){if(!W.loop)return z.stopWalking(),W.onFinishCallback&&W.onFinishCallback(),void(W.fraction=1);W.target=0}else W.onReachedPointCallback&&W.onReachedPointCallback();W.fraction=0,M.lookAt(W.path[W.target])}}}}catch(v){E={error:v}}finally{try{O&&!O.done&&(R=B.return)&&R.call(B)}finally{if(E)throw E.error}}},e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e._instance=null,e}(),Rt=100,Pt=function(){function t(v,A,E){this.NPCScript=[],this.isBubleOpen=!1,this.activeTextId=0,this.defaultSound=null,this.baseYOffset=2.5,this.baseYOffset=A||2.5,this.rootEntity=new Entity,this.rootEntity.addComponent(new Billboard(!1,!0,!1)),this.rootEntity.addComponent(new Transform),this.rootEntity.setParent(v),this.container=new Entity,this.container.addComponent(new Transform({position:new Vector3(-.1,this.baseYOffset,0)})),this.container.setParent(this.rootEntity),this.material=new BasicMaterial,this.material.texture=Z,this.panel=new Entity,this.panel.addComponent(new Transform({scale:new Vector3(2,1,1)})),this.panel.setParent(this.container),this.panel.addComponent(new PlaneShape),this.panel.addComponent(this.material),this.panel.getComponent(PlaneShape).visible=!1,b(this.panel.getComponent(PlaneShape),J.bubbles.normal,1024,1024),this.text=new Entity,this.text.addComponent(new Transform({position:new Vector3(0,0,.05),rotation:Quaternion.Euler(0,180,0)})),this.text.addComponent(new TextShape("")),this.text.setParent(this.container),this.text.getComponent(TextShape).textWrapping=!0,this.text.getComponent(TextShape).font=V,this.text.getComponent(TextShape).hTextAlign="center",this.text.getComponent(TextShape).vTextAlign="center",this.text.getComponent(TextShape).fontSize=1,this.text.getComponent(TextShape).fontWeight="normal",this.text.getComponent(TextShape).color=Color3.Black(),this.text.getComponent(TextShape).visible=!1,this.soundEnt=new Entity,E&&(this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(this.container),this.soundEnt.addComponent(new AudioSource(new AudioClip(E))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=E),Bt.createAndAddToEngine()}return t.prototype.openDialogWindow=function(v,A){this.NPCScript=v,this.activeTextId=A?"number"==typeof A?A:function(v,A){for(var E=0;E<v.length;E++)if(v[E].name&&v[E].name==A)return E;return 0}(v,A):0;var E=v[this.activeTextId]?v[this.activeTextId]:{text:""};E.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(E.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),this.text.getComponent(TextShape).fontSize=E.fontSize?E.fontSize:1,this.text.getComponent(Transform).position.y=E.offsetY?E.offsetY+0:0,this.text.getComponent(Transform).position.x=E.offsetX?E.offsetX:0,this.text.getComponent(TextShape).visible=!0,this.panel.getComponent(PlaneShape).visible=!0,this.text.getComponent(TextShape).value="",E.text.length<Rt&&E.text.slice(0,Rt),Bt._instance.newText(this,E.text,this.activeTextId,E.timeOn?E.timeOn:void 0,E.typeSpeed?E.typeSpeed:void 0),this.adjustBubble(E.text.length),this.layoutDialogWindow(this.activeTextId),this.isBubleOpen=!0},t.prototype.adjustBubble=function(v){v<8?(b(this.panel.getComponent(PlaneShape),J.bubbles.short,1024,1024),this.panel.getComponent(Transform).scale.x=.58,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.1,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=.7):v<25?(b(this.panel.getComponent(PlaneShape),J.bubbles.normal,1024,1024),this.panel.getComponent(Transform).scale.x=1.43,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.5,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=1.5):v<50?(b(this.panel.getComponent(PlaneShape),J.bubbles.long,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=.765,this.container.getComponent(Transform).position.y=this.baseYOffset+0,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2):(b(this.panel.getComponent(PlaneShape),J.bubbles.huge,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=1.195,this.container.getComponent(Transform).position.y=this.baseYOffset+.2,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2)},t.prototype.next=function(){var v=this.NPCScript[this.activeTextId];v||(v=this.NPCScript[this.activeTextId-1]),v.triggeredByNext&&v.triggeredByNext(),v.isEndOfDialog?this.closeDialogWindow():(this.activeTextId++,(v=this.NPCScript[this.activeTextId]).text.length<Rt&&v.text.slice(0,Rt),this.text.getComponent(TextShape).value="",this.adjustBubble(v.text.length),Bt._instance.newText(this,v.text,this.activeTextId,v.timeOn?v.timeOn:void 0,v.typeSpeed?v.typeSpeed:void 0),this.layoutDialogWindow(this.activeTextId))},t.prototype.layoutDialogWindow=function(v){var A=this.NPCScript[v]?this.NPCScript[v]:{text:""},E=A.offsetY?A.offsetY+0:0;A.buttons&&A.buttons.length>=3?E+=50:A.buttons&&A.buttons.length>=1&&(E+=24),this.text.getComponent(TextShape).fontSize=A.fontSize?A.fontSize:1,this.text.getComponent(TextShape).visible=!0,this.text.getComponent(Transform).position.y=E,A.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(A.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce())},t.prototype.closeDialogWindow=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1)},t.prototype.closeDialogEndAll=function(){this.isBubleOpen&&(Bt._instance.Dialog==this&&(Bt._instance.done=!0,Bt._instance.Dialog=null),this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1)},t.prototype.skipDialogs=function(){if(this.isBubleOpen)for(;this.NPCScript[this.activeTextId];){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}},t}(),Bt=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.Text=null,this.textId=0,this.done=!0,this.showing=!1,this.timeOn=3,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done)if(this.timer+=v,this.showing)this.timer>this.timeOn&&(this.showing=!1,this.done=!0,this.timer=0,this.window.next());else if(this.timer>=2/this.speed){var A=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=A,this.closeTag(A),this.visibleChars>=this.fullText.length&&(this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length),this.Text&&(this.Text.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,A,E,R,B){if(v!=this.Dialog||E!=this.textId){var O=this.Dialog;this.Dialog=v,this.Text=this.Dialog.text.getComponent(TextShape),this.textId=E,O&&v!=O&&O.skipDialogs(),this.timer=0,this.done=!1,this.showing=!1,this.fullText=A,this.visibleChars=0,this.window=v,B&&B<=0?this.rush():this.speed=B||45,this.timeOn=R||3}},t.prototype.rush=function(){this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length,this.Text&&(this.Text.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var A=!1,E=!1,R=this.visibleChars-v;R<this.visibleChars;R++)A?">"==this.fullText.substr(R,1)&&(E=!0):"<"==this.fullText.substr(R,1)&&(A=!0);if(A&&!E)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),Ot=function(E){function o(R,B,O,z){var M=E.call(this)||this;M.introduced=!1,M.onWalkAway=null,M.inCooldown=!1,M.coolDownDuration=5,M.faceUser=!1,M.walkingAnim=null,M.walkingSpeed=2,M.bubbleHeight=2,M.addComponent(new GLTFShape(B)),M.addComponent(new Transform(R)),engine.addEntity(M),M.state=v.NPCState.STANDING,z&&z.noUI||(z&&z.portrait?M.dialog=new gt("string"==typeof z.portrait?{path:z.portrait}:z.portrait,!(!z||!z.darkUI)&&z.darkUI,z.dialogSound?z.dialogSound:void 0):M.dialog=new gt(void 0,!(!z||!z.darkUI)&&z.darkUI,z&&z.dialogSound?z.dialogSound:void 0)),z&&z.textBubble&&(z&&z.bubbleHeight&&(M.bubbleHeight=z.bubbleHeight),M.bubble=new Pt(M,M.bubbleHeight,z.dialogSound?z.dialogSound:void 0)),M.addComponent(new Animator),M.idleAnim=new AnimationState(z&&z.idleAnim?z.idleAnim:"Idle",{looping:!0}),M.getComponent(Animator).addClip(M.idleAnim),M.lastPlayedAnim=M.idleAnim,M.idleAnim.play(),z&&z.walkingAnim&&(M.walkingAnim=new AnimationState(z.walkingAnim,{looping:!0}),M.getComponent(Animator).addClip(M.walkingAnim)),M.onActivate=O,z&&z.onWalkAway&&(M.onWalkAway=z.onWalkAway),M.endAnimTimer=new Entity,engine.addEntity(M.endAnimTimer),M.closeDialogTimer=new Entity,engine.addEntity(M.closeDialogTimer),M.pauseWalkingTimer=new Entity,engine.addEntity(M.pauseWalkingTimer);var W=z&&z.onlyClickTrigger?ActionButton.POINTER:ActionButton.PRIMARY;M.addComponent(new OnPointerDown((function(v){M.inCooldown||M.dialog&&M.dialog.isDialogOpen||M.activate()}),{button:W,hoverText:z&&z.hoverText?z.hoverText:"Talk",showFeedback:!z||!z.onlyExternalTrigger})),z&&z.onlyExternalTrigger&&M.removeComponent(OnPointerDown);var V={};return(!z||z&&!z.continueOnWalkAway)&&(V.onCameraExit=function(){M.handleWalkAway()}),z&&(!z||z.onlyExternalTrigger||z.onlyClickTrigger||z.onlyETrigger)||(V.onCameraEnter=function(){M.inCooldown?log(M.name," in cooldown"):M.dialog&&M.dialog.isDialogOpen||z&&z.onlyExternalTrigger||z&&z.onlyClickTrigger||M.activate()}),(V.onCameraEnter||V.onCameraExit)&&M.addComponent(new St(new q(z&&z.reactDistance?z.reactDistance:6,Vector3.Zero()),V)),z&&z.faceUser&&(M.addComponent(new A(!0,z.turningSpeed?z.turningSpeed:void 0)),M.faceUser=!0),z&&z.walkingSpeed&&(M.walkingSpeed=z.walkingSpeed),z&&z.coolDownDuration&&(M.coolDownDuration=z.coolDownDuration),z&&z.path&&(M.addComponent(new Ct(z.path?z.path:[])),M.getComponent(Ct).loop=!0,_t.push(M),M.followPath()),M}return i(o,E),o.prototype.activate=function(){var v=this;this.faceUser&&(this.getComponent(A).active=!0),this.inCooldown=!0,this.addComponentOrReplace(new $(this.coolDownDuration,(function(){v.inCooldown=!1}))),this.onActivate()},o.prototype.endInteraction=function(){this.faceUser&&(this.getComponent(A).active=!1),this.dialog&&this.dialog.isDialogOpen&&this.dialog.closeDialogWindow(),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.state=v.NPCState.STANDING},o.prototype.handleWalkAway=function(){this.state!=v.NPCState.FOLLOWPATH&&(this.endInteraction(),this.onWalkAway&&this.onWalkAway())},o.prototype.talk=function(A,E,R){var B=this;this.introduced=!0,this.state=v.NPCState.TALKING,this.closeDialogTimer.hasComponent($)&&this.closeDialogTimer.removeComponent($),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.dialog.openDialogWindow(A,E||0),R&&this.closeDialogTimer.addComponentOrReplace(new $(R,(function(){B.dialog.closeDialogWindow()})))},o.prototype.talkBubble=function(v,A){this.bubble||(this.bubble=new Pt(this,this.bubbleHeight)),this.bubble.openDialogWindow(v,A||0)},o.prototype.playAnimation=function(v,A,E){var R=this;this.endAnimTimer.hasComponent($)&&this.endAnimTimer.removeComponent($);var B=this.getComponent(Animator).getClip(v);A&&(B.looping=!1,E&&this.endAnimTimer.addComponentOrReplace(new $(E,(function(){B.stop(),R.idleAnim&&(R.idleAnim.play(),R.lastPlayedAnim=R.idleAnim)})))),B.play(!0),this.lastPlayedAnim=B},o.prototype.changeIdleAnim=function(v,A){this.idleAnim=new AnimationState(v,{looping:!0}),this.getComponent(Animator).addClip(this.idleAnim),A&&(this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim)},o.prototype.followPath=function(E){if(!this.hasComponent(Ct)){if(!E)return;this.addComponent(new Ct(E.path?E.path:[])),_t.push(this)}this.faceUser&&(this.getComponent(A).active=!1);var R=this.getComponent(Ct);if(E){if(E.path)if(E.curve){var B=Curve3.CreateCatmullRomSpline(E.path,4*E.path.length,!!E.loop).getPoints();E.loop&&B.pop(),R.path=B}else R.path=E.path;null!=E.loop&&(R.loop=E.loop),null!=E.startingPoint&&R.setIndex(E.startingPoint),E.onFinishCallback&&(R.onFinishCallback=E.onFinishCallback),E.onReachedPointCallback&&(R.onReachedPointCallback=E.onReachedPointCallback)}var O=this.getComponent(Transform).position;(0==R.fraction&&R.path[R.origin].subtract(O).lengthSquared()>.1||R.fraction>0&&O.subtract(R.path[R.origin]).normalize()==R.path[R.target].subtract(R.path[R.origin]).normalize())&&(R.path.splice(R.origin,0,this.getComponent(Transform).position),R.fraction=0),this.getComponent(Transform).lookAt(R.path[R.target]);for(var z=0,M=[],W=0;W<R.path.length-1;W++){var V;z+=V=Vector3.Distance(R.path[W],R.path[W+1]),M.push(V)}for(R.loop&&(z+=V=Vector3.Distance(R.path[R.path.length-1],R.path[0]),M.push(V)),E&&E.totalDuration?R.totalDuration=E.totalDuration:E&&E.speed?R.totalDuration=z/E.speed:R.totalDuration||(R.totalDuration=z/this.walkingSpeed),R.speed=[],W=0;W<M.length;W++)R.speed.push(1/(M[W]/z*R.totalDuration));this.walkingAnim&&(this.endAnimTimer.hasComponent($)&&this.endAnimTimer.removeComponent($),this.walkingAnim.play(),this.lastPlayedAnim=this.walkingAnim),this.state=v.NPCState.FOLLOWPATH},o.prototype.stopWalking=function(A){var E=this;this.state=v.NPCState.STANDING,this.walkingAnim&&(this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim),A&&this.pauseWalkingTimer.addComponentOrReplace(new $(A,(function(){E.dialog&&E.dialog.isDialogOpen||(E.lastPlayedAnim.stop(),E.walkingAnim&&(E.walkingAnim.play(),E.lastPlayedAnim=E.walkingAnim),E.endAnimTimer.hasComponent($)&&E.endAnimTimer.removeComponent($),E.state=v.NPCState.FOLLOWPATH)})))},o}(Entity);v.CustomDialogButton=bt,v.DialogTypeInSystem=vt,v.DialogWindow=gt,v.NPC=Ot,v.NPCDelay=$,v.NPCLerpData=Ct,v.NPCTriggerComponent=St,v.SFFont=W,v.SFHeavyFont=V,v.TrackUserFlag=A,v.TriggerBoxShape=j,v.TriggerSphereShape=q,v.canvas=O,v.darkTheme=Q,v.lightTheme=H,Object.defineProperty(v,"__esModule",{value:!0})})),function(v,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define("@dcl/ui-scene-utils",["exports"],A):A((v="undefined"!=typeof globalThis?globalThis:v||self)["ui-utils"]={})}(this,(function(v){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(v,A){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(v[E]=A[E])})(v,A)};function i(v,A){function o(){this.constructor=v}e(v,A),v.prototype=null===A?Object.create(A):(o.prototype=A.prototype,new o)}var o=function(){return(o=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var B in A=arguments[E])Object.prototype.hasOwnProperty.call(A,B)&&(v[B]=A[B]);return v}).apply(this,arguments)};function n(v,A){var E={};for(var R in v)Object.prototype.hasOwnProperty.call(v,R)&&A.indexOf(R)<0&&(E[R]=v[R]);if(null!=v&&"function"==typeof Object.getOwnPropertySymbols){var B=0;for(R=Object.getOwnPropertySymbols(v);B<R.length;B++)A.indexOf(R[B])<0&&Object.prototype.propertyIsEnumerable.call(v,R[B])&&(E[R[B]]=v[R[B]])}return E}function r(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var A=function(){function t(A,E){var B=this;R.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=A,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(A){B.onTimeReachedCallback(),A.removeComponent(v)}}var v;return v=t,t.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=function(v,A,E,R){var B,O=arguments.length,z=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,A,E,R);else for(var M=v.length-1;M>=0;M--)(B=v[M])&&(z=(O<3?B(z):O>3?B(A,E,z):B(A,E))||z);return O>3&&z&&Object.defineProperty(A,E,z),z}([Component("UItimerDelay")],t)}(),E=engine.getComponentGroup(A),R=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){var R,B;try{for(var O=r(E.entities),z=O.next();!z.done;z=O.next()){var M=z.value,W=M.getComponent(A);W.elapsedTime+=v,W.elapsedTime>=W.targetTime&&W.onTargetTimeReached(M)}}catch(v){R={error:v}}finally{try{z&&!z.done&&(B=O.return)&&B.call(O)}finally{if(R)throw R.error}}},t._instance=null,t}(),B=new UICanvas;B.visible=!0;var O=new Font(Fonts.SanFrancisco),z=new Font(Fonts.SanFrancisco_Heavy),M=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),W=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),V=new UIText(B);V.vAlign="center",V.hAlign="center",V.hTextAlign="center",V.vTextAlign="center",V.font=O,V.fontSize=60,V.color=new Color4(0,0,0,1),V.visible=!1,V.positionY=80;var H=new UIImage(B,M);H.hAlign="center",H.vAlign="center",H.width=400,H.height=250,H.visible=!1;var Q,Z,K,J,$=function(v){function e(A,E,R,z,M,W,V){var H=v.call(this)||this;return H.canvas=B,H.valueAsNum=A,H.uiText=new UIText(B),H.fixedDigits=V||null,H.uiText.value=H.toFixedLengthString(A),H.uiText.hAlign="right",H.uiText.vAlign="bottom",H.uiText.positionX=E||0,H.uiText.positionY=R||0,H.uiText.fontSize=M||25,H.uiText.font=O,H.uiText.vTextAlign="center",H.uiText.hTextAlign="center",H.uiText.color=z||Color4.White(),H.uiText.outlineColor=Color4.Black(),H.uiText.outlineWidth=W?0:.1,H}return i(e,v),e.prototype.read=function(){return this.valueAsNum},e.prototype.increase=function(v){this.valueAsNum+=v||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.decrease=function(v){this.valueAsNum-=v||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.set=function(v){this.valueAsNum=v,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.toFixedLengthString=function(v){var A=v.toString();if(!this.fixedDigits)return A;for(var E=A.length-this.fixedDigits;E<0;)A="0".concat(A),E+=1;return E>0&&(A=v.toPrecision(this.fixedDigits)),A},e}(Entity);(Q=v.PromptStyles||(v.PromptStyles={})).LIGHT="light",Q.DARK="dark",Q.LIGHTLARGE="lightlarge",Q.DARKLARGE="darklarge",Q.LIGHTSLANTED="lightslanted",Q.DARKSLANTED="darkslanted",(Z=v.BarStyles||(v.BarStyles={})).ROUNDBLACK="roundblack",Z.ROUNDWHITE="roundwhite",Z.ROUNDSILVER="roundsilver",Z.ROUNDGOLD="roundgold",Z.SQUAREBLACK="squareblack",Z.SQUAREWHITE="squarewhite",Z.SQUARESILVER="squaresilver",Z.SQUAREGOLD="squaregold",(K=v.ButtonStyles||(v.ButtonStyles={})).E="e",K.F="f",K.DARK="dark",K.RED="red",K.ROUNDBLACK="roundblack",K.ROUNDWHITE="roundwhite",K.ROUNDSILVER="roundsilver",K.ROUNDGOLD="roundgold",K.SQUAREBLACK="squareblack",K.SQUAREWHITE="squarewhite",K.SQUARESILVER="squaresilver",K.SQUAREGOLD="squaregold",(J=v.SwitchStyles||(v.SwitchStyles={})).ROUNDGREEN="roundgreen",J.ROUNDRED="roundred",J.SQUAREGREEN="squaregreen",J.SQUARERED="squarered";var et={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},nt={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},it={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},ot={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},rt={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},st={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},at={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},lt={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},ut={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},ht={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},ct={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},pt={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567},dt={sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},ft={sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},yt={sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},gt={sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},vt={sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},bt={closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},wt={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},xt={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},Tt={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},At={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},St={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},Ct={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},_t={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},It={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168},Rt={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},Pt={sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},Bt={sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},Ot={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},zt={sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},Nt={sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501};function S(v,A){v.sourceWidth=A.sourceWidth,v.sourceHeight=A.sourceHeight,v.sourceLeft=A.sourceLeft?A.sourceLeft:0,v.sourceTop=A.sourceTop?A.sourceTop:0}function C(v){var A=-10-4*v;return A>-65?A:-65}var Lt=function(A){function o(E,R,O,z,W,V,H){var Q=A.call(this)||this;if(Q.canvas=B,Q.valueAsNum=E>1?1:E,Q.fullWidth=V?128*V:128,Q.background=new UIImage(B,M),Q.background.width=V?128*V:128,Q.background.height=V?32*V:32,Q.background.hAlign="right",Q.background.vAlign="bottom",Q.background.positionX=R||0,Q.background.positionY=O||0,W)switch(W){case v.BarStyles.ROUNDBLACK:S(Q.background,rt);break;case v.BarStyles.ROUNDWHITE:S(Q.background,at);break;case v.BarStyles.ROUNDSILVER:S(Q.background,ut);break;case v.BarStyles.ROUNDGOLD:S(Q.background,ct);break;case v.BarStyles.SQUAREBLACK:S(Q.background,st);break;case v.BarStyles.SQUAREWHITE:S(Q.background,lt);break;case v.BarStyles.SQUARESILVER:S(Q.background,ht);break;case v.BarStyles.SQUAREGOLD:S(Q.background,pt)}else S(Q.background,ut);return Q.background.sourceWidth=128,Q.background.sourceHeight=32,Q.background.visible=!0,Q.bar=new UIContainerRect(Q.background),Q.bar.color=z||Color4.Red(),Q.bar.thickness=0,Q.bar.hAlign="left",Q.bar.vAlign="center",Q.bar.positionX=V?2.55*V:2.55,Q.bar.positionY=0,Q.bar.height=V?32*V-7.5*V:24.5,Q.bar.width=V?Q.fullWidth*Q.valueAsNum-5.1*V:Q.fullWidth*Q.valueAsNum-5.1,H&&Q.hide(),Q}return i(o,A),o.prototype.read=function(){return this.valueAsNum},o.prototype.increase=function(v){this.valueAsNum+=v||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.decrease=function(v){this.valueAsNum-=v||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.set=function(v){this.valueAsNum=v,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.hide=function(){this.background.visible=!1,this.bar.visible=!1},o.prototype.show=function(){this.background.visible=!0,this.bar.visible=!0},o}(Entity),Ft=function(v){function e(A,E,R,O,z,M){var W=v.call(this)||this;W.canvas=B;var V=new Texture(A);return W.image=new UIImage(B,V),W.image.hAlign="right",W.image.vAlign="bottom",W.image.positionX=E||0,W.image.positionY=R||0,W.image.width=O||64,W.image.height=z||64,W.image.sourceLeft=M&&M.sourceLeft?M.sourceLeft:0,W.image.sourceTop=M&&M.sourceTop?M.sourceTop:0,W.image.sourceWidth=M&&M.sourceWidth?M.sourceWidth:O||64,W.image.sourceHeight=M&&M.sourceHeight?M.sourceHeight:z||64,W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var E=this;if(this.image.visible=!0,v){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(v,(function(){E.hide()})))}},e}(Entity),kt=function(v){function e(A,E,R,O,z,M){var W=v.call(this)||this;W.canvas=B;var V=new Texture(A);return W.image=new UIImage(B,V),W.image.hAlign="right",W.image.vAlign="bottom",W.image.positionX=E||0,W.image.positionY=R||0,W.image.width=O||32,W.image.height=z||32,W.image.sourceLeft=M&&M.sourceLeft?M.sourceLeft:0,W.image.sourceTop=M&&M.sourceTop?M.sourceTop:0,W.image.sourceWidth=M?M.sourceWidth:O||32,W.image.sourceHeight=M?M.sourceHeight:z||32,W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var E=this;if(this.image.visible=!0,v){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(v,(function(){E.hide()})))}},e}(Entity),Wt=function(v){function e(A,E,R,O,z,M){var W=v.call(this)||this;W.canvas=B;var V=new Texture(A);return W.image=new UIImage(B,V),W.image.hAlign="right",W.image.vAlign="bottom",W.image.positionX=E||0,W.image.positionY=R||0,W.image.width=O||128,W.image.height=z||128,W.image.sourceLeft=M&&M.sourceLeft?M.sourceLeft:0,W.image.sourceTop=M&&M.sourceTop?M.sourceTop:0,W.image.sourceWidth=M?M.sourceWidth:O||128,W.image.sourceHeight=M?M.sourceHeight:z||128,W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var E=this;if(this.image.visible=!0,v){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(v,(function(){E.hide()})))}},e}(Entity),qt=function(v){function e(E,R,O,z,M,W,V,H){var Q=v.call(this)||this;Q.canvas=B;var Z=new Texture(E);if(Q.image=new UIImage(B,Z),Q.image.hAlign="center",Q.image.vAlign="center",Q.image.positionX=z||0,Q.image.positionY=M||0,Q.image.width=W||512,Q.image.height=V||512,Q.image.sourceLeft=H&&H.sourceLeft?H.sourceLeft:0,Q.image.sourceTop=H&&H.sourceTop?H.sourceTop:0,Q.image.sourceWidth=H?H.sourceWidth:W||512,Q.image.sourceHeight=H?H.sourceHeight:V||512,Q.image.visible=!O,-1!=R){var K=new Entity;engine.addEntity(K),K.addComponentOrReplace(new A(R||3,(function(){Q.hide()})))}return Q}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var E=this;if(this.image.visible=!0,v){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(v,(function(){E.hide()})))}},e}(Entity),Vt=function(v){function e(A,E,R,z){var V=v.call(this)||this;V.canvas=B,V.background=H,V.UIOpenTime=+Date.now(),V.onAccept=E||null;var Q=z?W:M;return H.source=Q,H.width=400,H.height=250,H.positionY=0,S(H,yt),H.visible=!0,V.closeIcon=new UIImage(H,Q),V.closeIcon.positionX=175,V.closeIcon.positionY=100,V.closeIcon.width=32,V.closeIcon.height=32,S(V.closeIcon,z?bt.closeW:bt.closeD),V.closeIcon.onClick=new OnClick((function(){V.close()})),V.text=new UIText(H),V.text.value=A,V.text.adaptWidth=!1,V.text.textWrapping=!0,V.text.width=380,V.text.hAlign="center",V.text.vAlign="top",V.text.positionX=0,V.text.positionY=-65,V.text.fontSize=24,V.text.font=O,V.text.vTextAlign="center",V.text.hTextAlign="center",V.text.color=z?Color4.White():Color4.Black(),V.button=new UIImage(H,Q),V.button.positionX=0,V.button.positionY=-60,V.button.width=174,V.button.height=46,S(V.button,et),V.icon=new UIImage(V.button,1==z?W:M),V.icon.width=26,V.icon.height=26,V.icon.hAlign="center",V.icon.vAlign="center",V.icon.isPointerBlocker=!1,S(V.icon,dt),V.icon.positionX=C(R?R.length:2),V.buttonLabel=new UIText(V.button),V.buttonLabel.value=R||"Ok",V.buttonLabel.hTextAlign="center",V.buttonLabel.vTextAlign="center",V.buttonLabel.positionX=30,V.buttonLabel.fontSize=18,V.buttonLabel.font=O,V.buttonLabel.color=Color4.White(),V.buttonLabel.isPointerBlocker=!1,V.button.onClick=new OnClick((function(){V.accept()})),V.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){V.button.visible&&+Date.now()-V.UIOpenTime>100&&V.accept()})),V}return i(e,v),e.prototype.close=function(){H.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.close()},e.prototype.hide=function(){H.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1},e.prototype.show=function(){H.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0},e}(Entity),Ut=function(v){function e(A,E,R,V,Q,Z,K){var J=v.call(this)||this;J.canvas=B,J.background=H,J.UIOpenTime=+Date.now(),J.onAccept=R,J.onReject=V||null;var $=K?W:M;return H.source=$,H.width=480,H.height=384,S(H,gt),H.visible=!0,J.closeIcon=new UIImage(H,$),J.closeIcon.positionX=215,J.closeIcon.positionY=164,J.closeIcon.width=32,J.closeIcon.height=32,S(J.closeIcon,K?bt.closeW:bt.closeD),J.closeIcon.onClick=new OnClick((function(){J.close()})),J.title=new UIText(H),J.title.value=A,J.title.adaptWidth=!1,J.title.textWrapping=!0,J.title.width=380,J.title.hAlign="center",J.title.vAlign="top",J.title.positionX=0,J.title.positionY=-20,J.title.font=z,J.title.fontSize=24,J.title.vTextAlign="center",J.title.hTextAlign="center",J.title.color=K?Color4.White():Color4.Black(),J.text=new UIText(H),J.text.value=E,J.text.adaptWidth=!1,J.text.textWrapping=!0,J.text.width=380,J.text.hAlign="center",J.text.vAlign="top",J.text.positionX=0,J.text.positionY=-145,J.text.fontSize=24,J.text.font=O,J.text.vTextAlign="center",J.text.hTextAlign="center",J.text.color=K?Color4.White():Color4.Black(),J.buttonE=new UIImage(H,$),J.buttonE.positionX=-100,J.buttonE.positionY=-120,J.buttonE.width=174,J.buttonE.height=46,S(J.buttonE,et),J.buttonEIcon=new UIImage(J.buttonE,1==K?W:M),J.buttonEIcon.width=26,J.buttonEIcon.height=26,J.buttonEIcon.hAlign="center",J.buttonEIcon.vAlign="center",J.buttonEIcon.isPointerBlocker=!1,S(J.buttonEIcon,dt),J.buttonEIcon.positionX=C(Q?Q.length:2),J.buttonELabel=new UIText(J.buttonE),J.buttonELabel.value=Q||"Ok",J.buttonELabel.hTextAlign="center",J.buttonELabel.vTextAlign="center",J.buttonELabel.positionX=30,J.buttonELabel.fontSize=18,J.buttonELabel.font=O,J.buttonELabel.color=Color4.White(),J.buttonELabel.isPointerBlocker=!1,J.buttonE.onClick=new OnClick((function(){J.accept()})),J.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){J.buttonE.visible&&+Date.now()-J.UIOpenTime>100&&J.accept()})),J.buttonF=new UIImage(H,$),J.buttonF.positionX=100,J.buttonF.positionY=-120,J.buttonF.width=174,J.buttonF.height=46,S(J.buttonF,nt),J.buttonFIcon=new UIImage(J.buttonF,1==K?W:M),J.buttonFIcon.width=26,J.buttonFIcon.height=26,J.buttonFIcon.hAlign="center",J.buttonFIcon.vAlign="center",J.buttonFIcon.isPointerBlocker=!1,S(J.buttonFIcon,ft),J.buttonFIcon.positionX=C(Z?Z.length:6),J.buttonFLabel=new UIText(J.buttonF),J.buttonFLabel.value=Z||"Cancel",J.buttonFLabel.hTextAlign="center",J.buttonFLabel.vTextAlign="center",J.buttonFLabel.positionX=30,J.buttonFLabel.fontSize=18,J.buttonFLabel.font=O,J.buttonFLabel.color=Color4.White(),J.buttonFLabel.isPointerBlocker=!1,J.buttonF.onClick=new OnClick((function(){J.reject()})),J.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){J.buttonF.visible&&+Date.now()-J.UIOpenTime>100&&J.reject()})),J}return i(e,v),e.prototype.close=function(){H.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.title.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.close()},e.prototype.reject=function(){this.onReject&&this.onReject(),this.close()},e.prototype.hide=function(){H.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.buttonEIcon.visible=!1,this.buttonFIcon.visible=!1},e.prototype.show=function(){H.visible=!0,this.closeIcon.visible=!0,this.buttonE.visible=!0,this.buttonF.visible=!0,this.text.visible=!0,this.buttonELabel.visible=!0,this.buttonFLabel.visible=!0,this.buttonEIcon.visible=!0,this.buttonFIcon.visible=!0},e}(Entity),Ht=function(v){function e(A,E,R,V,Q){var Z=v.call(this)||this;Z.canvas=B,Z.background=H,Z.UIOpenTime=+Date.now(),Z.onAccept=E;var K=Q?W:M;H.source=K,H.width=400,H.height=250,S(H,yt),H.visible=!0,Z.text=new UIText(H),Z.text.value=A,Z.text.adaptWidth=!1,Z.text.textWrapping=!0,Z.text.width=320,Z.text.hAlign="center",Z.text.vAlign="top",Z.text.positionX=0,Z.text.positionY=-20,Z.text.fontSize=24,Z.text.font=z,Z.text.vTextAlign="center",Z.text.hTextAlign="center",Z.text.color=Q?Color4.White():Color4.Black(),Z.closeIcon=new UIImage(H,K),Z.closeIcon.positionX=175,Z.closeIcon.positionY=100,Z.closeIcon.width=32,Z.closeIcon.height=32,S(Z.closeIcon,Q?bt.closeW:bt.closeD),Z.closeIcon.onClick=new OnClick((function(){Z.hide()})),Z.button=new UIImage(H,K),Z.button.positionX=0,Z.button.positionY=-60,Z.button.width=174,Z.button.height=46,S(Z.button,et),Z.icon=new UIImage(Z.button,1==Q?W:M),Z.icon.width=26,Z.icon.height=26,Z.icon.hAlign="center",Z.icon.vAlign="center",Z.icon.isPointerBlocker=!1,S(Z.icon,dt),Z.icon.positionX=C(R?R.length:6),Z.buttonLabel=new UIText(Z.button),Z.buttonLabel.value=R||"Submit",Z.buttonLabel.hTextAlign="center",Z.buttonLabel.vTextAlign="center",Z.buttonLabel.positionX=30,Z.buttonLabel.fontSize=18,Z.buttonLabel.font=O,Z.buttonLabel.color=Color4.White(),Z.buttonLabel.isPointerBlocker=!1,Z.fillInBox=new UIInputText(H),Z.fillInBox.color=Color4.Black(),Z.fillInBox.font=O,Z.fillInBox.width=312,Z.fillInBox.height=46,Z.fillInBox.positionX=0,Z.fillInBox.positionY=15,Z.fillInBox.placeholder=V||"Fill in",Z.fillInBox.hTextAlign="center",Z.fillInBox.vTextAlign="center",Z.fillInBox.fontSize=22;var J="";return Z.fillInBox.onChanged=new OnChanged((function(v){J=v.value})),Z.fillInBox.onTextSubmit=new OnTextSubmit((function(v){Z.accept(J)})),Z.button.onClick=new OnClick((function(){Z.accept(J)})),Z.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){Z.button.visible&&+Date.now()-Z.UIOpenTime>100&&Z.accept(J)})),Z}return i(e,v),e.prototype.close=function(){H.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1},e.prototype.accept=function(v){this.onAccept(v),this.close()},e.prototype.hide=function(){H.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1},e.prototype.show=function(){H.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0,this.fillInBox.visible=!0},e}(Entity),Gt=function(A){function o(E,R,O,z){var V=A.call(this)||this;switch(V.elements=[],V.texture=M,V.darkTheme=!1,V.background=new UIImage(B,M),V.closeIcon=new UIImage(V.background,V.texture),V.UIOpenTime=0,V.canvas=B,V.UIOpenTime=+Date.now(),V.background=new UIImage(B,M),V.background.hAlign="center",V.background.vAlign="center",E||(E=v.PromptStyles.LIGHT),E){case v.PromptStyles.LIGHT:V.texture=M,S(V.background,yt),S(V.closeIcon,bt.closeD),V.closeIcon.positionX=R?R/2-25:175,V.closeIcon.positionY=O?O/2-25:145;break;case v.PromptStyles.DARK:V.texture=W,V.darkTheme=!0,S(V.background,yt),S(V.closeIcon,bt.closeW),V.closeIcon.positionX=R?R/2-25:175,V.closeIcon.positionY=O?O/2-25:145;break;case v.PromptStyles.LIGHTLARGE:V.texture=M,S(V.background,gt),S(V.closeIcon,bt.closeD),V.closeIcon.positionX=R?R/2-25:215,V.closeIcon.positionY=O?O/2-25:165;break;case v.PromptStyles.DARKLARGE:V.texture=W,V.darkTheme=!0,S(V.background,gt),S(V.closeIcon,bt.closeW),V.closeIcon.positionX=R?R/2-25:215,V.closeIcon.positionY=O?O/2-25:165;break;case v.PromptStyles.LIGHTSLANTED:V.texture=M,S(V.background,vt),S(V.closeIcon,bt.closeD),V.closeIcon.positionX=R?R/2-25:215,V.closeIcon.positionY=O?O/2-25:138;break;case v.PromptStyles.DARKSLANTED:V.texture=W,V.darkTheme=!0,S(V.background,vt),S(V.closeIcon,bt.closeW),V.closeIcon.positionX=R?R/2-25:215,V.closeIcon.positionY=O?O/2-25:138;break;default:V.texture=new Texture(E),V.closeIcon.visible=!1}return V.background.source=V.texture,V.background.width=R||V.background.sourceWidth,V.background.height=O||V.background.sourceHeight,V.background.visible=!0,V.closeIcon.width=32,V.closeIcon.height=32,V.closeIcon.source=V.texture,V.closeIcon.onClick=new OnClick((function(){V.hide()})),z&&V.hide(),V}return i(o,A),o.prototype.hide=function(){var v,A;this.background.visible=!1,this.closeIcon.visible=!1;try{for(var E=r(this.elements),R=E.next();!R.done;R=E.next())R.value.hide()}catch(A){v={error:A}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(v)throw v.error}}},o.prototype.show=function(){var v,A;this.background.visible=!0,this.closeIcon.visible=!0;try{for(var E=r(this.elements),R=E.next();!R.done;R=E.next())R.value.show()}catch(A){v={error:A}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(v)throw v.error}}},o.prototype.addText=function(v,A,E,R,B){var O=new Jt(this,v,A,E,this.darkTheme,R||void 0,B||void 0);return this.elements.push(O),O},o.prototype.addButton=function(v,A,E,R,B){var O=new Yt(this,this.texture,this.UIOpenTime,v,A,E,R,B||void 0);return this.elements.push(O),O},o.prototype.addCheckbox=function(v,A,E,R,B,O,z){var M=new Qt(this,this.texture,this.darkTheme,v,A,E,R||void 0,B||void 0,O||void 0,z||void 0);return this.elements.push(M),M},o.prototype.addSwitch=function(v,A,E,R,B,O,z){var M=new Zt(this,this.texture,this.darkTheme,v,A,E,R||void 0,B||void 0,O||void 0,z||void 0);return this.elements.push(M),M},o.prototype.addIcon=function(v,A,E,R,B,O){var z=new Texture(v),M=new Kt(this,z,A,E,R||void 0,B||void 0,O||void 0);return this.elements.push(M),M},o.prototype.addTextBox=function(v,A,E,R){var B=new $t(this,v,A,E||void 0,R||void 0);return this.elements.push(B),B},o}(Entity),Yt=function(A){function o(E,R,B,z,M,W,V,H){var Q=A.call(this)||this;if(Q.icon=null,Q.image=new UIImage(E.background,R),Q.image.positionX=M,Q.image.positionY=W,Q.image.width=174,Q.image.height=46,Q.label=new UIText(Q.image),H)switch(H){case v.ButtonStyles.E:S(Q.image,et),Q.label.positionX=25,Q.icon=new UIImage(Q.image,R),Q.icon.width=26,Q.icon.height=26,Q.icon.hAlign="center",Q.icon.vAlign="center",Q.icon.isPointerBlocker=!1,S(Q.icon,dt),Q.icon.positionX=C(z.length);break;case v.ButtonStyles.F:S(Q.image,nt),Q.label.positionX=25,Q.icon=new UIImage(Q.image,R),Q.icon.width=26,Q.icon.height=26,Q.icon.hAlign="center",Q.icon.vAlign="center",Q.icon.isPointerBlocker=!1,S(Q.icon,ft),Q.icon.positionX=C(z.length);break;case v.ButtonStyles.RED:S(Q.image,it);break;case v.ButtonStyles.DARK:S(Q.image,ot);break;case v.ButtonStyles.ROUNDBLACK:S(Q.image,rt);break;case v.ButtonStyles.ROUNDWHITE:S(Q.image,at);break;case v.ButtonStyles.ROUNDSILVER:S(Q.image,ut);break;case v.ButtonStyles.ROUNDGOLD:S(Q.image,ct);break;case v.ButtonStyles.SQUAREBLACK:S(Q.image,st);break;case v.ButtonStyles.SQUAREWHITE:S(Q.image,lt);break;case v.ButtonStyles.SQUARESILVER:S(Q.image,ht);break;case v.ButtonStyles.SQUAREGOLD:S(Q.image,pt);break;default:S(Q.image,ut)}else S(Q.image,ut);return Q.label.value=z,Q.label.hTextAlign="center",Q.label.vTextAlign="center",Q.label.fontSize=20,Q.label.font=O,Q.label.color=H==v.ButtonStyles.ROUNDWHITE||H==v.ButtonStyles.SQUAREWHITE?Color4.Black():Color4.White(),Q.label.isPointerBlocker=!1,Q.image.onClick=new OnClick((function(){V()})),H==v.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){Q.image.visible&&+Date.now()-B>100&&V()})):H==v.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){Q.image.visible&&+Date.now()-B>100&&V()})),Q}return i(o,A),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1,this.icon&&(this.icon.visible=!1)},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0,this.icon&&(this.icon.visible=!0)},o}(Entity),Qt=function(v){function e(A,E,R,B,z,M,W,V,H,Q){var Z=v.call(this)||this;return Z.checked=!!Q,Z.darkTheme=R,Z.large=H||!1,Z.image=new UIImage(A.background,E),Z.image.positionX=z,Z.image.positionY=M,Z.image.width=H?32:24,Z.image.height=H?32:24,0==Z.checked?Z.uncheck():Z.check(),Z.label=new UIText(Z.image),Z.label.positionX=H?40:30,Z.label.color=R?Color4.White():Color4.Black(),Z.label.value=B,Z.label.hTextAlign="left",Z.label.vTextAlign="center",Z.label.fontSize=20,Z.label.font=O,Z.label.isPointerBlocker=!1,Z.image.onClick=new OnClick((function(){0==Z.checked?Z.check():Z.uncheck(),Z.checked?W&&W():V&&V()})),Z}return i(e,v),e.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},e.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},e.prototype.uncheck=function(){this.checked=!1,this.darkTheme?this.large?S(this.image,St):S(this.image,wt):this.large?S(this.image,_t):S(this.image,Tt)},e.prototype.check=function(){this.checked=!0,this.darkTheme?this.large?S(this.image,Ct):S(this.image,xt):this.large?S(this.image,It):S(this.image,At)},e}(Entity),Zt=function(A){function o(E,R,B,z,M,W,V,H,Q,Z){var K=A.call(this)||this;return K.checked=!!Z,K.darkTheme=B,K.style=Q||v.SwitchStyles.ROUNDGREEN,K.image=new UIImage(E.background,R),K.image.positionX=M,K.image.positionY=W,K.image.width=64,K.image.height=32,0==K.checked?K.check():K.uncheck(),K.label=new UIText(K.image),K.label.positionX=80,K.label.color=B?Color4.White():Color4.Black(),K.label.value=z,K.label.hTextAlign="left",K.label.vTextAlign="center",K.label.fontSize=20,K.label.font=O,K.label.isPointerBlocker=!1,K.image.onClick=new OnClick((function(){0==K.checked?K.check():K.uncheck(),K.checked?V&&V():H&&H()})),K}return i(o,A),o.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},o.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},o.prototype.check=function(){switch(this.checked=!0,this.style){case v.SwitchStyles.ROUNDGREEN:S(this.image,Bt);break;case v.SwitchStyles.ROUNDRED:S(this.image,Pt);break;case v.SwitchStyles.SQUAREGREEN:S(this.image,Nt);break;case v.SwitchStyles.SQUARERED:S(this.image,zt)}},o.prototype.uncheck=function(){this.checked=!1,this.style==v.SwitchStyles.ROUNDGREEN||this.style==v.SwitchStyles.ROUNDRED?S(this.image,Rt):S(this.image,Ot)},o}(Entity),Kt=function(v){function e(A,E,R,B,O,z,M){var W=v.call(this)||this;return W.image=new UIImage(A.background,E),W.image.positionX=R,W.image.positionY=B,W.image.width=O||128,W.image.height=z||128,W.image.sourceLeft=M&&M.sourceLeft?M.sourceLeft:0,W.image.sourceTop=M&&M.sourceTop?M.sourceTop:0,W.image.sourceWidth=M&&M.sourceWidth?M.sourceWidth:O||128,W.image.sourceHeight=M&&M.sourceHeight?M.sourceHeight:z||128,W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity),Jt=function(v){function e(A,E,R,B,O,z,M){var W=v.call(this)||this;return W.text=new UIText(A.background),W.text.value=E,W.text.positionX=R||0,W.text.positionY=B||0,W.text.hTextAlign="center",W.text.color=z||(O?Color4.White():Color4.Black()),W.text.fontSize=M||15,W}return i(e,v),e.prototype.hide=function(){this.text.visible=!1},e.prototype.show=function(){this.text.visible=!0},e}(Entity),$t=function(v){function e(A,E,R,B,z){var M=v.call(this)||this;return M.currentText="",M.fillInBox=new UIInputText(A.background),M.fillInBox.color=Color4.Black(),M.fillInBox.font=O,M.fillInBox.width=312,M.fillInBox.height=46,M.fillInBox.positionX=E,M.fillInBox.positionY=R,M.fillInBox.placeholder=B||"Fill in",M.fillInBox.hTextAlign="center",M.fillInBox.vTextAlign="center",M.fillInBox.fontSize=22,M.fillInBox.onChanged=new OnChanged((function(v){M.fillInBox&&!M.fillInBox.visible||(M.currentText=v.value,z&&z(M.currentText))})),M.fillInBox.onTextSubmit=new OnTextSubmit((function(v){M.fillInBox&&!M.fillInBox.visible||(M.currentText=v.text,z&&z(M.currentText))})),M}return i(e,v),e.prototype.hide=function(){this.fillInBox.visible=!1},e.prototype.show=function(){this.fillInBox.visible=!0},e}(Entity),ee=function(v){function e(A,E,R,z,M,W){var V=v.call(this)||this;return V.canvas=B,V.uiText=new UIText(B),V.uiText.value=A,V.uiText.hAlign="right",V.uiText.vAlign="bottom",V.uiText.positionX=E||0,V.uiText.positionY=R||0,V.uiText.fontSize=M||25,V.uiText.font=O,V.uiText.vTextAlign="center",V.uiText.hTextAlign="center",V.uiText.color=z||Color4.White(),V.uiText.outlineColor=Color4.Black(),V.uiText.outlineWidth=W?0:.1,V}return i(e,v),e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.set=function(v){this.uiText.value=v,this.uiText.visible=!0},e}(Entity),ne=function(v){function e(E,R,O,z){var W=v.call(this)||this;if(W.canvas=B,W.image=new UIImage(B,M),W.image.hAlign="center",W.image.vAlign="center",W.image.positionX=R||0,W.image.positionY=O?O+80:80,W.image.width=z?48*z:48,W.image.height=z?64*z:64,S(W.image,bt.TimerLarge),E&&0!=E){var V=new Entity;engine.addEntity(V),V.addComponentOrReplace(new A(E||3,(function(){W.hide()})))}return W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity);function q(v){return v&&"object"==typeof v&&!Array.isArray(v)}function j(v,A){var E=o({},v);return q(v)&&q(A)&&Object.keys(A).forEach((function(R){var B,O;q(A[R])?R in v?E[R]=j(v[R],A[R]):E=o(o({},E),((B={})[R]=A[R],B)):E=o(o({},E),((O={})[R]=A[R],O))})),E}var ie=function(){function t(v,A){this.shape=v,A&&this.setProperties(A)}return t.prototype.setProperties=function(v){var A,E;try{for(var R=r(Object.keys(v)),B=R.next();!B.done;B=R.next()){var O=B.value;this.shape[O]=v[O]}}catch(v){A={error:v}}finally{try{B&&!B.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},t.prototype.getProperty=function(v){return this.shape[v]},t}(),oe=function(v){function e(A,E){var R,B,O,z,M=v.call(this,new UIInputText(A),o(o({},E),{placeholder:null!==(R=null==E?void 0:E.placeholder)&&void 0!==R?R:null==E?void 0:E.value,placeholderColor:null!==(B=null==E?void 0:E.placeholderColor)&&void 0!==B?B:null==E?void 0:E.color,onFocus:new OnFocus((function(){var v;M.isInputFocused=!0,null===(v=null==E?void 0:E.onFocus)||void 0===v||v.call(E)})),onBlur:new OnBlur((function(){var v,A;M.isInputFocused=!1,""===M.inputValue&&void 0!==M.placeholder?(M.setInputValue(M.placeholder),null===(v=null==E?void 0:E.onBlur)||void 0===v||v.call(E,!0)):null===(A=null==E?void 0:E.onBlur)||void 0===A||A.call(E,!1)})),onChanged:new OnChanged((function(v){var A,R=v.value;if(M.shape.visible)if(M.inputValue=R,R===M.placeholder)M.shape.placeholderColor=M.placeholderColor;else if(""===R&&(M.shape.placeholderColor=M.color,M.shape.placeholder=""),M.isInputFocused||""===R){var B=null!==(A=null==E?void 0:E.waitTime)&&void 0!==A?A:e.DEFAULT_WAIT_TIME;setTimeout((function(){var v;M.inputValue===R&&(null===(v=null==E?void 0:E.onChanged)||void 0===v||v.call(E,R))}),B)}})),onTextSubmit:new OnTextSubmit((function(v){var A=v.text,R=A.substr(0,A.length-1),B=null==E?void 0:E.onTextSubmit;B?B(R):setTimeout((function(){return M.shape.placeholder=R}),0)}))}))||this;return M.inputValue="",M.isInputFocused=!1,M.placeholder=M.shape.placeholder,M.color=M.shape.color,M.placeholderColor=M.shape.placeholderColor,M.inputValue=null!==(O=null==E?void 0:E.value)&&void 0!==O?O:null!==(z=null==E?void 0:E.placeholder)&&void 0!==z?z:"",M.isInputFocused=!1,M}return i(e,v),e.prototype.getValue=function(){return this.inputValue},e.prototype.isFocused=function(){return this.isInputFocused},e.prototype.setInputValue=function(v){var A=this.isInputFocused;this.isInputFocused=!1,this.shape.placeholder="",this.inputValue=this.shape.placeholder=v,this.isInputFocused=A},e.prototype.reset=function(){this.setInputValue(this.placeholder)},e.prototype.hide=function(){this.setProperties({visible:!1})},e.prototype.show=function(){this.setProperties({visible:!0}),this.setInputValue(this.inputValue)},e.DEFAULT_WAIT_TIME=650,e}(ie),se=function(v){function e(A,E){var R=v.call(this,new UIContainerRect(A),o({isPointerBlocker:!0},E))||this,B=new UIImage(R.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));return B.width="100%",B.height="100%",B.sourceWidth=1,B.sourceHeight=1,B.isPointerBlocker=!0,R.image=B,(null==E?void 0:E.onClick)&&R.setOnClick(E.onClick),R}return i(e,v),e.prototype.performClick=function(){var v;null===(v=this.image.onClick)||void 0===v||v.callback({})},e.prototype.setOnClick=function(v){this.image.onClick=new OnClick(v)},e.prototype.clearOnClick=function(){this.image.onClick=null},e}(ie),ae=function(v){function e(A,E){var R=v.call(this,new UIContainerRect(A),o({width:"100%",vAlign:"top",visible:!1},E))||this;R.config=o(o({},e.DEFAULTS),E);var B=new se(R.shape,{width:"100%",height:"100%",color:Color4.Clear()});R.clickableContainer=B;var O=new UIImage(B.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));O.width=O.height=R.config.imageSize,O.hAlign="left",O.positionX=10,O.vAlign="center",R.image=O;var z=new UIText(B.shape);z.vAlign="top",z.hAlign="left",z.vTextAlign="top",z.fontSize=R.config.topFontSize,z.color=R.config.topTextColor,z.positionX=55,z.positionY=-10,z.isPointerBlocker=!1,R.topLeftText=z;var M=new UIText(B.shape);M.vAlign="top",M.hAlign="right",M.vTextAlign="top",M.hTextAlign="right",M.fontSize=z.fontSize,M.color=z.color,M.isPointerBlocker=!1,M.positionX=-10,M.positionY=z.positionY,R.topRightText=M;var W=new UIText(B.shape);W.vAlign="bottom",W.hAlign="left",W.vTextAlign="bottom",W.fontSize=R.config.bottomFontSize,W.color=R.config.bottomTextColor,W.positionX=z.positionX,W.positionY=10,W.isPointerBlocker=!1,R.bottomLeftText=W;var V=new UIText(B.shape);return V.vAlign="bottom",V.hAlign="right",V.vTextAlign="bottom",V.hTextAlign="right",V.fontSize=W.fontSize,V.color=W.color,V.isPointerBlocker=!1,V.positionX=M.positionX,V.positionY=W.positionY,R.bottomRightText=V,R}return i(e,v),e.prototype.setOption=function(v,A){this.image.visible=!1,this.topRightText.visible=!1,this.bottomLeftText.visible=!1,this.bottomRightText.visible=!1,v.image?(this.image.source=new Texture(v.image.src),this.image.sourceWidth=v.image.sourceWidth,this.image.sourceHeight=v.image.sourceHeight,this.image.visible=!0,this.topLeftText.positionX=this.config.imageSize+20):this.topLeftText.positionX=10,"string"==typeof v.visualText?(this.topLeftText.value=v.visualText,this.topLeftText.vAlign=this.topLeftText.vTextAlign="center",this.topLeftText.positionY=0):"text"in v.visualText?(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=v.visualText.text,this.bottomLeftText.value=v.visualText.subText,this.bottomLeftText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX):"bottomLeft"in v.visualText&&(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=v.visualText.topLeft,this.topRightText.value=v.visualText.topRight,this.bottomLeftText.value=v.visualText.bottomLeft,this.bottomRightText.value=v.visualText.bottomRight,this.topRightText.visible=!0,this.bottomLeftText.visible=!0,this.bottomRightText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX),A?this.clickableContainer.setOnClick(A):this.clickableContainer.clearOnClick()},e.prototype.setProperties=function(A){v.prototype.setProperties.call(this,A)},e.prototype.getProperty=function(A){return v.prototype.getProperty.call(this,A)},e.prototype.performClick=function(){this.clickableContainer.performClick()},e.DEFAULTS={topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},e}(ie),le=function(v){function e(A,E,R,B){var O=v.call(this,new UIContainerRect(A),o({},R))||this;O.onSuccessfulSelection=B,O.uiOptions=[],O.options={},R.visible,R.opacity,R.hAlign,R.vAlign,R.positionX,R.positionY;var z=n(R,["visible","opacity","hAlign","vAlign","positionX","positionY"]);O.config=j(e.DEFAULTS,z),O.setProperties({width:O.config.width,height:O.config.initialHeight,color:O.config.borderColor}),O.setItems(E.items,E.dropdownDefaultItemIds);var W=new UIContainerRect(O.shape);W.color=O.config.backgroundColor,W.width=O.config.width-2*O.config.borderSize,W.height=O.config.initialHeight-2*O.config.borderSize,O.insideContainer=W;var V=new oe(W,{vAlign:"top",hTextAlign:"left",vTextAlign:"center",width:"92%",fontSize:O.config.search.fontSize,placeholder:O.config.search.placeholder.defaultText,placeholderColor:O.config.search.placeholder.textColor,color:O.config.search.textColor,focusedBackground:Color4.Clear(),background:Color4.Clear(),height:.95*O.config.initialHeight,onBlur:function(){return O.close()},onTextSubmit:function(){O.uiOptions[0].getProperty("visible")?O.uiOptions[0].performClick():O.close()},onChanged:function(v){if(O.hideAllOptions(),v===O.config.search.placeholder.defaultText||""===v)O.showDefaultOptions();else{var A=v.toLowerCase(),E=[];for(var R in O.options){var B=O.options[R];if(B.searchBy.toLowerCase().indexOf(A)>=0&&(E.push(B),E.length===O.config.options.maxVisibleOptions))break}E.length>0?O.showOptions(E):O.showErrorMessage("Sorry, we can't find \""+v+'"')}}});O.inputText=V;for(var H=0;H<O.config.options.maxVisibleOptions;H++){var Q=new ae(W,o(o({},O.config.options),{height:O.config.initialHeight,positionY:-O.config.initialHeight-O.config.initialHeight*H,color:H%2==0?O.config.options.oddBackgroundColor:W.color}));O.uiOptions.push(Q)}var Z=new UIImage(W,M);Z.onClick=new OnClick((function(){return O.close()})),Z.sourceTop=305,Z.sourceLeft=985,Z.sourceWidth=Z.sourceHeight=35,Z.width=Z.height=18,Z.hAlign="right",Z.vAlign="top",Z.positionX=-12,Z.positionY=-12,Z.visible=Z.isPointerBlocker=!0;var K=new UIText(W);return K.height=20,K.visible=!1,K.width="92%",K.hTextAlign="center",K.vAlign="bottom",K.positionY=20,K.fontSize=O.config.errorMessage.fontSize,K.color=O.config.errorMessage.textColor,O.errorMessage=K,O}return i(e,v),e.prototype.open=function(){this.setProperties({visible:!0}),this.showDefaultOptions()},e.prototype.close=function(){this.setProperties({visible:!1}),this.inputText.reset()},e.prototype.setItems=function(v,A){this.options=v.reduce((function(v,A){var E;return A.searchBy=null!==(E=A.searchBy)&&void 0!==E?E:"string"==typeof A.visualText?A.visualText:"text"in A.visualText?A.visualText.text:A.visualText.topLeft,v[A.id]=A,v}),{}),A?this.setDropdownDefaults(A):this.defaultOptions=A,this.hideAllOptions()},e.prototype.setDropdownDefaults=function(v){var A,E;try{for(var R=r(v),B=R.next();!B.done;B=R.next()){var O=B.value;if(!(O in this.options))return void error("Couldn't find an option with id '"+O+"'. Will not set new defaults")}}catch(v){A={error:v}}finally{try{B&&!B.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}this.defaultOptions=v},e.prototype.showDefaultOptions=function(){var v,A=this;if(this.defaultOptions)v=this.defaultOptions.map((function(v){return A.options[v]})).slice(0,this.config.options.maxVisibleOptions);else for(var E in v=[],this.options)if(v.push(this.options[E]),v.length===this.config.options.maxVisibleOptions)break;this.showOptions(v)},e.prototype.showOptions=function(v){var A=this;this.resizeHeight(this.config.initialHeight*v.length+2*this.config.borderSize),v.forEach((function(v,E){var R=A.uiOptions[E];R.setOption(v,(function(){A.onSuccessfulSelection(v),A.setProperties({visible:!1})})),R.setProperties({visible:!0})})),this.errorMessage.visible=!1},e.prototype.hideAllOptions=function(){this.uiOptions.forEach((function(v){return v.setProperties({visible:!1})}))},e.prototype.showErrorMessage=function(v){this.errorMessage.visible=!0,this.errorMessage.value=v,this.resizeHeight(60)},e.prototype.resizeHeight=function(v){this.setProperties({height:this.config.initialHeight+v}),this.insideContainer.height=this.config.initialHeight+v-2*this.config.borderSize},e.DEFAULTS={borderColor:Color4.FromInts(232,236,253,255),backgroundColor:Color4.White(),borderSize:2,width:300,initialHeight:60,search:{fontSize:16,textColor:Color4.FromInts(24,26,70,255),placeholder:{defaultText:"Click to search",textColor:Color4.FromInts(118,120,181,200)}},options:{maxVisibleOptions:5,oddBackgroundColor:Color4.FromInts(246,246,255,255),topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},errorMessage:{fontSize:13,textColor:Color4.FromInts(125,127,157,255)}},e}(ie),ue=function(v){function e(A,E,R,B){var O=v.call(this,new UIContainerRect(A),o({},R))||this;O.onSuccessfulSelection=B,R.visible,R.opacity,R.hAlign,R.vAlign,R.positionX,R.positionY;var z=n(R,["visible","opacity","hAlign","vAlign","positionX","positionY"]);O.config=j(le.DEFAULTS,z),O.setProperties({width:O.config.width,height:O.config.initialHeight,color:O.config.borderColor});var M=new se(O.shape,{color:O.config.backgroundColor,width:O.config.width-2*O.config.borderSize,height:O.config.initialHeight-2*O.config.borderSize,onClick:function(){return O.uiSearchPrompt.open()}}),W=new ae(M.shape,o(o({},O.config.options),{height:O.config.initialHeight,color:Color4.Clear(),width:O.config.width-2*O.config.borderSize-20,visible:!0,hAlign:"left",isPointerBlocker:!1})),V=new UIText(M.shape);if(V.value="Click to select an option",V.fontSize=O.config.search.fontSize,V.color=O.config.search.placeholder.textColor,V.vTextAlign=V.hTextAlign="center",V.positionX=-O.config.borderSize-10,V.isPointerBlocker=!1,V.opacity=V.color.a,O.initialText=V,null==E?void 0:E.initialItemId){var H=E.items.filter((function(v){return v.id===E.initialItemId}))[0];H&&(W.setOption(H),O.initialText.visible=!1)}var Q=new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAN5AAADeQELGyzWAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlQTFRF////AAAAAAAAflGpXQAAAAJ0Uk5TAICbK04YAAAAeklEQVQ4je3PsRXEMAgE0VFCEapG9agaiiDRVXkJxlpq8IYT/AfwTbZ/ssPUEJgGZ2hYDTmgSIAiDoqsdskBRQIUcVBktXdO/jeVuBDPMBpRyEMUEhVMiUKKSOQlEokrmBKJXARsJWAqAaYEjEbAVgJmtGDewmjEt9wfISOqAUzY2sAAAAAASUVORK5CYII="),Z=new UIImage(M.shape,Q);return Z.sourceWidth=Z.sourceHeight=64,Z.height=15,Z.width=12,Z.hAlign="right",Z.vAlign="center",Z.positionX=-10,Z.visible=!0,Z.isPointerBlocker=!1,O.uiSearchPrompt=new le(O.shape,E,o(o({},R),{visible:!1,vAlign:"top",initialHeight:O.config.initialHeight-2*O.config.borderSize}),(function(v){W.setOption(v),O.initialText.visible=!1,O.onSuccessfulSelection(v)})),O}return i(e,v),e.prototype.open=function(){this.setProperties({visible:!0})},e.prototype.close=function(){this.setProperties({visible:!1})},e.prototype.setSearchItems=function(v,A){this.uiSearchPrompt.setItems(v,A)},e.prototype.setSearchDropdownDefaults=function(v){this.uiSearchPrompt.setDropdownDefaults(v)},e}(ie);v.CenterImage=qt,v.CornerLabel=ee,v.CustomPrompt=Gt,v.CustomPromptButton=Yt,v.CustomPromptCheckBox=Qt,v.CustomPromptIcon=Kt,v.CustomPromptSwitch=Zt,v.CustomPromptText=Jt,v.CustomPromptTextBox=$t,v.FillInPrompt=Ht,v.LargeIcon=Wt,v.LoadingIcon=ne,v.MediumIcon=Ft,v.OkPrompt=Vt,v.OptionPrompt=Ut,v.SFFont=O,v.SFHeavyFont=z,v.SmallIcon=kt,v.UIBar=Lt,v.UICounter=$,v.UISearchPrompt=le,v.UISelectBox=ue,v.canvas=B,v.darkTheme=W,v.displayAnnouncement=function(v,E,R,B,O){V.visible=!0,V.value=v,V.color=R||Color4.Yellow(),V.fontSize=B||50,V.font=z,V.outlineColor=Color4.Black(),V.outlineWidth=O?0:.1,V.adaptWidth=!1,V.textWrapping=!0,V.width=900;var M=new Entity;engine.addEntity(M),-1!=E&&M.addComponentOrReplace(new A(E||3,(function(){V.visible=!1})))},v.hideAnnouncements=function(){V.visible=!1},v.lightTheme=M,Object.defineProperty(v,"__esModule",{value:!0})})),function(v){var A;"object"==typeof exports&&"undefined"!=typeof module?module.exports=v():("undefined"!=typeof window?A=window:"undefined"!=typeof global?A=global:"undefined"!=typeof self&&(A=self),A.CANNON=v())}((function(){return function e(v,A,E){function d(B,O){if(!A[B]){if(!v[B]){var z="function"==typeof require&&require;if(!O&&z)return z(B,!0);if(R)return R(B,!0);throw new Error("Cannot find module '"+B+"'")}var M=A[B]={exports:{}};v[B][0].call(M.exports,(function(A){return d(v[B][1][A]||A)}),M,M.exports,e,v,A,E)}return A[B].exports}for(var R="function"==typeof require&&require,B=0;B<E.length;B++)d(E[B]);return d}({1:[function(v,A){A.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(v,A){A.exports={version:v("../package.json").version,AABB:v("./collision/AABB"),ArrayCollisionMatrix:v("./collision/ArrayCollisionMatrix"),Body:v("./objects/Body"),Box:v("./shapes/Box"),Broadphase:v("./collision/Broadphase"),Constraint:v("./constraints/Constraint"),ContactEquation:v("./equations/ContactEquation"),Narrowphase:v("./world/Narrowphase"),ConeTwistConstraint:v("./constraints/ConeTwistConstraint"),ContactMaterial:v("./material/ContactMaterial"),ConvexPolyhedron:v("./shapes/ConvexPolyhedron"),Cylinder:v("./shapes/Cylinder"),DistanceConstraint:v("./constraints/DistanceConstraint"),Equation:v("./equations/Equation"),EventTarget:v("./utils/EventTarget"),FrictionEquation:v("./equations/FrictionEquation"),GSSolver:v("./solver/GSSolver"),GridBroadphase:v("./collision/GridBroadphase"),Heightfield:v("./shapes/Heightfield"),HingeConstraint:v("./constraints/HingeConstraint"),LockConstraint:v("./constraints/LockConstraint"),Mat3:v("./math/Mat3"),Material:v("./material/Material"),NaiveBroadphase:v("./collision/NaiveBroadphase"),ObjectCollisionMatrix:v("./collision/ObjectCollisionMatrix"),Pool:v("./utils/Pool"),Particle:v("./shapes/Particle"),Plane:v("./shapes/Plane"),PointToPointConstraint:v("./constraints/PointToPointConstraint"),Quaternion:v("./math/Quaternion"),Ray:v("./collision/Ray"),RaycastVehicle:v("./objects/RaycastVehicle"),RaycastResult:v("./collision/RaycastResult"),RigidVehicle:v("./objects/RigidVehicle"),RotationalEquation:v("./equations/RotationalEquation"),RotationalMotorEquation:v("./equations/RotationalMotorEquation"),SAPBroadphase:v("./collision/SAPBroadphase"),SPHSystem:v("./objects/SPHSystem"),Shape:v("./shapes/Shape"),Solver:v("./solver/Solver"),Sphere:v("./shapes/Sphere"),SplitSolver:v("./solver/SplitSolver"),Spring:v("./objects/Spring"),Trimesh:v("./shapes/Trimesh"),Vec3:v("./math/Vec3"),Vec3Pool:v("./utils/Vec3Pool"),World:v("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(v,A){function n(v){v=v||{},this.lowerBound=new E,v.lowerBound&&this.lowerBound.copy(v.lowerBound),this.upperBound=new E,v.upperBound&&this.upperBound.copy(v.upperBound)}var E=v("../math/Vec3");v("../utils/Utils"),A.exports=n;var R=new E;n.prototype.setFromPoints=function(v,A,E,B){var O=this.lowerBound,z=this.upperBound,M=E;O.copy(v[0]),M&&M.vmult(O,O),z.copy(O);for(var W=1;W<v.length;W++){var V=v[W];M&&(M.vmult(V,R),V=R),V.x>z.x&&(z.x=V.x),V.x<O.x&&(O.x=V.x),V.y>z.y&&(z.y=V.y),V.y<O.y&&(O.y=V.y),V.z>z.z&&(z.z=V.z),V.z<O.z&&(O.z=V.z)}return A&&(A.vadd(O,O),A.vadd(z,z)),B&&(O.x-=B,O.y-=B,O.z-=B,z.x+=B,z.y+=B,z.z+=B),this},n.prototype.copy=function(v){return this.lowerBound.copy(v.lowerBound),this.upperBound.copy(v.upperBound),this},n.prototype.clone=function(){return(new n).copy(this)},n.prototype.extend=function(v){var A=v.lowerBound.x;this.lowerBound.x>A&&(this.lowerBound.x=A);var E=v.upperBound.x;this.upperBound.x<E&&(this.upperBound.x=E),A=v.lowerBound.y,this.lowerBound.y>A&&(this.lowerBound.y=A),E=v.upperBound.y,this.upperBound.y<E&&(this.upperBound.y=E),A=v.lowerBound.z,this.lowerBound.z>A&&(this.lowerBound.z=A),E=v.upperBound.z,this.upperBound.z<E&&(this.upperBound.z=E)},n.prototype.overlaps=function(v){var A=this.lowerBound,E=this.upperBound,R=v.lowerBound,B=v.upperBound;return(R.x<=E.x&&E.x<=B.x||A.x<=B.x&&B.x<=E.x)&&(R.y<=E.y&&E.y<=B.y||A.y<=B.y&&B.y<=E.y)&&(R.z<=E.z&&E.z<=B.z||A.z<=B.z&&B.z<=E.z)},n.prototype.contains=function(v){var A=this.lowerBound,E=this.upperBound,R=v.lowerBound,B=v.upperBound;return A.x<=R.x&&E.x>=B.x&&A.y<=R.y&&E.y>=B.y&&A.z<=R.z&&E.z>=B.z},n.prototype.getCorners=function(v,A,E,R,B,O,z,M){var W=this.lowerBound,V=this.upperBound;v.copy(W),A.set(V.x,W.y,W.z),E.set(V.x,V.y,W.z),R.set(W.x,V.y,V.z),B.set(V.x,W.y,W.z),O.set(W.x,V.y,W.z),z.set(W.x,W.y,V.z),M.copy(V)};var B=[new E,new E,new E,new E,new E,new E,new E,new E];n.prototype.toLocalFrame=function(v,A){var E=B,R=E[0],O=E[1],z=E[2],M=E[3],W=E[4],V=E[5],H=E[6],Q=E[7];this.getCorners(R,O,z,M,W,V,H,Q);for(var Z=0;8!==Z;Z++){var K=E[Z];v.pointToLocal(K,K)}return A.setFromPoints(E)},n.prototype.toWorldFrame=function(v,A){var E=B,R=E[0],O=E[1],z=E[2],M=E[3],W=E[4],V=E[5],H=E[6],Q=E[7];this.getCorners(R,O,z,M,W,V,H,Q);for(var Z=0;8!==Z;Z++){var K=E[Z];v.pointToWorld(K,K)}return A.setFromPoints(E)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(v,A){function n(){this.matrix=[]}A.exports=n,n.prototype.get=function(v,A){if(v=v.index,(A=A.index)>v){var E=A;A=v,v=E}return this.matrix[(v*(v+1)>>1)+A-1]},n.prototype.set=function(v,A,E){if(v=v.index,(A=A.index)>v){var R=A;A=v,v=R}this.matrix[(v*(v+1)>>1)+A-1]=E?1:0},n.prototype.reset=function(){for(var v=0,A=this.matrix.length;v!==A;v++)this.matrix[v]=0},n.prototype.setNumObjects=function(v){this.matrix.length=v*(v-1)>>1}},{}],5:[function(v,A){function n(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var E=v("../objects/Body"),R=v("../math/Vec3"),B=v("../math/Quaternion");v("../shapes/Shape"),v("../shapes/Plane"),A.exports=n,n.prototype.collisionPairs=function(){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var O=E.STATIC|E.KINEMATIC;n.prototype.needBroadphaseCollision=function(v,A){return 0!=(v.collisionFilterGroup&A.collisionFilterMask)&&0!=(A.collisionFilterGroup&v.collisionFilterMask)&&(0==(v.type&O)&&v.sleepState!==E.SLEEPING||0==(A.type&O)&&A.sleepState!==E.SLEEPING)},n.prototype.intersectionTest=function(v,A,E,R){this.useBoundingBoxes?this.doBoundingBoxBroadphase(v,A,E,R):this.doBoundingSphereBroadphase(v,A,E,R)};var z=new R;new R,new B,new R,n.prototype.doBoundingSphereBroadphase=function(v,A,E,R){var B=z;A.position.vsub(v.position,B),Math.pow(v.boundingRadius+A.boundingRadius,2)>B.norm2()&&(E.push(v),R.push(A))},n.prototype.doBoundingBoxBroadphase=function(v,A,E,R){v.aabbNeedsUpdate&&v.computeAABB(),A.aabbNeedsUpdate&&A.computeAABB(),v.aabb.overlaps(A.aabb)&&(E.push(v),R.push(A))};var M={keys:[]},W=[],V=[];n.prototype.makePairsUnique=function(v,A){for(var E=M,R=W,B=V,O=v.length,z=0;z!==O;z++)R[z]=v[z],B[z]=A[z];for(v.length=0,A.length=0,z=0;z!==O;z++){var H=R[z].id,Q=B[z].id;E[Z=Q>H?H+","+Q:Q+","+H]=z,E.keys.push(Z)}for(z=0;z!==E.keys.length;z++){var Z=E.keys.pop(),K=E[Z];v.push(R[K]),A.push(B[K]),delete E[Z]}},n.prototype.setWorld=function(){};var H=new R;n.boundingSphereCheck=function(v,A){var E=H;return v.position.vsub(A.position,E),Math.pow(v.shape.boundingSphereRadius+A.shape.boundingSphereRadius,2)>E.norm2()},n.prototype.aabbQuery=function(){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(v,A){function n(v,A,B,O,z){E.apply(this),this.nx=B||10,this.ny=O||10,this.nz=z||10,this.aabbMin=v||new R(100,100,100),this.aabbMax=A||new R(-100,-100,-100);var M=this.nx*this.ny*this.nz;if(0>=M)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=M,this.binLengths.length=M;for(var W=0;M>W;W++)this.bins[W]=[],this.binLengths[W]=0}A.exports=n;var E=v("./Broadphase"),R=v("../math/Vec3"),B=v("../shapes/Shape");n.prototype=new E,n.prototype.constructor=n;var O=new R;new R,n.prototype.collisionPairs=function(v,A,E){function o(v,A,E,R,B,O,z){var M=(v-it)*st|0,W=(A-ot)*at|0,$=(E-rt)*lt|0,et=xt((R-it)*st),nt=xt((B-ot)*at),ut=xt((O-rt)*lt);0>M?M=0:M>=V&&(M=V-1),0>W?W=0:W>=H&&(W=H-1),0>$?$=0:$>=Q&&($=Q-1),0>et?et=0:et>=V&&(et=V-1),0>nt?nt=0:nt>=H&&(nt=H-1),0>ut?ut=0:ut>=Q&&(ut=Q-1),W*=K,$*=J,et*=Z,nt*=K,ut*=J;for(var ht=M*=Z;et>=ht;ht+=Z)for(var ct=W;nt>=ct;ct+=K)for(var pt=$;ut>=pt;pt+=J){var dt=ht+ct+pt;gt[dt][vt[dt]++]=z}}for(var R=v.numObjects(),z=v.bodies,M=this.aabbMax,W=this.aabbMin,V=this.nx,H=this.ny,Q=this.nz,Z=H*Q,K=Q,J=1,$=M.x,et=M.y,nt=M.z,it=W.x,ot=W.y,rt=W.z,st=V/($-it),at=H/(et-ot),lt=Q/(nt-rt),ut=($-it)/V,ht=(et-ot)/H,ct=(nt-rt)/Q,pt=.5*Math.sqrt(ut*ut+ht*ht+ct*ct),dt=B.types,ft=dt.SPHERE,yt=dt.PLANE,gt=(dt.BOX,dt.COMPOUND,dt.CONVEXPOLYHEDRON,this.bins),vt=this.binLengths,bt=this.bins.length,wt=0;wt!==bt;wt++)vt[wt]=0;var xt=Math.ceil;for(W=Math.min,M=Math.max,wt=0;wt!==R;wt++){var Tt=(Ht=z[wt]).shape;switch(Tt.type){case ft:var At=Ht.position.x,St=Ht.position.y,Ct=Ht.position.z,_t=Tt.radius;o(At-_t,St-_t,Ct-_t,At+_t,St+_t,Ct+_t,Ht);break;case yt:Tt.worldNormalNeedsUpdate&&Tt.computeWorldNormal(Ht.quaternion);var It=Tt.worldNormal,Rt=it+.5*ut-Ht.position.x,Pt=ot+.5*ht-Ht.position.y,Bt=rt+.5*ct-Ht.position.z,Ot=O;Ot.set(Rt,Pt,Bt);for(var zt=0,Nt=0;zt!==V;zt++,Nt+=Z,Ot.y=Pt,Ot.x+=ut)for(var Lt=0,Ft=0;Lt!==H;Lt++,Ft+=K,Ot.z=Bt,Ot.y+=ht)for(var kt=0,Wt=0;kt!==Q;kt++,Wt+=J,Ot.z+=ct)if(Ot.dot(It)<pt){var qt=Nt+Ft+Wt;gt[qt][vt[qt]++]=Ht}break;default:Ht.aabbNeedsUpdate&&Ht.computeAABB(),o(Ht.aabb.lowerBound.x,Ht.aabb.lowerBound.y,Ht.aabb.lowerBound.z,Ht.aabb.upperBound.x,Ht.aabb.upperBound.y,Ht.aabb.upperBound.z,Ht)}}for(wt=0;wt!==bt;wt++){var Vt=vt[wt];if(Vt>1){var Ut=gt[wt];for(zt=0;zt!==Vt;zt++){var Ht=Ut[zt];for(Lt=0;Lt!==zt;Lt++){var Gt=Ut[Lt];this.needBroadphaseCollision(Ht,Gt)&&this.intersectionTest(Ht,Gt,A,E)}}}}this.makePairsUnique(A,E)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(v,A){function n(){E.apply(this)}A.exports=n;var E=v("./Broadphase"),R=v("./AABB");n.prototype=new E,n.prototype.constructor=n,n.prototype.collisionPairs=function(v,A,E){var R,B,O,z,M=v.bodies,W=M.length;for(R=0;R!==W;R++)for(B=0;B!==R;B++)O=M[R],z=M[B],this.needBroadphaseCollision(O,z)&&this.intersectionTest(O,z,A,E)},new R,n.prototype.aabbQuery=function(v,A,E){E=E||[];for(var R=0;R<v.bodies.length;R++){var B=v.bodies[R];B.aabbNeedsUpdate&&B.computeAABB(),B.aabb.overlaps(A)&&E.push(B)}return E}},{"./AABB":3,"./Broadphase":5}],8:[function(v,A){function n(){this.matrix={}}A.exports=n,n.prototype.get=function(v,A){if(v=v.id,(A=A.id)>v){var E=A;A=v,v=E}return v+"-"+A in this.matrix},n.prototype.set=function(v,A,E){if(v=v.id,(A=A.id)>v){var R=A;A=v,v=R}E?this.matrix[v+"-"+A]=!0:delete this.matrix[v+"-"+A]},n.prototype.reset=function(){this.matrix={}},n.prototype.setNumObjects=function(){}},{}],9:[function(v,A){function n(v,A){this.from=v?v.clone():new E,this.to=A?A.clone():new E,this._direction=new E,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=n.ANY,this.result=new O,this.hasHit=!1,this.callback=function(){}}function o(v,A,E,R){R.vsub(A,gt),E.vsub(A,H),v.vsub(A,Q);var B,O,z=gt.dot(gt),M=gt.dot(H),W=gt.dot(Q),V=H.dot(H),Z=H.dot(Q);return(B=V*W-M*Z)>=0&&(O=z*Z-M*W)>=0&&z*V-M*M>B+O}A.exports=n;var E=v("../math/Vec3"),R=v("../math/Quaternion"),B=v("../math/Transform"),O=(v("../shapes/ConvexPolyhedron"),v("../shapes/Box"),v("../collision/RaycastResult")),z=v("../shapes/Shape"),M=v("../collision/AABB");n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4;var W=new M,V=[];n.prototype.intersectWorld=function(v,A){return this.mode=A.mode||n.ANY,this.result=A.result||new O,this.skipBackfaces=!!A.skipBackfaces,this.collisionFilterMask=void 0!==A.collisionFilterMask?A.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==A.collisionFilterGroup?A.collisionFilterGroup:-1,A.from&&this.from.copy(A.from),A.to&&this.to.copy(A.to),this.callback=A.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(W),V.length=0,v.broadphase.aabbQuery(v,W,V),this.intersectBodies(V),this.hasHit};var H=new E,Q=new E;n.pointInTriangle=o;var Z=new E,K=new R;n.prototype.intersectBody=function(v,A){A&&(this.result=A,this._updateDirection());var E=this.checkCollisionResponse;if((!E||v.collisionResponse)&&0!=(this.collisionFilterGroup&v.collisionFilterMask)&&0!=(v.collisionFilterGroup&this.collisionFilterMask))for(var R=Z,B=K,O=0,z=v.shapes.length;z>O;O++){var M=v.shapes[O];if((!E||M.collisionResponse)&&(v.quaternion.mult(v.shapeOrientations[O],B),v.quaternion.vmult(v.shapeOffsets[O],R),R.vadd(v.position,R),this.intersectShape(M,B,R,v),this.result._shouldStop))break}},n.prototype.intersectBodies=function(v,A){A&&(this.result=A,this._updateDirection());for(var E=0,R=v.length;!this.result._shouldStop&&R>E;E++)this.intersectBody(v[E])},n.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},n.prototype.intersectShape=function(v,A,E,R){var B=function(v,A,E){E.vsub(v,gt);var R=gt.dot(A);return A.mult(R,vt),vt.vadd(v,vt),E.distanceTo(vt)}(this.from,this._direction,E);if(!(B>v.boundingSphereRadius)){var O=this[v.type];O&&O.call(this,v,A,E,R)}};var J=(new E,new E,new E),$=new E,et=new E,nt=new E;new E,new O,n.prototype.intersectBox=function(v,A,E,R){return this.intersectConvex(v.convexPolyhedronRepresentation,A,E,R)},n.prototype[z.types.BOX]=n.prototype.intersectBox,n.prototype.intersectPlane=function(v,A,R,B){var O=this.from,z=this.to,M=this._direction,W=new E(0,0,1);A.vmult(W,W);var V=new E;O.vsub(R,V);var H=V.dot(W);if(z.vsub(R,V),!(H*V.dot(W)>0||O.distanceTo(z)<H)){var Q=W.dot(M);if(!(Math.abs(Q)<this.precision)){var Z=new E,K=new E,J=new E;O.vsub(R,Z);var $=-W.dot(Z)/Q;M.scale($,K),O.vadd(K,J),this.reportIntersection(W,J,v,B,-1)}}},n.prototype[z.types.PLANE]=n.prototype.intersectPlane,n.prototype.getAABB=function(v){var A=this.to,E=this.from;v.lowerBound.x=Math.min(A.x,E.x),v.lowerBound.y=Math.min(A.y,E.y),v.lowerBound.z=Math.min(A.z,E.z),v.upperBound.x=Math.max(A.x,E.x),v.upperBound.y=Math.max(A.y,E.y),v.upperBound.z=Math.max(A.z,E.z)};var it={faceList:[0]};n.prototype.intersectHeightfield=function(v,A,R,O){var z=(v.data,v.elementSize,new E),M=new n(this.from,this.to);B.pointToLocalFrame(R,A,M.from,M.from),B.pointToLocalFrame(R,A,M.to,M.to);var W=[],V=null,H=null,Q=null,Z=null,K=v.getIndexOfPosition(M.from.x,M.from.y,W,!1);if(K&&(V=W[0],H=W[1],Q=W[0],Z=W[1]),(K=v.getIndexOfPosition(M.to.x,M.to.y,W,!1))&&((null===V||W[0]<V)&&(V=W[0]),(null===Q||W[0]>Q)&&(Q=W[0]),(null===H||W[1]<H)&&(H=W[1]),(null===Z||W[1]>Z)&&(Z=W[1])),null!==V){v.getRectMinMax(V,H,Q,Z,[]);for(var J=V;Q>=J;J++)for(var $=H;Z>=$;$++){if(this.result._shouldStop)return;if(v.getConvexTrianglePillar(J,$,!1),B.pointToWorldFrame(R,A,v.pillarOffset,z),this.intersectConvex(v.pillarConvex,A,z,O,it),this.result._shouldStop)return;v.getConvexTrianglePillar(J,$,!0),B.pointToWorldFrame(R,A,v.pillarOffset,z),this.intersectConvex(v.pillarConvex,A,z,O,it)}}},n.prototype[z.types.HEIGHTFIELD]=n.prototype.intersectHeightfield;var ot=new E,rt=new E;n.prototype.intersectSphere=function(v,A,E,R){var B=this.from,O=this.to,z=v.radius,M=Math.pow(O.x-B.x,2)+Math.pow(O.y-B.y,2)+Math.pow(O.z-B.z,2),W=2*((O.x-B.x)*(B.x-E.x)+(O.y-B.y)*(B.y-E.y)+(O.z-B.z)*(B.z-E.z)),V=Math.pow(B.x-E.x,2)+Math.pow(B.y-E.y,2)+Math.pow(B.z-E.z,2)-Math.pow(z,2),H=Math.pow(W,2)-4*M*V,Q=ot,Z=rt;if(!(0>H))if(0===H)B.lerp(O,H,Q),Q.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,Q,v,R,-1);else{var K=(-W-Math.sqrt(H))/(2*M),J=(-W+Math.sqrt(H))/(2*M);if(K>=0&&1>=K&&(B.lerp(O,K,Q),Q.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,Q,v,R,-1)),this.result._shouldStop)return;J>=0&&1>=J&&(B.lerp(O,J,Q),Q.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,Q,v,R,-1))}},n.prototype[z.types.SPHERE]=n.prototype.intersectSphere;var st=new E,at=(new E,new E,new E);n.prototype.intersectConvex=function(v,A,E,R,B){for(var O=st,z=at,M=B&&B.faceList||null,W=v.faces,V=v.vertices,H=v.faceNormals,Q=this._direction,Z=this.from,K=this.to,it=Z.distanceTo(K),ot=M?M.length:W.length,rt=this.result,lt=0;!rt._shouldStop&&ot>lt;lt++){var ut=M?M[lt]:lt,ht=W[ut],ct=H[ut],pt=A,dt=E;z.copy(V[ht[0]]),pt.vmult(z,z),z.vadd(dt,z),z.vsub(Z,z),pt.vmult(ct,O);var ft=Q.dot(O);if(!(Math.abs(ft)<this.precision)){var yt=O.dot(z)/ft;if(!(0>yt)){Q.mult(yt,J),J.vadd(Z,J),$.copy(V[ht[0]]),pt.vmult($,$),dt.vadd($,$);for(var gt=1;!rt._shouldStop&&gt<ht.length-1;gt++){et.copy(V[ht[gt]]),nt.copy(V[ht[gt+1]]),pt.vmult(et,et),pt.vmult(nt,nt),dt.vadd(et,et),dt.vadd(nt,nt);var vt=J.distanceTo(Z);!o(J,$,et,nt)&&!o(J,et,$,nt)||vt>it||this.reportIntersection(O,J,v,R,ut)}}}}},n.prototype[z.types.CONVEXPOLYHEDRON]=n.prototype.intersectConvex;var lt=new E,ut=new E,ht=new E,ct=new E,pt=new E,dt=new E,ft=(new M,[]),yt=new B;n.prototype.intersectTrimesh=function(v,A,E,R,O){var z=lt,M=ft,W=yt,V=at,H=ut,Q=ht,Z=ct,K=dt,it=pt,ot=(O&&O.faceList,v.indices),rt=(v.vertices,v.faceNormals,this.from),st=this.to,gt=this._direction;W.position.copy(E),W.quaternion.copy(A),B.vectorToLocalFrame(E,A,gt,H),B.pointToLocalFrame(E,A,rt,Q),B.pointToLocalFrame(E,A,st,Z);var vt=Q.distanceSquared(Z);v.tree.rayQuery(this,W,M);for(var bt=0,wt=M.length;!this.result._shouldStop&&bt!==wt;bt++){var xt=M[bt];v.getNormal(xt,z),v.getVertex(ot[3*xt],$),$.vsub(Q,V);var Tt=H.dot(z),At=z.dot(V)/Tt;if(!(0>At)){H.scale(At,J),J.vadd(Q,J),v.getVertex(ot[3*xt+1],et),v.getVertex(ot[3*xt+2],nt);var St=J.distanceSquared(Q);!o(J,et,$,nt)&&!o(J,$,et,nt)||St>vt||(B.vectorToWorldFrame(A,z,it),B.pointToWorldFrame(E,A,J,K),this.reportIntersection(it,K,v,R,xt))}}M.length=0},n.prototype[z.types.TRIMESH]=n.prototype.intersectTrimesh,n.prototype.reportIntersection=function(v,A,E,R,B){var O=this.from,z=this.to,M=O.distanceTo(A),W=this.result;if(!(this.skipBackfaces&&v.dot(this._direction)>0))switch(W.hitFaceIndex=void 0!==B?B:-1,this.mode){case n.ALL:this.hasHit=!0,W.set(O,z,v,A,E,R,M),W.hasHit=!0,this.callback(W);break;case n.CLOSEST:(M<W.distance||!W.hasHit)&&(this.hasHit=!0,W.hasHit=!0,W.set(O,z,v,A,E,R,M));break;case n.ANY:this.hasHit=!0,W.hasHit=!0,W.set(O,z,v,A,E,R,M),W._shouldStop=!0}};var gt=new E,vt=new E},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(v,A){function n(){this.rayFromWorld=new E,this.rayToWorld=new E,this.hitNormalWorld=new E,this.hitPointWorld=new E,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var E=v("../math/Vec3");A.exports=n,n.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},n.prototype.abort=function(){this._shouldStop=!0},n.prototype.set=function(v,A,E,R,B,O,z){this.rayFromWorld.copy(v),this.rayToWorld.copy(A),this.hitNormalWorld.copy(E),this.hitPointWorld.copy(R),this.shape=B,this.body=O,this.distance=z}},{"../math/Vec3":30}],11:[function(v,A){function n(v){E.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var A=this.axisList;this._addBodyHandler=function(v){A.push(v.body)},this._removeBodyHandler=function(v){var E=A.indexOf(v.body);-1!==E&&A.splice(E,1)},v&&this.setWorld(v)}var E=(v("../shapes/Shape"),v("../collision/Broadphase"));A.exports=n,n.prototype=new E,n.prototype.setWorld=function(v){this.axisList.length=0;for(var A=0;A<v.bodies.length;A++)this.axisList.push(v.bodies[A]);v.removeEventListener("addBody",this._addBodyHandler),v.removeEventListener("removeBody",this._removeBodyHandler),v.addEventListener("addBody",this._addBodyHandler),v.addEventListener("removeBody",this._removeBodyHandler),this.world=v,this.dirty=!0},n.insertionSortX=function(v){for(var A=1,E=v.length;E>A;A++){for(var R=v[A],B=A-1;B>=0&&!(v[B].aabb.lowerBound.x<=R.aabb.lowerBound.x);B--)v[B+1]=v[B];v[B+1]=R}return v},n.insertionSortY=function(v){for(var A=1,E=v.length;E>A;A++){for(var R=v[A],B=A-1;B>=0&&!(v[B].aabb.lowerBound.y<=R.aabb.lowerBound.y);B--)v[B+1]=v[B];v[B+1]=R}return v},n.insertionSortZ=function(v){for(var A=1,E=v.length;E>A;A++){for(var R=v[A],B=A-1;B>=0&&!(v[B].aabb.lowerBound.z<=R.aabb.lowerBound.z);B--)v[B+1]=v[B];v[B+1]=R}return v},n.prototype.collisionPairs=function(v,A,E){var R,B,O=this.axisList,z=O.length,M=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),R=0;R!==z;R++){var W=O[R];for(B=R+1;z>B;B++){var V=O[B];if(this.needBroadphaseCollision(W,V)){if(!n.checkBounds(W,V,M))break;this.intersectionTest(W,V,A,E)}}}},n.prototype.sortList=function(){for(var v=this.axisList,A=this.axisIndex,E=v.length,R=0;R!==E;R++){var B=v[R];B.aabbNeedsUpdate&&B.computeAABB()}0===A?n.insertionSortX(v):1===A?n.insertionSortY(v):2===A&&n.insertionSortZ(v)},n.checkBounds=function(v,A,E){var R,B;return 0===E?(R=v.position.x,B=A.position.x):1===E?(R=v.position.y,B=A.position.y):2===E&&(R=v.position.z,B=A.position.z),R+v.boundingRadius>B-A.boundingRadius},n.prototype.autoDetectAxis=function(){for(var v=0,A=0,E=0,R=0,B=0,O=0,z=this.axisList,M=z.length,W=1/M,V=0;V!==M;V++){var H=z[V],Q=H.position.x;v+=Q,A+=Q*Q;var Z=H.position.y;E+=Z,R+=Z*Z;var K=H.position.z;B+=K,O+=K*K}var J=A-v*v*W,$=R-E*E*W,et=O-B*B*W;this.axisIndex=J>$?J>et?0:2:$>et?1:2},n.prototype.aabbQuery=function(v,A,E){E=E||[],this.dirty&&(this.sortList(),this.dirty=!1);var R=this.axisIndex,B="x";1===R&&(B="y"),2===R&&(B="z");for(var O=this.axisList,z=(A.lowerBound[B],A.upperBound[B],0);z<O.length;z++){var M=O[z];M.aabbNeedsUpdate&&M.computeAABB(),M.aabb.overlaps(A)&&E.push(M)}return E}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(v,A){function n(v,A,z){var M=void 0!==(z=z||{}).maxForce?z.maxForce:1e6,W=z.pivotA?z.pivotA.clone():new O,V=z.pivotB?z.pivotB.clone():new O;this.axisA=z.axisA?z.axisA.clone():new O,this.axisB=z.axisB?z.axisB.clone():new O,E.call(this,v,W,A,V,M),this.collideConnected=!!z.collideConnected,this.angle=void 0!==z.angle?z.angle:0;var H=this.coneEquation=new R(v,A,z),Q=this.twistEquation=new B(v,A,z);this.twistAngle=void 0!==z.twistAngle?z.twistAngle:0,H.maxForce=0,H.minForce=-M,Q.maxForce=0,Q.minForce=-M,this.equations.push(H,Q)}A.exports=n;var E=(v("./Constraint"),v("./PointToPointConstraint")),R=v("../equations/ConeEquation"),B=v("../equations/RotationalEquation"),O=(v("../equations/ContactEquation"),v("../math/Vec3"));n.prototype=new E,n.constructor=n,new O,new O,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,R=this.coneEquation,B=this.twistEquation;E.prototype.update.call(this),v.vectorToWorldFrame(this.axisA,R.axisA),A.vectorToWorldFrame(this.axisB,R.axisB),this.axisA.tangents(B.axisA,B.axisA),v.vectorToWorldFrame(B.axisA,B.axisA),this.axisB.tangents(B.axisB,B.axisB),A.vectorToWorldFrame(B.axisB,B.axisB),R.angle=this.angle,B.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(v,A){function n(v,A,R){R=E.defaults(R,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=v,this.bodyB=A,this.id=n.idCounter++,this.collideConnected=R.collideConnected,R.wakeUpBodies&&(v&&v.wakeUp(),A&&A.wakeUp())}A.exports=n;var E=v("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.prototype.enable=function(){for(var v=this.equations,A=0;A<v.length;A++)v[A].enabled=!0},n.prototype.disable=function(){for(var v=this.equations,A=0;A<v.length;A++)v[A].enabled=!1},n.idCounter=0},{"../utils/Utils":53}],14:[function(v,A){function n(v,A,B,O){E.call(this,v,A),void 0===B&&(B=v.position.distanceTo(A.position)),void 0===O&&(O=1e6),this.distance=B;var z=this.distanceEquation=new R(v,A);this.equations.push(z),z.minForce=-O,z.maxForce=O}A.exports=n;var E=v("./Constraint"),R=v("../equations/ContactEquation");n.prototype=new E,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,E=this.distanceEquation,R=.5*this.distance,B=E.ni;A.position.vsub(v.position,B),B.normalize(),B.mult(R,E.ri),B.mult(-R,E.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(v,A){function n(v,A,z){var M=void 0!==(z=z||{}).maxForce?z.maxForce:1e6,W=z.pivotA?z.pivotA.clone():new O,V=z.pivotB?z.pivotB.clone():new O;E.call(this,v,W,A,V,M),(this.axisA=z.axisA?z.axisA.clone():new O(1,0,0)).normalize(),(this.axisB=z.axisB?z.axisB.clone():new O(1,0,0)).normalize();var H=this.rotationalEquation1=new R(v,A,z),Q=this.rotationalEquation2=new R(v,A,z),Z=this.motorEquation=new B(v,A,M);Z.enabled=!1,this.equations.push(H,Q,Z)}A.exports=n;var E=(v("./Constraint"),v("./PointToPointConstraint")),R=v("../equations/RotationalEquation"),B=v("../equations/RotationalMotorEquation"),O=(v("../equations/ContactEquation"),v("../math/Vec3"));n.prototype=new E,n.constructor=n,n.prototype.enableMotor=function(){this.motorEquation.enabled=!0},n.prototype.disableMotor=function(){this.motorEquation.enabled=!1},n.prototype.setMotorSpeed=function(v){this.motorEquation.targetVelocity=v},n.prototype.setMotorMaxForce=function(v){this.motorEquation.maxForce=v,this.motorEquation.minForce=-v};var z=new O,M=new O;n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,R=this.motorEquation,B=this.rotationalEquation1,O=this.rotationalEquation2,W=z,V=M,H=this.axisA,Q=this.axisB;E.prototype.update.call(this),v.quaternion.vmult(H,W),A.quaternion.vmult(Q,V),W.tangents(B.axisA,O.axisA),B.axisB.copy(V),O.axisB.copy(V),this.motorEquation.enabled&&(v.quaternion.vmult(this.axisA,R.axisA),A.quaternion.vmult(this.axisB,R.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(v,A){function n(v,A,O){var z=void 0!==(O=O||{}).maxForce?O.maxForce:1e6,M=new B,W=new B,V=new B;v.position.vadd(A.position,V),V.scale(.5,V),A.pointToLocalFrame(V,W),v.pointToLocalFrame(V,M),E.call(this,v,M,A,W,z);var H=this.rotationalEquation1=new R(v,A,O),Q=this.rotationalEquation2=new R(v,A,O),Z=this.rotationalEquation3=new R(v,A,O);this.equations.push(H,Q,Z)}A.exports=n;var E=(v("./Constraint"),v("./PointToPointConstraint")),R=v("../equations/RotationalEquation"),B=(v("../equations/RotationalMotorEquation"),v("../equations/ContactEquation"),v("../math/Vec3"));n.prototype=new E,n.constructor=n,new B,new B,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,R=(this.motorEquation,this.rotationalEquation1),O=this.rotationalEquation2,z=this.rotationalEquation3;E.prototype.update.call(this),v.vectorToWorldFrame(B.UNIT_X,R.axisA),A.vectorToWorldFrame(B.UNIT_Y,R.axisB),v.vectorToWorldFrame(B.UNIT_Y,O.axisA),A.vectorToWorldFrame(B.UNIT_Z,O.axisB),v.vectorToWorldFrame(B.UNIT_Z,z.axisA),A.vectorToWorldFrame(B.UNIT_X,z.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(v,A){function n(v,A,O,z,M){E.call(this,v,O),M=void 0!==M?M:1e6,this.pivotA=A?A.clone():new B,this.pivotB=z?z.clone():new B;var W=this.equationX=new R(v,O),V=this.equationY=new R(v,O),H=this.equationZ=new R(v,O);this.equations.push(W,V,H),W.minForce=V.minForce=H.minForce=-M,W.maxForce=V.maxForce=H.maxForce=M,W.ni.set(1,0,0),V.ni.set(0,1,0),H.ni.set(0,0,1)}A.exports=n;var E=v("./Constraint"),R=v("../equations/ContactEquation"),B=v("../math/Vec3");n.prototype=new E,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,E=this.equationX,R=this.equationY,B=this.equationZ;v.quaternion.vmult(this.pivotA,E.ri),A.quaternion.vmult(this.pivotB,E.rj),R.ri.copy(E.ri),R.rj.copy(E.rj),B.ri.copy(E.ri),B.rj.copy(E.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(v,A){function n(v,A,B){var O=void 0!==(B=B||{}).maxForce?B.maxForce:1e6;R.call(this,v,A,-O,O),this.axisA=B.axisA?B.axisA.clone():new E(1,0,0),this.axisB=B.axisB?B.axisB.clone():new E(0,1,0),this.angle=void 0!==B.angle?B.angle:0}A.exports=n;var E=v("../math/Vec3"),R=(v("../math/Mat3"),v("./Equation"));n.prototype=new R,n.prototype.constructor=n;var B=new E,O=new E;n.prototype.computeB=function(v){var A=this.a,E=this.b,R=this.axisA,z=this.axisB,M=B,W=O,V=this.jacobianElementA,H=this.jacobianElementB;return R.cross(z,M),z.cross(R,W),V.rotational.copy(W),H.rotational.copy(M),-(Math.cos(this.angle)-R.dot(z))*A-this.computeGW()*E-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(v,A){function n(v,A,B){B=void 0!==B?B:1e6,E.call(this,v,A,0,B),this.restitution=0,this.ri=new R,this.rj=new R,this.ni=new R}A.exports=n;var E=v("./Equation"),R=v("../math/Vec3");v("../math/Mat3"),n.prototype=new E,n.prototype.constructor=n;var B=new R,O=new R,z=new R;n.prototype.computeB=function(v){var A=this.a,E=this.b,R=this.bi,M=this.bj,W=this.ri,V=this.rj,H=B,Q=O,Z=R.velocity,K=R.angularVelocity,J=(R.force,R.torque,M.velocity),$=M.angularVelocity,et=(M.force,M.torque,z),nt=this.jacobianElementA,it=this.jacobianElementB,ot=this.ni;W.cross(ot,H),V.cross(ot,Q),ot.negate(nt.spatial),H.negate(nt.rotational),it.spatial.copy(ot),it.rotational.copy(Q),et.copy(M.position),et.vadd(V,et),et.vsub(R.position,et),et.vsub(W,et);var rt=ot.dot(et),st=this.restitution+1;return-rt*A-(st*J.dot(ot)-st*Z.dot(ot)+$.dot(Q)-K.dot(H))*E-v*this.computeGiMf()};var M=new R,W=new R,V=new R,H=new R,Q=new R;n.prototype.getImpactVelocityAlongNormal=function(){var v=M,A=W,E=V,R=H,B=Q;return this.bi.position.vadd(this.ri,E),this.bj.position.vadd(this.rj,R),this.bi.getVelocityAtWorldPoint(E,v),this.bj.getVelocityAtWorldPoint(R,A),v.vsub(A,B),this.ni.dot(B)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(v,A){function n(v,A,R,B){this.id=n.id++,this.minForce=void 0===R?-1e6:R,this.maxForce=void 0===B?1e6:B,this.bi=v,this.bj=A,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new E,this.jacobianElementB=new E,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}A.exports=n;var E=v("../math/JacobianElement"),R=v("../math/Vec3");n.prototype.constructor=n,n.id=0,n.prototype.setSpookParams=function(v,A,E){var R=A,B=v,O=E;this.a=4/(O*(1+4*R)),this.b=4*R/(1+4*R),this.eps=4/(O*O*B*(1+4*R))},n.prototype.computeB=function(v,A,E){var R=this.computeGW();return-this.computeGq()*v-R*A-this.computeGiMf()*E},n.prototype.computeGq=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,B=E.position,O=R.position;return v.spatial.dot(B)+A.spatial.dot(O)};var B=new R;n.prototype.computeGW=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,O=E.velocity,z=R.velocity,M=E.angularVelocity||B,W=R.angularVelocity||B;return v.multiplyVectors(O,M)+A.multiplyVectors(z,W)},n.prototype.computeGWlambda=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,O=E.vlambda,z=R.vlambda,M=E.wlambda||B,W=R.wlambda||B;return v.multiplyVectors(O,M)+A.multiplyVectors(z,W)};var O=new R,z=new R,M=new R,W=new R;n.prototype.computeGiMf=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,B=E.force,V=E.torque,H=R.force,Q=R.torque,Z=E.invMassSolve,K=R.invMassSolve;return E.invInertiaWorldSolve?E.invInertiaWorldSolve.vmult(V,M):M.set(0,0,0),R.invInertiaWorldSolve?R.invInertiaWorldSolve.vmult(Q,W):W.set(0,0,0),B.mult(Z,O),H.mult(K,z),v.multiplyVectors(O,M)+A.multiplyVectors(z,W)};var V=new R;n.prototype.computeGiMGt=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,B=E.invMassSolve,O=R.invMassSolve,z=E.invInertiaWorldSolve,M=R.invInertiaWorldSolve,W=B+O;return z&&(z.vmult(v.rotational,V),W+=V.dot(v.rotational)),M&&(M.vmult(A.rotational,V),W+=V.dot(A.rotational)),W};var H=new R;new R,new R,new R,new R,new R,n.prototype.addToWlambda=function(v){var A=this.jacobianElementA,E=this.jacobianElementB,R=this.bi,B=this.bj,O=H;A.spatial.mult(R.invMassSolve*v,O),R.vlambda.vadd(O,R.vlambda),E.spatial.mult(B.invMassSolve*v,O),B.vlambda.vadd(O,B.vlambda),R.invInertiaWorldSolve&&(R.invInertiaWorldSolve.vmult(A.rotational,O),O.mult(v,O),R.wlambda.vadd(O,R.wlambda)),B.invInertiaWorldSolve&&(B.invInertiaWorldSolve.vmult(E.rotational,O),O.mult(v,O),B.wlambda.vadd(O,B.wlambda))},n.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(v,A){function n(v,A,B){E.call(this,v,A,-B,B),this.ri=new R,this.rj=new R,this.t=new R}A.exports=n;var E=v("./Equation"),R=v("../math/Vec3");v("../math/Mat3"),n.prototype=new E,n.prototype.constructor=n;var B=new R,O=new R;n.prototype.computeB=function(v){var A=(this.a,this.b),E=(this.bi,this.bj,this.ri),R=this.rj,z=B,M=O,W=this.t;E.cross(W,z),R.cross(W,M);var V=this.jacobianElementA,H=this.jacobianElementB;return W.negate(V.spatial),z.negate(V.rotational),H.spatial.copy(W),H.rotational.copy(M),-this.computeGW()*A-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(v,A){function n(v,A,B){var O=void 0!==(B=B||{}).maxForce?B.maxForce:1e6;R.call(this,v,A,-O,O),this.axisA=B.axisA?B.axisA.clone():new E(1,0,0),this.axisB=B.axisB?B.axisB.clone():new E(0,1,0),this.maxAngle=Math.PI/2}A.exports=n;var E=v("../math/Vec3"),R=(v("../math/Mat3"),v("./Equation"));n.prototype=new R,n.prototype.constructor=n;var B=new E,O=new E;n.prototype.computeB=function(v){var A=this.a,E=this.b,R=this.axisA,z=this.axisB,M=B,W=O,V=this.jacobianElementA,H=this.jacobianElementB;return R.cross(z,M),z.cross(R,W),V.rotational.copy(W),H.rotational.copy(M),-(Math.cos(this.maxAngle)-R.dot(z))*A-this.computeGW()*E-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(v,A){function n(v,A,B){B=void 0!==B?B:1e6,R.call(this,v,A,-B,B),this.axisA=new E,this.axisB=new E,this.targetVelocity=0}A.exports=n;var E=v("../math/Vec3"),R=(v("../math/Mat3"),v("./Equation"));n.prototype=new R,n.prototype.constructor=n,n.prototype.computeB=function(v){var A=(this.a,this.b),E=(this.bi,this.bj,this.axisA),R=this.axisB,B=this.jacobianElementA,O=this.jacobianElementB;return B.rotational.copy(E),R.negate(O.rotational),-(this.computeGW()-this.targetVelocity)*A-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(v,A){function n(v,A,R){R=E.defaults(R,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=n.idCounter++,this.materials=[v,A],this.friction=R.friction,this.restitution=R.restitution,this.contactEquationStiffness=R.contactEquationStiffness,this.contactEquationRelaxation=R.contactEquationRelaxation,this.frictionEquationStiffness=R.frictionEquationStiffness,this.frictionEquationRelaxation=R.frictionEquationRelaxation}var E=v("../utils/Utils");A.exports=n,n.idCounter=0},{"../utils/Utils":53}],25:[function(v,A){function n(v){var A="";"string"==typeof(v=v||{})?(A=v,v={}):"object"==typeof v&&(A=""),this.name=A,this.id=n.idCounter++,this.friction=void 0!==v.friction?v.friction:-1,this.restitution=void 0!==v.restitution?v.restitution:-1}A.exports=n,n.idCounter=0},{}],26:[function(v,A){function n(){this.spatial=new E,this.rotational=new E}A.exports=n;var E=v("./Vec3");n.prototype.multiplyElement=function(v){return v.spatial.dot(this.spatial)+v.rotational.dot(this.rotational)},n.prototype.multiplyVectors=function(v,A){return v.dot(this.spatial)+A.dot(this.rotational)}},{"./Vec3":30}],27:[function(v,A){function n(v){this.elements=v||[0,0,0,0,0,0,0,0,0]}A.exports=n;var E=v("./Vec3");n.prototype.identity=function(){var v=this.elements;v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=1,v[5]=0,v[6]=0,v[7]=0,v[8]=1},n.prototype.setZero=function(){var v=this.elements;v[0]=0,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=0,v[6]=0,v[7]=0,v[8]=0},n.prototype.setTrace=function(v){var A=this.elements;A[0]=v.x,A[4]=v.y,A[8]=v.z},n.prototype.getTrace=function(v){v=v||new E;var A=this.elements;v.x=A[0],v.y=A[4],v.z=A[8]},n.prototype.vmult=function(v,A){A=A||new E;var R=this.elements,B=v.x,O=v.y,z=v.z;return A.x=R[0]*B+R[1]*O+R[2]*z,A.y=R[3]*B+R[4]*O+R[5]*z,A.z=R[6]*B+R[7]*O+R[8]*z,A},n.prototype.smult=function(v){for(var A=0;A<this.elements.length;A++)this.elements[A]*=v},n.prototype.mmult=function(v,A){for(var E=A||new n,R=0;3>R;R++)for(var B=0;3>B;B++){for(var O=0,z=0;3>z;z++)O+=v.elements[R+3*z]*this.elements[z+3*B];E.elements[R+3*B]=O}return E},n.prototype.scale=function(v,A){A=A||new n;for(var E=this.elements,R=A.elements,B=0;3!==B;B++)R[3*B+0]=v.x*E[3*B+0],R[3*B+1]=v.y*E[3*B+1],R[3*B+2]=v.z*E[3*B+2];return A},n.prototype.solve=function(v,A){A=A||new E;for(var R=[],B=0;12>B;B++)R.push(0);var O;for(B=0;3>B;B++)for(O=0;3>O;O++)R[B+4*O]=this.elements[B+3*O];R[3]=v.x,R[7]=v.y,R[11]=v.z;var z,M,W=3,V=W;do{if(0===R[(B=V-W)+4*B])for(O=B+1;V>O;O++)if(0!==R[B+4*O]){z=4;do{R[(M=4-z)+4*B]+=R[M+4*O]}while(--z);break}if(0!==R[B+4*B])for(O=B+1;V>O;O++){var H=R[B+4*O]/R[B+4*B];z=4;do{R[(M=4-z)+4*O]=B>=M?0:R[M+4*O]-R[M+4*B]*H}while(--z)}}while(--W);if(A.z=R[11]/R[10],A.y=(R[7]-R[6]*A.z)/R[5],A.x=(R[3]-R[2]*A.z-R[1]*A.y)/R[0],isNaN(A.x)||isNaN(A.y)||isNaN(A.z)||1/0===A.x||1/0===A.y||1/0===A.z)throw"Could not solve equation! Got x=["+A.toString()+"], b=["+v.toString()+"], A=["+this.toString()+"]";return A},n.prototype.e=function(v,A,E){return void 0===E?this.elements[A+3*v]:void(this.elements[A+3*v]=E)},n.prototype.copy=function(v){for(var A=0;A<v.elements.length;A++)this.elements[A]=v.elements[A];return this},n.prototype.toString=function(){for(var v="",A=0;9>A;A++)v+=this.elements[A]+",";return v},n.prototype.reverse=function(v){v=v||new n;for(var A=[],E=0;18>E;E++)A.push(0);var R;for(E=0;3>E;E++)for(R=0;3>R;R++)A[E+6*R]=this.elements[E+3*R];A[3]=1,A[9]=0,A[15]=0,A[4]=0,A[10]=1,A[16]=0,A[5]=0,A[11]=0,A[17]=1;var B,O,z=3,M=z;do{if(0===A[(E=M-z)+6*E])for(R=E+1;M>R;R++)if(0!==A[E+6*R]){B=6;do{A[(O=6-B)+6*E]+=A[O+6*R]}while(--B);break}if(0!==A[E+6*E])for(R=E+1;M>R;R++){var W=A[E+6*R]/A[E+6*E];B=6;do{A[(O=6-B)+6*R]=E>=O?0:A[O+6*R]-A[O+6*E]*W}while(--B)}}while(--z);E=2;do{R=E-1;do{W=A[E+6*R]/A[E+6*E],B=6;do{A[(O=6-B)+6*R]=A[O+6*R]-A[O+6*E]*W}while(--B)}while(R--)}while(--E);E=2;do{W=1/A[E+6*E],B=6;do{A[(O=6-B)+6*E]=A[O+6*E]*W}while(--B)}while(E--);E=2;do{R=2;do{if(O=A[3+R+6*E],isNaN(O)||1/0===O)throw"Could not reverse! A=["+this.toString()+"]";v.e(E,R,O)}while(R--)}while(E--);return v},n.prototype.setRotationFromQuaternion=function(v){var A=v.x,E=v.y,R=v.z,B=v.w,O=A+A,z=E+E,M=R+R,W=A*O,V=A*z,H=A*M,Q=E*z,Z=E*M,K=R*M,J=B*O,$=B*z,et=B*M,nt=this.elements;return nt[0]=1-(Q+K),nt[1]=V-et,nt[2]=H+$,nt[3]=V+et,nt[4]=1-(W+K),nt[5]=Z-J,nt[6]=H-$,nt[7]=Z+J,nt[8]=1-(W+Q),this},n.prototype.transpose=function(v){for(var A=(v=v||new n).elements,E=this.elements,R=0;3!==R;R++)for(var B=0;3!==B;B++)A[3*R+B]=E[3*B+R];return v}},{"./Vec3":30}],28:[function(v,A){function n(v,A,E,R){this.x=void 0!==v?v:0,this.y=void 0!==A?A:0,this.z=void 0!==E?E:0,this.w=void 0!==R?R:1}A.exports=n;var E=v("./Vec3");n.prototype.set=function(v,A,E,R){this.x=v,this.y=A,this.z=E,this.w=R},n.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},n.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.setFromAxisAngle=function(v,A){var E=Math.sin(.5*A);this.x=v.x*E,this.y=v.y*E,this.z=v.z*E,this.w=Math.cos(.5*A)},n.prototype.toAxisAngle=function(v){v=v||new E,this.normalize();var A=2*Math.acos(this.w),R=Math.sqrt(1-this.w*this.w);return.001>R?(v.x=this.x,v.y=this.y,v.z=this.z):(v.x=this.x/R,v.y=this.y/R,v.z=this.z/R),[v,A]};var R=new E,B=new E;n.prototype.setFromVectors=function(v,A){if(v.isAntiparallelTo(A)){var E=R,O=B;v.tangents(E,O),this.setFromAxisAngle(E,Math.PI)}else{var z=v.cross(A);this.x=z.x,this.y=z.y,this.z=z.z,this.w=Math.sqrt(Math.pow(v.norm(),2)*Math.pow(A.norm(),2))+v.dot(A),this.normalize()}};var O=new E,z=new E,M=new E;n.prototype.mult=function(v,A){A=A||new n;var E=this.w,R=O,B=z,W=M;return R.set(this.x,this.y,this.z),B.set(v.x,v.y,v.z),A.w=E*v.w-R.dot(B),R.cross(B,W),A.x=E*B.x+v.w*R.x+W.x,A.y=E*B.y+v.w*R.y+W.y,A.z=E*B.z+v.w*R.z+W.z,A},n.prototype.inverse=function(v){var A=this.x,E=this.y,R=this.z,B=this.w;v=v||new n,this.conjugate(v);var O=1/(A*A+E*E+R*R+B*B);return v.x*=O,v.y*=O,v.z*=O,v.w*=O,v},n.prototype.conjugate=function(v){return(v=v||new n).x=-this.x,v.y=-this.y,v.z=-this.z,v.w=this.w,v},n.prototype.normalize=function(){var v=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===v?(this.x=0,this.y=0,this.z=0,this.w=0):(v=1/v,this.x*=v,this.y*=v,this.z*=v,this.w*=v)},n.prototype.normalizeFast=function(){var v=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===v?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=v,this.y*=v,this.z*=v,this.w*=v)},n.prototype.vmult=function(v,A){A=A||new E;var R=v.x,B=v.y,O=v.z,z=this.x,M=this.y,W=this.z,V=this.w,H=V*R+M*O-W*B,Q=V*B+W*R-z*O,Z=V*O+z*B-M*R,K=-z*R-M*B-W*O;return A.x=H*V+K*-z+Q*-W-Z*-M,A.y=Q*V+K*-M+Z*-z-H*-W,A.z=Z*V+K*-W+H*-M-Q*-z,A},n.prototype.copy=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this},n.prototype.toEuler=function(v,A){A=A||"YZX";var E,R,B,O=this.x,z=this.y,M=this.z,W=this.w;if("YZX"!==A)throw new Error("Euler order "+A+" not supported yet.");var V=O*z+M*W;if(V>.499&&(E=2*Math.atan2(O,W),R=Math.PI/2,B=0),-.499>V&&(E=-2*Math.atan2(O,W),R=-Math.PI/2,B=0),isNaN(E)){var H=O*O,Q=z*z,Z=M*M;E=Math.atan2(2*z*W-2*O*M,1-2*Q-2*Z),R=Math.asin(2*V),B=Math.atan2(2*O*W-2*z*M,1-2*H-2*Z)}v.y=E,v.z=R,v.x=B},n.prototype.setFromEuler=function(v,A,E,R){R=R||"XYZ";var B=Math.cos(v/2),O=Math.cos(A/2),z=Math.cos(E/2),M=Math.sin(v/2),W=Math.sin(A/2),V=Math.sin(E/2);return"XYZ"===R?(this.x=M*O*z+B*W*V,this.y=B*W*z-M*O*V,this.z=B*O*V+M*W*z,this.w=B*O*z-M*W*V):"YXZ"===R?(this.x=M*O*z+B*W*V,this.y=B*W*z-M*O*V,this.z=B*O*V-M*W*z,this.w=B*O*z+M*W*V):"ZXY"===R?(this.x=M*O*z-B*W*V,this.y=B*W*z+M*O*V,this.z=B*O*V+M*W*z,this.w=B*O*z-M*W*V):"ZYX"===R?(this.x=M*O*z-B*W*V,this.y=B*W*z+M*O*V,this.z=B*O*V-M*W*z,this.w=B*O*z+M*W*V):"YZX"===R?(this.x=M*O*z+B*W*V,this.y=B*W*z+M*O*V,this.z=B*O*V-M*W*z,this.w=B*O*z-M*W*V):"XZY"===R&&(this.x=M*O*z-B*W*V,this.y=B*W*z-M*O*V,this.z=B*O*V+M*W*z,this.w=B*O*z+M*W*V),this},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(v,A){function n(v){v=v||{},this.position=new E,v.position&&this.position.copy(v.position),this.quaternion=new R,v.quaternion&&this.quaternion.copy(v.quaternion)}var E=v("./Vec3"),R=v("./Quaternion");A.exports=n;var B=new R;n.pointToLocalFrame=function(v,A,R,O){return O=O||new E,R.vsub(v,O),A.conjugate(B),B.vmult(O,O),O},n.prototype.pointToLocal=function(v,A){return n.pointToLocalFrame(this.position,this.quaternion,v,A)},n.pointToWorldFrame=function(v,A,R,B){return B=B||new E,A.vmult(R,B),B.vadd(v,B),B},n.prototype.pointToWorld=function(v,A){return n.pointToWorldFrame(this.position,this.quaternion,v,A)},n.prototype.vectorToWorldFrame=function(v,A){return A=A||new E,this.quaternion.vmult(v,A),A},n.vectorToWorldFrame=function(v,A,E){return v.vmult(A,E),E},n.vectorToLocalFrame=function(v,A,R,B){return B=B||new E,A.w*=-1,A.vmult(R,B),A.w*=-1,B}},{"./Quaternion":28,"./Vec3":30}],30:[function(v,A){function n(v,A,E){this.x=v||0,this.y=A||0,this.z=E||0}A.exports=n;var E=v("./Mat3");n.ZERO=new n(0,0,0),n.UNIT_X=new n(1,0,0),n.UNIT_Y=new n(0,1,0),n.UNIT_Z=new n(0,0,1),n.prototype.cross=function(v,A){var E=v.x,R=v.y,B=v.z,O=this.x,z=this.y,M=this.z;return(A=A||new n).x=z*B-M*R,A.y=M*E-O*B,A.z=O*R-z*E,A},n.prototype.set=function(v,A,E){return this.x=v,this.y=A,this.z=E,this},n.prototype.setZero=function(){this.x=this.y=this.z=0},n.prototype.vadd=function(v,A){return A?(A.x=v.x+this.x,A.y=v.y+this.y,void(A.z=v.z+this.z)):new n(this.x+v.x,this.y+v.y,this.z+v.z)},n.prototype.vsub=function(v,A){return A?(A.x=this.x-v.x,A.y=this.y-v.y,void(A.z=this.z-v.z)):new n(this.x-v.x,this.y-v.y,this.z-v.z)},n.prototype.crossmat=function(){return new E([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},n.prototype.normalize=function(){var v=this.x,A=this.y,E=this.z,R=Math.sqrt(v*v+A*A+E*E);if(R>0){var B=1/R;this.x*=B,this.y*=B,this.z*=B}else this.x=0,this.y=0,this.z=0;return R},n.prototype.unit=function(v){v=v||new n;var A=this.x,E=this.y,R=this.z,B=Math.sqrt(A*A+E*E+R*R);return B>0?(B=1/B,v.x=A*B,v.y=E*B,v.z=R*B):(v.x=1,v.y=0,v.z=0),v},n.prototype.norm=function(){var v=this.x,A=this.y,E=this.z;return Math.sqrt(v*v+A*A+E*E)},n.prototype.length=n.prototype.norm,n.prototype.norm2=function(){return this.dot(this)},n.prototype.lengthSquared=n.prototype.norm2,n.prototype.distanceTo=function(v){var A=this.x,E=this.y,R=this.z,B=v.x,O=v.y,z=v.z;return Math.sqrt((B-A)*(B-A)+(O-E)*(O-E)+(z-R)*(z-R))},n.prototype.distanceSquared=function(v){var A=this.x,E=this.y,R=this.z,B=v.x,O=v.y,z=v.z;return(B-A)*(B-A)+(O-E)*(O-E)+(z-R)*(z-R)},n.prototype.mult=function(v,A){A=A||new n;var E=this.x,R=this.y,B=this.z;return A.x=v*E,A.y=v*R,A.z=v*B,A},n.prototype.scale=n.prototype.mult,n.prototype.dot=function(v){return this.x*v.x+this.y*v.y+this.z*v.z},n.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},n.prototype.negate=function(v){return(v=v||new n).x=-this.x,v.y=-this.y,v.z=-this.z,v};var R=new n,B=new n;n.prototype.tangents=function(v,A){var E=this.norm();if(E>0){var O=R,z=1/E;O.set(this.x*z,this.y*z,this.z*z);var M=B;Math.abs(O.x)<.9?(M.set(1,0,0),O.cross(M,v)):(M.set(0,1,0),O.cross(M,v)),O.cross(v,A)}else v.set(1,0,0),A.set(0,1,0)},n.prototype.toString=function(){return this.x+","+this.y+","+this.z},n.prototype.toArray=function(){return[this.x,this.y,this.z]},n.prototype.copy=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this},n.prototype.lerp=function(v,A,E){var R=this.x,B=this.y,O=this.z;E.x=R+(v.x-R)*A,E.y=B+(v.y-B)*A,E.z=O+(v.z-O)*A},n.prototype.almostEquals=function(v,A){return void 0===A&&(A=1e-6),!(Math.abs(this.x-v.x)>A||Math.abs(this.y-v.y)>A||Math.abs(this.z-v.z)>A)},n.prototype.almostZero=function(v){return void 0===v&&(v=1e-6),!(Math.abs(this.x)>v||Math.abs(this.y)>v||Math.abs(this.z)>v)};var O=new n;n.prototype.isAntiparallelTo=function(v,A){return this.negate(O),O.almostEquals(v,A)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(v,A){function n(v){v=v||{},E.apply(this),this.id=n.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new R,this.collisionFilterGroup="number"==typeof v.collisionFilterGroup?v.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof v.collisionFilterMask?v.collisionFilterMask:1,this.collisionResponse=!0,this.position=new R,v.position&&this.position.copy(v.position),this.previousPosition=new R,this.initPosition=new R,this.velocity=new R,v.velocity&&this.velocity.copy(v.velocity),this.initVelocity=new R,this.force=new R;var A="number"==typeof v.mass?v.mass:0;this.mass=A,this.invMass=A>0?1/A:0,this.material=v.material||null,this.linearDamping="number"==typeof v.linearDamping?v.linearDamping:.01,this.type=0>=A?n.STATIC:n.DYNAMIC,typeof v.type==typeof n.STATIC&&(this.type=v.type),this.allowSleep=void 0===v.allowSleep||v.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==v.sleepSpeedLimit?v.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==v.sleepTimeLimit?v.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new R,this.quaternion=new O,v.quaternion&&this.quaternion.copy(v.quaternion),this.initQuaternion=new O,this.angularVelocity=new R,v.angularVelocity&&this.angularVelocity.copy(v.angularVelocity),this.initAngularVelocity=new R,this.interpolatedPosition=new R,this.interpolatedQuaternion=new O,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new R,this.invInertia=new R,this.invInertiaWorld=new B,this.invMassSolve=0,this.invInertiaSolve=new R,this.invInertiaWorldSolve=new B,this.fixedRotation=void 0!==v.fixedRotation&&v.fixedRotation,this.angularDamping=void 0!==v.angularDamping?v.angularDamping:.01,this.aabb=new z,this.aabbNeedsUpdate=!0,this.wlambda=new R,v.shape&&this.addShape(v.shape),this.updateMassProperties()}A.exports=n;var E=v("../utils/EventTarget"),R=(v("../shapes/Shape"),v("../math/Vec3")),B=v("../math/Mat3"),O=v("../math/Quaternion"),z=(v("../material/Material"),v("../collision/AABB")),M=v("../shapes/Box");n.prototype=new E,n.prototype.constructor=n,n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2,n.idCounter=0,n.prototype.wakeUp=function(){var v=this.sleepState;this.sleepState=0,v===n.SLEEPING&&this.dispatchEvent({type:"wakeup"})},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.prototype.sleepTick=function(v){if(this.allowSleep){var A=this.sleepState,E=this.velocity.norm2()+this.angularVelocity.norm2(),R=Math.pow(this.sleepSpeedLimit,2);A===n.AWAKE&&R>E?(this.sleepState=n.SLEEPY,this.timeLastSleepy=v,this.dispatchEvent(n.sleepyEvent)):A===n.SLEEPY&&E>R?this.wakeUp():A===n.SLEEPY&&v-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}},n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},n.prototype.pointToLocalFrame=function(v,A){return A=A||new R,v.vsub(this.position,A),this.quaternion.conjugate().vmult(A,A),A},n.prototype.vectorToLocalFrame=function(v,A){return A=A||new R,this.quaternion.conjugate().vmult(v,A),A},n.prototype.pointToWorldFrame=function(v,A){return A=A||new R,this.quaternion.vmult(v,A),A.vadd(this.position,A),A},n.prototype.vectorToWorldFrame=function(v,A){return A=A||new R,this.quaternion.vmult(v,A),A};var W=new R,V=new O;n.prototype.addShape=function(v,A,E){var B=new R,z=new O;return A&&B.copy(A),E&&z.copy(E),this.shapes.push(v),this.shapeOffsets.push(B),this.shapeOrientations.push(z),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},n.prototype.updateBoundingRadius=function(){for(var v=this.shapes,A=this.shapeOffsets,E=v.length,R=0,B=0;B!==E;B++){var O=v[B];O.updateBoundingSphereRadius();var z=A[B].norm(),M=O.boundingSphereRadius;z+M>R&&(R=z+M)}this.boundingRadius=R};var H=new z;n.prototype.computeAABB=function(){for(var v=this.shapes,A=this.shapeOffsets,E=this.shapeOrientations,R=v.length,B=W,O=V,z=this.quaternion,M=this.aabb,Q=H,Z=0;Z!==R;Z++){var K=v[Z];E[Z].mult(z,O),O.vmult(A[Z],B),B.vadd(this.position,B),K.calculateWorldAABB(B,O,Q.lowerBound,Q.upperBound),0===Z?M.copy(Q):M.extend(Q)}this.aabbNeedsUpdate=!1};var Q=new B,Z=new B;new B,n.prototype.updateInertiaWorld=function(v){var A=this.invInertia;if(A.x!==A.y||A.y!==A.z||v){var E=Q,R=Z;E.setRotationFromQuaternion(this.quaternion),E.transpose(R),E.scale(A,E),E.mmult(R,this.invInertiaWorld)}};var K=new R,J=new R;n.prototype.applyForce=function(v,A){if(this.type===n.DYNAMIC){var E=K;A.vsub(this.position,E);var R=J;E.cross(v,R),this.force.vadd(v,this.force),this.torque.vadd(R,this.torque)}};var $=new R,et=new R;n.prototype.applyLocalForce=function(v,A){if(this.type===n.DYNAMIC){var E=$,R=et;this.vectorToWorldFrame(v,E),this.pointToWorldFrame(A,R),this.applyForce(E,R)}};var nt=new R,it=new R,ot=new R;n.prototype.applyImpulse=function(v,A){if(this.type===n.DYNAMIC){var E=nt;A.vsub(this.position,E);var R=it;R.copy(v),R.mult(this.invMass,R),this.velocity.vadd(R,this.velocity);var B=ot;E.cross(v,B),this.invInertiaWorld.vmult(B,B),this.angularVelocity.vadd(B,this.angularVelocity)}};var rt=new R,st=new R;n.prototype.applyLocalImpulse=function(v,A){if(this.type===n.DYNAMIC){var E=rt,R=st;this.vectorToWorldFrame(v,E),this.pointToWorldFrame(A,R),this.applyImpulse(E,R)}};var at=new R;n.prototype.updateMassProperties=function(){var v=at;this.invMass=this.mass>0?1/this.mass:0;var A=this.inertia,E=this.fixedRotation;this.computeAABB(),v.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),M.calculateInertia(v,this.mass,A),this.invInertia.set(A.x>0&&!E?1/A.x:0,A.y>0&&!E?1/A.y:0,A.z>0&&!E?1/A.z:0),this.updateInertiaWorld(!0)},n.prototype.getVelocityAtWorldPoint=function(v,A){var E=new R;return v.vsub(this.position,E),this.angularVelocity.cross(E,A),this.velocity.vadd(A,A),A}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(v,A){function n(v){this.chassisBody=v.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==v.indexRightAxis?v.indexRightAxis:1,this.indexForwardAxis=void 0!==v.indexForwardAxis?v.indexForwardAxis:0,this.indexUpAxis=void 0!==v.indexUpAxis?v.indexUpAxis:2}function o(v,A,E,R,B){var O=0,z=E,M=$,W=et,V=nt;return v.getVelocityAtWorldPoint(z,M),A.getVelocityAtWorldPoint(z,W),M.vsub(W,V),(O=-R.dot(V)*(1/(d(v,E,R)+d(A,E,R))))>B&&(O=B),-B>O&&(O=-B),O}function d(v,A,E){var R=it,B=ot,O=rt,z=st;return A.vsub(v.position,R),R.cross(E,B),v.invInertiaWorld.vmult(B,z),z.cross(R,O),v.invMass+E.dot(O)}function i(v,A,E,R,B,O){if(B.norm2()>1.1)return 0;var z=at,M=lt,W=ut;return v.getVelocityAtWorldPoint(A,z),E.getVelocityAtWorldPoint(R,M),z.vsub(M,W),-.2*B.dot(W)*(1/(v.invMass+E.invMass))}var E=(v("./Body"),v("../math/Vec3")),R=v("../math/Quaternion"),B=(v("../collision/RaycastResult"),v("../collision/Ray")),O=v("../objects/WheelInfo");A.exports=n;var z=(new E,new E,new E,new E),M=new E,W=new E;new B,n.prototype.addWheel=function(v){var A=new O(v=v||{}),E=this.wheelInfos.length;return this.wheelInfos.push(A),E},n.prototype.setSteeringValue=function(v,A){this.wheelInfos[A].steering=v},new E,n.prototype.applyEngineForce=function(v,A){this.wheelInfos[A].engineForce=v},n.prototype.setBrake=function(v,A){this.wheelInfos[A].brake=v},n.prototype.addToWorld=function(v){this.constraints,v.add(this.chassisBody);var A=this;this.preStepCallback=function(){A.updateVehicle(v.dt)},v.addEventListener("preStep",this.preStepCallback),this.world=v},n.prototype.getVehicleAxisWorld=function(v,A){A.set(0===v?1:0,1===v?1:0,2===v?1:0),this.chassisBody.vectorToWorldFrame(A,A)},n.prototype.updateVehicle=function(v){for(var A=this.wheelInfos,R=A.length,B=this.chassisBody,O=0;R>O;O++)this.updateWheelTransform(O);this.currentVehicleSpeedKmHour=3.6*B.velocity.norm();var z=new E;for(this.getVehicleAxisWorld(this.indexForwardAxis,z),z.dot(B.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),O=0;R>O;O++)this.castRay(A[O]);this.updateSuspension(v);var M=new E,W=new E;for(O=0;R>O;O++){var V=(K=A[O]).suspensionForce;V>K.maxSuspensionForce&&(V=K.maxSuspensionForce),K.raycastResult.hitNormalWorld.scale(V*v,M),K.raycastResult.hitPointWorld.vsub(B.position,W),B.applyImpulse(M,K.raycastResult.hitPointWorld)}this.updateFriction(v);var H=new E,Q=new E,Z=new E;for(O=0;R>O;O++){var K=A[O];B.getVelocityAtWorldPoint(K.chassisConnectionPointWorld,Z);var J=1;if(1===this.indexUpAxis&&(J=-1),K.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,Q);var $=Q.dot(K.raycastResult.hitNormalWorld);K.raycastResult.hitNormalWorld.scale($,H),Q.vsub(H,Q);var et=Q.dot(Z);K.deltaRotation=J*et*v/K.radius}!K.sliding&&K.isInContact||0===K.engineForce||!K.useCustomSlidingRotationalSpeed||(K.deltaRotation=(K.engineForce>0?1:-1)*K.customSlidingRotationalSpeed*v),Math.abs(K.brake)>Math.abs(K.engineForce)&&(K.deltaRotation=0),K.rotation+=K.deltaRotation,K.deltaRotation*=.99}},n.prototype.updateSuspension=function(){for(var v=this.chassisBody.mass,A=this.wheelInfos,E=A.length,R=0;E>R;R++){var B=A[R];if(B.isInContact){var O,z=B.suspensionRestLength-B.suspensionLength;O=B.suspensionStiffness*z*B.clippedInvContactDotSuspension;var M=B.suspensionRelativeVelocity;O-=(0>M?B.dampingCompression:B.dampingRelaxation)*M,B.suspensionForce=O*v,B.suspensionForce<0&&(B.suspensionForce=0)}else B.suspensionForce=0}},n.prototype.removeFromWorld=function(v){this.constraints,v.remove(this.chassisBody),v.removeEventListener("preStep",this.preStepCallback),this.world=null};var V=new E,H=new E;n.prototype.castRay=function(v){var A=V,R=H;this.updateWheelTransformWorld(v);var B=this.chassisBody,O=-1,z=v.suspensionRestLength+v.radius;v.directionWorld.scale(z,A);var M=v.chassisConnectionPointWorld;M.vadd(A,R);var W=v.raycastResult;W.reset();var Q=B.collisionResponse;B.collisionResponse=!1,this.world.rayTest(M,R,W),B.collisionResponse=Q;var Z=W.body;if(v.raycastResult.groundObject=0,Z){O=W.distance,v.raycastResult.hitNormalWorld=W.hitNormalWorld,v.isInContact=!0;var K=W.distance;v.suspensionLength=K-v.radius;var J=v.suspensionRestLength-v.maxSuspensionTravel,$=v.suspensionRestLength+v.maxSuspensionTravel;v.suspensionLength<J&&(v.suspensionLength=J),v.suspensionLength>$&&(v.suspensionLength=$,v.raycastResult.reset());var et=v.raycastResult.hitNormalWorld.dot(v.directionWorld),nt=new E;B.getVelocityAtWorldPoint(v.raycastResult.hitPointWorld,nt);var it=v.raycastResult.hitNormalWorld.dot(nt);if(et>=-.1)v.suspensionRelativeVelocity=0,v.clippedInvContactDotSuspension=10;else{var ot=-1/et;v.suspensionRelativeVelocity=it*ot,v.clippedInvContactDotSuspension=ot}}else v.suspensionLength=v.suspensionRestLength+0*v.maxSuspensionTravel,v.suspensionRelativeVelocity=0,v.directionWorld.scale(-1,v.raycastResult.hitNormalWorld),v.clippedInvContactDotSuspension=1;return O},n.prototype.updateWheelTransformWorld=function(v){v.isInContact=!1;var A=this.chassisBody;A.pointToWorldFrame(v.chassisConnectionPointLocal,v.chassisConnectionPointWorld),A.vectorToWorldFrame(v.directionLocal,v.directionWorld),A.vectorToWorldFrame(v.axleLocal,v.axleWorld)},n.prototype.updateWheelTransform=function(v){var A=z,E=M,B=W,O=this.wheelInfos[v];this.updateWheelTransformWorld(O),O.directionLocal.scale(-1,A),E.copy(O.axleLocal),A.cross(E,B),B.normalize(),E.normalize();var V=O.steering,H=new R;H.setFromAxisAngle(A,V);var Q=new R;Q.setFromAxisAngle(E,O.rotation);var Z=O.worldTransform.quaternion;this.chassisBody.quaternion.mult(H,Z),Z.mult(Q,Z),Z.normalize();var K=O.worldTransform.position;K.copy(O.directionWorld),K.scale(O.suspensionLength,K),K.vadd(O.chassisConnectionPointWorld,K)};var Q=[new E(1,0,0),new E(0,1,0),new E(0,0,1)];n.prototype.getWheelTransformWorld=function(v){return this.wheelInfos[v].worldTransform};var Z=new E,K=[],J=[];n.prototype.updateFriction=function(v){for(var A=Z,R=this.wheelInfos,B=R.length,O=this.chassisBody,z=J,M=K,W=0;B>W;W++)et=(ht=R[W]).raycastResult.body,ht.sideImpulse=0,ht.forwardImpulse=0,z[W]||(z[W]=new E),M[W]||(M[W]=new E);for(W=0;B>W;W++)if(et=(ht=R[W]).raycastResult.body){var V=M[W];this.getWheelTransformWorld(W).vectorToWorldFrame(Q[this.indexRightAxis],V);var H=ht.raycastResult.hitNormalWorld,$=V.dot(H);H.scale($,A),V.vsub(A,V),V.normalize(),H.cross(V,z[W]),z[W].normalize(),ht.sideImpulse=i(O,ht.raycastResult.hitPointWorld,et,ht.raycastResult.hitPointWorld,V),ht.sideImpulse*=1}for(this.sliding=!1,W=0;B>W;W++){var et=(ht=R[W]).raycastResult.body,nt=0;if(ht.slipInfo=1,et){var it=ht.brake?ht.brake:0;nt=o(O,et,ht.raycastResult.hitPointWorld,z[W],it);var ot=it/(nt+=ht.engineForce*v);ht.slipInfo*=ot}if(ht.forwardImpulse=0,ht.skidInfo=1,et){ht.skidInfo=1;var rt=ht.suspensionForce*v*ht.frictionSlip,st=rt*rt;ht.forwardImpulse=nt;var at=.5*ht.forwardImpulse,lt=1*ht.sideImpulse,ut=at*at+lt*lt;ht.sliding=!1,ut>st&&(this.sliding=!0,ht.sliding=!0,ot=rt/Math.sqrt(ut),ht.skidInfo*=ot)}}if(this.sliding)for(W=0;B>W;W++)0!==(ht=R[W]).sideImpulse&&ht.skidInfo<1&&(ht.forwardImpulse*=ht.skidInfo,ht.sideImpulse*=ht.skidInfo);for(W=0;B>W;W++){var ht=R[W],ct=new E;if(ct.copy(ht.raycastResult.hitPointWorld),0!==ht.forwardImpulse){var pt=new E;z[W].scale(ht.forwardImpulse,pt),O.applyImpulse(pt,ct)}if(0!==ht.sideImpulse){et=ht.raycastResult.body;var dt=new E;dt.copy(ht.raycastResult.hitPointWorld);var ft=new E;M[W].scale(ht.sideImpulse,ft),O.pointToLocalFrame(ct,ct),ct["xyz"[this.indexUpAxis]]*=ht.rollInfluence,O.pointToWorldFrame(ct,ct),O.applyImpulse(ft,ct),ft.scale(-1,ft),et.applyImpulse(ft,dt)}}};var $=new E,et=new E,nt=new E,it=new E,ot=new E,rt=new E,st=new E,at=new E,lt=new E,ut=new E},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(v,A){function n(v){if(this.wheelBodies=[],this.coordinateSystem=void 0===v.coordinateSystem?new O(1,2,3):v.coordinateSystem.clone(),this.chassisBody=v.chassisBody,!this.chassisBody){var A=new B(new O(5,2,.5));this.chassisBody=new E(1,A)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var E=v("./Body"),R=v("../shapes/Sphere"),B=v("../shapes/Box"),O=v("../math/Vec3"),z=v("../constraints/HingeConstraint");A.exports=n,n.prototype.addWheel=function(v){var A=(v=v||{}).body;A||(A=new E(1,new R(1.2))),this.wheelBodies.push(A),this.wheelForces.push(0);var B=(new O,void 0!==v.position?v.position.clone():new O),M=new O;this.chassisBody.pointToWorldFrame(B,M),A.position.set(M.x,M.y,M.z);var W=void 0!==v.axis?v.axis.clone():new O(0,1,0);this.wheelAxes.push(W);var V=new z(this.chassisBody,A,{pivotA:B,axisA:W,pivotB:O.ZERO,axisB:W,collideConnected:!1});return this.constraints.push(V),this.wheelBodies.length-1},n.prototype.setSteeringValue=function(v,A){var E=this.wheelAxes[A],R=Math.cos(v),B=Math.sin(v),O=E.x,z=E.y;this.constraints[A].axisA.set(R*O-B*z,B*O+R*z,0)},n.prototype.setMotorSpeed=function(v,A){var E=this.constraints[A];E.enableMotor(),E.motorTargetVelocity=v},n.prototype.disableMotor=function(v){this.constraints[v].disableMotor()};var M=new O;n.prototype.setWheelForce=function(v,A){this.wheelForces[A]=v},n.prototype.applyWheelForce=function(v,A){var E=this.wheelAxes[A],R=this.wheelBodies[A],B=R.torque;E.scale(v,M),R.vectorToWorldFrame(M,M),B.vadd(M,B)},n.prototype.addToWorld=function(v){for(var A=this.constraints,E=this.wheelBodies.concat([this.chassisBody]),R=0;R<E.length;R++)v.add(E[R]);for(R=0;R<A.length;R++)v.addConstraint(A[R]);v.addEventListener("preStep",this._update.bind(this))},n.prototype._update=function(){for(var v=this.wheelForces,A=0;A<v.length;A++)this.applyWheelForce(v[A],A)},n.prototype.removeFromWorld=function(v){for(var A=this.constraints,E=this.wheelBodies.concat([this.chassisBody]),R=0;R<E.length;R++)v.remove(E[R]);for(R=0;R<A.length;R++)v.removeConstraint(A[R])};var W=new O;n.prototype.getWheelSpeed=function(v){var A=this.wheelAxes[v],E=this.wheelBodies[v].angularVelocity;return this.chassisBody.vectorToWorldFrame(A,W),E.dot(W)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(v,A){function n(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}A.exports=n;var E=(v("../shapes/Shape"),v("../math/Vec3"));v("../math/Quaternion"),v("../shapes/Particle"),v("../objects/Body"),v("../material/Material"),n.prototype.add=function(v){this.particles.push(v),this.neighbors.length<this.particles.length&&this.neighbors.push([])},n.prototype.remove=function(v){var A=this.particles.indexOf(v);-1!==A&&(this.particles.splice(A,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var R=new E;n.prototype.getNeighbors=function(v,A){for(var E=this.particles.length,B=v.id,O=this.smoothingRadius*this.smoothingRadius,z=R,M=0;M!==E;M++){var W=this.particles[M];W.position.vsub(v.position,z),B!==W.id&&z.norm2()<O&&A.push(W)}};var B=new E,O=new E,z=new E,M=new E,W=new E,V=new E;n.prototype.update=function(){for(var v=this.particles.length,A=B,E=this.speedOfSound,R=this.eps,H=0;H!==v;H++){var Q=this.particles[H];(ut=this.neighbors[H]).length=0,this.getNeighbors(Q,ut),ut.push(this.particles[H]);for(var Z=ut.length,K=0,J=0;J!==Z;J++){Q.position.vsub(ut[J].position,A);var $=A.norm(),et=this.w($);K+=ut[J].mass*et}this.densities[H]=K,this.pressures[H]=E*E*(this.densities[H]-this.density)}var nt=O,it=z,ot=M,rt=W,st=V;for(H=0;H!==v;H++){var at,lt,ut,ht=this.particles[H];for(nt.set(0,0,0),it.set(0,0,0),Z=(ut=this.neighbors[H]).length,J=0;J!==Z;J++){var ct=ut[J];ht.position.vsub(ct.position,rt);var pt=rt.norm();at=-ct.mass*(this.pressures[H]/(this.densities[H]*this.densities[H]+R)+this.pressures[J]/(this.densities[J]*this.densities[J]+R)),this.gradw(rt,ot),ot.mult(at,ot),nt.vadd(ot,nt),ct.velocity.vsub(ht.velocity,st),st.mult(1/(1e-4+this.densities[H]*this.densities[J])*this.viscosity*ct.mass,st),lt=this.nablaw(pt),st.mult(lt,st),it.vadd(st,it)}it.mult(ht.mass,it),nt.mult(ht.mass,nt),ht.force.vadd(it,ht.force),ht.force.vadd(nt,ht.force)}},n.prototype.w=function(v){var A=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(A,9))*Math.pow(A*A-v*v,3)},n.prototype.gradw=function(v,A){var E=v.norm(),R=this.smoothingRadius;v.mult(945/(32*Math.PI*Math.pow(R,9))*Math.pow(R*R-E*E,2),A)},n.prototype.nablaw=function(v){var A=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(A,9))*(A*A-v*v)*(7*v*v-3*A*A)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(v,A){function n(v,A,R){R=R||{},this.restLength="number"==typeof R.restLength?R.restLength:1,this.stiffness=R.stiffness||100,this.damping=R.damping||1,this.bodyA=v,this.bodyB=A,this.localAnchorA=new E,this.localAnchorB=new E,R.localAnchorA&&this.localAnchorA.copy(R.localAnchorA),R.localAnchorB&&this.localAnchorB.copy(R.localAnchorB),R.worldAnchorA&&this.setWorldAnchorA(R.worldAnchorA),R.worldAnchorB&&this.setWorldAnchorB(R.worldAnchorB)}var E=v("../math/Vec3");A.exports=n,n.prototype.setWorldAnchorA=function(v){this.bodyA.pointToLocalFrame(v,this.localAnchorA)},n.prototype.setWorldAnchorB=function(v){this.bodyB.pointToLocalFrame(v,this.localAnchorB)},n.prototype.getWorldAnchorA=function(v){this.bodyA.pointToWorldFrame(this.localAnchorA,v)},n.prototype.getWorldAnchorB=function(v){this.bodyB.pointToWorldFrame(this.localAnchorB,v)};var R=new E,B=new E,O=new E,z=new E,M=new E,W=new E,V=new E,H=new E,Q=new E,Z=new E,K=new E;n.prototype.applyForce=function(){var v=this.stiffness,A=this.damping,E=this.restLength,J=this.bodyA,$=this.bodyB,et=R,nt=B,it=O,ot=z,rt=K,st=M,at=W,lt=V,ut=H,ht=Q,ct=Z;this.getWorldAnchorA(st),this.getWorldAnchorB(at),st.vsub(J.position,lt),at.vsub($.position,ut),at.vsub(st,et);var pt=et.norm();nt.copy(et),nt.normalize(),$.velocity.vsub(J.velocity,it),$.angularVelocity.cross(ut,rt),it.vadd(rt,it),J.angularVelocity.cross(lt,rt),it.vsub(rt,it),nt.mult(-v*(pt-E)-A*it.dot(nt),ot),J.force.vsub(ot,J.force),$.force.vadd(ot,$.force),lt.cross(ot,ht),ut.cross(ot,ct),J.torque.vsub(ht,J.torque),$.torque.vadd(ct,$.torque)}},{"../math/Vec3":30}],36:[function(v,A){function n(v){v=O.defaults(v,{chassisConnectionPointLocal:new E,chassisConnectionPointWorld:new E,directionLocal:new E,directionWorld:new E,axleLocal:new E,axleWorld:new E,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=v.maxSuspensionTravel,this.customSlidingRotationalSpeed=v.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=v.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=v.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=v.chassisConnectionPointWorld.clone(),this.directionLocal=v.directionLocal.clone(),this.directionWorld=v.directionWorld.clone(),this.axleLocal=v.axleLocal.clone(),this.axleWorld=v.axleWorld.clone(),this.suspensionRestLength=v.suspensionRestLength,this.suspensionMaxLength=v.suspensionMaxLength,this.radius=v.radius,this.suspensionStiffness=v.suspensionStiffness,this.dampingCompression=v.dampingCompression,this.dampingRelaxation=v.dampingRelaxation,this.frictionSlip=v.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=v.rollInfluence,this.maxSuspensionForce=v.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=v.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new B,this.worldTransform=new R,this.isInContact=!1}var E=v("../math/Vec3"),R=v("../math/Transform"),B=v("../collision/RaycastResult"),O=v("../utils/Utils");A.exports=n;var z=new E,M=new E;z=new E,n.prototype.updateWheel=function(v){var A=this.raycastResult;if(this.isInContact){var E=A.hitNormalWorld.dot(A.directionWorld);A.hitPointWorld.vsub(v.position,M),v.getVelocityAtWorldPoint(M,z);var R=A.hitNormalWorld.dot(z);if(E>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var B=-1/E;this.suspensionRelativeVelocity=R*B,this.clippedInvContactDotSuspension=B}}else A.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,A.directionWorld.scale(-1,A.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(v,A){function n(v){E.call(this),this.type=E.types.BOX,this.halfExtents=v,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3"),B=v("./ConvexPolyhedron");n.prototype=new E,n.prototype.constructor=n,n.prototype.updateConvexPolyhedronRepresentation=function(){var v=this.halfExtents.x,A=this.halfExtents.y,E=this.halfExtents.z,O=R,z=[new O(-v,-A,-E),new O(v,-A,-E),new O(v,A,-E),new O(-v,A,-E),new O(-v,-A,E),new O(v,-A,E),new O(v,A,E),new O(-v,A,E)],M=(new O(0,0,1),new O(0,1,0),new O(1,0,0),new B(z,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=M,M.material=this.material},n.prototype.calculateLocalInertia=function(v,A){return A=A||new R,n.calculateInertia(this.halfExtents,v,A),A},n.calculateInertia=function(v,A,E){var R=v;E.x=1/12*A*(2*R.y*2*R.y+2*R.z*2*R.z),E.y=1/12*A*(2*R.x*2*R.x+2*R.z*2*R.z),E.z=1/12*A*(2*R.y*2*R.y+2*R.x*2*R.x)},n.prototype.getSideNormals=function(v,A){var E=v,R=this.halfExtents;if(E[0].set(R.x,0,0),E[1].set(0,R.y,0),E[2].set(0,0,R.z),E[3].set(-R.x,0,0),E[4].set(0,-R.y,0),E[5].set(0,0,-R.z),void 0!==A)for(var B=0;B!==E.length;B++)A.vmult(E[B],E[B]);return E},n.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var O=new R;new R,n.prototype.forEachWorldCorner=function(v,A,E){for(var R=this.halfExtents,B=[[R.x,R.y,R.z],[-R.x,R.y,R.z],[-R.x,-R.y,R.z],[-R.x,-R.y,-R.z],[R.x,-R.y,-R.z],[R.x,R.y,-R.z],[-R.x,R.y,-R.z],[R.x,-R.y,R.z]],z=0;z<B.length;z++)O.set(B[z][0],B[z][1],B[z][2]),A.vmult(O,O),v.vadd(O,O),E(O.x,O.y,O.z)};var z=[new R,new R,new R,new R,new R,new R,new R,new R];n.prototype.calculateWorldAABB=function(v,A,E,R){var B=this.halfExtents;z[0].set(B.x,B.y,B.z),z[1].set(-B.x,B.y,B.z),z[2].set(-B.x,-B.y,B.z),z[3].set(-B.x,-B.y,-B.z),z[4].set(B.x,-B.y,-B.z),z[5].set(B.x,B.y,-B.z),z[6].set(-B.x,B.y,-B.z),z[7].set(B.x,-B.y,B.z);var O=z[0];A.vmult(O,O),v.vadd(O,O),R.copy(O),E.copy(O);for(var M=1;8>M;M++){O=z[M],A.vmult(O,O),v.vadd(O,O);var W=O.x,V=O.y,H=O.z;W>R.x&&(R.x=W),V>R.y&&(R.y=V),H>R.z&&(R.z=H),W<E.x&&(E.x=W),V<E.y&&(E.y=V),H<E.z&&(E.z=H)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(v,A){function n(v,A,R){E.call(this),this.type=E.types.CONVEXPOLYHEDRON,this.vertices=v||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=A||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=R?R.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3"),B=(v("../math/Quaternion"),v("../math/Transform"));n.prototype=new E,n.prototype.constructor=n;var O=new R;n.prototype.computeEdges=function(){var v=this.faces,A=this.vertices,E=(A.length,this.uniqueEdges);E.length=0;for(var R=O,B=0;B!==v.length;B++)for(var z=v[B],M=z.length,W=0;W!==M;W++){var V=(W+1)%M;A[z[W]].vsub(A[z[V]],R),R.normalize();for(var H=!1,Q=0;Q!==E.length;Q++)if(E[Q].almostEquals(R)||E[Q].almostEquals(R)){H=!0;break}H||E.push(R.clone())}},n.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var v=0;v<this.faces.length;v++){for(var A=0;A<this.faces[v].length;A++)if(!this.vertices[this.faces[v][A]])throw new Error("Vertex "+this.faces[v][A]+" not found!");var E=this.faceNormals[v]||new R;this.getFaceNormal(v,E),E.negate(E),this.faceNormals[v]=E;var B=this.vertices[this.faces[v][0]];if(E.dot(B)<0)for(console.error(".faceNormals["+v+"] = Vec3("+E.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),A=0;A<this.faces[v].length;A++)console.warn(".vertices["+this.faces[v][A]+"] = Vec3("+this.vertices[this.faces[v][A]].toString()+")")}};var z=new R,M=new R;n.computeNormal=function(v,A,E,R){A.vsub(v,M),E.vsub(A,z),z.cross(M,R),R.isZero()||R.normalize()},n.prototype.getFaceNormal=function(v,A){var E=this.faces[v],R=this.vertices[E[0]],B=this.vertices[E[1]],O=this.vertices[E[2]];return n.computeNormal(R,B,O,A)};var W=new R;n.prototype.clipAgainstHull=function(v,A,E,B,O,z,M,V,H){for(var Q=W,Z=-1,K=-Number.MAX_VALUE,J=0;J<E.faces.length;J++){Q.copy(E.faceNormals[J]),O.vmult(Q,Q);var $=Q.dot(z);$>K&&(K=$,Z=J)}for(var et=[],nt=E.faces[Z],it=nt.length,ot=0;it>ot;ot++){var rt=E.vertices[nt[ot]],st=new R;st.copy(rt),O.vmult(st,st),B.vadd(st,st),et.push(st)}Z>=0&&this.clipFaceAgainstHull(z,v,A,et,M,V,H)};var V=new R,H=new R,Q=new R,Z=new R,K=new R,J=new R;n.prototype.findSeparatingAxis=function(v,A,E,R,B,O,z,M){var W=V,$=H,et=Q,nt=Z,it=K,ot=J,rt=Number.MAX_VALUE,st=this;if(st.uniqueAxes)for(var at=0;at!==st.uniqueAxes.length;at++){if(E.vmult(st.uniqueAxes[at],W),!1===(ct=st.testSepAxis(W,v,A,E,R,B)))return!1;rt>ct&&(rt=ct,O.copy(W))}else{var lt=z?z.length:st.faces.length;for(at=0;lt>at;at++){var ut=z?z[at]:at;if(W.copy(st.faceNormals[ut]),E.vmult(W,W),!1===(ct=st.testSepAxis(W,v,A,E,R,B)))return!1;rt>ct&&(rt=ct,O.copy(W))}}if(v.uniqueAxes)for(at=0;at!==v.uniqueAxes.length;at++){if(B.vmult(v.uniqueAxes[at],$),!1===(ct=st.testSepAxis($,v,A,E,R,B)))return!1;rt>ct&&(rt=ct,O.copy($))}else{var ht=M?M.length:v.faces.length;for(at=0;ht>at;at++){var ct;if(ut=M?M[at]:at,$.copy(v.faceNormals[ut]),B.vmult($,$),!1===(ct=st.testSepAxis($,v,A,E,R,B)))return!1;rt>ct&&(rt=ct,O.copy($))}}for(var pt=0;pt!==st.uniqueEdges.length;pt++){E.vmult(st.uniqueEdges[pt],nt);for(var dt=0;dt!==v.uniqueEdges.length;dt++)if(B.vmult(v.uniqueEdges[dt],it),nt.cross(it,ot),!ot.almostZero()){ot.normalize();var ft=st.testSepAxis(ot,v,A,E,R,B);if(!1===ft)return!1;rt>ft&&(rt=ft,O.copy(ot))}}return R.vsub(A,et),et.dot(O)>0&&O.negate(O),!0};var $=[],et=[];n.prototype.testSepAxis=function(v,A,E,R,B,O){n.project(this,v,E,R,$),n.project(A,v,B,O,et);var z=$[0],M=$[1],W=et[0],V=et[1];if(V>z||M>W)return!1;var H=z-V,Q=W-M;return Q>H?H:Q};var nt=new R,it=new R;n.prototype.calculateLocalInertia=function(v,A){this.computeLocalAABB(nt,it);var E=it.x-nt.x,R=it.y-nt.y,B=it.z-nt.z;A.x=1/12*v*(2*R*2*R+2*B*2*B),A.y=1/12*v*(2*E*2*E+2*B*2*B),A.z=1/12*v*(2*R*2*R+2*E*2*E)},n.prototype.getPlaneConstantOfFace=function(v){var A=this.faces[v],E=this.faceNormals[v],R=this.vertices[A[0]];return-E.dot(R)};var ot=new R,rt=new R,st=new R,at=new R,lt=new R,ut=new R,ht=new R,ct=new R;n.prototype.clipFaceAgainstHull=function(v,A,E,R,B,O,z){for(var M=ot,W=rt,V=st,H=at,Q=lt,Z=ut,K=ht,J=ct,$=this,et=R,nt=[],it=-1,pt=Number.MAX_VALUE,dt=0;dt<$.faces.length;dt++){M.copy($.faceNormals[dt]),E.vmult(M,M);var ft=M.dot(v);pt>ft&&(pt=ft,it=dt)}if(!(0>it)){var yt=$.faces[it];yt.connectedFaces=[];for(var gt=0;gt<$.faces.length;gt++)for(var vt=0;vt<$.faces[gt].length;vt++)-1!==yt.indexOf($.faces[gt][vt])&&gt!==it&&-1===yt.connectedFaces.indexOf(gt)&&yt.connectedFaces.push(gt);for(var bt=(et.length,yt.length),wt=0;bt>wt;wt++){var xt=$.vertices[yt[wt]],Tt=$.vertices[yt[(wt+1)%bt]];xt.vsub(Tt,W),V.copy(W),E.vmult(V,V),A.vadd(V,V),H.copy(this.faceNormals[it]),E.vmult(H,H),A.vadd(H,H),V.cross(H,Q),Q.negate(Q),Z.copy(xt),E.vmult(Z,Z),A.vadd(Z,Z);var At=(Z.dot(Q),yt.connectedFaces[wt]);K.copy(this.faceNormals[At]);var St=this.getPlaneConstantOfFace(At);J.copy(K),E.vmult(J,J);var Ct=St-J.dot(A);for(this.clipFaceAgainstPlane(et,nt,J,Ct);et.length;)et.shift();for(;nt.length;)et.push(nt.shift())}for(K.copy(this.faceNormals[it]),St=this.getPlaneConstantOfFace(it),J.copy(K),E.vmult(J,J),Ct=St-J.dot(A),gt=0;gt<et.length;gt++){var _t=J.dot(et[gt])+Ct;if(B>=_t&&(console.log("clamped: depth="+_t+" to minDist="+B),_t=B),O>=_t){var It=et[gt];if(0>=_t){var Rt={point:It,normal:J,depth:_t};z.push(Rt)}}}}},n.prototype.clipFaceAgainstPlane=function(v,A,E,B){var O,z,M=v.length;if(2>M)return A;var W=v[v.length-1],V=v[0];O=E.dot(W)+B;for(var H=0;M>H;H++){if(V=v[H],z=E.dot(V)+B,0>O)if(0>z)(Q=new R).copy(V),A.push(Q);else{var Q=new R;W.lerp(V,O/(O-z),Q),A.push(Q)}else 0>z&&(Q=new R,W.lerp(V,O/(O-z),Q),A.push(Q),A.push(V));W=V,O=z}return A},n.prototype.computeWorldVertices=function(v,A){for(var E=this.vertices.length;this.worldVertices.length<E;)this.worldVertices.push(new R);for(var B=this.vertices,O=this.worldVertices,z=0;z!==E;z++)A.vmult(B[z],O[z]),v.vadd(O[z],O[z]);this.worldVerticesNeedsUpdate=!1},new R,n.prototype.computeLocalAABB=function(v,A){var E=this.vertices.length,R=this.vertices;v.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var B=0;E>B;B++){var O=R[B];O.x<v.x?v.x=O.x:O.x>A.x&&(A.x=O.x),O.y<v.y?v.y=O.y:O.y>A.y&&(A.y=O.y),O.z<v.z?v.z=O.z:O.z>A.z&&(A.z=O.z)}},n.prototype.computeWorldFaceNormals=function(v){for(var A=this.faceNormals.length;this.worldFaceNormals.length<A;)this.worldFaceNormals.push(new R);for(var E=this.faceNormals,B=this.worldFaceNormals,O=0;O!==A;O++)v.vmult(E[O],B[O]);this.worldFaceNormalsNeedsUpdate=!1},n.prototype.updateBoundingSphereRadius=function(){for(var v=0,A=this.vertices,E=0,R=A.length;E!==R;E++){var B=A[E].norm2();B>v&&(v=B)}this.boundingSphereRadius=Math.sqrt(v)};var pt=new R;n.prototype.calculateWorldAABB=function(v,A,E,R){for(var B,O,z,M,W,V,H=this.vertices.length,Q=this.vertices,Z=0;H>Z;Z++){pt.copy(Q[Z]),A.vmult(pt,pt),v.vadd(pt,pt);var K=pt;K.x<B||void 0===B?B=K.x:(K.x>M||void 0===M)&&(M=K.x),K.y<O||void 0===O?O=K.y:(K.y>W||void 0===W)&&(W=K.y),K.z<z||void 0===z?z=K.z:(K.z>V||void 0===V)&&(V=K.z)}E.set(B,O,z),R.set(M,W,V)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.prototype.getAveragePointLocal=function(v){v=v||new R;for(var A=this.vertices.length,E=this.vertices,B=0;A>B;B++)v.vadd(E[B],v);return v.mult(1/A,v),v},n.prototype.transformAllPoints=function(v,A){var E=this.vertices.length,R=this.vertices;if(A){for(var B=0;E>B;B++){var O=R[B];A.vmult(O,O)}for(B=0;B<this.faceNormals.length;B++)O=this.faceNormals[B],A.vmult(O,O)}if(v)for(B=0;E>B;B++)(O=R[B]).vadd(v,O)};var dt=new R,ft=new R,yt=new R;n.prototype.pointIsInside=function(v){var A=this.vertices.length,E=this.vertices,R=this.faces,B=this.faceNormals,O=this.faces.length,z=dt;this.getAveragePointLocal(z);for(var M=0;O>M;M++){this.faces[M].length,A=B[M];var W=E[R[M][0]],V=ft;v.vsub(W,V);var H=A.dot(V),Q=yt;z.vsub(W,Q);var Z=A.dot(Q);if(0>H&&Z>0||H>0&&0>Z)return!1}return-1};var gt=(new R,new R),vt=new R;n.project=function(v,A,E,R,O){var z=v.vertices.length,M=gt,W=0,V=0,H=vt,Q=v.vertices;H.setZero(),B.vectorToLocalFrame(E,R,A,M),B.pointToLocalFrame(E,R,H,H);var Z=H.dot(M);V=W=Q[0].dot(M);for(var K=1;z>K;K++){var J=Q[K].dot(M);J>W&&(W=J),V>J&&(V=J)}if((V-=Z)>(W-=Z)){var $=V;V=W,W=$}O[0]=W,O[1]=V}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(v,A){function n(v,A,O,z){var M=z,W=[],V=[],H=[],Q=[],Z=[],K=Math.cos,J=Math.sin;W.push(new R(A*K(0),A*J(0),.5*-O)),Q.push(0),W.push(new R(v*K(0),v*J(0),.5*O)),Z.push(1);for(var $=0;M>$;$++){var et=2*Math.PI/M*($+1),nt=2*Math.PI/M*($+.5);M-1>$?(W.push(new R(A*K(et),A*J(et),.5*-O)),Q.push(2*$+2),W.push(new R(v*K(et),v*J(et),.5*O)),Z.push(2*$+3),H.push([2*$+2,2*$+3,2*$+1,2*$])):H.push([0,1,2*$+1,2*$]),(M%2==1||M/2>$)&&V.push(new R(K(nt),J(nt),0))}H.push(Z),V.push(new R(0,0,1));var it=[];for($=0;$<Q.length;$++)it.push(Q[Q.length-$-1]);H.push(it),this.type=E.types.CONVEXPOLYHEDRON,B.call(this,W,H,V)}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3"),B=(v("../math/Quaternion"),v("./ConvexPolyhedron"));n.prototype=new B},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(v,A){function n(v,A){A=O.defaults(A,{maxValue:null,minValue:null,elementSize:1}),this.data=v,this.maxValue=A.maxValue,this.minValue=A.minValue,this.elementSize=A.elementSize,null===A.minValue&&this.updateMinValue(),null===A.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,E.call(this),this.pillarConvex=new R,this.pillarOffset=new B,this.type=E.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var E=v("./Shape"),R=v("./ConvexPolyhedron"),B=v("../math/Vec3"),O=v("../utils/Utils");A.exports=n,n.prototype=new E,n.prototype.update=function(){this._cachedPillars={}},n.prototype.updateMinValue=function(){for(var v=this.data,A=v[0][0],E=0;E!==v.length;E++)for(var R=0;R!==v[E].length;R++){var B=v[E][R];A>B&&(A=B)}this.minValue=A},n.prototype.updateMaxValue=function(){for(var v=this.data,A=v[0][0],E=0;E!==v.length;E++)for(var R=0;R!==v[E].length;R++){var B=v[E][R];B>A&&(A=B)}this.maxValue=A},n.prototype.setHeightValueAtIndex=function(v,A,E){this.data[v][A]=E,this.clearCachedConvexTrianglePillar(v,A,!1),v>0&&(this.clearCachedConvexTrianglePillar(v-1,A,!0),this.clearCachedConvexTrianglePillar(v-1,A,!1)),A>0&&(this.clearCachedConvexTrianglePillar(v,A-1,!0),this.clearCachedConvexTrianglePillar(v,A-1,!1)),A>0&&v>0&&this.clearCachedConvexTrianglePillar(v-1,A-1,!0)},n.prototype.getRectMinMax=function(v,A,E,R,B){B=B||[];for(var O=this.data,z=this.minValue,M=v;E>=M;M++)for(var W=A;R>=W;W++){var V=O[M][W];V>z&&(z=V)}B[0]=this.minValue,B[1]=z},n.prototype.getIndexOfPosition=function(v,A,E,R){var B=this.elementSize,O=this.data,z=Math.floor(v/B),M=Math.floor(A/B);return E[0]=z,E[1]=M,R&&(0>z&&(z=0),0>M&&(M=0),z>=O.length-1&&(z=O.length-1),M>=O[0].length-1&&(M=O[0].length-1)),!(0>z||0>M||z>=O.length-1||M>=O[0].length-1)},n.prototype.getHeightAt=function(v,A,E){var R=[];this.getIndexOfPosition(v,A,R,E);var B=[];return this.getRectMinMax(R[0],R[1]+1,R[0],R[1]+1,B),(B[0]+B[1])/2},n.prototype.getCacheConvexTrianglePillarKey=function(v,A,E){return v+"_"+A+"_"+(E?1:0)},n.prototype.getCachedConvexTrianglePillar=function(v,A,E){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(v,A,E)]},n.prototype.setCachedConvexTrianglePillar=function(v,A,E,R,B){this._cachedPillars[this.getCacheConvexTrianglePillarKey(v,A,E)]={convex:R,offset:B}},n.prototype.clearCachedConvexTrianglePillar=function(v,A,E){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(v,A,E)]},n.prototype.getConvexTrianglePillar=function(v,A,E){var O=this.pillarConvex,z=this.pillarOffset;if(this.cacheEnabled){if(M=this.getCachedConvexTrianglePillar(v,A,E))return this.pillarConvex=M.convex,void(this.pillarOffset=M.offset);O=new R,z=new B,this.pillarConvex=O,this.pillarOffset=z}var M=this.data,W=this.elementSize,V=O.faces;O.vertices.length=6;for(var H=0;6>H;H++)O.vertices[H]||(O.vertices[H]=new B);for(V.length=5,H=0;5>H;H++)V[H]||(V[H]=[]);var Q=O.vertices,Z=(Math.min(M[v][A],M[v+1][A],M[v][A+1],M[v+1][A+1])-this.minValue)/2+this.minValue;E?(z.set((v+.75)*W,(A+.75)*W,Z),Q[0].set(.25*W,.25*W,M[v+1][A+1]-Z),Q[1].set(-.75*W,.25*W,M[v][A+1]-Z),Q[2].set(.25*W,-.75*W,M[v+1][A]-Z),Q[3].set(.25*W,.25*W,-Z-1),Q[4].set(-.75*W,.25*W,-Z-1),Q[5].set(.25*W,-.75*W,-Z-1),V[0][0]=0,V[0][1]=1,V[0][2]=2,V[1][0]=5,V[1][1]=4,V[1][2]=3,V[2][0]=2,V[2][1]=5,V[2][2]=3,V[2][3]=0,V[3][0]=3,V[3][1]=4,V[3][2]=1,V[3][3]=0,V[4][0]=1,V[4][1]=4,V[4][2]=5,V[4][3]=2):(z.set((v+.25)*W,(A+.25)*W,Z),Q[0].set(-.25*W,-.25*W,M[v][A]-Z),Q[1].set(.75*W,-.25*W,M[v+1][A]-Z),Q[2].set(-.25*W,.75*W,M[v][A+1]-Z),Q[3].set(-.25*W,-.25*W,-Z-1),Q[4].set(.75*W,-.25*W,-Z-1),Q[5].set(-.25*W,.75*W,-Z-1),V[0][0]=0,V[0][1]=1,V[0][2]=2,V[1][0]=5,V[1][1]=4,V[1][2]=3,V[2][0]=0,V[2][1]=2,V[2][2]=5,V[2][3]=3,V[3][0]=1,V[3][1]=0,V[3][2]=3,V[3][3]=4,V[4][0]=4,V[4][1]=5,V[4][2]=2,V[4][3]=1),O.computeNormals(),O.computeEdges(),O.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(v,A,E,O,z)},n.prototype.calculateLocalInertia=function(v,A){return(A=A||new B).set(0,0,0),A},n.prototype.volume=function(){return Number.MAX_VALUE},n.prototype.calculateWorldAABB=function(v,A,E,R){E.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),R.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},n.prototype.updateBoundingSphereRadius=function(){var v=this.data,A=this.elementSize;this.boundingSphereRadius=new B(v.length*A,v[0].length*A,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(v,A){function n(){E.call(this),this.type=E.types.PARTICLE}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(v,A){return(A=A||new R).set(0,0,0),A},n.prototype.volume=function(){return 0},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},n.prototype.calculateWorldAABB=function(v,A,E,R){E.copy(v),R.copy(v)}},{"../math/Vec3":30,"./Shape":43}],42:[function(v,A){function n(){E.call(this),this.type=E.types.PLANE,this.worldNormal=new R,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.computeWorldNormal=function(v){var A=this.worldNormal;A.set(0,0,1),v.vmult(A,A),this.worldNormalNeedsUpdate=!1},n.prototype.calculateLocalInertia=function(v,A){return A||new R},n.prototype.volume=function(){return Number.MAX_VALUE};var B=new R;n.prototype.calculateWorldAABB=function(v,A,E,R){B.set(0,0,1),A.vmult(B,B);var O=Number.MAX_VALUE;E.set(-O,-O,-O),R.set(O,O,O),1===B.x&&(R.x=v.x),1===B.y&&(R.y=v.y),1===B.z&&(R.z=v.z),-1===B.x&&(E.x=v.x),-1===B.y&&(E.y=v.y),-1===B.z&&(E.z=v.z)},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(v,A){function n(){this.id=n.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}A.exports=n;var n=v("./Shape");v("../math/Vec3"),v("../math/Quaternion"),v("../material/Material"),n.prototype.constructor=n,n.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},n.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},n.prototype.calculateLocalInertia=function(){throw"calculateLocalInertia() not implemented for shape type "+this.type},n.idCounter=0,n.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(v,A){function n(v){if(E.call(this),this.radius=void 0!==v?Number(v):1,this.type=E.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(v,A){A=A||new R;var E=2*v*this.radius*this.radius/5;return A.x=E,A.y=E,A.z=E,A},n.prototype.volume=function(){return 4*Math.PI*this.radius/3},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},n.prototype.calculateWorldAABB=function(v,A,E,R){for(var B=this.radius,O=["x","y","z"],z=0;z<O.length;z++){var M=O[z];E[M]=v[M]-B,R[M]=v[M]+B}}},{"../math/Vec3":30,"./Shape":43}],45:[function(v,A){function n(v,A){E.call(this),this.type=E.types.TRIMESH,this.vertices=new Float32Array(v),this.indices=new Int16Array(A),this.normals=new Float32Array(A.length),this.aabb=new O,this.edges=null,this.scale=new R(1,1,1),this.tree=new z,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3"),B=(v("../math/Quaternion"),v("../math/Transform")),O=v("../collision/AABB"),z=v("../utils/Octree");n.prototype=new E,n.prototype.constructor=n;var M=new R;n.prototype.updateTree=function(){var v=this.tree;v.reset(),v.aabb.copy(this.aabb);var A=this.scale;v.aabb.lowerBound.x*=1/A.x,v.aabb.lowerBound.y*=1/A.y,v.aabb.lowerBound.z*=1/A.z,v.aabb.upperBound.x*=1/A.x,v.aabb.upperBound.y*=1/A.y,v.aabb.upperBound.z*=1/A.z;for(var E=new O,B=new R,z=new R,M=new R,W=[B,z,M],V=0;V<this.indices.length/3;V++){var H=3*V;this._getUnscaledVertex(this.indices[H],B),this._getUnscaledVertex(this.indices[H+1],z),this._getUnscaledVertex(this.indices[H+2],M),E.setFromPoints(W),v.insert(E,V)}v.removeEmptyNodes()};var W=new O;n.prototype.getTrianglesInAABB=function(v,A){W.copy(v);var E=this.scale,R=E.x,B=E.y,O=E.z,z=W.lowerBound,M=W.upperBound;return z.x/=R,z.y/=B,z.z/=O,M.x/=R,M.y/=B,M.z/=O,this.tree.aabbQuery(W,A)},n.prototype.setScale=function(v){var A=this.scale.x===this.scale.y===this.scale.z,E=v.x===v.y===v.z;A&&E||this.updateNormals(),this.scale.copy(v),this.updateAABB(),this.updateBoundingSphereRadius()},n.prototype.updateNormals=function(){for(var v=M,A=this.normals,E=0;E<this.indices.length/3;E++){var R=3*E,B=this.indices[R],O=this.indices[R+1],z=this.indices[R+2];this.getVertex(B,K),this.getVertex(O,J),this.getVertex(z,$),n.computeNormal(J,K,$,v),A[R]=v.x,A[R+1]=v.y,A[R+2]=v.z}},n.prototype.updateEdges=function(){for(var v={},f=function(){v[B>R?R+"_"+B:B+"_"+R]=!0},A=0;A<this.indices.length/3;A++){var E=3*A,R=this.indices[E],B=this.indices[E+1];this.indices[E+2],f(),f(),f()}var O=Object.keys(v);for(this.edges=new Int16Array(2*O.length),A=0;A<O.length;A++){var z=O[A].split("_");this.edges[2*A]=parseInt(z[0],10),this.edges[2*A+1]=parseInt(z[1],10)}},n.prototype.getEdgeVertex=function(v,A,E){var R=this.edges[2*v+(A?1:0)];this.getVertex(R,E)};var V=new R,H=new R;n.prototype.getEdgeVector=function(v,A){var E=V,R=H;this.getEdgeVertex(v,0,E),this.getEdgeVertex(v,1,R),R.vsub(E,A)};var Q=new R,Z=new R;n.computeNormal=function(v,A,E,R){A.vsub(v,Z),E.vsub(A,Q),Q.cross(Z,R),R.isZero()||R.normalize()};var K=new R,J=new R,$=new R;n.prototype.getVertex=function(v,A){var E=this.scale;return this._getUnscaledVertex(v,A),A.x*=E.x,A.y*=E.y,A.z*=E.z,A},n.prototype._getUnscaledVertex=function(v,A){var E=3*v,R=this.vertices;return A.set(R[E],R[E+1],R[E+2])},n.prototype.getWorldVertex=function(v,A,E,R){return this.getVertex(v,R),B.pointToWorldFrame(A,E,R,R),R},n.prototype.getTriangleVertices=function(v,A,E,R){var B=3*v;this.getVertex(this.indices[B],A),this.getVertex(this.indices[B+1],E),this.getVertex(this.indices[B+2],R)},n.prototype.getNormal=function(v,A){var E=3*v;return A.set(this.normals[E],this.normals[E+1],this.normals[E+2])};var et=new O;n.prototype.calculateLocalInertia=function(v,A){this.computeLocalAABB(et);var E=et.upperBound.x-et.lowerBound.x,R=et.upperBound.y-et.lowerBound.y,B=et.upperBound.z-et.lowerBound.z;return A.set(1/12*v*(2*R*2*R+2*B*2*B),1/12*v*(2*E*2*E+2*B*2*B),1/12*v*(2*R*2*R+2*E*2*E))};var nt=new R;n.prototype.computeLocalAABB=function(v){var A=v.lowerBound,E=v.upperBound,R=this.vertices.length,B=(this.vertices,nt);this.getVertex(0,B),A.copy(B),E.copy(B);for(var O=0;O!==R;O++)this.getVertex(O,B),B.x<A.x?A.x=B.x:B.x>E.x&&(E.x=B.x),B.y<A.y?A.y=B.y:B.y>E.y&&(E.y=B.y),B.z<A.z?A.z=B.z:B.z>E.z&&(E.z=B.z)},n.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},n.prototype.updateBoundingSphereRadius=function(){for(var v=0,A=this.vertices,E=new R,B=0,O=A.length/3;B!==O;B++){this.getVertex(B,E);var z=E.norm2();z>v&&(v=z)}this.boundingSphereRadius=Math.sqrt(v)};var it=(new R,new B),ot=new O;n.prototype.calculateWorldAABB=function(v,A,E,R){var B=it,O=ot;B.position=v,B.quaternion=A,this.aabb.toWorldFrame(B,O),E.copy(O.lowerBound),R.copy(O.upperBound)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.createTorus=function(v,A,E,R,B){v=v||1,A=A||.5,E=E||8,R=R||6,B=B||2*Math.PI;for(var O=[],z=[],M=0;E>=M;M++)for(var W=0;R>=W;W++){var V=W/R*B,H=M/E*Math.PI*2,Q=(v+A*Math.cos(H))*Math.cos(V),Z=(v+A*Math.cos(H))*Math.sin(V),K=A*Math.sin(H);O.push(Q,Z,K)}for(M=1;E>=M;M++)for(W=1;R>=W;W++){var J=(R+1)*M+W-1,$=(R+1)*(M-1)+W-1,et=(R+1)*(M-1)+W,nt=(R+1)*M+W;z.push(J,$,nt),z.push($,et,nt)}return new n(O,z)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(v,A){function n(){E.call(this),this.iterations=10,this.tolerance=1e-7}A.exports=n;var E=(v("../math/Vec3"),v("../math/Quaternion"),v("./Solver"));n.prototype=new E;var R=[],B=[],O=[];n.prototype.solve=function(v,A){var E,z,M,W,V,H=0,Q=this.iterations,Z=this.tolerance*this.tolerance,K=this.equations,J=K.length,$=A.bodies,et=$.length,nt=v;if(0!==J)for(var it=0;it!==et;it++)$[it].updateSolveMassProperties();var ot=B,rt=O,st=R;for(ot.length=J,rt.length=J,st.length=J,it=0;it!==J;it++){var at=K[it];st[it]=0,rt[it]=at.computeB(nt),ot[it]=1/at.computeC()}if(0!==J){for(it=0;it!==et;it++){var lt=(ct=$[it]).vlambda,ut=ct.wlambda;lt.set(0,0,0),ut&&ut.set(0,0,0)}for(H=0;H!==Q;H++){W=0;for(var ht=0;ht!==J;ht++)at=K[ht],E=rt[ht],z=ot[ht],(V=st[ht])+(M=z*(E-at.computeGWlambda()-at.eps*V))<at.minForce?M=at.minForce-V:V+M>at.maxForce&&(M=at.maxForce-V),st[ht]+=M,W+=M>0?M:-M,at.addToWlambda(M);if(Z>W*W)break}for(it=0;it!==et;it++){var ct,pt=(ct=$[it]).velocity,dt=ct.angularVelocity;pt.vadd(ct.vlambda,pt),dt&&dt.vadd(ct.wlambda,dt)}}return H}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(v,A){function n(){this.equations=[]}A.exports=n,n.prototype.solve=function(){return 0},n.prototype.addEquation=function(v){v.enabled&&this.equations.push(v)},n.prototype.removeEquation=function(v){var A=this.equations,E=A.indexOf(v);-1!==E&&A.splice(E,1)},n.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(v,A){function n(v){for(E.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=v,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function o(v){for(var A=v.length,E=0;E!==A;E++){var R=v[E];if(!(R.visited||R.body.type&M))return R}return!1}function d(v,A,E,R){for(W.push(v),v.visited=!0,A(v,E,R);W.length;)for(var B,O=W.pop();B=o(O.children);)B.visited=!0,A(B,E,R),W.push(B)}function i(v,A,E){A.push(v.body);for(var R=v.eqs.length,B=0;B!==R;B++){var O=v.eqs[B];-1===E.indexOf(O)&&E.push(O)}}function t(v,A){return A.id-v.id}A.exports=n;var E=(v("../math/Vec3"),v("../math/Quaternion"),v("./Solver")),R=v("../objects/Body");n.prototype=new E;var B=[],O=[],z={bodies:[]},M=R.STATIC,W=[];n.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},n.prototype.solve=function(v,A){for(var E=B,R=this.nodePool,M=A.bodies,W=this.equations,V=W.length,H=M.length,Q=this.subsolver;R.length<H;)R.push(this.createNode());E.length=H;for(var Z=0;H>Z;Z++)E[Z]=R[Z];for(Z=0;Z!==H;Z++){var K=E[Z];K.body=M[Z],K.children.length=0,K.eqs.length=0,K.visited=!1}for(var J=0;J!==V;J++){var $=W[J],et=(Z=M.indexOf($.bi),M.indexOf($.bj)),nt=E[Z],it=E[et];nt.children.push(it),nt.eqs.push($),it.children.push(nt),it.eqs.push($)}var ot,rt=0,st=O;Q.tolerance=this.tolerance,Q.iterations=this.iterations;for(var at=z;ot=o(E);){st.length=0,at.bodies.length=0,d(ot,i,at.bodies,st);var lt=st.length;for(st=st.sort(t),Z=0;Z!==lt;Z++)Q.addEquation(st[Z]);Q.solve(v,at),Q.removeAllEquations(),rt++}return rt}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(v,A){var n=function(){};A.exports=n,n.prototype={constructor:n,addEventListener:function(v,A){void 0===this._listeners&&(this._listeners={});var E=this._listeners;return void 0===E[v]&&(E[v]=[]),-1===E[v].indexOf(A)&&E[v].push(A),this},hasEventListener:function(v,A){if(void 0===this._listeners)return!1;var E=this._listeners;return void 0!==E[v]&&-1!==E[v].indexOf(A)},removeEventListener:function(v,A){if(void 0===this._listeners)return this;var E=this._listeners;if(void 0===E[v])return this;var R=E[v].indexOf(A);return-1!==R&&E[v].splice(R,1),this},dispatchEvent:function(v){if(void 0===this._listeners)return this;var A=this._listeners[v.type];if(void 0!==A){v.target=this;for(var E=0,R=A.length;R>E;E++)A[E].call(this,v)}return this}}},{}],50:[function(v,A){function n(v){v=v||{},this.root=v.root||null,this.aabb=v.aabb?v.aabb.clone():new E,this.data=[],this.children=[]}function o(v,A){(A=A||{}).root=null,A.aabb=v,n.call(this,A),this.maxDepth=void 0!==A.maxDepth?A.maxDepth:8}var E=v("../collision/AABB"),R=v("../math/Vec3");A.exports=o,o.prototype=new n,n.prototype.reset=function(){this.children.length=this.data.length=0},n.prototype.insert=function(v,A,E){var R=this.data;if(E=E||0,!this.aabb.contains(v))return!1;var B=this.children;if(E<(this.maxDepth||this.root.maxDepth)){var O=!1;B.length||(this.subdivide(),O=!0);for(var z=0;8!==z;z++)if(B[z].insert(v,A,E+1))return!0;O&&(B.length=0)}return R.push(A),!0};var B=new R;n.prototype.subdivide=function(){var v=this.aabb,A=v.lowerBound,O=v.upperBound,z=this.children;z.push(new n({aabb:new E({lowerBound:new R(0,0,0)})}),new n({aabb:new E({lowerBound:new R(1,0,0)})}),new n({aabb:new E({lowerBound:new R(1,1,0)})}),new n({aabb:new E({lowerBound:new R(1,1,1)})}),new n({aabb:new E({lowerBound:new R(0,1,1)})}),new n({aabb:new E({lowerBound:new R(0,0,1)})}),new n({aabb:new E({lowerBound:new R(1,0,1)})}),new n({aabb:new E({lowerBound:new R(0,1,0)})})),O.vsub(A,B),B.scale(.5,B);for(var M=this.root||this,W=0;8!==W;W++){var V=z[W];V.root=M;var H=V.aabb.lowerBound;H.x*=B.x,H.y*=B.y,H.z*=B.z,H.vadd(A,H),H.vadd(B,V.aabb.upperBound)}},n.prototype.aabbQuery=function(v,A){for(var E=(this.data,this.children,[this]);E.length;){var R=E.pop();R.aabb.overlaps(v)&&Array.prototype.push.apply(A,R.data),Array.prototype.push.apply(E,R.children)}return A};var O=new E;n.prototype.rayQuery=function(v,A,E){return v.getAABB(O),O.toLocalFrame(A,O),this.aabbQuery(O,E),E},n.prototype.removeEmptyNodes=function(){for(var v=[this];v.length;){for(var A=v.pop(),E=A.children.length-1;E>=0;E--)A.children[E].data.length||A.children.splice(E,1);Array.prototype.push.apply(v,A.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(v,A){function n(){this.objects=[],this.type=Object}A.exports=n,n.prototype.release=function(){for(var v=arguments.length,A=0;A!==v;A++)this.objects.push(arguments[A])},n.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},n.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(v,A){function n(){this.data={keys:[]}}A.exports=n,n.prototype.get=function(v,A){if(v>A){var E=A;A=v,v=E}return this.data[v+"-"+A]},n.prototype.set=function(v,A,E){if(v>A){var R=A;A=v,v=R}var B=v+"-"+A;this.get(v,A)||this.data.keys.push(B),this.data[B]=E},n.prototype.reset=function(){for(var v=this.data,A=v.keys;A.length>0;)delete v[A.pop()]}},{}],53:[function(v,A){function n(){}A.exports=n,n.defaults=function(v,A){for(var E in v=v||{},A)E in v||(v[E]=A[E]);return v}},{}],54:[function(v,A){function n(){R.call(this),this.type=E}A.exports=n;var E=v("../math/Vec3"),R=v("./Pool");n.prototype=new R,n.prototype.constructObject=function(){return new E}},{"../math/Vec3":30,"./Pool":51}],55:[function(v,A){function n(v){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new W,this.world=v,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function o(v,A,E){for(var R=null,B=v.length,O=0;O!==B;O++){var z=v[O],M=St;v[(O+1)%B].vsub(z,M);var W=Ct;M.cross(A,W);var V=_t;E.vsub(z,V);var H=W.dot(V);if(!(null===R||H>0&&!0===R||0>=H&&!1===R))return!1;null===R&&(R=H>0)}return!0}A.exports=n;var E=v("../collision/AABB"),R=v("../shapes/Shape"),B=v("../collision/Ray"),O=v("../math/Vec3"),z=v("../math/Transform"),M=(v("../shapes/ConvexPolyhedron"),v("../math/Quaternion")),W=(v("../solver/Solver"),v("../utils/Vec3Pool")),V=v("../equations/ContactEquation"),H=v("../equations/FrictionEquation");n.prototype.createContactEquation=function(v,A,E,R,B,O){var z;this.contactPointPool.length?((z=this.contactPointPool.pop()).bi=v,z.bj=A):z=new V(v,A),z.enabled=v.collisionResponse&&A.collisionResponse&&E.collisionResponse&&R.collisionResponse;var M=this.currentContactMaterial;z.restitution=M.restitution,z.setSpookParams(M.contactEquationStiffness,M.contactEquationRelaxation,this.world.dt);var W=E.material||v.material,H=R.material||A.material;return W&&H&&W.restitution>=0&&H.restitution>=0&&(z.restitution=W.restitution*H.restitution),z.si=B||E,z.sj=O||R,z},n.prototype.createFrictionEquationsFromContact=function(v,A){var E=v.bi,R=v.bj,B=v.si,O=v.sj,z=this.world,M=this.currentContactMaterial,W=M.friction,V=B.material||E.material,Q=O.material||R.material;if(V&&Q&&V.friction>=0&&Q.friction>=0&&(W=V.friction*Q.friction),W>0){var Z=W*z.gravity.length(),K=E.invMass+R.invMass;K>0&&(K=1/K);var J=this.frictionEquationPool,$=J.length?J.pop():new H(E,R,Z*K),et=J.length?J.pop():new H(E,R,Z*K);return $.bi=et.bi=E,$.bj=et.bj=R,$.minForce=et.minForce=-Z*K,$.maxForce=et.maxForce=Z*K,$.ri.copy(v.ri),$.rj.copy(v.rj),et.ri.copy(v.ri),et.rj.copy(v.rj),v.ni.tangents($.t,et.t),$.setSpookParams(M.frictionEquationStiffness,M.frictionEquationRelaxation,z.dt),et.setSpookParams(M.frictionEquationStiffness,M.frictionEquationRelaxation,z.dt),$.enabled=et.enabled=v.enabled,A.push($,et),!0}return!1};var Q=new O,Z=new O,K=new O;n.prototype.createFrictionFromAverage=function(v){var A=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(A,this.frictionResult)&&1!==v){var E=this.frictionResult[this.frictionResult.length-2],R=this.frictionResult[this.frictionResult.length-1];Q.setZero(),Z.setZero(),K.setZero();for(var B=A.bi,O=(A.bj,0);O!==v;O++)(A=this.result[this.result.length-1-O]).bodyA!==B?(Q.vadd(A.ni,Q),Z.vadd(A.ri,Z),K.vadd(A.rj,K)):(Q.vsub(A.ni,Q),Z.vadd(A.rj,Z),K.vadd(A.ri,K));var z=1/v;Z.scale(z,E.ri),K.scale(z,E.rj),R.ri.copy(E.ri),R.rj.copy(E.rj),Q.normalize(),Q.tangents(E.t,R.t)}};var J=new O,$=new O,et=new M,nt=new M;n.prototype.getContacts=function(v,A,E,R,B,O,z){this.contactPointPool=B,this.frictionEquationPool=z,this.result=R,this.frictionResult=O;for(var M=et,W=nt,V=J,H=$,Q=0,Z=v.length;Q!==Z;Q++){var K=v[Q],it=A[Q],ot=null;K.material&&it.material&&(ot=E.getContactMaterial(K.material,it.material)||null);for(var rt=0;rt<K.shapes.length;rt++){K.quaternion.mult(K.shapeOrientations[rt],M),K.quaternion.vmult(K.shapeOffsets[rt],V),V.vadd(K.position,V);for(var st=K.shapes[rt],at=0;at<it.shapes.length;at++){it.quaternion.mult(it.shapeOrientations[at],W),it.quaternion.vmult(it.shapeOffsets[at],H),H.vadd(it.position,H);var lt=it.shapes[at];if(!(V.distanceTo(H)>st.boundingSphereRadius+lt.boundingSphereRadius)){var ut=null;st.material&&lt.material&&(ut=E.getContactMaterial(st.material,lt.material)||null),this.currentContactMaterial=ut||ot||E.defaultContactMaterial;var ht=this[st.type|lt.type];ht&&(st.type<lt.type?ht.call(this,st,lt,V,H,M,W,K,it,st,lt):ht.call(this,lt,st,H,V,W,M,it,K,st,lt))}}}}},n.prototype[R.types.BOX|R.types.BOX]=n.prototype.boxBox=function(v,A,E,R,B,O,z,M){v.convexPolyhedronRepresentation.material=v.material,A.convexPolyhedronRepresentation.material=A.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.convexConvex(v.convexPolyhedronRepresentation,A.convexPolyhedronRepresentation,E,R,B,O,z,M,v,A)},n.prototype[R.types.BOX|R.types.CONVEXPOLYHEDRON]=n.prototype.boxConvex=function(v,A,E,R,B,O,z,M){v.convexPolyhedronRepresentation.material=v.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,this.convexConvex(v.convexPolyhedronRepresentation,A,E,R,B,O,z,M,v,A)},n.prototype[R.types.BOX|R.types.PARTICLE]=n.prototype.boxParticle=function(v,A,E,R,B,O,z,M){v.convexPolyhedronRepresentation.material=v.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,this.convexParticle(v.convexPolyhedronRepresentation,A,E,R,B,O,z,M,v,A)},n.prototype[R.types.SPHERE]=n.prototype.sphereSphere=function(v,A,E,R,B,O,z,M){var W=this.createContactEquation(z,M,v,A);R.vsub(E,W.ni),W.ni.normalize(),W.ri.copy(W.ni),W.rj.copy(W.ni),W.ri.mult(v.radius,W.ri),W.rj.mult(-A.radius,W.rj),W.ri.vadd(E,W.ri),W.ri.vsub(z.position,W.ri),W.rj.vadd(R,W.rj),W.rj.vsub(M.position,W.rj),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)};var it=new O,ot=new O,rt=new O;n.prototype[R.types.PLANE|R.types.TRIMESH]=n.prototype.planeTrimesh=function(v,A,E,R,B,M,W,V){var H=new O,Q=it;Q.set(0,0,1),B.vmult(Q,Q);for(var Z=0;Z<A.vertices.length/3;Z++){A.getVertex(Z,H);var K=new O;K.copy(H),z.pointToWorldFrame(R,M,K,H);var J=ot;if(H.vsub(E,J),0>=Q.dot(J)){var $=this.createContactEquation(W,V,v,A);$.ni.copy(Q);var et=rt;Q.scale(J.dot(Q),et),H.vsub(et,et),$.ri.copy(et),$.ri.vsub(W.position,$.ri),$.rj.copy(H),$.rj.vsub(V.position,$.rj),this.result.push($),this.createFrictionEquationsFromContact($,this.frictionResult)}}};var st=new O,at=new O,lt=(new O,new O),ut=new O,ht=new O,ct=new O,pt=new O,dt=new O,ft=new O,yt=new O,gt=new O,vt=new O,bt=new O,wt=new E,xt=[];n.prototype[R.types.SPHERE|R.types.TRIMESH]=n.prototype.sphereTrimesh=function(v,A,E,R,O,M,W,V){var H=ht,Q=ct,Z=pt,K=dt,J=ft,$=yt,et=wt,nt=ut,it=at,ot=xt;z.pointToLocalFrame(R,M,E,J);var rt=v.radius;et.lowerBound.set(J.x-rt,J.y-rt,J.z-rt),et.upperBound.set(J.x+rt,J.y+rt,J.z+rt),A.getTrianglesInAABB(et,ot);for(var Tt=lt,At=v.radius*v.radius,St=0;St<ot.length;St++)for(var Ct=0;3>Ct;Ct++)A.getVertex(A.indices[3*ot[St]+Ct],Tt),Tt.vsub(J,it),it.norm2()<=At&&(nt.copy(Tt),z.pointToWorldFrame(R,M,nt,Tt),Tt.vsub(E,it),(Rt=this.createContactEquation(W,V,v,A)).ni.copy(it),Rt.ni.normalize(),Rt.ri.copy(Rt.ni),Rt.ri.scale(v.radius,Rt.ri),Rt.ri.vadd(E,Rt.ri),Rt.ri.vsub(W.position,Rt.ri),Rt.rj.copy(Tt),Rt.rj.vsub(V.position,Rt.rj),this.result.push(Rt),this.createFrictionEquationsFromContact(Rt,this.frictionResult));for(St=0;St<ot.length;St++)for(Ct=0;3>Ct;Ct++){A.getVertex(A.indices[3*ot[St]+Ct],H),A.getVertex(A.indices[3*ot[St]+(Ct+1)%3],Q),Q.vsub(H,Z),J.vsub(Q,$);var _t=$.dot(Z);J.vsub(H,$);var It=$.dot(Z);if(It>0&&0>_t&&(J.vsub(H,$),K.copy(Z),K.normalize(),It=$.dot(K),K.scale(It,$),$.vadd(H,$),(Lt=$.distanceTo(J))<v.radius)){var Rt=this.createContactEquation(W,V,v,A);$.vsub(J,Rt.ni),Rt.ni.normalize(),Rt.ni.scale(v.radius,Rt.ri),z.pointToWorldFrame(R,M,$,$),$.vsub(V.position,Rt.rj),z.vectorToWorldFrame(M,Rt.ni,Rt.ni),z.vectorToWorldFrame(M,Rt.ri,Rt.ri),this.result.push(Rt),this.createFrictionEquationsFromContact(Rt,this.frictionResult)}}for(var Pt=gt,Bt=vt,Ot=bt,zt=st,Nt=(St=0,ot.length);St!==Nt;St++){A.getTriangleVertices(ot[St],Pt,Bt,Ot),A.getNormal(ot[St],zt),J.vsub(Pt,$);var Lt=$.dot(zt);zt.scale(Lt,$),J.vsub($,$),Lt=$.distanceTo(J),B.pointInTriangle($,Pt,Bt,Ot)&&Lt<v.radius&&(Rt=this.createContactEquation(W,V,v,A),$.vsub(J,Rt.ni),Rt.ni.normalize(),Rt.ni.scale(v.radius,Rt.ri),z.pointToWorldFrame(R,M,$,$),$.vsub(V.position,Rt.rj),z.vectorToWorldFrame(M,Rt.ni,Rt.ni),z.vectorToWorldFrame(M,Rt.ri,Rt.ri),this.result.push(Rt),this.createFrictionEquationsFromContact(Rt,this.frictionResult))}ot.length=0};var Tt=new O,At=new O;n.prototype[R.types.SPHERE|R.types.PLANE]=n.prototype.spherePlane=function(v,A,E,R,B,O,z,M){var W=this.createContactEquation(z,M,v,A);if(W.ni.set(0,0,1),O.vmult(W.ni,W.ni),W.ni.negate(W.ni),W.ni.normalize(),W.ni.mult(v.radius,W.ri),E.vsub(R,Tt),W.ni.mult(W.ni.dot(Tt),At),Tt.vsub(At,W.rj),-Tt.dot(W.ni)<=v.radius){var V=W.ri,H=W.rj;V.vadd(E,V),V.vsub(z.position,V),H.vadd(R,H),H.vsub(M.position,H),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}};var St=new O,Ct=new O,_t=new O,It=new O,Rt=new O,Pt=new O,Bt=new O,Ot=[new O,new O,new O,new O,new O,new O],zt=new O,Nt=new O,Lt=new O,Ft=new O;n.prototype[R.types.SPHERE|R.types.BOX]=n.prototype.sphereBox=function(v,A,E,R,B,O,z,M){var W=this.v3pool,V=Ot;E.vsub(R,It),A.getSideNormals(V,O);for(var H=v.radius,Q=!1,Z=Nt,K=Lt,J=Ft,$=null,et=0,nt=0,it=0,ot=null,rt=0,st=V.length;rt!==st&&!1===Q;rt++){var at=Rt;at.copy(V[rt]);var lt=at.norm();at.normalize();var ut=It.dot(at);if(lt+H>ut&&ut>0){var ht=Pt,ct=Bt;ht.copy(V[(rt+1)%3]),ct.copy(V[(rt+2)%3]);var pt=ht.norm(),dt=ct.norm();ht.normalize(),ct.normalize();var ft=It.dot(ht),yt=It.dot(ct);if(pt>ft&&ft>-pt&&dt>yt&&yt>-dt){var gt=Math.abs(ut-lt-H);(null===ot||ot>gt)&&(ot=gt,nt=ft,it=yt,$=lt,Z.copy(at),K.copy(ht),J.copy(ct),et++)}}}if(et){Q=!0;var vt=this.createContactEquation(z,M,v,A);Z.mult(-H,vt.ri),vt.ni.copy(Z),vt.ni.negate(vt.ni),Z.mult($,Z),K.mult(nt,K),Z.vadd(K,Z),J.mult(it,J),Z.vadd(J,vt.rj),vt.ri.vadd(E,vt.ri),vt.ri.vsub(z.position,vt.ri),vt.rj.vadd(R,vt.rj),vt.rj.vsub(M.position,vt.rj),this.result.push(vt),this.createFrictionEquationsFromContact(vt,this.frictionResult)}for(var bt=W.get(),wt=zt,xt=0;2!==xt&&!Q;xt++)for(var Tt=0;2!==Tt&&!Q;Tt++)for(var At=0;2!==At&&!Q;At++)bt.set(0,0,0),xt?bt.vadd(V[0],bt):bt.vsub(V[0],bt),Tt?bt.vadd(V[1],bt):bt.vsub(V[1],bt),At?bt.vadd(V[2],bt):bt.vsub(V[2],bt),R.vadd(bt,wt),wt.vsub(E,wt),wt.norm2()<H*H&&(Q=!0,(vt=this.createContactEquation(z,M,v,A)).ri.copy(wt),vt.ri.normalize(),vt.ni.copy(vt.ri),vt.ri.mult(H,vt.ri),vt.rj.copy(bt),vt.ri.vadd(E,vt.ri),vt.ri.vsub(z.position,vt.ri),vt.rj.vadd(R,vt.rj),vt.rj.vsub(M.position,vt.rj),this.result.push(vt),this.createFrictionEquationsFromContact(vt,this.frictionResult));W.release(bt),bt=null;var St=W.get(),Ct=W.get(),_t=(vt=W.get(),W.get()),kt=(gt=W.get(),V.length);for(xt=0;xt!==kt&&!Q;xt++)for(Tt=0;Tt!==kt&&!Q;Tt++)if(xt%3!=Tt%3){V[Tt].cross(V[xt],St),St.normalize(),V[xt].vadd(V[Tt],Ct),vt.copy(E),vt.vsub(Ct,vt),vt.vsub(R,vt);var Wt=vt.dot(St);for(St.mult(Wt,_t),At=0;At===xt%3||At===Tt%3;)At++;gt.copy(E),gt.vsub(_t,gt),gt.vsub(Ct,gt),gt.vsub(R,gt);var qt=Math.abs(Wt),Vt=gt.norm();if(qt<V[At].norm()&&H>Vt){Q=!0;var Ut=this.createContactEquation(z,M,v,A);Ct.vadd(_t,Ut.rj),Ut.rj.copy(Ut.rj),gt.negate(Ut.ni),Ut.ni.normalize(),Ut.ri.copy(Ut.rj),Ut.ri.vadd(R,Ut.ri),Ut.ri.vsub(E,Ut.ri),Ut.ri.normalize(),Ut.ri.mult(H,Ut.ri),Ut.ri.vadd(E,Ut.ri),Ut.ri.vsub(z.position,Ut.ri),Ut.rj.vadd(R,Ut.rj),Ut.rj.vsub(M.position,Ut.rj),this.result.push(Ut),this.createFrictionEquationsFromContact(Ut,this.frictionResult)}}W.release(St,Ct,vt,_t,gt)};var kt=new O,Wt=new O,qt=new O,Vt=new O,Ut=new O,Ht=new O,Gt=new O,Yt=new O,Qt=new O,Zt=new O;n.prototype[R.types.SPHERE|R.types.CONVEXPOLYHEDRON]=n.prototype.sphereConvex=function(v,A,E,R,B,O,z,M){var W=this.v3pool;E.vsub(R,kt);for(var V=A.faceNormals,H=A.faces,Q=A.vertices,Z=v.radius,K=0;K!==Q.length;K++){var J=Q[K],$=Ut;O.vmult(J,$),R.vadd($,$);var et=Vt;if($.vsub(E,et),et.norm2()<Z*Z)return nt=!0,(gt=this.createContactEquation(z,M,v,A)).ri.copy(et),gt.ri.normalize(),gt.ni.copy(gt.ri),gt.ri.mult(Z,gt.ri),$.vsub(R,gt.rj),gt.ri.vadd(E,gt.ri),gt.ri.vsub(z.position,gt.ri),gt.rj.vadd(R,gt.rj),gt.rj.vsub(M.position,gt.rj),this.result.push(gt),void this.createFrictionEquationsFromContact(gt,this.frictionResult)}for(var nt=!1,it=(K=0,H.length);K!==it&&!1===nt;K++){var ot=V[K],rt=H[K],st=Ht;O.vmult(ot,st);var at=Gt;O.vmult(Q[rt[0]],at),at.vadd(R,at);var lt=Yt;st.mult(-Z,lt),E.vadd(lt,lt);var ut=Qt;lt.vsub(at,ut);var ht=ut.dot(st),ct=Zt;if(E.vsub(at,ct),0>ht&&ct.dot(st)>0){for(var pt=[],dt=0,ft=rt.length;dt!==ft;dt++){var yt=W.get();O.vmult(Q[rt[dt]],yt),R.vadd(yt,yt),pt.push(yt)}if(o(pt,st,E)){nt=!0;var gt=this.createContactEquation(z,M,v,A);st.mult(-Z,gt.ri),st.negate(gt.ni);var vt=W.get();st.mult(-ht,vt);var bt=W.get();st.mult(-Z,bt),E.vsub(R,gt.rj),gt.rj.vadd(bt,gt.rj),gt.rj.vadd(vt,gt.rj),gt.rj.vadd(R,gt.rj),gt.rj.vsub(M.position,gt.rj),gt.ri.vadd(E,gt.ri),gt.ri.vsub(z.position,gt.ri),W.release(vt),W.release(bt),this.result.push(gt),this.createFrictionEquationsFromContact(gt,this.frictionResult),dt=0;for(var wt=pt.length;dt!==wt;dt++)W.release(pt[dt]);return}for(dt=0;dt!==rt.length;dt++){var xt=W.get(),Tt=W.get();O.vmult(Q[rt[(dt+1)%rt.length]],xt),O.vmult(Q[rt[(dt+2)%rt.length]],Tt),R.vadd(xt,xt),R.vadd(Tt,Tt);var At=Wt;Tt.vsub(xt,At);var St=qt;At.unit(St);var Ct=W.get(),_t=W.get();E.vsub(xt,_t);var It=_t.dot(St);St.mult(It,Ct),Ct.vadd(xt,Ct);var Rt=W.get();if(Ct.vsub(E,Rt),It>0&&It*It<At.norm2()&&Rt.norm2()<Z*Z){for(gt=this.createContactEquation(z,M,v,A),Ct.vsub(R,gt.rj),Ct.vsub(E,gt.ni),gt.ni.normalize(),gt.ni.mult(Z,gt.ri),gt.rj.vadd(R,gt.rj),gt.rj.vsub(M.position,gt.rj),gt.ri.vadd(E,gt.ri),gt.ri.vsub(z.position,gt.ri),this.result.push(gt),this.createFrictionEquationsFromContact(gt,this.frictionResult),dt=0,wt=pt.length;dt!==wt;dt++)W.release(pt[dt]);return W.release(xt),W.release(Tt),W.release(Ct),W.release(Rt),void W.release(_t)}W.release(xt),W.release(Tt),W.release(Ct),W.release(Rt),W.release(_t)}for(dt=0,wt=pt.length;dt!==wt;dt++)W.release(pt[dt])}}},new O,new O,n.prototype[R.types.PLANE|R.types.BOX]=n.prototype.planeBox=function(v,A,E,R,B,O,z,M){A.convexPolyhedronRepresentation.material=A.material,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.planeConvex(v,A.convexPolyhedronRepresentation,E,R,B,O,z,M)};var Kt=new O,Jt=new O,$t=new O,ee=new O;n.prototype[R.types.PLANE|R.types.CONVEXPOLYHEDRON]=n.prototype.planeConvex=function(v,A,E,R,B,O,z,M){var W=Kt,V=Jt;V.set(0,0,1),B.vmult(V,V);for(var H=0,Q=$t,Z=0;Z!==A.vertices.length;Z++)if(W.copy(A.vertices[Z]),O.vmult(W,W),R.vadd(W,W),W.vsub(E,Q),0>=V.dot(Q)){var K=this.createContactEquation(z,M,v,A),J=ee;V.mult(V.dot(Q),J),W.vsub(J,J),J.vsub(E,K.ri),K.ni.copy(V),W.vsub(R,K.rj),K.ri.vadd(E,K.ri),K.ri.vsub(z.position,K.ri),K.rj.vadd(R,K.rj),K.rj.vsub(M.position,K.rj),this.result.push(K),H++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(K,this.frictionResult)}this.enableFrictionReduction&&H&&this.createFrictionFromAverage(H)};var ne=new O,ie=new O;n.prototype[R.types.CONVEXPOLYHEDRON]=n.prototype.convexConvex=function(v,A,E,R,B,O,z,M,W,V,H,Q){var Z=ne;if(!(E.distanceTo(R)>v.boundingSphereRadius+A.boundingSphereRadius)&&v.findSeparatingAxis(A,E,B,R,O,Z,H,Q)){var K=[],J=ie;v.clipAgainstHull(E,B,A,R,O,Z,-100,100,K);for(var $=0,et=0;et!==K.length;et++){var nt=this.createContactEquation(z,M,v,A,W,V),it=nt.ri,ot=nt.rj;Z.negate(nt.ni),K[et].normal.negate(J),J.mult(K[et].depth,J),K[et].point.vadd(J,it),ot.copy(K[et].point),it.vsub(E,it),ot.vsub(R,ot),it.vadd(E,it),it.vsub(z.position,it),ot.vadd(R,ot),ot.vsub(M.position,ot),this.result.push(nt),$++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(nt,this.frictionResult)}this.enableFrictionReduction&&$&&this.createFrictionFromAverage($)}};var oe=new O,se=new O,ae=new O;n.prototype[R.types.PLANE|R.types.PARTICLE]=n.prototype.planeParticle=function(v,A,E,R,B,O,z,M){var W=oe;W.set(0,0,1),z.quaternion.vmult(W,W);var V=se;if(R.vsub(z.position,V),0>=W.dot(V)){var H=this.createContactEquation(M,z,A,v);H.ni.copy(W),H.ni.negate(H.ni),H.ri.set(0,0,0);var Q=ae;W.mult(W.dot(R),Q),R.vsub(Q,Q),H.rj.copy(Q),this.result.push(H),this.createFrictionEquationsFromContact(H,this.frictionResult)}};var le=new O;n.prototype[R.types.PARTICLE|R.types.SPHERE]=n.prototype.sphereParticle=function(v,A,E,R,B,O,z,M){var W=le;if(W.set(0,0,1),R.vsub(E,W),W.norm2()<=v.radius*v.radius){var V=this.createContactEquation(M,z,A,v);W.normalize(),V.rj.copy(W),V.rj.mult(v.radius,V.rj),V.ni.copy(W),V.ni.negate(V.ni),V.ri.set(0,0,0),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult)}};var ue=new M,he=new O,ce=(new O,new O),de=new O,fe=new O;n.prototype[R.types.PARTICLE|R.types.CONVEXPOLYHEDRON]=n.prototype.convexParticle=function(v,A,E,R,B,O,z,M){var W=-1,V=ce,H=fe,Q=null,Z=he;if(Z.copy(R),Z.vsub(E,Z),B.conjugate(ue),ue.vmult(Z,Z),v.pointIsInside(Z)){v.worldVerticesNeedsUpdate&&v.computeWorldVertices(E,B),v.worldFaceNormalsNeedsUpdate&&v.computeWorldFaceNormals(B);for(var K=0,J=v.faces.length;K!==J;K++){var $=[v.worldVertices[v.faces[K][0]]],et=v.worldFaceNormals[K];R.vsub($[0],de);var nt=-et.dot(de);(null===Q||Math.abs(nt)<Math.abs(Q))&&(Q=nt,W=K,V.copy(et))}if(-1!==W){var it=this.createContactEquation(M,z,A,v);V.mult(Q,H),H.vadd(R,H),H.vsub(E,H),it.rj.copy(H),V.negate(it.ni),it.ri.set(0,0,0);var ot=it.ri,rt=it.rj;ot.vadd(R,ot),ot.vsub(M.position,ot),rt.vadd(E,rt),rt.vsub(z.position,rt),this.result.push(it),this.createFrictionEquationsFromContact(it,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},n.prototype[R.types.BOX|R.types.HEIGHTFIELD]=n.prototype.boxHeightfield=function(v,A,E,R,B,O,z,M){v.convexPolyhedronRepresentation.material=v.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,this.convexHeightfield(v.convexPolyhedronRepresentation,A,E,R,B,O,z,M)};var ye=new O,me=new O,ve=[0];n.prototype[R.types.CONVEXPOLYHEDRON|R.types.HEIGHTFIELD]=n.prototype.convexHeightfield=function(v,A,E,R,B,O,M,W){var V=A.data,H=A.elementSize,Q=v.boundingSphereRadius,Z=me,K=ve,J=ye;z.pointToLocalFrame(R,O,E,J);var $=Math.floor((J.x-Q)/H)-1,et=Math.ceil((J.x+Q)/H)+1,nt=Math.floor((J.y-Q)/H)-1,it=Math.ceil((J.y+Q)/H)+1;if(!(0>et||0>it||$>V.length||nt>V[0].length)){0>$&&($=0),0>et&&(et=0),0>nt&&(nt=0),0>it&&(it=0),$>=V.length&&($=V.length-1),et>=V.length&&(et=V.length-1),it>=V[0].length&&(it=V[0].length-1),nt>=V[0].length&&(nt=V[0].length-1);var ot=[];A.getRectMinMax($,nt,et,it,ot);var rt=ot[0],st=ot[1];if(!(J.z-Q>st||J.z+Q<rt))for(var at=$;et>at;at++)for(var lt=nt;it>lt;lt++)A.getConvexTrianglePillar(at,lt,!1),z.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.convexConvex(v,A.pillarConvex,E,Z,B,O,M,W,null,null,K,null),A.getConvexTrianglePillar(at,lt,!0),z.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.convexConvex(v,A.pillarConvex,E,Z,B,O,M,W,null,null,K,null)}};var be=new O,we=new O;n.prototype[R.types.SPHERE|R.types.HEIGHTFIELD]=n.prototype.sphereHeightfield=function(v,A,E,R,B,O,M,W){var V=A.data,H=v.radius,Q=A.elementSize,Z=we,K=be;z.pointToLocalFrame(R,O,E,K);var J=Math.floor((K.x-H)/Q)-1,$=Math.ceil((K.x+H)/Q)+1,et=Math.floor((K.y-H)/Q)-1,nt=Math.ceil((K.y+H)/Q)+1;if(!(0>$||0>nt||J>V.length||nt>V[0].length)){0>J&&(J=0),0>$&&($=0),0>et&&(et=0),0>nt&&(nt=0),J>=V.length&&(J=V.length-1),$>=V.length&&($=V.length-1),nt>=V[0].length&&(nt=V[0].length-1),et>=V[0].length&&(et=V[0].length-1);var it=[];A.getRectMinMax(J,et,$,nt,it);var ot=it[0],rt=it[1];if(!(K.z-H>rt||K.z+H<ot))for(var st=this.result,at=J;$>at;at++)for(var lt=et;nt>lt;lt++){var ut=st.length;if(A.getConvexTrianglePillar(at,lt,!1),z.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.sphereConvex(v,A.pillarConvex,E,Z,B,O,M,W),A.getConvexTrianglePillar(at,lt,!0),z.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.sphereConvex(v,A.pillarConvex,E,Z,B,O,M,W),st.length-ut>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(v,A){function n(){M.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new R,this.broadphase=new et,this.bodies=[],this.solver=new O,this.constraints=[],this.narrowphase=new z(this),this.collisionMatrix=new W,this.collisionMatrixPrevious=new W,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new Z,this.defaultMaterial=new V("default"),this.defaultContactMaterial=new H(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}A.exports=n;var E=v("../shapes/Shape"),R=v("../math/Vec3"),B=v("../math/Quaternion"),O=v("../solver/GSSolver"),z=(v("../utils/Vec3Pool"),v("../equations/ContactEquation"),v("../equations/FrictionEquation"),v("./Narrowphase")),M=v("../utils/EventTarget"),W=v("../collision/ArrayCollisionMatrix"),V=v("../material/Material"),H=v("../material/ContactMaterial"),Q=v("../objects/Body"),Z=v("../utils/TupleDictionary"),K=v("../collision/RaycastResult"),J=v("../collision/AABB"),$=v("../collision/Ray"),et=v("../collision/NaiveBroadphase");n.prototype=new M;var nt=(new J,new $);if(n.prototype.getContactMaterial=function(v,A){return this.contactMaterialTable.get(v.id,A.id)},n.prototype.numObjects=function(){return this.bodies.length},n.prototype.collisionMatrixTick=function(){var v=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=v,this.collisionMatrix.reset()},n.prototype.add=n.prototype.addBody=function(v){-1===this.bodies.indexOf(v)&&(v.index=this.bodies.length,this.bodies.push(v),v.world=this,v.initPosition.copy(v.position),v.initVelocity.copy(v.velocity),v.timeLastSleepy=this.time,v instanceof Q&&(v.initAngularVelocity.copy(v.angularVelocity),v.initQuaternion.copy(v.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=v,this.dispatchEvent(this.addBodyEvent))},n.prototype.addConstraint=function(v){this.constraints.push(v)},n.prototype.removeConstraint=function(v){var A=this.constraints.indexOf(v);-1!==A&&this.constraints.splice(A,1)},n.prototype.rayTest=function(v,A,E){E instanceof K?this.raycastClosest(v,A,{skipBackfaces:!0},E):this.raycastAll(v,A,{skipBackfaces:!0},E)},n.prototype.raycastAll=function(v,A,E,R){return E.mode=$.ALL,E.from=v,E.to=A,E.callback=R,nt.intersectWorld(this,E)},n.prototype.raycastAny=function(v,A,E,R){return E.mode=$.ANY,E.from=v,E.to=A,E.result=R,nt.intersectWorld(this,E)},n.prototype.raycastClosest=function(v,A,E,R){return E.mode=$.CLOSEST,E.from=v,E.to=A,E.result=R,nt.intersectWorld(this,E)},n.prototype.remove=function(v){v.world=null;var A=this.bodies.length-1,E=this.bodies,R=E.indexOf(v);if(-1!==R){E.splice(R,1);for(var B=0;B!==E.length;B++)E[B].index=B;this.collisionMatrix.setNumObjects(A),this.removeBodyEvent.body=v,this.dispatchEvent(this.removeBodyEvent)}},n.prototype.removeBody=n.prototype.remove,n.prototype.addMaterial=function(v){this.materials.push(v)},n.prototype.addContactMaterial=function(v){this.contactmaterials.push(v),this.contactMaterialTable.set(v.materials[0].id,v.materials[1].id,v)},"undefined"==typeof performance&&(performance={}),!performance.now){var it=Date.now();performance.timing&&performance.timing.navigationStart&&(it=performance.timing.navigationStart),performance.now=function(){return Date.now()-it}}var ot=new R;n.prototype.step=function(v,A,E){if(E=E||10,0===(A=A||0))this.internalStep(v),this.time+=v;else{var R=Math.floor((this.time+A)/v)-Math.floor(this.time/v);R=Math.min(R,E);for(var B=performance.now(),O=0;O!==R&&(this.internalStep(v),!(performance.now()-B>1e3*v));O++);this.time+=A;for(var z=this.time%v/v,M=ot,W=this.bodies,V=0;V!==W.length;V++){var H=W[V];H.type!==Q.STATIC&&H.sleepState!==Q.SLEEPING?(H.position.vsub(H.previousPosition,M),M.scale(z,M),H.position.vadd(M,H.interpolatedPosition)):(H.interpolatedPosition.copy(H.position),H.interpolatedQuaternion.copy(H.quaternion))}}};var rt={type:"postStep"},st={type:"preStep"},at={type:"collide",body:null,contact:null},lt=[],ut=[],ht=[],ct=[],pt=(new R,new R,new R,new R,new R,new R,new R,new R,new R,new B,new B),dt=new B,ft=new R;n.prototype.internalStep=function(v){this.dt=v;var A,R=this.contacts,B=ht,O=ct,z=this.numObjects(),M=this.bodies,W=this.solver,V=this.gravity,H=this.doProfiling,Z=this.profile,K=Q.DYNAMIC,J=this.constraints,$=ut,et=(V.norm(),V.x),nt=V.y,it=V.z,ot=0;for(H&&(A=performance.now()),ot=0;ot!==z;ot++)if((_t=M[ot]).type&K){var yt=_t.force,gt=_t.mass;yt.x+=gt*et,yt.y+=gt*nt,yt.z+=gt*it}ot=0;for(var vt=this.subsystems.length;ot!==vt;ot++)this.subsystems[ot].update();H&&(A=performance.now()),B.length=0,O.length=0,this.broadphase.collisionPairs(this,B,O),H&&(Z.broadphase=performance.now()-A);var bt=J.length;for(ot=0;ot!==bt;ot++)if(!(Rt=J[ot]).collideConnected)for(var wt=B.length-1;wt>=0;wt-=1)(Rt.bodyA===B[wt]&&Rt.bodyB===O[wt]||Rt.bodyB===B[wt]&&Rt.bodyA===O[wt])&&(B.splice(wt,1),O.splice(wt,1));this.collisionMatrixTick(),H&&(A=performance.now());var xt=lt,Tt=R.length;for(ot=0;ot!==Tt;ot++)xt.push(R[ot]);R.length=0;var At=this.frictionEquations.length;for(ot=0;ot!==At;ot++)$.push(this.frictionEquations[ot]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(B,O,this,R,xt,this.frictionEquations,$),H&&(Z.narrowphase=performance.now()-A),H&&(A=performance.now()),ot=0;ot<this.frictionEquations.length;ot++)W.addEquation(this.frictionEquations[ot]);for(var St=R.length,Ct=0;Ct!==St;Ct++){var _t=(Rt=R[Ct]).bi,It=Rt.bj;Rt.si,Rt.sj,(_t.material&&It.material&&this.getContactMaterial(_t.material,It.material)||this.defaultContactMaterial).friction,_t.material&&It.material&&(_t.material.friction>=0&&It.material.friction>=0&&(_t.material.friction,It.material.friction),_t.material.restitution>=0&&It.material.restitution>=0&&(Rt.restitution=_t.material.restitution*It.material.restitution)),W.addEquation(Rt),_t.allowSleep&&_t.type===Q.DYNAMIC&&_t.sleepState===Q.SLEEPING&&It.sleepState===Q.AWAKE&&It.type!==Q.STATIC&&It.velocity.norm2()+It.angularVelocity.norm2()>=2*Math.pow(It.sleepSpeedLimit,2)&&(_t._wakeUpAfterNarrowphase=!0),It.allowSleep&&It.type===Q.DYNAMIC&&It.sleepState===Q.SLEEPING&&_t.sleepState===Q.AWAKE&&_t.type!==Q.STATIC&&_t.velocity.norm2()+_t.angularVelocity.norm2()>=2*Math.pow(_t.sleepSpeedLimit,2)&&(It._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(_t,It,!0),this.collisionMatrixPrevious.get(_t,It)||(at.body=It,at.contact=Rt,_t.dispatchEvent(at),at.body=_t,It.dispatchEvent(at))}for(H&&(Z.makeContactConstraints=performance.now()-A,A=performance.now()),ot=0;ot!==z;ot++)(_t=M[ot])._wakeUpAfterNarrowphase&&(_t.wakeUp(),_t._wakeUpAfterNarrowphase=!1);for(bt=J.length,ot=0;ot!==bt;ot++){var Rt;(Rt=J[ot]).update(),wt=0;for(var Pt=Rt.equations.length;wt!==Pt;wt++){var Bt=Rt.equations[wt];W.addEquation(Bt)}}W.solve(v,this),H&&(Z.solve=performance.now()-A),W.removeAllEquations();var Ot=Math.pow;for(ot=0;ot!==z;ot++)if((_t=M[ot]).type&K){var zt=Ot(1-_t.linearDamping,v),Nt=_t.velocity;Nt.mult(zt,Nt);var Lt=_t.angularVelocity;if(Lt){var Ft=Ot(1-_t.angularDamping,v);Lt.mult(Ft,Lt)}}for(this.dispatchEvent(st),ot=0;ot!==z;ot++)(_t=M[ot]).preStep&&_t.preStep.call(_t);H&&(A=performance.now());var kt=pt,Wt=dt,qt=this.stepnumber,Vt=Q.DYNAMIC|Q.KINEMATIC,Ut=qt%(this.quatNormalizeSkip+1)==0,Ht=this.quatNormalizeFast,Gt=.5*v;for(E.types.PLANE,E.types.CONVEXPOLYHEDRON,ot=0;ot!==z;ot++){var Yt=M[ot],Qt=Yt.force,Zt=Yt.torque;if(Yt.type&Vt&&Yt.sleepState!==Q.SLEEPING){var Kt=Yt.velocity,Jt=Yt.angularVelocity,$t=Yt.position,ee=Yt.quaternion,ne=Yt.invMass,ie=Yt.invInertiaWorld;Kt.x+=Qt.x*ne*v,Kt.y+=Qt.y*ne*v,Kt.z+=Qt.z*ne*v,Yt.angularVelocity&&(ie.vmult(Zt,ft),ft.mult(v,ft),ft.vadd(Jt,Jt)),$t.x+=Kt.x*v,$t.y+=Kt.y*v,$t.z+=Kt.z*v,Yt.angularVelocity&&(kt.set(Jt.x,Jt.y,Jt.z,0),kt.mult(ee,Wt),ee.x+=Gt*Wt.x,ee.y+=Gt*Wt.y,ee.z+=Gt*Wt.z,ee.w+=Gt*Wt.w,Ut&&(Ht?ee.normalizeFast():ee.normalize())),Yt.aabb&&(Yt.aabbNeedsUpdate=!0),Yt.updateInertiaWorld&&Yt.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,H&&(Z.integrate=performance.now()-A),this.time+=v,this.stepnumber+=1,this.dispatchEvent(rt),ot=0;ot!==z;ot++){var oe=(_t=M[ot]).postStep;oe&&oe.call(_t)}if(this.allowSleep)for(ot=0;ot!==z;ot++)M[ot].sleepTick(this.time)},n.prototype.clearForces=function(){for(var v=this.bodies,A=v.length,E=0;E!==A;E++){var R=v[E];R.force,R.torque,R.force.set(0,0,0),R.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)}));var nftCenter=new Entity;nftCenter.addComponent(new Transform({position:new Vector3(80,0,80),scale:new Vector3(.88,1,.88)})),nftCenter.addComponent(new GLTFShape("models/Community_Center.glb")),engine.addEntity(nftCenter);